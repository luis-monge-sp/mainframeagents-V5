         TITLE 'CDT TABLE SERVICE ROUTINE'                              00000100
****************************************************************        00000200
****                                                        ****        00000300
****     CONTROL-SA  RELEASE .....                          ****        00000400
****                                                        ****        00000500
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00000600
****                                                        ****        00000700
****************************************************************        00000800
*                                                                       00000900
****************************************************************        00001000
*                                                              *        00001100
* TITLE            : CTSFCDT                                   *        00001200
*                                                              *        00001300
* FILE NAME        : CTSFCDT                                   *        00001400
*                                                              *        00001500
* AUTHOR           : ALEXANDER SHVARTSMAN                      *        00001600
*                                                              *        00001700
* CREATION DATE    : 28/12/97                                  *        00001800
*                                                              *        00001900
* DESCRIPTION      : CDT TABLE ACCESS ROUTINE                  *        00002000
*                                                              *        00002100
* ASSUMPTIONS AND                                              *        00002200
*   CONSIDERATIONS : CALLER MUST BE APF AUTHORIZED             *        00002300
*                                                              *        00002400
****************************************************************        00002500
****************************************************************        00002600
* MOD.ID   WHO      WHEN      DESCRIPTION                      *        00002700
* -------- -------- --------- -------------------------------- *        00002800
* IS10071  AVNERL   07FEB2012 SUPPORT DYNAMIC CDTS             *        00002904
* BS10130  NURITY   11JAN2024 FIX THE DYNAMIC CDT SUPPORT.     *        00003004
* IS10188  AVNERL   06OCT2024 MOVE OUR MODULES ABOVE 16M LINE  *        00003109
****************************************************************        00003200
*        PARAMETER LIST DSECT                                           00003300
****************************************************************        00003400
*                                                                       00003500
PARMLIST DSECT                                                          00003600
AOPTION  DS    A                       OPTION CODE :                    00003700
*                                          GET-ENTRIES-NUMBER           00003800
*                                          GET-ENTRIES                  00003900
*                                          GET-ENTRY-INFO               00004000
*                                          CHK-ENTRY-INFO               00004100
ADEBUG   DS    A                       DEBUG LEVEL                      00004200
PRMSPEC  EQU   *                                                        00004300
*                                                                       00004400
*        GET-ENTRIES-NUMBER                                             00004500
*                                                                       00004600
         ORG   PRMSPEC                                                  00004700
AENMB    DS    A                       ENTRIES NUMBER  - OUT            00004800
         ORG   ,                                                        00004900
*                                                                       00005000
*        GET-ENTRIES                                                    00005100
*                                                                       00005200
         ORG   PRMSPEC                                                  00005300
AEAREA   DS    A                       ENTRIES AREA.EACH ELMNT 8 BYTES  00005400
         ORG   ,                                                        00005500
*                                                                       00005600
*        GET-ENTRY-INFO                                                 00005700
*                                                                       00005800
         ORG   PRMSPEC                                                  00005900
AENTRY   DS    A                       ENTRY NAME        -  IN          00006000
AOUT     DS    A                       EXTRACT AREA ADDR -  OUT         00006100
         ORG   ,                                                        00006200
*                                                                       00006300
*        CHK-ENTRY-INFO                                                 00006400
*                                                                       00006500
         ORG   PRMSPEC                                                  00006600
ACENTRY  DS    A                       ENTRY FOR CHECKING               00006700
         ORG   ,                                                        00006800
*                                                                       00006900
****************************************************************        00007000
*        INITIALIZE                                                     00007100
****************************************************************        00007200
*                                                                       00007300
CTSFCDT  CSECT                                                          00007400
CTSFCDT  AMODE 31                                                       00007500
*IS10188 CTSFCDT  RMODE 24       (FOR CTSADBG)                          00007609
CTSFCDT  RMODE ANY                                              IS10188 00007710
*        PRINT NOGEN                                                    00007809
         BEGIN *,R12                                                    00007909
         CTSEQUR                                                        00008009
         CTSLEVEL                                                       00008109
         LR    R10,R1                                                   00008209
         USING PARMLIST,R10            ADDRESABILITY PARAMETERS         00008309
*                                                                       00008409
*        SET DEBUG LEVEL                                                00008509
*                                                                       00008609
         L     R2,ADEBUG               R2 -> DEBUG LEVEL (4 BYTES)      00008709
         XC    DEBUGL,DEBUGL           STORE DEBUG LEVEL                00008809
         XC    DEBUG,DEBUG             STORE DEBUG LEVEL                00008909
         ICM   R2,15,0(R2)             DEBUG LEVEL                      00009009
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00009109
         STC   R2,DEBUGL               STORE DEBUG LEVEL (1 BYTE)       00009209
         ST    R2,DEBUG                STORE DEBUG LEVEL (1 WORD)       00009309
NODEBUG  DS    0H                                                       00009409
         CTSADBG 'ENTERING',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=RAREA        00009509
         XC    RETCODE,RETCODE         SET RETURN CODE                  00009609
*                                                                       00009709
         L     R2,AOPTION              OPTION CODE                      00009809
         MVC   OPTCDE(20),0(R2)        MOVE OPTION CODE                 00009909
         TR    OPTCDE(20),TAB          CONVERT OPTION TO UPPERCASE      00010009
*                                                                       00010109
         CTSADBG 'OPTION=_',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=RAREA,      100010209
               (OPTCDE,20)                                              00010309
*                                                                       00010409
*        VERIFY RACF RUNNING STATUS                                     00010509
*                                                                       00010609
         L     R2,CVTPTR               LOAD ADDR CVT                    00010709
         USING CVT,R2                  ADDRESSABILITY CVT DSECT         00010809
         L     R3,CVTRAC               LOAD ADDR CVT RACF               00010909
         LTR   R3,R3                   ADDR SUPPLIED ?                  00011009
         BZ    RET16                   NO, RACF 'DOWN'                  00011109
*                                                                       00011209
         USING RCVT,R3                 ADDRESSABILITY CVT RACF DSECT    00011309
*                                                                       00011409
         CTSADBG 'RCVTID=_ RELEASE=_',                                 100011509
               (RCVTID,4,RCVTVRMN,4),                                  200011609
               LEVEL=(DEBUGL,1,2,3,4,5),RAREA=RAREA                     00011709
*                                                                       00011809
*        BLOCK ID CHECKING: SHOULD BE 'RCVT'                            00011909
*                                                                       00012009
         CLC   =CL4'RCVT',RCVTID       CHECK BLOCK ID                   00012109
         BNE   RET16                   INVALID BLOCK ID                 00012209
         TM    RCVTSTAT,RCVTRNA        RACF ACTIVE ?                    00012309
         BO    RET16                   NO                               00012409
         TM    RCVTFLGS,RCVTROFF       RACF ACTIVE ?                    00012509
         BO    RET16                   NO                               00012609
*                                                                       00012709
*IS10071                                                                00012809
*IS10071 L     R5,RCVTCDTP             PTR TO CLASS DESC TABLE          00012909
*IS10071 LTR   R5,R5                   PTR = 0 ?                        00013009
*IS10071 BZ    RET4                    CDT TABLE DOES NOT EXIST         00013109
*                                                                       00013209
*** PREPARE DATA AREAS FOR RACROUTE REQUEST=STAT ***            IS10071 00013309
         MVC   CLASSNM,BLANKS                                   IS10071 00013409
         LA    R4,COPYAREA                                      IS10071 00013509
         USING CNST,R4                                          IS10071 00013609
*BS10130 LA    R5,COPYCNSX                                      IS10071 00013709
*BS10130 USING CNSX,R5                                          IS10071 00013809
         LA    R0,COPYAREA                                      IS10071 00013909
         LA    R1,COPYLEN                                       IS10071 00014009
         SLR   R15,R15                                          IS10071 00014109
         MVCL  R0,R14               CLEAR RETURN AREA FOR CDT   IS10071 00014209
*                                                                       00014309
*        OPTION CODE ROUTER                                             00014409
*                                                                       00014509
         CLC   OPTCDE(20),=CL20'GET-ENTRIES-NUMBER'                     00014609
         BE    GCDT1                                                    00014709
         CLC   OPTCDE(20),=CL20'GET-ENTRIES'                            00014809
         BE    GCDT2                                                    00014909
         CLC   OPTCDE(20),=CL20'GET-ENTRY-INFO'                         00015009
         BE    GCDT3                                                    00015109
         CLC   OPTCDE(20),=CL20'CHK-ENTRY-INFO'                         00015209
         BE    GCDT4                                                    00015309
         B     RET8                                                     00015409
*                                                                       00015509
*--------------------------------------------------------------         00015609
*        GET-ENTRIES-NUMBER                                             00015709
*--------------------------------------------------------------         00015809
*                                                                       00015909
GCDT1    DS    0H                                                       00016009
         SR    R8,R8                   ENTRIES COUNTER                  00016109
*IS10071 USING CDT19,R5                                                 00016209
LOOP     EQU   *                                                IS10071 00016309
* ISSUE  RACROUTE REQUEST=STAT TO GET NEXT CLASS.               IS10071 00016409
         RACROUTE REQUEST=STAT,COPY=COPYAREA,COPYLEN=COPYLEN,   IS10071X00016509
               NEXT=CLASSNM,WORKA=RRWA,                         IS10071X00016609
               RELEASE=7709,MF=S                                IS10071 00016709
         LH    R11,CNSTLGT             HAVE WE REACHED THE END? IS10071 00016809
         LTR   R11,R11                                          IS10071 00016909
         BZ    GCDT1B                                           IS10071 00017009
* PROCESS EACH CLASS HERE. A COPY OF THE CDT ENTRY IS IN COPYAREA,10026 00017109
* AND THE CLASS NAME IS ALSO IN CLASSNM.                        IS10071 00017209
***      B     LOOP                                             IS10071 00017309
***                                                                     00017409
GCDT1A   DS    0H                                                       00017509
         LA    R8,1(R8)                CDT COUNTER                      00017609
         B     LOOP                                             IS10071 00017709
*                                                                       00017809
*IS10071 CTSADBG '#._',(?R8,CDT19CLS,8),                               X00017909
               LEVEL=(DEBUGL,8),RAREA=RAREA                             00018009
         CTSADBG '#._',(?R8,CLASSNM,8),                         IS10071X00018109
               LEVEL=(DEBUGL,6,7,8),RAREA=RAREA                         00018209
*                                                                       00018309
*        GET NEXT ENTRY FROM CDT                                        00018409
*                                                                       00018509
*IS10071                                                                00018609
*IS10071 SR    R4,R4                                                    00018709
*IS10071 ICM   R4,X'3',CDT19LN         LOAD CDTLEN                      00018809
*IS10071 LTR   R4,R4                   END-OF-CDT-TABLE                 00018909
*IS10071 BZ    GCDT1B                  RETURN                           00019009
*IS10071 AR    R5,R4                   INCR ADDR OF CDT TABLE           00019109
*IS10071 SR    R4,R4                   CHECK NEXT ENTRY LENGTH          00019209
*IS10071 ICM   R4,X'3',CDT19LN         LOAD CDTLEN                      00019309
*IS10071 LTR   R4,R4                   END-OF-CDT-TABLE                 00019409
*IS10071 BZ    GCDT1B                  RETURN                           00019509
*IS10071 B     GCDT1A                  LOOP                             00019609
GCDT1B   DS    0H                                                       00019709
         L     R4,AENMB                ENTRIES NUMBER  - OUT            00019809
         ST    R8,0(R4)                SAVE ENTRIES NUMBER              00019909
*                                                                       00020009
         CTSADBG 'DETECTED # ENTRIES',(?R8),                           X00020109
               LEVEL=(DEBUGL,4,5,6,7),RAREA=RAREA                       00020209
*                                                                       00020309
         B     RET0                                                     00020409
*                                                                       00020509
*--------------------------------------------------------------         00020609
*        GET-ENTRIES                                                    00020709
*--------------------------------------------------------------         00020809
*                                                                       00020909
GCDT2    DS    0H                                                       00021009
         SR    R8,R8                   ENTRIES COUNTER                  00021109
         L     R6,AEAREA               ENTRIES AREA.EACH ELMNT 8 BYTES  00021209
*                                                                       00021309
         CTSADBG 'E.ADDR=~',LEVEL=(DEBUGL,4,5,6,7),RAREA=RAREA,(?R6)    00021409
*                                                                       00021509
LOOP2    EQU   *                                                IS10071 00021609
* ISSUE  RACROUTE REQUEST=STAT TO GET NEXT CLASS.               IS10071 00021709
         RACROUTE REQUEST=STAT,COPY=COPYAREA,COPYLEN=COPYLEN,   IS10071X00021809
               NEXT=CLASSNM,WORKA=RRWA,                         IS10071X00021909
               RELEASE=7709,MF=S                                IS10071 00022009
         LH    R11,CNSTLGT             HAVE WE REACHED THE END? IS10071 00022109
         LTR   R11,R11                 YES                      IS10071 00022209
         BZ    GCDT2B                       LEAVE LOOP          IS10071 00022309
*IS10071 USING CDT19,R5                                                 00022409
GCDT2A   DS    0H                      NO                               00022509
         LA    R8,1(R8)                   ADVANCE CDT COUNTER           00022609
*                                                                       00022709
*IS10071 CTSADBG '#._ AT=~',(?R8,CDT19CLS,8,?R6),                       00022809
         CTSADBG '#._ AT=~',(?R8,CLASSNM,8,?R6),  ???VERIFY??? IS10071 X00022909
               LEVEL=(DEBUGL,6,7,8),RAREA=RAREA                         00023009
*IS10071 MVC   0(8,R6),CDT19CLS        RETURN CDT CLASS                 00023109
         MVC   0(8,R6),CLASSNM         RETURN CDT CLASS NAME   IS10071  00023209
         LA    R6,8(R6)                ADVANCE PTR OF OUTPUT            00023309
         B     LOOP2                   CONTINUE IN LOOP         IS10071 00023409
*                                                                       00023509
*        GET NEXT ENTRY FROM CDT                                        00023609
*                                                                       00023709
*IS10071                                                                00023809
*IS10071 SR    R4,R4                                                    00023909
*IS10071 ICM   R4,X'3',CDT19LN         LOAD CDTLEN                      00024009
*IS10071 LTR   R4,R4                   END-OF-CDT-TABLE                 00024109
*IS10071 BZ    GCDT2B                  RETURN                           00024209
*IS10071 AR    R5,R4                   INCR ADDR OF CDT TABLE           00024309
*IS10071 SR    R4,R4                   CHECK NEXT ENTRY LENGTH          00024409
*IS10071 ICM   R4,X'3',CDT19LN         LOAD CDTLEN                      00024509
*IS10071 LTR   R4,R4                   END-OF-CDT-TABLE                 00024609
*IS10071 BZ    GCDT2B                  RETURN                           00024709
*IS10071 B     GCDT2A                  LOOP                             00024809
GCDT2B   DS    0H                                                       00024909
*                                                                       00025009
         CTSADBG 'RETURNED # ENTRIES',(?R8),                           X00025109
               LEVEL=(DEBUGL,4,5,6,7),RAREA=RAREA                       00025209
*                                                                       00025309
         B     RET0                                                     00025409
*                                                                       00025509
*--------------------------------------------------------------         00025609
*        GET-ENTRY-INFO                                                 00025709
*--------------------------------------------------------------         00025809
*                                                                       00025909
GCDT3    DS    0H                                                       00026009
         L     R2,AENTRY               ENTRY NAME        -  IN          00026109
         L     R3,AOUT                 EXTRACT AREA ADDR -  OUT         00026209
         ST    R3,AAREA                                                 00026309
*                                                                       00026409
         CTSADBG 'ENTRY=_ EXTRACT.AREA=~/$/$',                         100026509
               (0(R2),8,?R3,0(R3),4,4(R3),4),                          200026609
               LEVEL=(DEBUGL,4,5,6,7),RAREA=RAREA                       00026709
*                                                                       00026809
*        MOVE PARAMETERS TO TEST PROGRAM                                00026909
*                                                                       00027009
*IS10071 L     R4,TSTCDT                                                00027109
         L     R1,TSTCDT                                        IS10071 00027209
*IS10071 USING TESTCDT,R4              TEST ROUTINE                     00027309
*IS10071 MVC   DBGCDT(1),DEBUGL        DEBUG LEVEL                      00027409
         MVC   DBGCDT-TESTCDT(1,R1),DEBUGL        DEBUG LEVEL   IS10071 00027509
*IS10071 DROP  R4                                                       00027609
*                                                                       00027709
*        CALL TO GENERAL EXTRACTOR                                      00027809
*                                                                       00027909
         MVC   ENTRY12(8),0(R2)        MOVE ENTRY NAME TO EXTRACTOR     00028009
GETGB    CTSFAGR LOCATE,                                               100028109
               TYPE='GEN',OUTEP=OUTP,OUTAREA=AAREA,                    200028209
               ENTRY=ENTRY1,RC=RETCODEF,CLASS=CLASS,GETPRG=CTSFRXT,    300028309
               DEBUG=DEBUG,TEST=TSTCDT,DATAMAP=EXT,                    400028409
               (TXTL='CDT.CLASS',TXTR='0',REPEAT=YES),                 500028509
               ($UACC,E,X,TXTL='CDT.UACC',TXTR='1',TRN=TUACC),         *00028609
               ($UACC,E,C,TXTL='CDT.UACC',TXTR='1'),                   *00028709
               ($FIRST,E,X,TXTL='CDT.FIRST',TXTR='2',TRN=TFIRST),      *00028809
               ($GROUP,E,C,TXTL='CDT.GROUP_CLASS_REF',TXTR='3'),       *00028900
               ($MEMBER,E,C,TXTL='CDT.MEMBER_CLASS_REF',TXTR='4'),     *00029000
               ($MAXLNTH,E,X,TXTL='CDT.MAXLNTH',TXTR='5'),             *00029100
               ($OTHER,E,X,TXTL='CDT.OTHER',TXTR='6',TRN=TOTHER),      *00029200
               ($POSIT,E,X,TXTL='CDT.POSIT',TXTR='7'),                 *00029300
               ($ATTR1,E,X,TXTL='CDT.ATTR',TXTR='8',TRN=TATTR1),       *00029400
               ($ATTR2,E,X,TXTL='CDT.ATTR',TXTR='8',TRN=TATTR2)         00029500
*                                                                       00029700
         B     RET0                                                     00029800
*                                                                       00029900
*--------------------------------------------------------------         00030000
*        CHK-ENTRY-INFO                                                 00030100
*--------------------------------------------------------------         00030200
*                                                                       00030300
GCDT4    DS    0H                                                       00030400
         L     R2,ACENTRY              ENTRY NAME        -  IN          00030500
*                                                                       00030700
         CTSADBG 'ENTRY=_',(0(R2),8),                                  100030800
               LEVEL=(DEBUGL,4,5,6,7),RAREA=RAREA                       00030900
         MVC   CLASSNM(8),0(R2)                                BS10130  00031001
*                                                                       00031100
*        LOCATE REQUIRED RESOURCE CLASS                                 00031200
*                                                                       00031300
*IS10071 L     R6,CVTPTR               LOAD ADDR CVT                    00031400
*IS10071 USING CVT,R6                  ADDRESSABILITY CVT DSECT         00031500
*IS10071 L     R7,CVTRAC               LOAD ADDR CVT RACF               00031600
*IS10071 USING RCVT,R7                 ADDRESSABILITY CVT RACF DSECT    00031700
*                                                                       00031800
*IS10071 CTSADBG 'RCVTID=_ RELEASE=_',(RCVTID,4,RCVTVRMN,4),           100031900
               LEVEL=(DEBUGL,4,5,6,7)                                   00032000
*                                                                       00032100
*IS10071 L     R8,RCVTCDTP             PTR TO CLASS DESC TABLE          00032200
*IS10071 LTR   R8,R8                   PTR = 0 ?                        00032300
*IS10071 BZ    RET4                    CDT TABLE DOES NOT EXIST         00032400
*                                                                       00032500
*IS10071                                                                00032600
*IS10071 DROP  R6                                                       00032700
*IS10071 DROP  R7                                                       00032800
*BS10130 SR    R9,R9                   CDT CLASS COUNTER                00032901
*                                                                       00033000
*IS10071 USING CDT19,R8                                                 00033100
*BS10130 GCDT4A   DS    0H                                              00033201
* ISSUE RACROUTE REQUEST=STAT TO GET NEXT CLASS.                IS10071 00033300
*BS10130 RACROUTE REQUEST=STAT,COPY=COPYAREA,COPYLEN=COPYLEN,   IS10071X00033401
               NEXT=CLASSNM,WORKA=RRWA,                         IS10071X00033501
               RELEASE=7709,MF=S                                IS10071 00033601
*BS10130 LH    R11,CNSTLGT             HAVE WE REACHED THE END? IS10071 00033701
*BS10130 LTR   R11,R11                 YES                      IS10071 00033801
*BS10130 BZ    RET20                        LEAVE LOOP          IS10071 00033901
*BS10130 LA    R9,1(R9)                CDT CLASS COUNTER                00034001
*                                                                       00034100
*IS10071 CTSADBG '~.#._ LOOKING FOR=_',(?R8,?R9,CDT19CLS,8,0(R2),8),    00034200
*BS10130 CTSADBG '~.#._ LOOKING FOR=_',(?R8,?R9,CLASSNM,8,0(R2),8),    X00034301
               LEVEL=(DEBUGL,6,7,8)                                     00034400
*                                                                       00034500
*IS10071 CLC   0(8,R2),CDT19CLS        REQUIRED CDT CLASS ?             00034600
*BS10130 CLC   0(8,R2),CLASSNM         REQUIRED CDT CLASS ?     IS10071 00034701
*BS10130 BE    RET0                    CDT CLASS FOUND. RETURN          00034801
*BS10130 B     GCDT4A                  ...NOT FOUND==> LOOP     IS10071 00034901
*                                                                       00035001
         RACROUTE REQUEST=STAT,COPY=COPYAREA,COPYLEN=COPYLEN,  BS10130 X00035102
               CLASS=CLASSNM,WORKA=RRWA,                       BS10130 X00035201
               RELEASE=7709,MF=(E,CCDTRR)                      BS10130  00035302
SAFPC    USING SAFP,CCDTRR                                     BS10130  00035402
         CTSADBG 'RACROUTE LOCATE FOR _:  R15 = #  RC/RS = ~/~', 10130 X00035502
               (CLASSNM,8,?R15,SAFPC.SAFPRRET,SAFPC.SAFPRREA), BS10130 X00035601
               LEVEL=(DEBUGL,6,7,8)                            BS10130  00035701
         DROP  SAFPC                                           BS10130  00035801
         LH    R1,CNSTLGT              R1 = CDT LENGTH.        BS10130  00036001
         CHI   R1,0                    CDT WAS COPIED ?        BS10130  00036101
         BNE   RET0                    ..YES - OK.             BS10130  00036201
         B     RET20                   ..NO - NOT FOIUND.      IS10030  00036301
*                                                                       00036500
*        GET NEXT ENTRY FROM CDT                                        00036600
*                                                                       00036700
*IS10071 SR    R10,R10                                                  00036800
*IS10071 ICM   R10,X'3',CDT19LN        LOAD CDTLEN                      00036900
*IS10071 LTR   R10,R10                 END-OF-CDT-TABLE                 00037000
*IS10071 BZ    GCDT3B                  RETURN                           00037100
*IS10071 AR    R8,R10                  INCR ADDR OF CDT TABLE           00037200
*IS10071 SR    R10,R10                 CHECK NEXT ENTRY LENGTH          00037300
*IS10071 ICM   R10,X'3',CDT19LN        LOAD CDTLEN                      00037400
*IS10071 LTR   R10,R10                 END-OF-CDT-TABLE                 00037500
*IS10071 BZ    RET20                   CLASS NOT FOUND RETURN           00037600
*IS10071 B     GCDT4A                  LOOP                             00037700
*                                                                       00037800
*------------------------------------------------------------           00037900
*        SET RETURN CODE                                                00038000
*------------------------------------------------------------           00038100
RET0     DS    0H                      O.K                              00038200
         LA    R15,0                                                    00038300
         B     EXIT                                                     00038400
RET4     DS    0H                      CDT TABLE DOES NOT EXIST         00038500
         LA    R15,4                                                    00038600
         B     EXIT                                                     00038700
RET8     DS    0H                      INVALID OPTION CODE              00038800
         LA    R15,8                                                    00038900
         B     EXIT                                                     00039000
RET16    DS    0H                      RACF 'DOWN'                      00039100
         LA    R15,16                                                   00039200
         B     EXIT                                                     00039300
RET20    DS    0H                      ENTRY DOES NOT EXIST             00039400
         LA    R15,20                  FOR CHECK ENTRY MODE             00039500
         B     EXIT                                                     00039600
*                                                                       00039700
EXIT     DS    0H                                                       00039800
         CTSADBG 'EXITING WITH RC=~',(?R15),RAREA=RAREA,               100039900
               LEVEL=(DEBUGL,3,4,5,6,7)                                 00040000
         BRTRN (15)                                                     00040100
         DROP  ,                                               BS10130  00040201
*                                                                       00040300
         LTORG                                                          00040400
*                                                                       00040500
********************************************************************    00040600
*       W O R K  A R E A  A N D   C O N S T A N T S                     00040700
********************************************************************    00040800
*                                                                       00040900
RAREA    DS    32D                     DIAG WORK AREA                   00041000
AAREA    DS    A                       EXTRACT AREA ADDR                00041100
RETCODE  DS    F                       RETURN CODE                      00041200
RETCODEF DS    3F                      RACF RC                          00041300
DEBUG    DS    F                       DEBUG LEVEL                      00041400
DEBUGL   DS    CL1                     DEBUG LEVEL                      00041500
OPTCDE   DS    CL20                    OPTION CODE                      00041600
ENTRY1   DS    0H                      ENTRY NAME                       00041700
ENTRY11  DC    AL1(8)                                                   00041800
ENTRY12  DC    CL10' '                                                  00041900
OUTP     DC    A(DUMMYC)               EXTERNAL OUTPUT ROUTINE          00042000
CTSFRXT  DC    V(CTSFRXT)              EXTRACTOR NAME                   00042100
TSTCDT   DC    A(TESTCDT)              TEST ROUTINE                     00042200
CLASS    DC    CL8' '          CLASS NAME FOR CTSFAGR                   00042301
CLASSNM  DS    CL8             NAME OF CLASS FROM REQUEST=STAT  IS10071 00042400
BLANKS   DC    CL8'        '                                    IS10071 00042500
*                                                                       00042605
         DS    0D                                              BS10130  00042705
COPYAREA DS    CL(CNSTCBLN)    AREA FOR CNST PORTION            IS10071 00042800
*BS10130 COPYCNSX DS    CL(CNSXCBLN)    AREA FOR CNSX PORTION   IS10071 00042905
         DS    0D,CL(CNSXCBLN)    AREA FOR CNSX PORTION         BS10130 00043007
COPYLEN  EQU   *-COPYAREA      LENGTH OF CDT ENTRY              IS10071 00043105
*                                                                       00043305
CCDTRR   RACROUTE REQUEST=STAT,COPY=,COPYLEN,CLASS=,           BS10130 X00043405
               RELEASE=7709,MF=L                               BS10130  00043505
*                                                                       00043605
TAB      DC    256AL1(*-TAB)           TRANSLATE TABLE TO UPPERCASE     00043705
         ORG   TAB                                                      00043805
         DC    40C' '                                                   00043905
         ORG   TAB+C'A'-X'40'                                           00044005
         DC    C'ABCDEFGHI'                                             00044105
         ORG   TAB+C'J'-X'40'                                           00044205
         DC    C'JKLMNOPQR'                                             00044305
         ORG   TAB+C'S'-X'40'                                           00044405
         DC    C'STUVWXYZ'                                              00044505
         ORG   ,                                                        00044605
*                                                                       00044705
RRWA     DS    CL512           RACROUTE WORK AREA               IS10071 00044805
*                                                                       00044905
* -------------------------------------------------------               00045005
*        TRANSLATE TABLE                                                00045105
* -------------------------------------------------------               00045205
*                                                                       00045305
TUACC    DC    XL1'FF'                 ACCESS TRANSLATE TABLE           00045405
         DC    B'10000000',AL1(5),CL5'ALTER'                            00045505
         DC    B'01000000',AL1(7),CL7'CONTROL'                          00045605
         DC    B'00100000',AL1(6),CL6'UPDATE'                           00045705
         DC    B'00010000',AL1(4),CL4'READ'                             00045805
         DC    B'00001000',AL1(1),CL1' '                                00045905
         DC    B'00000100',AL1(1),CL1' '                                00046005
         DC    B'00000010',AL1(1),CL1' '                                00046105
         DC    B'00000001',AL1(4),CL4'NONE'                             00046205
         DC    B'00000000'             END OF TABLE                     00046305
*                                                                       00046405
TFIRST   DC    AL1(1),B'11110000'                                       00046505
         DC    AL1(3),CL3'ANY'                                          00046605
         DC    AL1(1),B'11100000'                                       00046705
         DC    AL1(8),CL8'ALPHANUM'                                     00046805
         DC    AL1(1),B'11000000'                                       00046905
         DC    AL1(5),CL5'ALPHA'                                        00047005
         DC    AL1(1),B'10000000'                                       00047105
         DC    AL1(8),CL8'NONATABC'                                     00047205
         DC    AL1(1),B'10100000'                                       00047305
         DC    AL1(8),CL8'NONATNUM'                                     00047405
         DC    AL1(1),B'00100000'                                       00047505
         DC    AL1(7),CL7'NUMERIC'                                      00047605
         DC    AL1(0)                  END OF TABLE                     00047705
*                                                                       00047805
TOTHER   DC    AL1(1),B'11110000'                                       00047905
         DC    AL1(3),CL3'ANY'                                          00048005
         DC    AL1(1),B'11100000'                                       00048105
         DC    AL1(8),CL8'ALPHANUM'                                     00048205
         DC    AL1(1),B'11000000'                                       00048305
         DC    AL1(5),CL5'ALPHA'                                        00048405
         DC    AL1(1),B'10000000'                                       00048505
         DC    AL1(8),CL8'NONATABC'                                     00048605
         DC    AL1(1),B'10100000'                                       00048705
         DC    AL1(8),CL8'NONATNUM'                                     00048805
         DC    AL1(1),B'00100000'                                       00048905
         DC    AL1(7),CL7'NUMERIC'                                      00049005
         DC    AL1(0)                  END OF TABLE                     00049105
*                                                                       00049205
TATTR1   DC    XL1'FF'                 ATTR FIELD                       00049305
         DC    B'10000000',AL1(1),CL1' '                                00049405
         DC    B'01000000',AL1(1),CL1' '                                00049505
         DC    B'00100000',AL1(4),CL4'OPER'                             00049605
         DC    B'00010000',AL1(7),CL7'RACLIST'                          00049705
         DC    B'00001000',AL1(7),CL7'GENLIST'                          00049805
         DC    B'00000000'             END OF TABLE                     00049905
*                                                                       00050005
TATTR2   DC    XL1'FF'                 ATTR FIELD                       00050105
         DC    B'10000000',AL1(7),CL7'RACLREQ'                          00050205
         DC    B'01000000',AL1(9),CL9'NOPROFDEF'                        00050305
         DC    B'00100000',AL1(7),CL7'SLBLREQ'                          00050405
         DC    B'00010000',AL1(7),CL7'RVRSMAC'                          00050505
         DC    B'00000000'             END OF TABLE                     00050605
*                                                                       00050705
         DROP  ,                                                        00050805
*                                                                       00050905
*********************************************************************   00051005
*                                                                   *   00051105
* DUMMY EXTRACTOR OUTPUT ROUTINE                                    *   00051205
*                                                                   *   00051305
*********************************************************************   00051405
DUMMYC   DS   0H           DUMMY OUTPUT SECTION                         00051505
         BR   R14                                                       00051605
         DROP  ,                                                        00051705
*                                                                       00051805
*********************************************************************   00051905
*                                                                   *   00052005
* EXTRACTOR EXIT ROUTINE                                            *   00052105
*                                                                   *   00052205
*********************************************************************   00052305
*                                                                   *   00052405
* INPUT PARAMETERS :                                                *   00052505
* ------------------                                                *   00052605
*                                                                   *   00052705
*  1) TYPE OF CALL                                                  *   00052805
*        START  -  BEFORE REACORD READ FROM RACF DATABASE           *   00052905
*        ENTRY  -  AFTER  REECORD READ FROM RACF DATABASE           *   00053005
*        ELEMN  -  ELEMENTARY DATA FIELD                            *   00053105
*        LIST   -  LIST DATA FIELD                                  *   00053205
*        END    -  BEFORE RETURN FROM EXTRACTOR                     *   00053305
*                                                                   *   00053405
*  SEE PARMM DESCT BELOW FOR OPCODE DEPENDENT PARAMETERS LIST       *   00053505
*                                                                   *   00053605
* RETURN CODE ( R15 ) :                                             *   00053705
* ---------------------                                             *   00053805
*                                                                   *   00053905
*        TYPE OF ENTRY POINT                                        *   00054005
*        ENTRY  -  0 - CONTINUE, 4 - NEXT RECORD , 8 - END          *   00054105
*        ELEMN  -  0 - CONTINUE, 4 - NOT PUT AND CONTINUE ,8-END    *   00054205
*        LIST   -  0 - CONTINUE, 4 - NOT PUT AND CONTINUE           *   00054305
*                                                                   *   00054405
*********************************************************************   00054505
TESTCDT  BEGIN                                                          00054605
*                                                                       00054705
********************************************************************    00054805
*        CHECK ENTRY REASON                                             00054905
********************************************************************    00055005
*                                                                       00055105
         ST    R1,PARMADDR            KEEP PARMS ADDR           IS10071 00055205
         LR    R11,R1                 -> PARAMETERS             IS10071 00055305
*IS10071 USING PARMM,R1                                                 00055405
         USING PARMM,R11                                        IS10071 00055505
         L     R2,XPROPCD                                               00055605
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 00055705
         BE    LSTART                           RACF DATABASE           00055805
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      00055905
         BE    LEND                             EXTRACTOR               00056005
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               00056105
         BE    LLIST                                                    00056205
*BS10130   THE CODE BELOW WAS MOVED TO LENTRY BECAUSE IT                00056305
*BS10130   HAS TO BE DONE ONLY BEFORE RACROUTE IS CALLED.               00056405
*BS10130   IF DONE BEFORE JUMPING TO LELEMN IT CLEARS THE               00056505
*BS10130   CDT THAT CONTAINS THE DATA.                                  00056605
*** PREPARE DATA AREAS FOR RACROUTE REQUEST=STAT            *** IS10071 00056705
*** (THE ABOVE 3 ENTRY POINTS DO NOT NEED THESE DATA AREAS) *** IS10071 00056805
*BS10130 MVC   CLSSNM,BLNKS                                     IS10071 00056905
*BS10130 LA    R8,CPYAREA               R8 -> CNST              IS10071 00057005
*BS10130 USING CNST,R8                                          IS10071 00057105
*BS10130 LA    R5,CPYCNSX               AVAIL AT CNSTCNSX       IS10071 00057205
*BS10130 USING CNSX,R5                                          IS10071 00057305
*BS10130 LA    R0,CPYAREA                                       IS10071 00057405
*BS10130 LA    R1,CPYLEN                                        IS10071 00057505
*BS10130 SLR   R15,R15                                          IS10071 00057605
*BS10130 MVCL  R0,R14               CLEAR RETURN AREA FOR CDT   IS10071 00057705
*** END OF DATA AREAS SETTING FOR RACROUTE REQUEST=STAT ***     IS10071 00057805
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 00057905
         BE    LENTRY                           RACF DATABASE           00058005
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         00058105
         BE    LELEMN                                                   00058205
*IS10071 CLI   0(R2),XPRLIST          LIST   -  LIST DATA               00058305
*IS10071 BE    LLIST                                                    00058405
*IS10071 CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      00058505
*IS10071 BE    LEND                             EXTRACTOR               00058605
         B     RET0T                                                    00058705
*                                                                       00058805
********************************************************************    00058905
*        START                                                          00059005
********************************************************************    00059105
*                                                                       00059205
LSTART   DS    0H                                                       00059305
         B     RET0T                                                    00059405
*                                                                       00059505
********************************************************************    00059605
*        ENTRY                                                          00059705
********************************************************************    00059805
*                                                                       00059905
LENTRY   DS    0H                                                       00060005
*** PREPARE DATA AREAS FOR RACROUTE REQUEST=STAT            *** BS10130 00060105
*                                                                       00060200
         L     R3,XPRENTRY                                              00060300
         L     R5,0(R3)                ENTRY NAME LENGTH                00060400
         L     R4,XPRPRFXY                                              00060500
         L     R4,0(R4)                                                 00060600
         USING RETAREA,R4                                               00060700
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X00060800
               (?R5,4(R3),?R5,XPFFLGS,1),                              X00060900
               LEVEL=(DBGCDT,4,5,6,7)                                   00061000
         DROP  R4                                                       00061100
         MVI   UACCCNTR,0              UACC FIELD COUNTER               00061200
*                                                                       00061301
         MVC   CLSSNM,BLNKS                                     IS10071 00061402
         AHI   R5,-1                   FOR EX                  BS10130  00061501
         EX    R5,MVCLS                TAKE CLASS NAME.        BS10130  00061601
         B     *+L'*+L'MVCLS                                   BS10130  00061701
MVCLS    MVC   CLSSNM(0),4(R3)                                 BS10130  00061801
*                                                                       00061900
         LA    R0,CPYAREA                                      BS10130  00062002
         LA    R1,CPYLEN                                       BS10130  00062102
         SLR   R15,R15                                         BS10130  00062202
         MVCL  R0,R14               CLEAR RETURN AREA FOR CDT  BS10130  00062302
*                                                                       00062402
**  LOCATE REQUIRED RESOURCE CLASS                                      00062502
*                                                                       00062600
         XC    CDTPTR,CDTPTR           CLEAR PTR TO CDT CLASS           00062702
*WS10226 L     R6,CVTPTR               LOAD ADDR CVT                    00062800
*WS10226 USING CVT,R6                  ADDRESSABILITY CVT DSECT         00062900
*WS10226 L     R7,CVTRAC               LOAD ADDR CVT RACF               00063000
*WS10226 USING RCVT,R7                 ADDRESSABILITY CVT RACF DSECT    00063100
*                                                                       00063200
*IS10071 CTSADBG 'RCVTID=_ RELEASE=_',(RCVTID,4,RCVTVRMN,4),           100063300
               LEVEL=(DBGCDT,4,5,6,7)                                   00063400
*                                                                       00063500
*IS10071 MVC   RELEASE(4),RCVTVRMN     RACF RELEASE                     00063600
*IS10071                                                                00063700
*IS10071 L     R8,RCVTCDTP             PTR TO CLASS DESC TABLE          00063800
*IS10071 LTR   R8,R8                   PTR = 0 ?                        00063900
*IS10071 BZ    RET4T                   CDT TABLE DOES NOT EXIST         00064000
*                                                                       00064100
*IS10071 DROP  R6                                                       00064200
*IS10071 DROP  R7                                                       00064300
*BS10130 SR    R9,R9                   CDT CLASS COUNTER                00064401
*                                                                       00064500
*IS10071 USING CDT19,R8                                                 00064600
*BS10130 GCDT3A   DS    0H                                              00064701
*BS10130 RACROUTE REQUEST=STAT,COPY=CPYAREA,COPYLEN=CPYLEN,     IS10071X00064801
               NEXT=CLSSNM,WORKA=RRW,                           IS10071X00064900
               RELEASE=7709,MF=S                                IS10071 00065000
*BS10130 LH    R11,CNSTLGT             HAVE WE REACHED THE END? IS10071 00065101
*BS10130 LTR   R11,R11                 YES                      IS10071 00065201
*BS10130 BZ    GCDT3B                       LEAVE LOOP          IS10071 00065301
*BS10130 LA    R9,1(R9)                CDT CLASS COUNTER                00065401
*                                                                       00065500
*IS10071 CTSADBG '~.#._ LOOKING FOR=_',(?R8,?R9,CDT19CLS,8,4(R3),8),    00065600
*BS10130 CTSADBG '~.#._ LOOKING FOR=_',                         IS10071X00065701
               (CLSSNM,?R9,CLSSNM,8,4(R3),8),                   IS10071X00065800
               LEVEL=(DBGCDT,6,7,8)                                     00065900
*                                                                       00066000
*IS10071 CLC   4(8,R3),CDT19CLS        REQUIRED CDT CLASS ?             00066100
*BS10130 CLC   4(8,R3),CLSSNM          REQUIRED CDT CLASS ?             00066201
*BS10130 BE    GCDT3C                  Y, KEEP PTR TO CLASS             00066301
*BS10130                                                                00066401
*BS10130 GET NEXT ENTRY FROM CDT                                        00066501
*BS10130                                                                00066601
*IS10071 SR    R10,R10                                                  00066700
*IS10071 ICM   R10,X'3',CDT19LN        LOAD CDTLEN                      00066800
*IS10071 LTR   R10,R10                 END-OF-CDT-TABLE                 00066900
*IS10071 BZ    GCDT3B                  RETURN                           00067000
*IS10071 AR    R8,R10                  INCR ADDR OF CDT TABLE           00067100
*IS10071 SR    R10,R10                 CHECK NEXT ENTRY LENGTH          00067200
*IS10071 ICM   R10,X'3',CDT19LN        LOAD CDTLEN                      00067300
*IS10071 LTR   R10,R10                 END-OF-CDT-TABLE                 00067400
*BS10130 BZ    GCDT3B                  RETURN                           00067501
*BS10130 B     GCDT3A                  LOOP                             00067601
*BS10130 GCDT3B   DS    0H                                              00067701
*BS10130 B     RET0T                                                    00067801
*BS10130 GCDT3C   DS    0H                                              00067901
*BS10130 ST    R8,CDTPTR               KEEP PTR TO CDT CLASS            00068001
*                                                                       00068100
*IS10071 CTSADBG '~.#._ LOCATED',(?R8,?R9,CDT19CLS,8),                  00068200
*BS10130 CTSADBG '~.#._ LOCATED',(?R8,?R9,CLSSNM,8),            IS10071X00068301
               LEVEL=(DBGCDT,4,5,6,7)                                   00068400
*                                                                       00068501
         RACROUTE REQUEST=STAT,COPY=CPYAREA,COPYLEN=CPYLEN,    BS10130 X00068602
               CLASS=CLSSNM,WORKA=RRW,                         BS10130 X00068701
               RELEASE=7709,MF=(E,GCDTRR)                      BS10130  00068802
SAFPG    USING SAFP,GCDTRR                                     BS10130  00068902
         CTSADBG 'RACROUTE LOCATE FOR _:  R15 = #  RC/RS = ~/~', 10130 X00069002
               (CLSSNM,8,?R15,SAFPG.SAFPRRET,SAFPG.SAFPRREA),  BS10130 X00069101
               LEVEL=(DBGCDT,4,5,6,7)                          BS10130  00069201
         CTSADBG TYPE=SNAP,ID=1,HDR='RETURNED CDT',            BS10130 X00069301
               ADDR=(CPYAREA,CPYAREA+CPYLEN-1),                BS10130 X00069401
               LEVEL=(DBGCDT,4,5,6,7)                          BS10130  00069501
         DROP  SAFPG                                           BS10130  00069601
         LA    R8,CPYAREA              SAVE POINTER FOR...     BS10130  00069701
         USING CNST,R8                                         BS10130  00069801
         LH    R1,CNSTLGT              R1 = CDT LENGTH.        BS10130  00069902
         CHI   R1,0                    CDT WAS COPIED ?        BS10130  00070001
         BE    RET0T                   ..NO - OUT.             BS10130  00070102
*                                                              BS10130  00070201
**  CDT WAS COPIED - SAVE ITS ADDRESS FOR FIELD PROCESSING.    BS10130  00070301
*                                                              BS10130  00070401
         ST    R8,CDTPTR               SAVE FOR ELEMNT ROUTINE BS10130  00070505
         B     RET0T                                                    00070601
         DROP  R8                                              BS10130  00070701
*                                                                       00070801
********************************************************************    00070901
*        ELEMNTRY FIELD                                                 00071001
********************************************************************    00071101
*                                                                       00071201
LELEMN   DS    0H                                                       00071301
         L     R3,XPRFNME                                               00071401
         L     R4,XPRFADRE                                              00071501
         L     R5,0(R4)                FIELD LENGTH                     00071601
*                                                                       00071701
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          *00071801
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *00071901
               LEVEL=(DBGCDT,4,5,6,7)                                   00072001
*                                                                       00072101
         L     R8,CDTPTR               GET PTR TO CDT CLASS             00072201
         CHI   R8,0                    CLASS WAS RETRIEVED ?   BS10130  00072301
         BE    RET4T                   ..NO - OUT.             BS10130  00072401
         USING CNST,R8                                         BS10130  00072501
         ICM   R11,15,CNSTCNSX         -> CNSX                  IS10071 00072601
*IS10071 LTR   R8,R8                   CLASS NOT FOUND                  00072701
         BZ    RET4T                   NO CNSX ==> RETURN               00072801
         USING CNSX,R11                                         IS10071 00072901
*                                                                       00073001
*IS10071 CTSADBG '~._ RES PROCESSING',(?R8,CDT19CLS,8),                 00073101
         CTSADBG '~._ RES PROCESSING',(?R8,CLSSNM,8),           IS10071X00073201
               LEVEL=(DBGCDT,4,5,6,7)                                   00073301
*                                                                       00073401
         CLC   =CL8'$UACC',0(R3)                                        00073501
         BE    LUACC                                                    00073601
         CLC   =CL8'$FIRST',0(R3)                                       00073701
         BE    LFIRST                                                   00073801
         CLC   =CL8'$GROUP',0(R3)                                       00073901
         BE    LGROUP                                                   00074001
         CLC   =CL8'$MEMBER',0(R3)                                      00074101
         BE    LMEMBER                                                  00074201
         CLC   =CL8'$MAXLNTH',0(R3)                                     00074301
         BE    LMXLEN                                                   00074401
         CLC   =CL8'$OTHER',0(R3)                                       00074501
         BE    LOTHER                                                   00074601
         CLC   =CL8'$POSIT',0(R3)                                       00074701
         BE    LPOSIT                                                   00074801
         CLC   =CL8'$ATTR1',0(R3)                                       00074901
         BE    LATTR1                                                   00075001
         CLC   =CL8'$ATTR2',0(R3)                                       00075101
         BE    LATTR2                                                   00075201
         B     RET4T                   UNKNOWN FIELD                    00075301
*                                                                       00075401
LUACC    DS    0H                                                       00075501
*IS10071 USING CDT19,R8                                                 00075601
         SR    R10,R10                                                  00075701
         IC    R10,UACCCNTR            UACC COUNTER                     00075801
         LA    R10,1(R10)              INCR COUNTER                     00075901
         STC   R10,UACCCNTR            UACC COUNTER                     00076001
         CLI   UACCCNTR,1              UACC COUNTER                     00076101
         BE    LUACC1                  FIRST APPEARNS  - WITH TRN TABLE 00076201
         CLI   UACCCNTR,2              UACC COUNTER                     00076301
         BE    LUACC2                  SECOND APPEARNS - TEXT           00076401
LUACC1   DS    0H                      FIRST APPEARNS  - WITH TRN TABLE 00076501
*IS10071 TM    CDT19MSC,X'40'          MISC. FLAGS                      00076601
         TM    CNSTMFLG,CNSTACEE       USE UACC FROM ACEE ?     IS10071 00076701
         BO    RET4T                   NOT USE TRANSLATE TABLE          00076801
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00076901
*IS10071 MVC   4(1,R4),CDT19UAC        DFTUACC FLAGS                    00077001
         MVC   4(1,R4),CNSTUACC        DEFAULT UACC             IS10071 00077101
         B     RET0T                                                    00077201
LUACC2   DS    0H                      FIRST APPEARNS  - WITH TRN TABLE 00077301
*IS10071 TM    CDT19MSC,X'40'          MISC. FLAGS                      00077401
         TM    CNSTMFLG,CNSTACEE       USE UACC FROM ACEE ?     IS10071 00077501
         BZ    RET4T                   USED TRANSLATE TABLE             00077601
         LA    R10,L'UACCDFLT                                           00077701
         ST    R10,0(R4)               FIELD LENGTH                     00077801
         MVC   4(L'UACCDFLT,R4),UACCDFLT                                00077901
         B     RET0T                                                    00078001
LFIRST   DS    0H                                                       00078101
*IS10071 USING CDT19,R8                                                 00078201
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00078301
*IS10071 MVC   4(1,R4),CDT19F1         FIRST CHAR FLAGS                 00078401
         MVC   4(1,R4),CNSTFRST        SYNTAX OF 1ST CHARACTER  IS10071 00078501
         B     RET0T                                                    00078601
LOTHER   DS    0H                                                       00078701
*IS10071 USING CDT19,R8                                                 00078801
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00078901
*IS10071 MVC   4(1,R4),CDT19F2         OTHER CHAR FLAGS                 00079001
         MVC   4(1,R4),CNSTREMN        SYNTAX OF REMAINING CHAR IS10071 00079101
         B     RET0T                                                    00079201
LGROUP   DS    0H                                                       00079301
*IS10071 USING CDT19,R8                                                 00079401
*IS10071 TM    CDT19MSC,X'80'          MISC. FLAGS                      00079501
         TM    CNSTMFLG,CNSTRGRP       CLASS IS RESOURCE GROUP  IS10071 00079601
         BO    RET4T                                                    00079701
*IS10071 CLC   CDT19GRP(8),=CL8' '     GROUP CLASS REF AN EMPTY ?       00079801
         CLC   CNSTXREF(8),=CL8' '     GROUP CLASS REF AN EMPTY?IS10071 00079901
         BE    RET4T                   Y, SKIP                          00080001
         MVC   0(4,R4),=F'8'           FIELD LENGTH                     00080101
*IS10071 MVC   4(8,R4),CDT19GRP        GROUP CLASS REF                  00080201
         MVC   4(8,R4),CNSTXREF        GROUP CLASS REF          IS10071 00080301
         B     RET0T                                                    00080401
LMEMBER  DS    0H                                                       00080501
*IS10071 USING CDT19,R8                                                 00080601
*IS10071 TM    CDT19MSC,X'80'          MISC. FLAGS                      00080701
         TM    CNSTMFLG,CNSTRGRP       CLASS IS RESOURCE GROUP  IS10071 00080801
         BZ    RET4T                                                    00080901
*IS10071 CLC   CDT19GRP(8),=CL8' '     MEMBER CLASS REF AN EMPTY ?      00081001
         CLC   CNSTXREF(8),=CL8' '     GROUP CLASS REF AN EMPTY?IS10071 00081101
         BE    RET4T                   Y, SKIP                          00081201
         MVC   0(4,R4),=F'8'           FIELD LENGTH                     00081301
*IS10071 MVC   4(8,R4),CDT19GRP        MEMBER CLASS REF                 00081401
         MVC   4(8,R4),CNSTXREF        GROUP CLASS REF          IS10071 00081501
         B     RET0T                                                    00081601
LMXLEN   DS    0H                                                       00081701
*IS10071 USING CDT19,R8                                                 00081801
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00081901
*IS10071 MVC   4(1,R4),CDT19PFL        MAXIMUM RESOURCE NAME LENGTH     00082001
         MVC   4(1,R4),CNSTMAXL        MAX MEMBER NAME LENGTH   IS10071 00082101
         B     RET0T                                                    00082201
LPOSIT   DS    0H                                                       00082301
*IS10071 USING CDT19,R8                                                 00082401
*IS10071 CLC   RELEASE(3),=CL3'201'    RACF 2.2 OR HIGHER ?             00082501
*IS10071 BH    LPOSIT22                                                 00082601
*IS10071 LA    R6,CDT19PST             POSIT MASK                       00082701
*IS10071 LA    R5,16                   POSIT MASK LENGTH IN BYTES       00082801
*IS10071 B     LPOSITDO                                                 00082901
LPOSIT22 DS    0H                                                       00083001
*IS10071 USING CDT22,R8                                                 00083101
*IS10071 LA    R6,CDT22PST             POSIT MASK                       00083201
         ICM   R6,15,CNSTCNSX          CNSX                    IS10071  00083307
         BZ    RET4T                   POSIT NUMBER NOT FOUND   IS10071 00083401
         LA    R6,CNSTVMSK-CNSX(,R6)   R6 -> POSIT MASK.       BS10130  00083507
*BS10130 LA    R5,128                  POSIT MASK LENGTH IN BYTES       00083707
         LA    R5,L'CNSTVMSK           POSIT MASK LENGTH (BYTES)BS10130 00083807
*IS10071 B     LPOSITDO                                                 00083907
LPOSITDO DS    0H                                                       00084007
         SR    R10,R10                 POSIT COUNTER                    00084107
         SR    R7,R7                   POSIT MASK BYTES COUNTER         00084207
*                                                                       00084307
         CTSADBG 'POSIT MASK=$',(0(R6),?R5),                           100084407
               LEVEL=(DBGCDT,4,5,6,7)                                   00084507
*                                                                       00084607
LPOSIT1  DS    0H                                                       00084707
         SR    R2,R2                                                    00084807
*IS10071 IC    R2,0(R6)                GET CURRENT POSIT MASK INFO      00084907
         IC    R2,CNSTVMSK             GET CRNT POSIT MASK INFO IS10071 00085007
         LA    R6,1(R6)                INCR ADDR OF MASK                00085107
         LA    R7,1(R7)                POSIT MASK BYTES COUNTER +1      00085207
         LA    R9,8                    LOOP VIA BITS                    00085307
LPOSIT2  DS    0H                                                       00085407
         STC   R2,WPOSIT                                                00085507
*                                                                       00085607
         CTSADBG '#.#.OBTAINED POSIT INFO=$',                          100085707
               (?R10,?R7,WPOSIT,1),LEVEL=(DBGCDT,6,7,8)                 00085807
*                                                                       00085907
         CLI   WPOSIT,X'00'            CURRNT INFO INCLUDES POSIT NMBR? 00086007
         BNE   LPOSIT3                 Y,SKIP                           00086107
         AR    R10,R9                  WAS SKIPPED 8 POSIT NUMBERS      00086207
         B     LPOSIT4                 GET NEXT POSIT MASK INFO         00086307
*                                                                       00086407
*        CURRENT INFO INCLUDES POSIT NUMBER                             00086507
*                                                                       00086607
LPOSIT3  DS     0H                                                      00086707
         LA    R10,1(R10)              POSIT NUMBER += 1                00086807
         TM    WPOSIT,X'80'            THIS BIT IS POSIT NUMBER ?       00086907
         BO    LPOSIT5                 Y, DETECTED POSIT NUMBER         00087007
*                                                                       00087107
         SLL   R2,1                    R2 <<= 1 GET NEXT BIT            00087207
         STC   R2,WPOSIT                                                00087307
*                                                                       00087407
         CTSADBG '#.#.UPDATED POSIT INFO=$',                           100087507
               (?R10,?R7,WPOSIT,1),LEVEL=(DBGCDT,6,7,8)                 00087607
*                                                                       00087707
         BCT   R9,LPOSIT3              LOOP VIA BITS                    00087807
*                                                                       00087907
LPOSIT4  DS    0H                      GET NEXT POSIT MASK INFO         00088007
         BCT   R5,LPOSIT1              LOOP VIA POSIT MASK INFO         00088107
         B     RET4T                   POSIT NUMBER NOT FOUND           00088207
*------------------------------------------------------------------     00088307
*        DETECTED POSIT NUMBER.  (R10)                                  00088407
*------------------------------------------------------------------     00088507
LPOSIT5  DS    0H                      Y, DETECTED POSIT NUMBER         00088607
         MVC   0(4,R4),=F'4'           FIELD LENGTH                     00088707
         BCTR  R10,0                                                    00088807
         ST    R10,4(R4)               POSIT NUMBER                     00088907
         B     RET0T                                                    00089007
*                                                                       00089107
LATTR1   DS    0H                                                       00089207
*IS10071 USING CDT19,R8                                                 00089307
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00089407
*IS10071 MVC   4(1,R4),CDT19MSC        MISC. FLAGS                      00089507
         MVC   4(1,R4),CNSTMFLG        MISC. FLAGS              IS10071 00089607
         B     RET0T                                                    00089707
LATTR2   DS    0H                                                       00089807
*IS10071 USING CDT19,R8                                                 00089907
*IS10071 CLC   RELEASE(3),=CL3'201'    RACF 2.2 OR HIGHER ?             00090007
*IS10071 BH    LATTR222                                                 00090107
*IS10071 MVC   4(1,R4),CDT19B1M        B1 MISC. FLAGS                   00090207
*IS10071 B     LATTR2DO                                                 00090307
LATTR222 DS    0H                                                       00090407
*IS10071 USING CDT22,R8                                                 00090507
*IS10071 MVC   4(1,R4),CDT22B1M        B1 MISC. FLAGS                   00090607
         MVC   4(1,R4),CNSTFLG0        MISCELLANEOUS FLAGS      IS10071 00090707
*IS10071 B     LATTR2DO                                                 00090807
LATTR2DO DS    0H                                                       00090907
         MVC   0(4,R4),=F'1'           FIELD LENGTH                     00091007
         B     RET0T                                                    00091107
         DROP  R11                                              IS10071 00091207
         DROP  R8                                              BS10130  00091307
*                                                                       00091407
********************************************************************    00091507
*        LIST FIELD                                                     00091607
********************************************************************    00091707
*                                                                       00091807
LLIST    DS    0H                                                       00091907
         USING PARMM,R11                                        IS10071 00092007
         L     R3,XPRFNML                                               00092107
         L     R4,XPRFADRL                                              00092207
         L     R5,0(R4)                FIELD LENGTH                     00092307
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *00092407
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *00092507
               LEVEL=(DBGCDT,4,5,6,7)                                   00092607
         B     RET4T                                                    00092707
*                                                                       00092807
********************************************************************    00092907
*        END                                                            00093007
********************************************************************    00093107
*                                                                       00093207
LEND     DS    0H                                                       00093307
         B     RET0T                                                    00093407
*                                                                       00093507
********************************************************************    00093607
*        SET RC AND EXIT                                                00093707
********************************************************************    00093807
*                                                                       00093907
RET0T    DS    0H                                                       00094007
         SR    R15,R15                                                  00094107
         B     RETT                                                     00094207
RET4T    DS    0H                                                       00094307
         LA    R15,4                                                    00094407
         B     RETT                                                     00094507
RET8T    DS    0H                                                       00094607
         LA    R15,8                                                    00094707
         B     RETT                                                     00094807
RETT     DS    0H                                                       00094907
         BRTRN (15)                                                     00095007
         LTORG                                                          00095107
DBGCDT   DS    CL1                     DEBUG LEVEL                      00095207
WPOSIT   DS    CL1                     WORK VAR                         00095307
UACCCNTR DS    CL1                     UACC FIELD COUNTER               00095407
UACCDFLT DC    CL18'USE UACC FROM ACEE'                                 00095507
RELEASE  DS    CL4                     RACF RELEASE                     00095607
CDTPTR   DS    A                       PTR TO CDT CLASS                 00095707
*                                                               IS10071 00095807
PARMADDR DS    A                       PARMS ADDR               IS10071 00095907
CLSSNM   DS    CL8             NAME OF CLASS FROM REQUEST=STAT  IS10071 00096007
BLNKS    DC    CL8'        '                                    IS10071 00096107
*                                                                       00096207
         DS    0D                                              BS10130  00096307
CPYAREA  DS    CL(CNSTCBLN)    AREA FOR CNST PORTION            IS10071 00096407
*BS10130 CPYCNSX  DS    CL(CNSXCBLN)    AREA FOR CNSX PORTION   IS10071 00096507
         DS    0D,CL(CNSXCBLN)    AREA FOR CNSX PORTION        BS10130  00096607
CPYLEN   EQU   *-CPYAREA       LENGTH OF CDT ENTRY              IS10071 00096707
*                                                                       00096807
GCDTRR   RACROUTE REQUEST=STAT,COPY=,COPYLEN=,CLASS=,          BS10130 X00096907
               RELEASE=7709,MF=L                               BS10130  00097007
*                                                                       00097107
RRW      DS    CL512           RACROUTE WORK AREA               IS10071 00097207
         DROP  ,                                                        00097307
******************************************************************      00097407
*        MAIN PARAMETERS LIST FOR TEST FUNCTIONS                        00097507
******************************************************************      00097607
PARMM    DSECT                                                          00097707
         COPY  CTSFXPR                                                  00097807
******************************************************************      00103405
*        RACF RETURN AREA PREFIX                                        00103505
******************************************************************      00103605
RETAREA  DSECT                                                          00103705
         COPY  CTSFXPF                                                  00103805
*                                                                       00103905
***************************************************************         00104005
*                                                             *         00104105
*        SYSTEM CONTROL BLOCKS MAPPING                        *         00104205
*                                                             *         00104305
***************************************************************         00104405
         PRINT GEN                                                      00104505
*                                                                       00104605
         CVT   DSECT=YES,LIST=YES                                       00104705
         ICHPRCVT                      RACF 1.9                         00104805
*                                                                       00104905
******** DROP THE WHOLE DSECT WHICH IS NOT USED ANY MORE AS     IS10071 00105005
******** CNST & CNSX REPLACE IT.                                IS10071 00105105
*IS10071  CDT19    DSECT                                                00105205
*IS10071  CDT19LN  DS    AL2                     LENGTH OF DESCRIPTOR   00105305
*IS10071  CDT19ID  DS    AL1(128)                ID                     00105405
*IS10071  CDT19CLS DS    CL8'$$FDSFAC'           CLASS NAME             00105505
*IS10071  CDT19GRP DS    CL8' '                  GROUP MEMBER XREF NULL 00105605
*IS10071  CDT19PFL DS    AL1(39)                 MAX RESOURCE NAME LEN  00105705
*IS10071  CDT19F1  DS    B'11100000'             FIRST CHAR FLAGS       00105805
*IS10071  CDT19F2  DS    B'11110000'             OTHER CHAR FLAGS       00105905
*IS10071  CDT19UAC DS    B'00000000'             DFTUACC FLAGS          00106005
*IS10071  CDT19MSC DS    B'01000000'             MISC. FLAGS            00106105
*IS10071  CDT19PST DS    3B'0'                   POSIT MASK             00106205
*IS10071           DS    B'01000000'             POSIT MASK             00106305
*IS10071           DS    12B'0'                  POSIT MASK             00106405
*IS10071  CDT19GPR DS    AL4(0)                  GENLIST POINTER        00106505
*IS10071  CDT19LPR DS    AL4(0)                  RACLIST POINTER        00106605
*IS10071  CDT19RC  DS    AL1(4)                  SET THE DEFAULT RETURN 00106705
*IS10071  CDT19B1M DS    B'00000000'             B1 MISC. FLAGS         00106805
*IS10071  CDT19KEY DS    AL1(0)                  SET THE KEYQUAL VALUE  00106905
*IS10071  CDT19ORG DS    AL1(39)                 ORIGINAL MAX NAME LEN  00107005
*IS10071  CDT19ALG DS    XL4'00'                 ALLIGN TO DWORD BDY    00107105
*IS10071  CDT19OK  DS    XL8'00'                 STOKEN FOR RACLIST DAT 00107205
*                                                                       00107305
******** DROP THE WHOLE DSECT WHICH IS NOT USED ANY MORE AS     IS10071 00107405
******** CNST & CNSX REPLACE IT.                                IS10071 00107505
*IS10071  CDT22    DSECT                                                00107605
*IS10071  CDT22LN  DS    AL2                     LENGTH OF DESCRIPTOR   00107705
*IS10071  CDT22ID  DS    AL1(128)                ID                     00107805
*IS10071  CDT22CLS DS    CL8'$$FDSFAC'           CLASS NAME             00107905
*IS10071  CDT22GRP DS    CL8' '                  GROUP MEMBER XREF NULL 00108005
*IS10071  CDT22PFL DS    AL1(39)                 MAX RESOURCE NAME LEN  00108105
*IS10071  CDT22F1  DS    B'11100000'             FIRST CHAR FLAGS       00108205
*IS10071  CDT22F2  DS    B'11110000'             OTHER CHAR FLAGS       00108305
*IS10071  CDT22UAC DS    B'00000000'             DFTUACC FLAGS          00108405
*IS10071  CDT22MSC DS    B'01000000'             MISC. FLAGS            00108505
*IS10071  CDT22PST DS    3B'0'                   POSIT MASK             00108605
*IS10071           DS    B'01000000'             POSIT MASK             00108705
*IS10071           DS    124B'0'                 POSIT MASK             00108805
*IS10071  CDT22GPR DS    AL4(0)                  GENLIST POINTER        00108905
*IS10071  CDT22LPR DS    AL4(0)                  RACLIST POINTER        00109005
*IS10071  CDT22RC  DS    AL1(4)                  SET THE DEFAULT RETURN 00109105
*IS10071  CDT22B1M DS    B'00000000'             B1 MISC. FLAGS         00109205
*IS10071  CDT22KEY DS    AL1(0)                  SET THE KEYQUAL VALUE  00109305
*IS10071  CDT22ORG DS    AL1(39)                 ORIGINAL MAX NAME LEN  00109405
*IS10071  CDT22ALG DS    XL4'00'                 ALLIGN TO DWORD BDY    00109505
*IS10071  CDT22OK  DS    XL8'00'                 STOKEN FOR RACLIST DAT 00109605
*                                                               IS10071 00109705
*CLASSNM  DS    CL8             NAME OF CLASS FROM REQUEST=STAT IS10071 00109805
*BLANKS   DC    CL8'        '                                   IS10071 00109905
*COPYAREA DS    CL(CNSTCBLN)    AREA FOR CNST PORTION           IS10071 00110005
*COPYCNSX DS    CL(CNSXCBLN)    AREA FOR CNSX PORTION           IS10071 00110105
*COPYLEN  EQU   *-COPYAREA      LENGTH OF CDT ENTRY             IS10071 00110205
*RRWA     DS    CL512           RACROUTE WORK AREA              IS10071 00110305
         ICHPCNST               GENERATES CNST AND CNSX DSECT           00110405
         ICHSAFP                RACROUTE PARM LIST DSECT       BS10130  00111001
         END   CTSFCDT                                                  00120000
