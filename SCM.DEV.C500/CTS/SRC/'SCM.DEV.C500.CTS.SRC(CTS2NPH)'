         TITLE 'SA-AGENT NPWPEXIT EXIT FOR ACF2 ONLINE INTERCEPTOR'     00010000
*********************************************************************** 00020000
****                                                               **** 00030000
****  SA-AGENT VERSION 4.0.XX                                      **** 00040000
****                                                               **** 00050000
****  (C) COPYRIGHT 1999-2000 BMC SOFTWARE INC.                    **** 00060000
****                                                               **** 00070000
*********************************************************************** 00080000
*                                                                       00090000
*********************************************************************** 00100000
*                                                                     * 00110000
* Module Name : NPWPEXIT (Dynamic Version)                            * 00120000
*                                                                     * 00130000
* Description : SA-Agent NPWPEXIT ACF2 exit ROUTINE for passphrase    * 00140000
*               change interception                                   * 00150000
* Function:                                                           * 00160000
*                                                                     * 00170000
*    NPWPEXIT is ACF2 new password phrase (passphrase) exit which     * 00180000
*    SA-Agent uses for passphrase syncronization support.             * 00190000
*    The exit intercepts passphrase changes that were generated by    * 00200000
*    the ACF2 commands 'INSERT' and 'CHANGE', as well as when         * 00210000
*    the user changes his passphrase during LOGON, due to his/her     * 00220000
*    request or ACF2 request when passphrase interval time expires.   * 00230000
*    Once the exit intercept the passphrase change, it notifies of    * 00240000
*    the event to SA-Agent online interceptor server via cross        * 00250000
*    memory services.                                                 * 00260000
*                                                                     * 00270000
* Attributes  : the exit module should be link-edited with RMODE ANY  * 00280000
*               and AMODE 31, reusable and reentrable.                * 00290000
*                                                                     * 00300000
* Environment : The exit receives control in Supervisor state         * 00310000
*               and key zero.                                         * 00320000
*                                                                     * 00330000
* Restrictions : None                                                 * 00340000
*                                                                     * 00350000
* Register usage :  R0  - Temporary work register                     * 00360000
*                   R1  - Temporary work register                     * 00370000
*                   R4  -> new password                               * 00380000
*                   R3  -> ACF2 Request Block                         * 00390000
*                   R5  -  length register                            * 00400000
*                   R6  -> user-id                                    * 00410000
*                   R7  -  not used                                   * 00420000
*                   R8  -> not used                                   * 00430000
*                   R9  -> not used                                   * 00440000
*                   R10 -> not used                                   * 00450000
*                   R11 -> ACNPWPXT ACF2's DSECT                        00460000
*                   R12 -> program base                               * 00470000
*                   R13 -> Dynamic Work Area (save area)              * 00480000
*                   R14 -  return address                             * 00490000
*                   R15 -  return code                                * 00500000
*                                                                     * 00510000
*  ACF2 documentation error:                                          * 00520000
*        In the ACF2's NPWPEXIT documentaion the possible values      * 00530000
*        for the request block first byte is X'01' and X'02',         * 00540000
*        but as the exit shows it is X'01' for logon processing       * 00550000
*        or X'0A' for INSERT/CHANGE                                   * 00560000
*                                                                     * 00570000
* Input :                                                             * 00580000
*                                                                     * 00590000
*    Register 1 points to a ACF2 password phrase exit parameter list  * 00600000
*    which is mapped by the ACNPWPXT mapping macro                    * 00610000
*                                                                     * 00620000
* Output:                                                             * 00630000
*                                                                     * 00640000
*    This exit always returns a Return Code of 0.                     * 00650000
*                                                                     * 00660000
* CHANGE ACTIVITY :                                                   * 00670000
*                                                                     * 00680000
*    04/01/18 MS Created                                              * 00690000
*                                                                     * 00700000
*********************************************************************** 00710000
*                                                                       00720000
****************************************************************        00730000
*        Configurations Definition                             *        00740000
****************************************************************        00750000
*                                                                       00760000
****************************************************************        00770000
*        register equates                                      *        00780000
****************************************************************        00790000
*                                                                       00800000
R0       EQU   0                                                        00810000
R1       EQU   1                                                        00820000
R2       EQU   2                                                        00830000
R3       EQU   3                                                        00840000
R4       EQU   4                                                        00850000
R5       EQU   5                                                        00860000
R6       EQU   6                                                        00870000
R7       EQU   7                                                        00880000
R8       EQU   8                                                        00890000
R9       EQU   9                                                        00900000
R10      EQU   10                                                       00910000
R11      EQU   11                                                       00920000
R12      EQU   12                                                       00930000
R13      EQU   13                                                       00940000
R14      EQU   14                                                       00950000
R15      EQU   15                                                       00960000
*                                                                       00970000
CTS2NPH  CSECT ,                                                        00980000
CTS2NPH  AMODE 31                                                       00990000
CTS2NPH  RMODE ANY                                                      01000000
****************************************************************        01010000
*        PROLOG CODE                                           *        01020000
****************************************************************        01030000
         SAVE  (14,12),,CTS2NPH-&SYSDATE-&SYSTIME                       01040000
         LR    R12,R15                 R12 -> PROGRAM BASE              01050000
         USING CTS2NPH,R12             PROGRAM ADDRESSABILITY           01060000
         CTSLEVEL ,                                                     01070000
         LR    R11,R1                  R11 -> PARAMETERS LIST           01080000
         USING ACNPWPXT,R11            ADDRESSABILITY                   01090000
*--------------------------------------------------------------*        01100000
*        Check module header                                   *        01110000
*--------------------------------------------------------------*        01120000
         LR    R10,R12                                                  01130000
         S     R10,=A(EXPLEN)          R10 -> EXIT PREFIX               01140000
         USING EXP,R10                                                  01150000
         CLC   =CL4'CSAX',EXPID        ARE WE OK ?                      01160000
         JE    CHKZOMBI                NO - WHAT THE ???                01170000
         WTO   'CTS2NPH: EXIT OVERLAYED. NO MODULE HEADER'              01180000
         J     NEXTEXIT                                                 01190000
*--------------------------------------------------------------*        01200000
*        if exit is disabled, continue with next one           *        01210000
*--------------------------------------------------------------*        01220000
CHKZOMBI DS    0H                                                       01230000
         TM    EXPFLAGS,EXPZOMBI       Is it zombi?                     01240000
         JO    NEXTEXIT                ..yes, invoke prev exit          01250000
*----------------------------------------------------------------*      01260000
*        Test Passphrase existance                               *      01270000
*----------------------------------------------------------------*      01280000
         ICM   R4,15,ACNPWP_NPW        passphrase exist?                01290000
         JZ    NEXTEXIT                ..no, get out                    01300000
         ICM   R5,15,ACNPWP_NPWL       its length?                      01310000
         JZ    NEXTEXIT                ..no, get out                    01320000
         L     R3,ACNPWP_RB            point to ACF2 RB                 01330000
*--------------------------------------------------------------*        01340000
*        Increase module use count                             *        01350000
*--------------------------------------------------------------*        01360000
INCUSECT DS    0H                                                       01370000
         L     R1,EXPUSECT             increase module use count        01380000
         LA    R0,1(0,R1)                                               01390000
         CS    R1,R0,EXPUSECT                                           01400000
         JNZ   INCUSECT                                                 01410000
*----------------------------------------------------------------*      01420000
*        Obtain workarea                                         *      01430000
*----------------------------------------------------------------*      01440000
START    DS    0H                                                       01450000
         GETMAIN RC,LV=WORKLEN,LOC=ANY                                  01460000
         LTR   R15,R15                                                  01470000
         JZ    CHAINSA                                                  01480000
         WTO   'CTS2NPH: GETMAIN FAILED ERROR'                          01490000
         J     RETURN                                                   01500000
CHAINSA  DS    0H                                                       01510000
         ST    R1,8(R13)               CHAIN                            01520000
         ST    R13,4(R1)               SAVE AREAS                       01530000
         LR    R13,R1                  ESTABLISH WORK AREA              01540000
         USING WORKAREA,R13            addressability                   01550000
*----------------------------------------------------------------*      01560000
*        Create recovery environment                             *      01570000
*----------------------------------------------------------------*      01580000
         ST    R10,ADDREXP             SAVE EXP FOR ABEND RETRY         01590000
         XC    ABNDCODE,ABNDCODE       CLEAR ABEND CODE                 01600000
         MVC   WRKESTAE,LSTESTAE                                        01610000
         ESTAE ABNDEXIT,PARAM=WORKAREA,TERM=YES,MF=(E,WRKESTAE)         01620000
*----------------------------------------------------------------*      01630000
*        Build RQC and EVT                                       *      01640000
*----------------------------------------------------------------*      01650000
*                                                                *      01660000
* 'RQC' is the 'request control block' which is used by the PC   *      01670000
* routines to pass information to the SA-Agent online            *      01680000
* interceptor .                                                  *      01690000
*                                                                *      01700000
* 'EVT' is the 'Event Control Block' which is imbeded in the     *      01710000
* request block for 'Notify Requests' . it describes the         *      01720000
* event that occured including the entity (user, group etc...)   *      01730000
* and the event action type (add, deleted, modify, password      *      01740000
* changed, etc...) .                                             *      01750000
*                                                                *      01760000
* the following code formats these control blocks and fill them  *      01770000
* with the relevant info so they can be passed on to the PC      *      01780000
* routines and be transfered to the online interceptor server.   *      01790000
*                                                                *      01800000
*----------------------------------------------------------------*      01810000
         AIF   ('&SYSPARM(1)' NE 'DEBUG').SKP01                  @DBG   01820000
*        display ACF2 Request Block code & passphrase's length   @DBG   01830000
         CVD   R5,PACKD                                          @DBG   01840000
         MVC   WTOAREA(WTODSPL),WTODSP                           @DBG   01850000
         UNPK  X2C(3),0(2,R3)                                    @DBG   01860000
         TR    X2C(2),HEX2CHAR                                   @DBG   01870000
         MVC   WTOAREA+11(2),X2C                                 @DBG   01880000
         UNPK  X2C(3),PACKD                                      @DBG   01890000
         OI    X2C+2,X'F0'                                       @DBG   01900000
         MVC   WTOAREA+14(3),X2C                                 @DBG   01910000
*        LA    R0,WTOAREA+18                                     @DBG   01920000
*        LA    R1,WTODSPL-27                                     @DBG   01930000
*        LR    R15,R5                                            @DBG   01940000
*        ICM   R15,B'1000',=C' '                                 @DBG   01950000
*        LR    R14,R4                                            @DBG   01960000
*        MVCL  R0,R14                                            @DBG   01970000
         WTO   MF=(E,WTOAREA)                                    @DBG   01980000
.SKP01   ANOP  ,                                                 @DBG   01990000
*                                                                       02000000
*        initialize RQC                                                 02010000
*                                                                       02020000
         LA    R0,RQCAREA              CLEAR THE AREA                   02030000
         LA    R1,RQCLEN               SET LENGTH                       02040000
         XR    R15,R15                 PADD WITH X'00'                  02050000
         MVCL  R0,R14                  CLEAR                            02060000
         USING RQC,RQCAREA             MAP IT                           02070000
         TIME  DEC                     GET TIME                         02080000
         STM   R0,R1,RQCTSTMP          TIMESTAMP RQC                    02090000
         MVI   RQCTYPE,RQCTNOTX        REQUEST TYPE IS 'NOTIFY'         02100000
*                                                                       02110000
*        build EVT                                                      02120000
*                                                                       02130000
         USING EVT,RQCEVT              MAP EVENT BLOCK                  02140000
         MVC   EVTEVT,=CL4'EVT '       SET EVENT BLOCK EYE CATCHER      02150000
         MVC   EVTFLAG,=A(EVTFULL)     SET EVT INFO ON                  02160000
         MVI   EVTTYPE,EVTTUSER        TYPE = USER                      02170000
*                                                                       02180000
         TIME  BIN                                                      02190000
         ST    R0,EVTTIME              EVENT TIME STAMP                 02200000
         ST    R1,EVTDATE              EVENT TIME STAMP                 02210000
*                                                                       02220000
         L     R6,ACNPWP_LID           R6->logon-id                     02230000
         MVC   EVTOUID,0(R6)           move logon-id                    02240000
         MVC   EVTUSER,0(R6)           move logon-id                    02250000
         CLI   0(R3),X'01'             ACVALD REQ ?                     02260000
         JNE   VALDCONT                YES, HANDLE IT                   02270000
         MVC   EVTUSER,ACVLID-ACVALD(R3) UID from ACVALD                02280000
VALDCONT DS    0H                                                       02290000
*                                                                       02300000
*        set originator details from LID record                         02310000
*                                                                       02320000
SETORG   DS    0H                                                       02330000
         L     R1,PSAAOLD-PSA            R1 -> ASCB                     02340000
         ICM   R15,15,ASCBJBNI-ASCB(R1)  JOBNAME EXISTS ?               02350000
         JNZ   COPYOJBN                  YES, THEN COPY IT              02360000
         ICM   R15,15,ASCBJBNS-ASCB(R1)  STCNAME EXISTS ?               02370000
         JZ    SKIPOJBN                  NO, NOTHING CAN BE COPIED      02380000
COPYOJBN DS    0H                                                       02390000
         MVC   EVTOJBN,0(R15)            COPY JOBNAME/STCNAME           02400000
SKIPOJBN DS    0H                                                       02410000
*                                                                       02420000
*        copy new PassPhrase                                            02430000
*                                                                       02440000
         STC   R5,EVTPWPH-1            save length                      02450000
         LA    R0,EVTPWPH              R0-> destination passphrase      02460000
         LHI   R1,L'EVTPWPH            R1=destination length            02470000
         MVCL  R0,R4                   move passphrase                  02480000
*                                      ..and also padd with nulls       02490000
*                                      ..because R5's high order byte   02500000
*                                      ..is null                        02510000
         MVI   EVTACT,EVTAPPH          ACTION = PASSphrase CHANGE       02520000
         MVI   EVTPHCLR,EVTPH$OT       default caller is 'OTHER'        02530000
*----------------------------------------------------------------*      02540000
*                                                                *      02550000
*        In the ACF2's NPWPEXIT documentaion the possible values *      02560000
*        for the request block first byte is X'01' and X'02',    *      02570000
*        but as the exit shows it is X'01' for logon processing  *      02580000
*        or X'0A' for INSERT/CHANGE                              *      02590000
*                                                                *      02600000
*        X'01' in the first byte of the request block indicates  *      02610000
*        that phrase change done during logon.                   *      02620000
*                                                                *      02630000
*----------------------------------------------------------------*      02640000
         CLI   0(R3),X'01'             from LOGON?                      02650000
         JNE   *+8                     no, leave the default            02660000
         MVI   EVTPHCLR,EVTPH$LG       mark it comes from LOGON         02670000
*----------------------------------------------------------------*      02680000
*        Notify server via PC routine                            *      02690000
*----------------------------------------------------------------*      02700000
*        AIF   ('&SYSPARM(1)' NE 'DEBUG').SKP02                  @DBG   02710000
*        display EVT block header                                @DBG   02720000
*        MVC   WTOAREA(WTODSPL),WTODSP                           @DBG   02730000
*        MVC   WTOAREA+11(01),EVTPHCLR                           @DBG   02740000
*        MVC   WTOAREA+12(50),EVTTYPE                            @DBG   02750000
*        WTO   MF=(E,WTOAREA)                                    @DBG   02760000
*SKP02   ANOP  ,                                                 @DBG   02770000
         MVC   SSNAME,EXPSSNAM                                          02780000
         MVC   JOBNAME,EXPJOBNM                                         02790000
         SR    R7,R7                                                    02800000
         MVC   PGMNAME,=CL8'CTS2NPH'                                    02810000
         CALL  CTSAPCC,(FUJIFLAG,                                      X02820000
               SSNAME,                                                 X02830000
               JOBNAME,                                                X02840000
               RQCAREA,                                                X02850000
               PCCWORK),                                               X02860000
               MF=(E,CALLAREA)                                          02870000
         LTR   R15,R15                 REQUEST PASSED SUCCESSFULLY ?    02880000
         JZ    CLEANUP                 YES, CONITNUE                    02890000
*                                                                       02900000
         CHI   R15,8                   FREE CHAIN EXISTS ?              02910000
         JE    NOFRCHN                 NO, FREE CHAIN RUN OUT           02920000
*                                                                       02930000
         CHI   R15,160                 IS SERVER UP ?                   02940000
         JH    ERRPCC                  NO, ERROR IN PC ROUTINE          02950000
****************************************************************        02960000
*        notify routine internal error - issue  error message           02970000
****************************************************************        02980000
         LTR   R7,R7                   CHECK CTS210E CNTR        BS2442 02990000
         JZ    SEND210E                                          BS2442 03000000
         WTO   'CTS2NPH: CTS230E COUNTER > 1. QUIT'              BS2442 03010000
         JNZ   SETZOMBI                LOOP ?, EXIT              BS2442 03020000
SEND210E DS    0H                                                BS2442 03030000
         CTSMSG1 CODE=CTS230E,ROUT=WTO,RAREA=WTOAREA                    03040000
         LA    R7,1(R7)                CTS210E CNTR+1            BS2442 03050000
         J     CLEANUP                                                  03060000
*                                                                       03070000
NOFRCHN  DS    0H                                                       03080000
         CTSMSG1 CODE=CTS233I,ROUT=WTO,RAREA=WTOAREA,                  X03090000
               PLANT=(7,PGMNAME,8,EVTUSER)                              03100000
         J     CLEANUP                                                  03110000
*                                                                       03120000
ERRPCC   DS    0H                                                       03130000
         CVD   R15,PACKD               CONVERT RC                       03140000
         UNPK  CHARRC,PACKD            ... TO                           03150000
         OI    CHARRC+7,X'F0'          ... EBCDIC                       03160000
         CTSMSG1 CODE=CTS231E,ROUT=WTO,RAREA=WTOAREA,                  X03170000
               PLANT=(4,CHARRC+4)                                       03180000
****************************************************************        03190000
*        issue Abend messgae                                   *        03200000
****************************************************************        03210000
CLEANUP  DS    0H                                                       03220000
         ICM   R2,15,ABNDCODE          R2 -> ABEND CODE WORD            03230000
         JZ    NOABEND                 ZERO, NO ABEND OCCURED           03240000
         MVI   ABNDTYPE,C'U'           ASSUME USER ABNED                03250000
         N     R2,=XL4'00000FFF'       ISOLATE USER ABEND CODE          03260000
         JNZ   ABENDMSG                HAVE IT, ISSUE THE MESSAGE       03270000
         L     R2,ABNDCODE             TRY AGAIN FOR SYSTEM ABNED       03280000
         SRL   R2,12                   ISOLATE SYSTEM ABEND CODE        03290000
         MVI   ABNDTYPE,C'S'           SET SYSTEM ABEND TYPE            03300000
ABENDMSG DS    0H                                                       03310000
         ST    R2,ABNDBIN              SAVE ISOLATED ABEND CODE         03320000
         UNPK  ABNDCHAR(9),ABNDBIN(5)  CONVERT ABEND CODE TO ZONED      03330000
         TR    ABNDCHAR(8),HEX2CHAR    CONEVRT TO CHARACTERS            03340000
         MVC   ABNDCHAR+4(1),ABNDTYPE  SET ABEND TYPE CHARACTER         03350000
         CTSMSG1 CODE=CTS232S,ROUT=WTO,RAREA=WTOAREA,                  X03360000
               PLANT=(8,PGMNAME,4,ABNDCHAR+4)                           03370000
NOABEND  DS    0H                                                       03380000
*--------------------------------------------------------------*        03390000
*        Decrease module use count                             *        03400000
*--------------------------------------------------------------*        03410000
DECUSECT DS    0H                                                       03420000
         L     R0,EXPUSECT                                              03430000
         LR    R1,R0                                                    03440000
         BCTR  R1,0                     decrease                        03450000
         CS    R0,R1,EXPUSECT           save new counter                03460000
         JNZ   DECUSECT                                                 03470000
*--------------------------------------------------------------*        03480000
*        Clrer recovery environment                            *        03490000
*--------------------------------------------------------------*        03500000
*                                                                       03510000
         ESTAE 0                                                        03520000
*                                                                       03530000
*--------------------------------------------------------------*        03540000
*        Release workarea storage                              *        03550000
*--------------------------------------------------------------*        03560000
         DROP  R13                                                      03570000
         LR    R1,R13                  ADDRESS FOR FREEMAIN             03580000
         L     R13,4(R13)              RESTORE CALLERS SAVE AREA        03590000
         LA    R0,WORKLEN              R0 = WORK AREA LENGTH            03600000
         FREEMAIN RC,LV=(R0),A=(R1)    FREE WORK AREA                   03610000
         LTR   R15,R15                 SUCCESS ?                        03620000
         JZ    NEXTEXIT                YES, CONTINUE                    03630000
         WTO   'CTS2NPH: FREEMAIN FAILED ERROR'                         03640000
         J     RETURN                                                   03650000
*--------------------------------------------------------------*        03660000
*        Branch to next exit if exists                         *        03670000
*--------------------------------------------------------------*        03680000
NEXTEXIT DS    0H                                                       03690000
         ICM   R15,15,EXPPREV          R15 -> NEXT EXIT                 03700000
         JZ    RETURN                  NO EXIT - RETURN TO CALLER       03710000
         C     R15,=XL4'FFFFFFFF'      NO PREVIOUS ?                    03720000
         JE    RETURN                  NO EXIT - RETURN                 03730000
         DROP  R10                                                      03740000
         L     R14,R12(R13,0)                                           03750000
         LM    R0,R12,20(R13)                                           03760000
         BSM   R0,R15                                                   03770000
*--------------------------------------------------------------*        03780000
*        TERMINATE TO CALLER                                   *        03790000
*--------------------------------------------------------------*        03800000
RETURN   DS    0H                                                       03810000
         SR    R15,R15                 LOAD RETURN CODE                 03820000
         RETURN (14,12),T,RC=(15)      RESTORE REGISTERS AND RETURN     03830000
*--------------------------------------------------------------*        03840000
*        SET ZOMBI AND QUIT                                    *        03850000
*--------------------------------------------------------------*        03860000
SETZOMBI DS    0H                                                BS2442 03870000
         WTO   'CTS2NPH: AUTO DISABLED'                          BS2442 03880000
         LR    R10,R12                                           BS2442 03890000
         S     R10,=A(EXPLEN)          R10 -> EXIT PREFIX        BS2442 03900000
         USING EXP,R10                                           BS2442 03910000
         OI    EXPFLAGS,EXPZOMBI       DISABLE EXIT              BS2442 03920000
         J     RETURN                                            BS2442 03930000
         DROP  R10                                               BS2442 03940000
*--------------------------------------------------------------*        03950000
*        CONSTANTS                                             *        03960000
*--------------------------------------------------------------*        03970000
         DS    0D                                                       03980000
FUJIFLAG DC    AL1(128)                FIXED FLAG FOR MVS SYSTEM        03990000
*                                                                       04000000
LSTESTAE ESTAE MF=L                    LIST FORM FOR ESTAE              04010000
LENESTAE EQU   *-LSTESTAE                                               04020000
*                                                                       04030000
         AIF   ('&SYSPARM(1)' NE 'DEBUG').SKP03                  @DBG   04040000
WTODSP   WTO   'Debug:                                                 X04050000
                                                            ',MF=L,    X04060000
               ROUTCDE=(2)                                              04070000
WTODSPL  EQU   *-WTODSP                                                 04080000
.SKP03   ANOP ,                                                  @DBG   04090000
*                                                                       04100000
HEXDIG   DC    CL16'0123456789ABCDEF'                                   04110000
HEX2CHAR EQU   HEXDIG-C'0'                                              04120000
         LTORG                                                          04130000
         DROP                                                           04140000
*--------------------------------------------------------------*        04150000
*        ABEND RECOVERY ROUTINE                                *        04160000
*--------------------------------------------------------------*        04170000
ABNDEXIT DS    0H                                                       04180000
         USING ABNDEXIT,R15            ABEND EXIT ADDRESSABILITY        04190000
         L     R12,=A(CTS2NPH)         RESTORE LMOD BASE REG            04200000
         DROP  R15                                                      04210000
         USING CTS2NPH,R12             RESTORE ITS ADDRESSABILITY       04220000
         C     R0,=F'12'               SDWA PROVIDED ?                  04230000
         JE    NOSDWA                  NO, CAN NOT RETRY                04240000
         USING SDWA,R1                 MAP SDWA                         04250000
         L     R13,SDWAPARM            RESTORE WORKAREA REGISTER        04260000
         USING WORKAREA,R13            MAP WORKAREA                     04270000
         MVC   ABNDCODE,SDWAABCC       SET ABEND CODE                   04280000
         TM    SDWAERRD,SDWACLUP       RETRY ALLOWED ?                  04290000
         JNZ   NORETRY                 NO, CAN NOT RETRY                04300000
*                                                                       04310000
RETRY    DS    0H                                                       04320000
         ST    R12,SDWASR12            SET BASE REGISTER FOR RETRY      04330000
         ST    R13,SDWASR13            SET WORKAREA REGISTER FOR RETRY  04340000
         MVC   SDWASR10,ADDREXP                                         04350000
         SETRP RETREGS=YES,RC=4,RETADDR=CLEANUP,                       X04360000
               FRESDWA=YES,DUMP=YES                                     04370000
         BR    R14                                                      04380000
*                                                                       04390000
NOSDWA   DS    0H                                                       04400000
         LR    R13,R2                   NO SDWA, PARM IN R2             04410000
         ST    R1,ABNDCODE              SAVE ABEND CODE                 04420000
         XR    R1,R1                    CLEAR                           04430000
NORETRY  DS    0H                                                       04440000
         XR    R15,R15                  INDICATE NO RETRY               04450000
         BR    R14                      RETURN TO RTM                   04460000
         LTORG                                                          04470000
         DROP                                                           04480000
****************************************************************        04490000
*        Dynamic Work Area DSECT                               *        04500000
****************************************************************        04510000
WORKAREA DSECT                                                          04520000
SAVEAREA DS    18F                     SAVE AREA TO CALL OTHERS         04530000
CALLAREA CALL  ,(,,,,),MF=L            EXECUTE FORM CALL AREA           04540000
PCCWORK  DS    XL512                   WORK AREA FOR CTSAPCC ROUTINE    04550000
RQCAREA  DS    CL(RQCLEN)              AREA FOR RQC                     04560000
PACKD    DS    D                       RETURN CODE CONVERSION           04570000
CHARRC   DS    CL8                     RETURN CODE CONVERSION           04580000
WTOAREA  DS    XL384                   WTO WORK AREA                    04590000
ABNDCODE DS    XL4                     ABCODE SAVED BY ESTAE ROUTINE    04600000
ABNDBIN  DS    XL5                     ISOLATED ABEND CODE + PAD BYTE   04610000
ABNDTYPE DS    CL1                     ABEND TYPE (S/U)                 04620000
ABNDCHAR DS    CL9                     CHARCTER ABEND CODE FOR MSG      04630000
X2C      EQU   ABNDCHAR,9                                          @DBG 04640000
SSNAME   DS    CL4                     SSNAME FROM EXP                  04650000
JOBNAME  DS    CL8                     JOBNAME FROM EXP                 04660000
PGMNAME  DS    CL8                     PROGRAM NAME FOR MSG             04670000
         DS    0F                                                       04680000
WRKESTAE DS    CL(LENESTAE)            EXECUTE FORM FOR ESTAE           04690000
ADDREXP  DS    A                       SAVE EXP ADDR FOR ABEND RETRY    04700000
RESERVED DS    16X                     RESERVED AREA                    04710000
WORKLEN  EQU   *-WORKAREA                                               04720000
****************************************************************        04730000
*        SA-AGENT CONTROL BLOCKS                               *        04740000
****************************************************************        04750000
RQC      DSECT                                                          04760000
         COPY  CTSRQC                  XMS REQUEST ELEMENT              04770000
EVT      DSECT                                                          04780000
         COPY  CTSEVT                  EVENT CONTROL BLOCK              04790000
EXP      DSECT                                                          04800000
         COPY  CTSAEXP                  MODULE PREFIX                   04810000
****************************************************************        04820000
*        SYSTEM DSECTS                                         *        04830000
****************************************************************        04840000
         IHASDWA                                                        04850000
         IHAPSA                                                         04860000
         CVT   DSECT=YES                                                04870000
         IHAASCB                                                        04880000
         IHAASXB                                                        04890000
*        IHAACEE                                                        04900000
         IKJTCB                                                         04910000
****************************************************************        04920000
*        ACF2 DSECTS                                           *        04930000
****************************************************************        04940000
         ACNPWPXT ,  ACF2 parameters macro area mapping                 04950000
         ACVALD                                                         04960000
         ACALT                                                          04970000
**                                                                      04980000
         END                                                            04990000
