         TITLE 'LIST RESOURCE ACL INFORMATION FROM RACF DATA BASE'      00010000
****************************************************************        00020000
****                                                        ****        00030000
****     CONTROL-SA  RELEASE 3.0.0                          ****        00040000
****                                                        ****        00050000
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00060000
****                                                        ****        00070000
****************************************************************        00080000
*                                                                       00090000
****************************************************************        00100000
*                                                              *        00110000
* TITLE            : CTSFGAC                                   *        00120000
*                                                              *        00130000
* FILE NAME        : CTSFGAC                                   *        00140000
*                                                              *        00150000
* AUTHOR           : ALEXANDER SHVARTSMAN                      *        00160000
*                                                              *        00170000
* CREATION DATE    : 24/12/97                                  *        00180000
*                                                              *        00190000
* DESCRIPTION      : LIST RESOURCE ACE INFO FROM RACF DATA BASE*        00200000
*                                                              *        00210000
* ASSUMPTIONS AND                                              *        00220000
*   CONSIDERATIONS : CALLER MUST BE APF AUTHORIZED             *        00230000
*                                                              *        00240000
****************************************************************        00250000
****************************************************************        00260000
* MOD.ID   WHO      WHEN     DESCRIPTION                       *        00270000
* -------- -------- -------- --------------------------------- *        00280000
* PS0288   ALEX     30/06/98 WHEN.SYSID SUPPORT                         00290000
* IS10186  AVNERL   21/01/24 RECOMP WITH CTSFXPR                        00292001
* IS10188  AVNERL   06/10/24 MOVE OUR MODULES ABOVE 16M LINE   *        00295002
****************************************************************        00300000
*        PARAMETER LIST DSECT                                           00310000
****************************************************************        00320000
*                                                                       00330000
PARMLIST DSECT                                                          00340000
AOPTION  DS    A                       OPTION CODE ( LOCATE/NEXT) - IN  00350000
AENTYP   DS    A                       ENTRY TYPE = 'DATASET',    - IN  00360000
*                                      OR GENERAL RESOURCE CLASS        00370000
AENTRY   DS    A                       ENTRY NAME                 - IN  00380000
AFGEN    DS    A                       GENERIC FLAG               - IN  00390000
AVOLUME  DS    A                       VOLUME                     - IN  00400000
AUNIT    DS    A                       UNIT                       - IN  00410000
AACL     DS    A                       ACE'S NUMBER               - IN  00430000
AOUT     DS    A                       OUTPUT LINE                - IN  00440000
ADEBUG   DS    A                       DEBUG LEVEL                - IN  00450000
ARCFRET  DS    A                       RACF RETURN CODE           - OUT 00460000
AREASON  DS    A                       RACF REASON CODE           - OUT 00470000
ASEP     DS    A                       SEPARATOR                  - IN  00480000
*                                                                       00490000
****************************************************************        00500000
*        INITIALIZE                                                     00510000
****************************************************************        00520000
*                                                                       00530000
CTSFGAC  CSECT                                                          00540000
CTSFGAC  AMODE 31                                                       00550000
*IS10188 CTSFGAC  RMODE 24       (FOR CTSADBG)                          00560002
CTSFGAC  RMODE ANY                                             IS10188  00561003
*        PRINT NOGEN                                                    00570000
         BEGIN *,R12,R11                                                00580000
         CTSEQUR                                                        00581000
         CTSLEVEL                                                       00590000
         LR    R10,R1                                                   00600000
         USING PARMLIST,R10            ADDRESABILITY PARAMETERS         00610000
*                                                                       00620000
*        SET DEBUG LEVEL                                                00630000
*                                                                       00640000
         L     R2,ADEBUG               R2 -> DEBUG LEVEL (4 BYTES)      00650000
         XC    DEBUGL,DEBUGL           STORE DEBUG LEVEL                00660000
         XC    DEBUG,DEBUG             STORE DEBUG LEVEL                00670000
         ICM   R2,15,0(R2)             DEBUG LEVEL                      00680000
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00690000
         STC   R2,DEBUGL               STORE DEBUG LEVEL (1 BYTE)       00700000
         ST    R2,DEBUG                STORE DEBUG LEVEL (1 BYTE)       00710000
NODEBUG  DS    0H                                                       00720000
         CTSADBG 'ENTERING',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=SADAREA      00730000
*                                                                       00740000
****************************************************************        00750000
*        PREPARE FOR EXTRACTOR CALL                                     00760000
****************************************************************        00770000
*                                                                       00780000
         L     R2,ASEP                 SEPARATOR                        00790000
         MVC   SEP(1),0(R2)            SAVE SEPARATOR                   00800000
         L     R2,AOUT                 EXTRACT AREA                     00810000
         ST    R2,AAREA                SAVE EXTRACT AREA ADDR           00820000
         NI    AAREA,X'7F'             CLEAR 0 - BYTE ( C-CONVENTIONS)  00830000
****************************************************************        01000000
*        ENTRY NAME HANDLING                                            01010000
****************************************************************        01020000
         MVI   ENTRY11,0               CLEAR LENGTH OF ENTRY FIELD      01030000
         L     R2,AENTRY                                                01040000
         MVC   ENTRY12(L'ENTRY12),0(R2)                                 01050000
         TR    ENTRY12(L'ENTRY12),TAB  CONVERT TO UPPERCASE             01060000
         LA    R1,ENTRY12+L'ENTRY12    MAX ENTRY NAME ADDR              01070000
         TRT   ENTRY12(L'ENTRY12),BLANKTAB                              01080000
         S     R1,=A(ENTRY12)                                           01090000
         LTR   R6,R1                   LENGTH = 0 ?                     01100000
         BNZ   LDSRLNZ                 NO,SKIP                          01110000
*-----------------------------------------------------------------      01120000
*        LENGTH=0 . VALID FOR 'NEXT' OPCODE                             01130000
*        IT MEANS SCAN DATABASE FROM THE BEGINING                       01140000
*-----------------------------------------------------------------      01150000
LDSRLZ   DS    0H                      LENGTH = 0                       01160000
         LA    R6,1                    LENGTH = 1                       01170000
         MVI   ENTRY11,1               INITIAL LENGTH = 1               01180000
         XC    ENTRY12,ENTRY12         CLEAR ENTRY NAME                 01190000
         B     LDSGCLS                                                  01200000
LDSRLNZ  DS    0H                                                       01210000
         STC   R6,ENTRY11              STORE REAL LENGTH OF ENTRY       01220000
LDSGCLS  DS    0H                                                       01230000
*                                                                       01231000
* -------------------------------------------------------               01240000
*        GET RESOURCE CLASS NAME                                        01250000
* -------------------------------------------------------               01260000
*                                                                       01261000
         MVC   CLASSR(8),=CL8' '                                        01270000
         L     R2,AENTYP               ADDR. CLASS-NAME                 01280000
         MVC   CLASSR(8),0(R2)                                          01290000
         TR    CLASSR(8),TAB           CONVERT CLASS  TO UPPERCASE      01300000
*                                                                       01310000
         CTSADBG 'CLASS=_ RESOURCE=#/_',LEVEL=(DEBUGL,3,4,5,6,7),      101320000
               (CLASSR,8,?R6,ENTRY12,?R6),RAREA=SADAREA                 01330000
*                                                                       01340000
* -------------------------------------------------------               01341000
*        GET VOLUME PARAMETER                                           01342000
* -------------------------------------------------------               01343000
*                                                                       01344000
         MVC   VOLUME(6),=CL6' '                                        01344100
         L     R2,AVOLUME              VOLUME                           01344200
         MVC   VOLUME(6),0(R2)                                          01344300
         TR    VOLUME(6),TAB           CONVERT VOLUME TO UPPERCASE      01344400
*                                                                       01344500
         CTSADBG 'VOLUME=_/$',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=SADAREA,  101344600
               (VOLUME,6,VOLUME,6)                                      01344700
*                                                                       01345000
* -------------------------------------------------------               01347000
*        GET OPCODE PARAMETER                                           01348000
* -------------------------------------------------------               01349000
*                                                                       01350000
         L     R2,AOPTION              OPTION CODE / LOCATE / NEXTC /   01370000
         MVC   OPTCDE(8),0(R2)         MOVE OPTION CODE                 01380000
         TR    OPTCDE(8),TAB           CONVERT OPTION TO UPPERCASE      01390000
*                                                                       01400000
         CTSADBG 'OPTION=_',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=SADAREA,    101410000
               (OPTCDE,8)                                               01420000
*                                                                       01430000
*        MOVE PARAMETERS RO TEST PROGRAMS (FOR DATASET PROCESSING)      01440000
*                                                                       01450000
         L     R5,DRACCTST             'DS'  EXIT-TEST ROUTINE          01460000
         USING TESTDACL,R5                                              01470000
         MVC   DBGRESD(1),DEBUGL       DEBUG LEVEL                      01480000
         MVC   TCLASSD(8),CLASSR       RESOURCE CLASS                   01490000
         DROP  R5                                                       01520000
*                                                                       01531000
*        MOVE PARAMETERS RO TEST PROGRAMS (FOR GENERAL RES PROCESSING)  01532000
*                                                                       01533000
         L     R5,GRACCTST             'GEN' EXIT-TEST ROUTINE          01540000
         USING TESTGACL,R5                                              01550000
         MVC   DBGRESG(1),DEBUGL       DEBUG LEVEL                      01560000
         MVC   TCLASSG(8),CLASSR       RESOURCE CLASS                   01570000
         DROP  R5                                                       01600000
*****************************************************************       01610000
*        LIST RESOURCE PROCESS. GET ICHENTRY ADDR                       01620000
*****************************************************************       01630000
         CLC   CLASSR(8),=CL8'DATASET' DATASET RESCOURCE CLASS ?        01640000
         BE    LDTSET                                                   01650000
         B     LGRSET                                                   01660000
LDTSET   DS    0H                                                       01670000
         CTSCALL GETLDPRM,,LINK=INT                                     01680000
         LR    R3,R15                  ICHEINTY ADDR OF PARM LIST       01690000
         B     LDSROPCD                                                 01700000
LGRSET   DS    0H                                                       01710000
         CTSCALL GETLGPRM,,LINK=INT                                     01720000
         LR    R3,R15                  ICHEINTY ADDR OF PARM LIST       01730000
         B     LDSROPCD                                                 01740000
*                                                                       01750000
****************************************************************        01760000
*        GENERIC,VOLUME PARAMETER HANDLING                              01770000
****************************************************************        01780000
*                                                                       01790000
LDSROPCD DS    0H                                                       01800000
         SR    R7,R7                   VOLUME ADDR DEFAULT (NO VOLUME)  01800100
         CLI   VOLUME,C' '             OBTAINED VOLUME ?                01800200
         BE    LDSRV0                  Y, SKIP                          01800300
         LA    R7,VOLUME               VOLUME ADDR                      01800400
LDSRV0   DS    0H                                                       01800500
         USING RXTPRM,R3               ADDRESSABILITY EXTRACTOR PARAMS  01800600
         L     R4,RXTRSGLT             SEGMENT'S LIST ADDR              01800700
         LA    R4,4(R4)                SKIP THE CONTROL WORD            01800800
LDSRV1   DS    0H                                                       01800900
         L     R5,8(R4)                ADDRESS ICHEINTY MACRO           01801000
         LTR   R5,R5                   END-OF-LIST ?                    01801100
         BZ    LDSRV2                  Y, SKIP                          01801200
*                                                                       01801300
         CTSADBG 'ICHEINTY=~ SET VOLUME=_ VOL.ADDR=~',                 101801400
               LEVEL=(DEBUGL,3,4,5,6,7),                               201801500
               (?R5,VOLUME,6,?R7),RAREA=SADAREA                         01801600
*                                                                       01801700
         ICHEINTY VOLUME=(R7),OPTIONS=(NOEXEC),                        X01801800
               RELEASE=1.8,MF=(E,(R5))                                  01801900
*                                                                       01802000
         LA    R4,16(R4)               GET NEXT ENTRY FROM TABLE        01802100
         B     LDSRV1                  LOOP                             01802200
*                                                                       01802300
LDSRV2   DS    0H                                                       01803000
         MVC   GENERIC(6),=CL6'UNCOND'                                  01830000
         L     R5,AFGEN                                                 01840000
         L     R6,0(R5)                                                 01850000
         LTR   R6,R6                                                    01860000
         BNZ   LDSRLCOP                                                 01870000
         MVC   GENERIC(6),=CL6'NO'                                      01880000
*                                                                       01890000
****************************************************************        01900000
*        LOCATE EXTRACTOR OPERATION                                     01910000
****************************************************************        01920000
*                                                                       01930000
LDSRLCOP DS    0H                                                       01940000
*                                                                       01950000
         CTSADBG 'OPCODE=_ GENERIC=_ RESET=_',RAREA=SADAREA,           X01960000
               (OPTCDE,6,GENERIC,6,RESET,3),LEVEL=(DEBUGL,3,4,5,6,7)    01970000
*                                                                       01980000
*        LOCATE OPCODE (FOR DATASET, GENERAL RESOURCE PROFILES)         02020000
*                                                                       02030000
LDSRLOCT DS    0H                                                       02040000
         L     R5,=A(MOVEACL)          CLEAR ACL'S COUNTER              02050000
         USING MOVEACL,R5                                               02060000
         XC    CURRCNT,CURRCNT                                          02070000
         MVC   DBGMV(1),DEBUGL         DEBUG LEVEL                      02072000
         DROP  R5                                                       02080000
*                                                                       02090000
         CTSFAGR LOCATE,RC=RETCODE,MF=(E,(R3))                          02100000
*                                                                       02350000
*        DIAG TRACE                                                     02360000
*                                                                       02370000
         L     R4,0(R3)                ICHEINTY MACRO PARAM LIST        02380000
         L     R5,20(R4)               RACF PREFIX AREA                 02390000
         SR    R6,R6                                                    02400000
         IC    R6,ENTRY11                                               02410000
         USING RETAREA,R5                                               02420000
*                                                                       02430000
         CTSADBG 'RC=#/#/# ENTRY=#/_ GENERIC=$ DUPCNT=# RBA=$',        *02440000
               (RETCODE,RETCODE+4,RETCODE+8,?R6,ENTRY12,?R6,           *02450000
               XPFFLGS,1,XPFDDSC,XPFRBA,6),                            *02460000
               LEVEL=(DEBUGL,5,6,7),RAREA=SADAREA                       02470000
*                                                                       02480000
         DROP  R5                                                       02490000
*                                                                       02500000
*------------------------------------------------------------           02620000
*     RETURN CURRENT ENTRY NAME TO CALLER                               02630000
*------------------------------------------------------------           02640000
*                                                                       02641000
LDSRRET  DS    0H                                                       02650000
         L     R2,AENTRY                                                02660000
         MVC   0(256,R2),=CL256' '                                      02670000
         SR    R6,R6                                                    02680000
         IC    R6,ENTRY11              LENGTH OF ENTRY NAME             02690000
*                                                                       02700000
         CTSADBG 'RETURNED ENTRY=#/_',RAREA=SADAREA,                   *02710000
               (?R6,ENTRY12,?R6),                                      *02720000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02730000
*                                                                       02731000
         BCTR  R6,0                                                     02740000
         EX    R6,MVCENTRY                                              02750000
* --------------------     1  - RACF RETURN CODE                        02760000
* --------------------     2  - RACF REASON CODE                        02770000
* --------------------     3  - EXTRACTOR RETURN CODE                   02780000
*------------------------------------------------------------           02790000
*        MOVE RETURN CODES TO CALLER                                    02800000
*------------------------------------------------------------           02810000
         L     R2,ARCFRET                                               02820000
         MVC   0(4,R2),RETCODE                                          02830000
         L     R2,AREASON                                               02840000
         MVC   0(4,R2),RETCODE+4                                        02850000
         L     R15,RETCODE+8                                            02860000
*                                                                       02861000
EXIT     DS    0H                                                       02870000
         CTSADBG 'EXITING WITH RC=~',(?R15),RAREA=SADAREA,             102880000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02890000
         BRTRN (15)                                                     02900000
*                                                                       02910000
         LTORG                                                          02920000
*                                                                       02930000
SADAREA  DS   32D                      DEBUG WORK AREA                  02931000
SEP      DS   CL1                      SEPARATOR                        02940000
AAREA    DS   F                        ADDRESS OUTPUT AREA AREA         02950000
DEBUG    DS   F                        DEBUG LEVEL                      02960000
DEBUGL   DS   CL1                      DEBUG LEVEL                      02970000
*                                                                       02980000
ENTRY1   DS   0H                       | ENTRY NAME                     03030000
ENTRY11  DS   AL1                      |    FOR                         03040000
ENTRY12  DS   CL256                    | RESOURCE PROFILE               03050000
*                                                                       03060000
OPTCDE   DS   CL8                      OPCODE:   LOCATE / NEXTC         03070000
CLASSR   DS   CL8                      RESOURCE CLASS FOR GET           03080000
VOLUME   DS   CL6                      VOLUME PARAMETER                 03090000
OUTP     DC   A(MOVEACL)               EXTERNAL OUTPUT ROUTINE          03100000
CTSFRXT  DC   V(CTSFRXT)               EXTRACTOR PROGRAM NAME           03110000
DRACCTST DC   A(TESTDACL)                                               03120000
GRACCTST DC   A(TESTGACL)                                               03130000
*                                      CLASS=SECDATA                    03140000
RETCODE  DS   3F                                                        03150000
* --------------------     1  - RACF RETURN CODE                        03160000
* --------------------     2  - RACF REASON CODE                        03170000
* --------------------     3  - EXTRACTOR RETURN CODE                   03180000
BLANKTAB DC    256AL1(00)                                               03190000
         ORG   BLANKTAB+X'40'                                           03200000
         DC    X'FF'                                                    03210000
         ORG   ,                                                        03220000
*                                                                       03230000
MVCENTRY MVC   0(0,R2),ENTRY12         MOVE ENTRY NAME                  03240000
*                                                                       03250000
TAB      DC    256AL1(*-TAB)           TRANSLATE TABLE TO UPPERCASE     03260000
         ORG   TAB                                                      03270000
         DC    40C' '                                                   03280000
         ORG   TAB+C'A'-X'40'                                           03290000
         DC    C'ABCDEFGHI'                                             03300000
         ORG   TAB+C'J'-X'40'                                           03310000
         DC    C'JKLMNOPQR'                                             03320000
         ORG   TAB+C'S'-X'40'                                           03330000
         DC    C'STUVWXYZ'                                              03340000
         ORG   ,                                                        03350000
*                                                                       03360000
* -------------------------------------------------------               03370000
*        ADDITIONAL PARAMETERS FOR DATASET PROCESSING                   03380000
* -------------------------------------------------------               03390000
RESET    DC   CL8'NO'                  RESET PREFIX PART RETURN         03400000
GENERIC  DC   CL8'UNCOND'              GENERIC PARAMETER                03410000
         DROP  ,                                                        03420000
****************************************************************        03430000
*                                                              *        03440000
* FUNCTION    : SET PARAMETER LIST ADDR                        *        03450000
* -------------                                                *        03460000
* RETURN CODES: NONE                                           *        03470000
* -------------                                                *        03480000
* RETURN VALUE: R15 - ADDR ICHEINTY TABLE                      *        03490000
* -------------                                                *        03500000
*                                                              *        03510000
****************************************************************        03520000
*                                                                       03530000
GETLDPRM BEGIN                                                          03540000
         L     R15,=A(GETDSPRM)                                         03550000
         BRTRN (15)                                                     03560000
*                                                                       03561000
****************************************************************        03570000
*        EXTRACTOR DEFINITION TABLES                                    03580000
****************************************************************        03590000
*                                                                       03760000
GETDSPRM CTSFAGR LOCATE,MF=L,DELAY=DELAYD,                             103770000
               TYPE='DS',OUTEP=OUTP,OUTAREA=AAREA,ENTRY=ENTRY1,        203780000
               TEST=DRACCTST,GENERIC=GENERIC,RESET=RESET,              303790000
               EOE=NO,GETPRG=CTSFRXT,DEBUG=DEBUG,                      403800000
               (TXTL='RESNAME'),                                       *03810000
               (ENTYPE,E,C,TXTL='RESTYPE'),                            *03820000
               (ACLCNT,E,X,TXTL='ACLCNT',IGNORE=YES),                  *03830000
               (USERID,L,C,TXTL='ID',EOL=NO),                          *03840000
               (ACSCNT,L,X,TXTL='INFO.ACC_COUNT',EOL=NO),              *03841000
               (USERACS,L,X,TXTL='ACCESS',TRN=ACSSD,EOL=YES,NL=YES),   *03850000
               (ACL2CNT,E,X,TXTL='ACL2CNT',IGNORE=YES),                *03860000
               (USER2ACS,L,C,TXTL='ID',EOL=NO),                        *03870000
               (PROGRAM,L,C,TXTL='WHEN.PROGRAM',EOL=NO),               *03880000
               (ACL2VAR,L,C,TXTL='WHENQ',EOL=NO,IGNORE=YES),           *03890000
               ($WPORT,E,C,TXTL='WHEN.APPCPORT',DELAY=YES,REPEAT=YES), *03890100
               ($WCNSL,E,C,TXTL='WHEN.CONSOLE',DELAY=YES,REPEAT=YES),  *03890200
               ($WJES,E,C,TXTL='WHEN.JESINPUT',DELAY=YES,REPEAT=YES),  *03890300
               ($WTERM,E,C,TXTL='WHEN.TERMINAL',DELAY=YES,REPEAT=YES), *03890400
               ($WSYSID,E,C,TXTL='WHEN.SYSID',DELAY=YES,REPEAT=YES),   *03890500
               (PACSCNT,L,X,TXTL='INFO.ACC_COUNT',EOL=NO),             *03890600
               (PROGACS,L,X,TXTL='ACCESS',TRN=ACSSD,EOL=YES,NL=YES)     03900000
* -------------------------------------------------------               03910000
ACSSD    DC    XL1'FF'                 ACCESS TRANSLATE TABLE           03920000
         DC    B'10000000',AL1(5),CL5'ALTER'                            03920100
         DC    B'01000000',AL1(7),CL7'CONTROL'                          03920200
         DC    B'00100000',AL1(6),CL6'UPDATE'                           03920300
         DC    B'00010000',AL1(4),CL4'READ'                             03920400
         DC    B'00001000',AL1(7),CL7'EXECUTE'                          03920500
         DC    B'00000100',AL1(8),CL8'RESERVED'                         03920600
         DC    B'00000010',AL1(8),CL8'RESERVED'                         03920700
         DC    B'00000001',AL1(4),CL4'NONE'                             03920800
         DC    B'00000000'             END OF TABLE                     03920900
* ----------------------------------------------------------            04050000
*                                      DUMMY DELAY PARAMETER            04050100
DELAYD   CTSFAGR LOCATE,MF=L,TYPE='DS',ENTRY=ENTRY1,DELAY=YES           04050200
* ----------------------------------------------------------            04051000
         LTORG                                                          04060000
* -------------------------------------------------------               04070000
         DROP  ,                                                        04080000
****************************************************************        04090000
*                                                              *        04100000
* FUNCTION    : SET PARAMETER LIST ADDR                        *        04110000
* -------------                                                *        04120000
* RETURN CODES: NONE                                           *        04130000
* -------------                                                *        04140000
* RETURN VALUE: R15 - ADDR ICHEINTY TABLE                      *        04150000
* -------------                                                *        04160000
*                                                              *        04170000
****************************************************************        04180000
*                                                                       04190000
GETLGPRM BEGIN                                                          04200000
         L     R15,=A(GETGRPRM)                                         04210000
         BRTRN (15)                                                     04220000
*                                                                       04221000
****************************************************************        04230000
*        EXTRACTOR DEFINITION TABLES                                    04240000
****************************************************************        04250000
*                                                                       04260000
GETGRPRM CTSFAGR LOCATE,MF=L,DELAY=DELAYG,                             104430000
               TYPE='GEN',OUTEP=OUTP,OUTAREA=AAREA,ENTRY=ENTRY1,       204440000
               TEST=GRACCTST,GENERIC=GENERIC,RESET=RESET,              304450000
               EOE=NO,GETPRG=CTSFRXT,CLASS=CLASSR,DEBUG=DEBUG,         404460000
               (TXTL='RESNAME'),                                       *04470000
               (CLASTYPE,E,C,TXTL='RESTYPE'),                          *04480000
               (ACLCNT,E,X,TXTL='ACLCNT',IGNORE=YES),                  *04490000
               (USERID,L,C,TXTL='ID',EOL=NO),                          *04500000
               (ACSCNT,L,X,TXTL='INFO.ACC_COUNT',EOL=NO),              *04501000
               (USERACS,L,X,TXTL='ACCESS',TRN=ACSSG,EOL=YES,NL=YES),   *04510000
               (ACL2CNT,E,X,TXTL='ACL2CNT',IGNORE=YES),                *04520000
               (ACL2UID,L,C,TXTL='ID',EOL=NO),                         *04540000
               (ACL2RSVD,L,C,TXTL='WHENQ',EOL=NO,IGNORE=YES),          *04550000
               ($WPORT,E,C,TXTL='WHEN.APPCPORT',DELAY=YES,REPEAT=YES), *04550100
               ($WCNSL,E,C,TXTL='WHEN.CONSOLE',DELAY=YES,REPEAT=YES),  *04550200
               ($WJES,E,C,TXTL='WHEN.JESINPUT',DELAY=YES,REPEAT=YES),  *04550300
               ($WTERM,E,C,TXTL='WHEN.TERMINAL',DELAY=YES,REPEAT=YES), *04550400
               ($WSYSID,E,C,TXTL='WHEN.SYSID',DELAY=YES,REPEAT=YES),   *04550500
               (ACL2ACNT,L,X,TXTL='INFO.ACC_COUNT',EOL=NO),            *04550600
               (ACL2ACC,L,X,TXTL='ACCESS',TRN=ACSSG,EOL=YES,NL=YES)     04610000
*                                                                       04620000
         LTORG                                                          04630000
*                                                                       04631000
*        DELAY DUMMY PARAMETER                                          04632000
*                                                                       04633000
*                                      DUMMY DELAY PARAMETER            04634000
DELAYG   CTSFAGR LOCATE,MF=L,TYPE='GEN',ENTRY=ENTRY1,DELAY=YES          04635000
*                                                                       04640000
* -------------------------------------------------------               04670000
ACSSG    DC    XL1'FF'                 ACCESS TRANSLATE TABLE           04801000
         DC    B'10000000',AL1(5),CL5'ALTER'                            04802000
         DC    B'01000000',AL1(7),CL7'CONTROL'                          04803000
         DC    B'00100000',AL1(6),CL6'UPDATE'                           04804000
         DC    B'00010000',AL1(4),CL4'READ'                             04805000
         DC    B'00001000',AL1(7),CL7'EXECUTE'                          04806000
         DC    B'00000100',AL1(7),CL7'UNKNOWN'                          04807000
         DC    B'00000010',AL1(7),CL7'UNKNOWN'                          04808000
         DC    B'00000001',AL1(4),CL4'NONE'                             04809000
         DC    B'00000000'             END OF TABLE                     04809100
* -------------------------------------------------------               04810000
         DROP  ,                                                        04820000
****************************************************************        04830000
*                                                              *        04840000
* FUNCTION    : TEST ROUTINE FOR LIST RESOURCES ACE'S          *        04850000
*               'DATASET' RESOURCE CLASS                       *        04860000
****************************************************************        04870000
*                                                                       04880000
TESTDACL BEGIN                                                          04890000
*--------------------------------------------------------------------   04900000
*        ADDRESSABILITY MAIN PARAMETERS                                 04910000
*--------------------------------------------------------------------   04920000
         USING PARMM,R1                                                 04930000
         L     R2,XPROPCD                                               04940000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 04950000
         BE    LSTARTD                          RACF DATA BASE          04960000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 04970000
         BE    LENTRYD                          RACF DATA BASE          04980000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         04990000
         BE    LELEMND                                                  05000000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               05010000
         BE    LLISTD                                                   05020000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      05030000
         BE    LENDD                            EXTRACTOR               05040000
         B     RET0D                                                    05050000
*                                                                       05060000
********************************************************************    05070000
*        START                                                          05080000
********************************************************************    05090000
*                                                                       05100000
LSTARTD  DS    0H                                                       05110000
         B     RET0D                                                    05120000
*                                      CATEGORIES CODES                 05130000
********************************************************************    05140000
*        ENTRY                                                          05150000
********************************************************************    05160000
*                                                                       05170000
LENTRYD  DS    0H                                                       05180000
         L     R3,XPRENTRY                                              05190000
         L     R5,0(R3)                ENTRY NAME LENGTH                05200000
         L     R4,XPRPRFXY                                              05210000
         L     R4,0(R4)                                                 05220000
         USING RETAREA,R4                                               05250000
*                                                                       05260000
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X05270000
               (?R5,4(R3),?R5,XPFFLGS,1),                              X05280000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       05290000
*                                                                       05300000
         DROP  R4                                                       05310000
         MVC   WHENQD(8),=CL8'*NONE*'  NO WHEN QUALIFIER FOUND   PS0288 05320000
         B     RET0D                   Y, RETURN (ACCEPT)               05390000
*                                                                       05400000
********************************************************************    05410000
*        ELEMNTRY FIELD                                                 05420000
********************************************************************    05430000
*                                                                       05440000
LELEMND  DS    0H                                                       05450000
         L     R3,XPRFNME              RACF FIELD NAME                  05460000
         L     R4,XPRFADRE             RACF FIELD VALUE                 05470000
         L     R5,0(R4)                FIELD LENGTH                     05480000
*                                                                       05490000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          X05500000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      X05510000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       05520000
*                                                                       05530000
         CLC   =CL8'ENTYPE',0(R3)                                       05540000
         BE    LCLASSD                                                  05550000
         CLC   =CL8'CLASTYPE',0(R3)                                     05560000
         BE    LCLASSD                                                  05570000
         CLC   =CL8'$WPORT',0(R3)      'WHEN.APPCPORT'                  05571000
         BE    LWPORT                                                   05571100
         CLC   =CL8'$WCNSL',0(R3)      'WHEN.CONSOLE'                   05572000
         BE    LWCNSL                                                   05572100
         CLC   =CL8'$WJES ',0(R3)      'WHEN.JESINPUT'                  05573000
         BE    LWJES                                                    05573100
         CLC   =CL8'$WTERM',0(R3)      'WHEN.TERMINAL'                  05574000
         BE    LTERM                                                    05575000
         CLC   =CL8'$WSYSID',0(R3)     'WHEN.SYSID'              PS0288 05576000
         BE    LSYSID                                            PS0288 05577000
         B     RET0D                                             PS0288 05580000
*                                                                       05590000
LCLASSD  DS    0H                                                       05600000
         MVC   0(4,R4),=F'8'           CLASS NAME LENGTH                05610000
         MVC   4(8,R4),TCLASSD                                          05620000
         B     RET0D                                                    05630000
*                                                                       05630100
LWPORT   DS    0H                                                       05631000
         CLC   WHENQD(8),=CL8'APPCPORT'                                 05631200
         BNE   RET4D                   DO NOT PUT TO EXTRACT AREA       05631300
         B     PUTWHENQ                PUT WHEN QUALIFIER               05631400
LWCNSL   DS    0H                                                       05632000
         CLC   WHENQD(8),=CL8'CONSOLE'                                  05632200
         BNE   RET4D                   DO NOT PUT TO EXTRACT AREA       05632300
         B     PUTWHENQ                PUT WHEN QUALIFIER               05632400
LWJES    DS    0H                                                       05633000
         CLC   WHENQD(8),=CL8'JESINPUT'                                 05633200
         BNE   RET4D                   DO NOT PUT TO EXTRACT AREA       05633300
         B     PUTWHENQ                PUT WHEN QUALIFIER               05633400
LTERM    DS    0H                                                       05634000
         CLC   WHENQD(8),=CL8'TERMINAL'                                 05636000
         BNE   RET4D                   DO NOT PUT TO EXTRACT AREA       05637000
         B     PUTWHENQ                PUT WHEN QUALIFIER               05638000
LSYSID   DS    0H                                                       05638100
         CLC   WHENQD(8),=CL8'SYSID'                             PS0288 05638200
         BNE   RET4D                   DO NOT PUT TO EXTRCT AREA PS0288 05638300
         B     PUTWHENQ                PUT WHEN QUALIFIER        PS0288 05638400
*                                                                       05638500
PUTWHENQ DS    0H                      PUT WHEN QUALIFIER               05639000
         MVC   WORKD(4),WHENILD                                         05639200
         L     R7,WORKD                SAVE WHEN OBJECT LENGTH          05639300
         CTSADBG 'RETURN:WHEN._=#/_',                                  *05639600
               (WHENQD,8,?R7,WHENITMD,?R7),                            *05639700
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       05639800
*                                                                       05639900
         LTR   R7,R7                                                    05640000
         BZ    RET4D                                                    05640100
*                                                                       05640700
*        RETURN WHEN QUALIFIER NAME                                     05640800
*                                                                       05640900
         MVC   0(4,R4),WHENILD         WHEN QUALIFIER LENGTH            05641000
         BCTR  R7,0                                                     05641100
         EX    R7,RETWHND              RETURN WHEN NAME QUALIFIER       05641200
         MVC   WORKD(4),=F'0'                                           05641300
         MVC   WHENQD(8),=CL8'*NONE*'  WHEN QUALIFIER RETURNED  PS0288  05641400
         B     RET0D                   PUT DATA TO ADDINFO              05641500
*                                                                       05643000
********************************************************************    05650000
*        LIST FIELD                                                     05660000
********************************************************************    05670000
*                                                                       05680000
LLISTD   DS    0H                                                       05690000
         L     R3,XPRFNML                                               05700000
         L     R4,XPRFADRL                                              05710000
         L     R5,0(R4)                FIELD LENGTH                     05720000
*                                                                       05730000
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *05740000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *05750000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       05760000
*                                                                       05770000
         CLC   =CL8'ACL2VAR',0(R3)                                      05771000
         BE    L2VARD                                                   05772000
         CLC   =CL8'PROGRAM',0(R3)                                      05773000
         BE    L2VARDP                                                  05774000
         CLC   =CL8'USERACS',0(R3)                                      05775000
         BE    LACSSD                                                   05776000
         CLC   =CL8'PROGACS',0(R3)                                      05777000
         BE    LACSSD                                                   05778000
         B     RET0D                   PUT DATA TO EXTRACT AREA         05780000
* --------------------------------------------------------------        05780100
*        FIX 'USERACS', 'PROGACS' FIELDS                                05780200
*        THE ACCESS='NONE' MAY BE IS 'ON' IN SPITE OF                   05780300
*        HIGHER FLAG IS 'ON' TOO. SEE TRANSLATE TABLE ACSSD             05780400
* --------------------------------------------------------------        05780500
LACSSD   DS    0H                                                       05781000
         TM    4(R4),B'00000001'       FLAG 'NONE' IS 'ON' ?            05781100
         BZ    RET0D                   N,PUT DATA TO EXTRACT AREA       05782000
         TM    4(R4),B'11111110'       HOW ABOUT OTHER FLAGS ?          05782100
         BZ    RET0D                   ALL OTHERS IS 'OFF'.NO PROBLEM   05782200
         NI    4(R4),B'11111000'       SET 'NONE' FLAF TO 'OFF'         05782300
         B     RET0D                   PUT DATA TO EXTRACT AREA         05783000
* --------------------------------------------------------------        05785300
*        'PROGRAM' FIELD                                                05785400
* --------------------------------------------------------------        05785500
*        WHEN RECIEVED AN EMPTY 'PROGRAM' FIELD, IT MEANS THAT          05785600
*        INFORMATION SHOULD BE EXTRACTED FROM ACL2VAR FIELD             05785700
*        FOR SECOND APPEARNCE OF THIS FIELD SHOULD BE RETURNED          05785800
*        'WHEN' QUALIFIER NAME (AFTER SEPARATING ACL2VAR FIELD)         05785900
* --------------------------------------------------------------        05786000
*                                                                       05786100
L2VARDP  DS    0H                                                       05786200
         CLI   4(R4),0                 FIELD EXISTS ?                   05787000
         BE    RET4D                   DO NOT PUT TO EXTRACT AREA       05789100
         B     RET0D                   PUT TO EXTRACT AREA              05789200
* --------------------------------------------------------              05789300
*        WHEN.XXXXXXXX     INFORMATION PROCESSING                       05789400
*        FIELD STRUCTURE : LEN=8 WHEN QUALIFIER(APPCPORT,TERMINAL,,)    05789500
*                          LEN=4 WHEN OBJECT LENGTH                     05789600
*                          LEN=X WHEN OBJECT                            05789700
* --------------------------------------------------------              05789800
L2VARD   DS    0H                                                       05789900
         MVC   WHENILD(4),=F'0'        RESET WHEN ITEM LENGTH           05790100
         LTR   R5,R5                   WHEN QUALIFIER LENGTH = 0 ?      05790200
         BZ    RET4D                   Y, RETURN                        05790300
         MVC   WHENQD(8),4(R4)         WHEN QUALIFIER                   05790400
         LR    R6,R4                   ADDR OF FIELD                    05790500
         LA    R6,4(R6)                SKIP FIELD LENGTH                05790600
         LA    R6,8(R6)                SKIP QUALIFIER                   05790700
         XC    WORKD,WORKD             CLEAR WHEN OBJECT LENGTH         05790800
         MVC   WORKD+1(3),0(R6)        GET OBJECT LENGTH                05790900
         L     R7,WORKD                SAVE WHEN OBJECT LENGTH          05791000
         MVC   WHENILD(4),WORKD        WHEN ITEM LENGTH                 05791100
         LA    R6,3(R6)                SKIP OBJECT LENGTH               05791200
*                                                                       05791300
         CTSADBG 'WHEN QUALIFIER=_/#/_',                               *05791400
               (WHENQD,8,?R7,0(R6),?R7),                               *05791500
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAG                       05791600
*                                                                       05791700
         BCTR  R7,0                    DECR FOR EXECUTE COMMAND         05791800
         EX    R7,MVWITEMD             MOVE WHEN ITEM                   05791900
         B     RET4D                   DO NOT PUT DATA TO EXTRACT AREA  05792100
* --------------------------------------------------------              05793000
*        END                                                            05800000
* --------------------------------------------------------              05810000
LENDD    DS    0H                                                       05820000
         B     RET0D                                                    05830000
* --------------------------------------------------------              05840000
*        EXITING                                                        05850000
* --------------------------------------------------------              05860000
RET0D    DS    0H                                                       05870000
         SR    R15,R15                                                  05880000
         B     RETTD                                                    05890000
RET4D    DS    0H                                                       05900000
         LA    R15,4                                                    05910000
         B     RETTD                                                    05920000
RET8D    DS    0H                                                       05930000
         LA    R15,8                                                    05940000
         B     RETTD                                                    05950000
RETTD    DS    0H                                                       05960000
         BRTRN (15)                                                     05970000
********************************************************************    05980000
*        W O R K  A R E A  A N D   C O N S T A N T S                    05990000
********************************************************************    06000000
*                                                                       06010000
RAREAD   DS    64F                                                      06020000
DBGRESD  DS    XL1                     DEBUG LEVEL                      06080000
PROGC    DC    XL1'00'                 'PROGRAM' FIELD COUNTER          06081000
TCLASSD  DS    CL8                     CLASS NAME                       06090000
MVWITEMD MVC   WHENITMD(0),0(R6)       MOVE WHEN ITEM                   06090100
RETWHND  MVC   4(0,R4),WHENITMD        RETURN WHEN ITEM NAME            06090200
WORKD    DS    F                                                        06091000
WHENQD   DS    CL8                     WHEN QUALIFIER                   06092000
WHENTLD  DS    AL4                     WHEN TOTAL LIST LENGTH           06093000
WHENILD  DS    AL4                     WHEN ITEM LENGTH                 06094000
WHENITMD DS    CL256                   WHEN ITEM                        06095000
********************************************************************    06100000
*       W O R K  A R E A  A N D   C O N S T A N T S                     06110000
********************************************************************    06120000
         LTORG                                                          06130000
         DROP  ,                                                        06140000
*                                                                       06150000
****************************************************************        06160000
*                                                              *        06170000
* FUNCTION    : TEST ROUTINE FOR LIST RESOURCES ACE'S          *        06180000
*               'GENERAL' RESOURCE CLASSES                     *        06190000
****************************************************************        06200000
*                                                                       06210000
TESTGACL BEGIN                                                          06220000
*--------------------------------------------------------------------   06230000
*        ADDRESSABILITY MAIN PARAMETERS                                 06240000
*--------------------------------------------------------------------   06250000
         USING PARMM,R1                                                 06260000
         L     R2,XPROPCD                                               06270000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 06280000
         BE    LSTARTG                          RACF DATA BASE          06290000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 06300000
         BE    LENTRYG                          RACF DATA BASE          06310000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         06320000
         BE    LELEMNG                                                  06330000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               06340000
         BE    LLISTG                                                   06350000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      06360000
         BE    LENDG                            EXTRACTOR               06370000
         B     RET0G                                                    06380000
*                                                                       06390000
********************************************************************    06400000
*        START                                                          06410000
********************************************************************    06420000
*                                                                       06430000
LSTARTG  DS    0H                                                       06440000
         B     RET0G                                                    06450000
*                                      CATEGORIES CODES                 06460000
********************************************************************    06470000
*        ENTRY                                                          06480000
********************************************************************    06490000
*                                                                       06500000
LENTRYG  DS    0H                                                       06510000
         L     R3,XPRENTRY                                              06520000
         L     R5,0(R3)                ENTRY NAME LENGTH                06530000
         L     R4,XPRPRFXY                                              06540000
         L     R4,0(R4)                                                 06550000
         USING RETAREA,R4                                               06580000
*                                                                       06590000
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X06600000
               (?R5,4(R3),?R5,XPFFLGS,1),                              X06610000
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       06620000
*                                                                       06630000
         DROP  R4                                                       06640000
         MVC   WHENQ(8),=CL8'*NONE*'   NO WHEN QUALIFIER FOUND   PS0288 06650000
         B     RET0G                   Y, RETURN (ACCEPT)               06720000
*                                                                       06730000
********************************************************************    06740000
*        ELEMNTRY FIELD                                                 06750000
********************************************************************    06760000
*                                                                       06770000
LELEMNG  DS    0H                                                       06780000
         L     R3,XPRFNME              RACF FIELD NAME                  06790000
         L     R4,XPRFADRE             RACF FIELD VALUE                 06800000
         L     R5,0(R4)                FIELD LENGTH                     06810000
*                                                                       06820000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          X06830000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      X06840000
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       06850000
*                                                                       06860000
         CLC   =CL8'ENTYPE',0(R3)                                       06870000
         BE    LCLASSG                                                  06880000
         CLC   =CL8'CLASTYPE',0(R3)                                     06890000
         BE    LCLASSG                                                  06900000
         CLC   =CL8'$WPORT',0(R3)      'WHEN.APPCPORT'                  06910000
         BE    LWPORTG                                                  06920000
         CLC   =CL8'$WCNSL',0(R3)      'WHEN.CONSOLE'                   06930000
         BE    LWCNSLG                                                  06940000
         CLC   =CL8'$WJES ',0(R3)      'WHEN.JESINPUT'                  06950000
         BE    LWJESG                                                   06960000
         CLC   =CL8'$WTERM',0(R3)      'WHEN.TERMINAL'                  06970000
         BE    LTERMG                                                   06980000
         CLC   =CL8'$WSYSID',0(R3)     'WHEN.SYSID'              PS0288 06990000
         BE    LSYSIDG                                           PS0288 07000000
         B     RET0G                                                    07030000
*                                                                       07500000
LCLASSG  DS    0H                                                       07510000
         MVC   0(4,R4),=F'8'           CLASS NAME LENGTH                07520000
         MVC   4(8,R4),TCLASSG                                          07530000
         B     RET0G                                                    07540000
*                                                                       07550000
LWPORTG  DS    0H                                                       07562000
         CLC   WHENQ(8),=CL8'APPCPORT'                                  07563000
         BNE   RET4G                   DO NOT PUT TO EXTRACT AREA       07564000
         B     PUTWHENG                PUT WHEN QUALIFIER               07565000
LWCNSLG  DS    0H                                                       07566000
         CLC   WHENQ(8),=CL8'CONSOLE'                                   07567000
         BNE   RET4G                   DO NOT PUT TO EXTRACT AREA       07568000
         B     PUTWHENG                PUT WHEN QUALIFIER               07569000
LWJESG   DS    0H                                                       07569100
         CLC   WHENQ(8),=CL8'JESINPUT'                                  07569200
         BNE   RET4G                   DO NOT PUT TO EXTRACT AREA       07569300
         B     PUTWHENG                PUT WHEN QUALIFIER               07569400
LTERMG   DS    0H                                                       07569500
         CLC   WHENQ(8),=CL8'TERMINAL'                                  07569600
         BNE   RET4G                   DO NOT PUT TO EXTRACT AREA       07569700
         B     PUTWHENG                PUT WHEN QUALIFIER               07569800
*                                                                       07569900
LSYSIDG  DS    0H                                                       07570000
         CLC   WHENQ(8),=CL8'SYSID'                              PS0288 07570100
         BNE   RET4G                   DO NOT PUT TO EXTRCT AREA PS0288 07570200
         B     PUTWHENG                PUT WHEN QUALIFIER        PS0288 07570300
*                                                                       07570400
PUTWHENG DS    0H                      PUT WHEN QUALIFIER               07570500
         MVC   WORK(4),WHENIL                                           07571000
         L     R7,WORK                 SAVE WHEN OBJECT LENGTH          07572000
         CTSADBG 'RETURN:WHEN._=#/_',                                  *07573000
               (WHENQ,8,?R7,WHENITM,?R7),                              *07574000
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       07575000
*                                                                       07576000
         LTR   R7,R7                                                    07577000
         BZ    RET4G                                                    07578000
*                                                                       07579000
*        RETURN 'WHEN' QUALIFIER NAME                                   07579100
*                                                                       07579200
         MVC   0(4,R4),WHENIL          WHEN QUALIFIER LENGTH            07579300
         BCTR  R7,0                                                     07579400
         EX    R7,RETWHN               RETURN WHEN NAME QUALIFIER       07579600
         MVC   WORK(4),=F'0'                                            07579700
         MVC   WHENQ(8),=CL8'*NONE*'   WHEN QUALIFIER RETURNED  PS0288  07579800
         B     RET0G                   PUT DATA TO EXTRACT AREA         07586000
*                                                                       08003000
********************************************************************    08010000
*        LIST FIELD                                                     08020000
********************************************************************    08030000
*                                                                       08040000
LLISTG   DS    0H                                                       08050000
         L     R3,XPRFNML                                               08060000
         L     R4,XPRFADRL                                              08070000
         L     R5,0(R4)                FIELD LENGTH                     08080000
*                                                                       08090000
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *08100000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *08110000
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       08120000
*                                                                       08130000
         CLC   =CL8'ACL2RSVD',0(R3)                                     08140000
         BE    L2VARG                                                   08150000
         CLC   =CL8'USERACS',0(R3)                                      08151100
         BE    LACSSG                                                   08151200
         CLC   =CL8'ACL2ACC',0(R3)                                      08151300
         BE    LACSSG                                                   08151400
         B     RET0G                   PUT DATA TO EXTRACT AREA         08160000
* --------------------------------------------------------------        08161000
*        FIX 'USERACS', 'ACL2ACC' FIELDS                                08162000
*        THE ACCESS='NONE' MAY BE IS 'ON' IN SPITE OF                   08163000
*        HIGHER FLAG IS 'ON' TOO. SEE TRANSLATE TABLE ACSSD             08164000
* --------------------------------------------------------------        08165000
LACSSG   DS    0H                                                       08166000
         TM    4(R4),B'00000001'       FLAG 'NONE' IS 'ON' ?            08167000
         BZ    RET0G                   N,PUT DATA TO EXTRACT AREA       08168000
         TM    4(R4),B'11111110'       HOW ABOUT OTHER FLAGS ?          08169000
         BZ    RET0G                   ALL OTHERS IS 'OFF'.NO PROBLEM   08169100
         NI    4(R4),B'11111000'       SET 'NONE' FLAF TO 'OFF'         08169200
         B     RET0G                   PUT DATA TO EXTRACT AREA         08169300
* --------------------------------------------------------              08170000
*        WHEN.XXXXXXXX     INFORMATION PROCESSING                       08180000
*        FIELD STRUCTURE : LEN=8 WHEN QUALIFIER(APPCPORT,TERMINAL,,)    08190000
*                          LEN=4 WHEN OBJECT LENGTH                     08200000
*                          LEN=X WHEN OBJECT                            08210000
* --------------------------------------------------------              08220000
L2VARG   DS    0H                                                       08230000
         MVC   WHENQ(8),4(R4)          WHEN QUALIFIER                   08240000
         LR    R6,R4                   ADDR OF FIELD                    08250000
         LA    R6,4(R6)                SKIP FIELD LENGTH                08260000
         LA    R6,8(R6)                SKIP QUALIFIER                   08270000
         XC    WORK,WORK               CLEAR WHEN OBJECT LENGTH         08271000
         MVC   WORK+1(3),0(R6)         GET OBJECT LENGTH                08280000
         L     R7,WORK                 SAVE WHEN OBJECT LENGTH          08290000
         MVC   WHENIL(4),WORK          WHEN ITEM LENGTH                 08300000
         LA    R6,3(R6)                SKIP OBJECT LENGTH               08310000
*                                                                       08320000
         CTSADBG 'WHEN QUALIFIER=_/#/_',                               *08330000
               (WHENQ,8,?R7,0(R6),?R7),                                *08340000
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       08350000
*                                                                       08360000
         BCTR  R7,0                    DECR FOR EXECUTE COMMAND         08370000
         EX    R7,MVWITEM              MOVE WHEN ITEM                   08380000
         MVC   0(4,R4),=F'8'           WHEN QUALIFIER LENGTH            08381000
         MVC   4(8,R4),WHENQ           WHEN QUALIFIER                   08382000
* PS0288 B     RET0G                   PUT DATA TO EXTRACT AREA         08391000
         B     RET4G                   DON'T PUT DATA            PS0288 08392000
*                                                                       08400000
* --------------------------------------------------------              08418000
*        END                                                            08420000
* --------------------------------------------------------              08430000
*                                                                       08440000
LENDG    DS    0H                                                       08450000
         B     RET0G                                                    08460000
* --------------------------------------------------------              08470000
*        EXITING                                                        08480000
* --------------------------------------------------------              08490000
RET0G    DS    0H                                                       08500000
         SR    R15,R15                                                  08510000
         B     RETTG                                                    08520000
RET4G    DS    0H                                                       08530000
         LA    R15,4                                                    08540000
         B     RETTG                                                    08550000
RET8G    DS    0H                                                       08560000
         LA    R15,8                                                    08570000
         B     RETTG                                                    08580000
RETTG    DS    0H                                                       08590000
         BRTRN (15)                                                     08600000
********************************************************************    08610000
*        W O R K  A R E A  A N D   C O N S T A N T S                    08620000
********************************************************************    08630000
*                                                                       08640000
RAREAG   DS    64F                                                      08650000
DBGRESG  DS    XL1                     DEBUG LEVEL                      08710000
TCLASSG  DS    CL8                     CLASS NAME                       08720000
*                                                                       08730000
MVWITEM  MVC   WHENITM(0),0(R6)        MOVE WHEN ITEM                   08740000
RETWHN   MVC   4(0,R4),WHENITM         RETURN WHEN ITEM NAME            08751000
WORK     DS    F                                                        08760000
WHENQ    DS    CL8                     WHEN QUALIFIER                   08770000
WHENTL   DS    AL4                     WHEN TOTAL LIST LENGTH           08780000
WHENIL   DS    AL4                     WHEN ITEM LENGTH                 08790000
WHENITM  DS    CL256                   WHEN ITEM                        08800000
********************************************************************    08810000
*       W O R K  A R E A  A N D   C O N S T A N T S                     08820000
********************************************************************    08830000
         LTORG                                                          08840000
         DROP  ,                                                        08850000
******************************************************************      08860000
*                                                                       08870000
* ---------------------------------------------------------------       08880000
MOVEACL  BEGIN                                                          08890000
* -------------------------------------ENTRY WRITE                      08900000
         LR    R11,R1                                                   08910000
         L     R6,4(R11)                                                08920000
         L     R6,0(R6)                ADDRESS AREA                     08930000
         MVC   LRECL(4),4(R6)          USING PART                       08940000
*                                                                       08950000
         LR    R7,R6                                                    08960000
         A     R7,LRECL                                                 08970000
         LA    R7,8(R7)                LENGTH + PREFIX LENGTH           08980000
         CTSADBG TYPE=SNAP,ID=1,HDR='**  ACL AREA  **',                108990000
               ADDR=(0(R6),0(R7)),RAREA=MVDAREA,                       209000000
               LEVEL=(DBGMV,3,4,5,6,7)                                  09002000
*                                                                       09010000
         L     R5,CURRCNT              ACL COUNTER += 1                 09020000
         LA    R5,1(R5)                                                 09030000
         ST    R5,CURRCNT                                               09040000
         SR    R4,R4                                                    09050000
         MVC   MAXREC(4),0(R6)         MAX LENGTH                       09060000
         L     R10,MAXREC                                               09070000
         LA    R10,8(R10)              MAX LEN _ PREFIX LENGTH (8)      09080000
         ST    R10,MAXREC                                               09090000
*                                                                       09100000
         CTSADBG 'ACL N=# MAX.LENGTH+PREFIX=# ',(?R5,MAXREC),          *09110000
               LEVEL=(DBGMV,3,4,5,6,7),RAREA=MVDAREA                    09111000
*                                                                       09120000
         M     R4,MAXREC                                                09130000
         LR    R8,R6                  ADDRESS AREA                      09140000
         AR    R8,R5                  ADDRESS FOR MVCL                  09150000
         L     R9,MAXREC                                                09160000
         L     R7,MAXREC                                                09170000
*                                                                       09180000
         CTSADBG 'MOVE FROM ADDR=~ ----> TO ADDR=~ LEN=#',             *09190000
               (?R6,?R8,?R7),RAREA=MVDAREA,                            *09191000
               LEVEL=(DBGMV,3,4,5,6,7)                                  09192000
*                                                                       09200000
         MVCL  R8,R6                                                    09210000
         BRTRN 0                                                        09220000
         LTORG                                                          09230000
LRECL    DS    F                       USE LENGTH                       09240000
MAXREC   DS    F                       MAX LENGTH                       09250000
CURRCNT  DS    F                       ACL ENTRIES COUNTER              09260000
MVDAREA  DS    32D                     DEBUG WORK AREA                  09260100
DBGMV    DS    CL1                     DEBUG LEVEL                      09261000
         LTORG ,                                                        09262000
* ---------------------------------------------------------------       09270000
         DROP  ,                                                        09280000
******************************************************************      09290000
*        MAIN PARAMETERS LIST FOR TEST FUNCTIONS                        09300000
******************************************************************      09310000
PARMM    DSECT                                                          09320000
         COPY  CTSFXPR                                                  09330000
******************************************************************      09340000
*        RACF RETURN AREA PREFIX                                        09350000
******************************************************************      09360000
RETAREA  DSECT                                                          09370000
         COPY  CTSFXPF                                                  09380000
******************************************************************      09380100
*        MAIN EXTRACTOR PARAMETERS LIST                                 09380200
******************************************************************      09380300
RXTPRM   DSECT                                                          09380400
RXTINTY  DS    A                       ADDRESS ICHEINTY MACRO           09380500
RXTEXT   DS    A                       ADDRESS GET PROGRAM              09380600
RXTDBG   DS    A                       DEBUG LEVEL                      09380700
RXTRC    DS    A                       RETURN CODE - 3 WORDS            09380800
*                                       1  - RACF RETURN CODE           09380900
*                                       2  - RACF REASON CODE           09381000
*                                       3  - EXTRACTOR RC               09381100
*                                                                       09381200
RXTOP    DS    CL8                     OPERATION  ( NEXT / LOCATE )     09381300
RXTPRF   DS    CL8                     PROFILE TYPE ( USR,GRP,..  )     09381400
RXTENTRY DS    A                       ENTRY VALUE                      09381500
RXTFLDS  DS    A                       ADDR FIELDS DESCRIPTIONS         09381600
RXTETXT  DS    A                       TEXT FOR ENTRY FIELD             09381700
RXTOUT   DS    A                       EXT OUTPUT ROUT. ( V - CONTST)   09381800
RXTEXTA  DS    A                       ADDR OUTPUT AREA                 09381900
RXT1LINE DS    A                       ONE LINE PARAMETER               09382000
RXTALST  DS    A                       ADDRESS ACTION LIST              09382100
RXTRULE  DS    A                       ADDR RULE LIST                   09382200
RXTGEN   DS    A                       ADDRESS GENERIC PARAMETER        09382300
RXTRST   DS    A                       ADDRESS RESET PARAMETER          09382400
RXTTSTP  DS    A                       ADDRESS EXIT TEST ROUTINE        09382500
RXTPRX   DS    A                       ICHEINTY MIN. WORK AREA          09382600
RXTMAP   DS    A                       ADDR MAP PARAMETER               09382700
RXTDELAY DS    A                       DELAY PARAMETER LIST             09382800
*                                                                       09382900
*   ADDITIONAL PARAMETERS  (2.1.0)                                      09383000
*                                                                       09383100
RXTRAREA DS    A                       RACF RETURN AREA                 09383200
RXTRSGLT DS    A                       SEGMENT'S LIST ADDR              09383300
*                                      HL2:0- UPDATE ICHEINTY REQUIRED  09383400
*                                          1- UPDATE ICHEINTY DONE      09383500
*                                      HL2: NUMBER OF SEGMENTS          09383600
*                                      CL8'SEGM-NAME',A(ICHEINTY-ADDR), 09383700
*                                                     A(0)-SEGM EXISTS  09384000
         END   CTSFGAC                                                  09390000
