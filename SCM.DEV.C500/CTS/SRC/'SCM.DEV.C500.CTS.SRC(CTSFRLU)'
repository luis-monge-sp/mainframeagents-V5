         TITLE 'LIST USER INFORMATION FROM RACF DATA BASE'              00010000
****************************************************************        00020000
****                                                        ****        00030000
****     CONTROL-SA  RELEASE 1.3.0                          ****        00040000
****                                                        ****        00050000
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00060000
****                                                        ****        00070000
****************************************************************        00080000
*                                                                       00090000
****************************************************************        00100000
*                                                              *        00110000
* TITLE            : CTSFRLU                                   *        00120000
*                                                              *        00130000
* FILE NAME        : CTSFRLU                                   *        00140000
*                                                              *        00150000
* AUTHOR           : ALEX SHVARTSMAN                           *        00160000
*                                                              *        00170000
* CREATION DATE    : 01/04/94                                  *        00180000
*                                                              *        00190000
* DESCRIPTION      : LIST USER INFORMATION FROM  RACF DATA BASE*        00200000
*                                                              *        00210000
* ASSUMPTIONS AND                                              *        00220000
*   CONSIDERATIONS : CALLER MUST BE AUTHORIZED                 *        00230000
*                                                              *        00240000
****************************************************************        00250000
****************************************************************        00260000
* MOD.ID   WHO      WHEN     DESCRIPTION                       *        00270000
* -------- -------- -------- --------------------------------- *        00280000
* AS0602   ALEX     06/02/95 CHANGE FIELD NAME 'REVOKE_STATUS' *        00290000
*                            TO 'REVOKED'                      *        00300000
* AS2706   ALEX     27/06/95 CHANGE TRANSLATE TABLE FOR FIELD  *        00310000
*                            OPERPARM.AUTH                     *        00320000
* SPR124   ALEX     18/07/95 RETURN SECURITY LEVEL CODE IN CASE*        00330000
*                            THAT CODE NOT FOUND IN GENERAL    *        00340000
*                            RESOURCE PROFILE                  *        00350000
* SPR132   ALEX     18/07/95 CHANGE TRANSLATE TABLE FOR FIELD  *        00360000
*                            'NAME'                            *        00370000
* SPR137   ALEX     30/07/95 WHEN PASSWORD INTERVAL EQUAL 'FF' *        00380000
*                            RETURN STRING "NO"                *        00390000
* ISAR0001 ALEX     28/03/96 RACF 2.2 SUPPORT                  *        00400000
*          ALEX     22/04/96 ADDED SPECIAL OMVS.UID FIELD PROCS*        00410000
*          ALEX     28/04/96 CHANGED CICS.TIMEOUT FIELD PROCS  *        00420000
*                                                              *        00430000
* PS0095    AS      03/06/97 CALL TO CTSADTE INSTEAD TO CTSFDTE*        00440000
* PS0150    AS      21/07/97 TEMPLATE CHECKING SUPPORT         *        00450000
*                            DCE SEGMENT SUPPORT               *        00460000
* PS0163    AS      29/07/97 RACF SECURITY SERVER SUPPORT      *        00470000
* PS0169    AS      29/07/97 RACF TABLE MINOR CHANGES          *        00480000
* BSR2032  ALEX     04/09/97 CICS.TIMEOUT RETURNED INCORRECTLY *        00490000
* PS0292    AS      16/07/98 DIGITAL CERTIFICATE SUPPORT       *        00500000
* BS2403   ALEXS    18/10/99 RACF 2.8 DOWNLOAD OF ENTIRE       *        00510000
*                            DATABASE DOES NOT RETURN ALL      *        00520000
*                            USERS TO ESS DATABASE             *        00530000
* PS0391   ALEXS    02/11/99 RACF 2.8 SUPPORT                  *        00540000
* PS0402   AS       20/12/99 RACF DATABASE CORRUPTION HANDLING *        00550000
* WS2377   SHMUELK  27/03/01 RESTRICTED/NORESTRICTED ATTRIBUTE *        00560000
* PS0460   SHMUELK  10/04/01 PROTECTED (NOPASSWORD) ATTRIBUTE  *        00570000
* BS2715   YONIMA   12/09/06 DIGITAL CERTIFICATE               *        00580000
* BS10001  ELIMY    11/12/06 DROP "FUTURE" REVOKE TEST         *        00590000
* IS10076  NURITY   31/01/13 SUPPORT CUSTOM FIELDS.            *        00600000
* WS10053  SELIGT   24/05/16 SUPPORT RACDCERT MAP DISPLAY      *        00610000
* SAS2IBMN NURITY   12/12/16 RESOLVE USING WARNING.            *        00611000
* CIQ#6    SELIGT   19/03/17 ACCOUNT AGGREGATION NOW INCLUDES  *        00612000
*                            CONNECTIONS                       *        00613000
* IS10147A SELIGT   19/07/17 ADD SUPPORT FOR PASSWORD PHRASE   *        00613100
* WS10070  KAILASP  04/03/18 ADD CONNECTION ATTRIBUTES AND     *        00613200
*                            ROAUDIT SUPPORT                   *        00613300
* WS10081  NURITY   26/05/21 MFA SUPPORT                       *        00613407
* WS10087  AVNERL   14/01/24 SUPPORT WORKATTR.WAEMAIL          *        00613510
* IS10186  AVNERL   21/01/24 RECOMP WITH CTSFXPR               *        00613611
* IS10188  AVNERL   06/10/24 MOVE OUR MODULES ABOVE 16M LINE   *        00613712
****************************************************************        00613810
*                                                                       00613910
****************************************************************        00614010
*        PARAMETER LIST DSECT                                           00614110
****************************************************************        00614210
*                                                                       00614310
PARMLIST DSECT                                                          00614410
AOPTION  DS    A                       ADDR OPTION CODE ( LOCATE/NEXT)  00614510
AENTYP   DS    A                       ADDR.ENTRY TYPE = 'USER'         00614610
AENTRY   DS    A                       ADDR ENTRY NAME                  00615000
AFGEN    DS    A                       ADDR. GENERIC FLAG = 0           00616000
AOUT     DS    A                       ADDR OUTPUT LINE                 00617000
ADEBUG   DS    A                       ADDR.DEBUG LEVEL                 00618000
ARCFRET  DS    A                       ADDR RACF RETURN CODE            00619000
AREASON  DS    A                       ADDR RACF REASON CODE            00620000
ASEP     DS    A                       SEPARATOR                        00630000
*                                                                       00640000
****************************************************************        00650000
*        INITIALIZE                                                     00660000
****************************************************************        00670000
*                                                                       00680000
CTSFRLU  CSECT                                                          00690000
CTSFRLU  AMODE 31                                                       00700000
*IS10188 CTSFRLU  RMODE 24       (FOR CTSADBG)                          00710012
CTSFRLU  RMODE ANY                                              IS10188 00711012
*IS10076 PRINT NOGEN                                                    00720000
         BEGIN *,R12,R11                                                00730000
         CTSEQUR                                                        00740000
*IS10076 CTSLEVEL                                                       00750000
*SAS2IBMN CTSLEVEL PATCH=NO                                    IS10076  00760000
         CTSLEVEL                                             SAS2IBMN  00770000
         LR    R10,R1                                                   00780000
         USING PARMLIST,R10            ADDRESABILITY PARAMETERS         00790000
*                                                                       00800000
*        SET DEBUG LEVEL                                                00810000
*                                                                       00820000
         L     R2,ADEBUG               R2 -> DEBUG LEVEL (4 BYTES)      00830000
         XC    DEBUGL,DEBUGL           STORE DEBUG LEVEL                00840000
         XC    DEBUG,DEBUG             STORE DEBUG LEVEL                00850000
         ICM   R2,15,0(R2)             DEBUG LEVEL                      00860000
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00870000
         STC   R2,DEBUGL               STORE DEBUG LEVEL (1 BYTE)       00880000
         ST    R2,DEBUG                STORE DEBUG LEVEL (1 BYTE)       00890000
NODEBUG  DS    0H                                                       00900000
         CTSADBG 'ENTERING',LEVEL=(DEBUGL,3,4,5,6,7)                    00910000
*                                                                       00920000
****************************************************************        00930000
*        PREPARE FOR EXTRACTOR CALL                                     00940000
****************************************************************        00950000
*                                                                       00960000
         L     R2,ASEP                 SEPARATOR                        00970000
         MVC   SEP(1),0(R2)            SAVE SEPARATOR                   00980000
         L     R2,AOUT                                                  00990000
         ST    R2,AAREA                STORE ADDRESS OUTPUT AREA        01000000
         NI    AAREA,X'7F'             CLEAR 0 - BYTE ( C-CONVENTIONS)  01010000
         MVI   ENTRY11,0               CLEAR LENGTH OF ENTRY FIELD      01020000
         L     R2,AENTRY                                                01030000
         MVC   ENTRY12(8),0(R2)                                         01040000
*BS2403  TR    ENTRY12(8),TAB          CONVERT TO UPPERCASE             01050000
         TR    ENTRY12(8),REPL_C_NULL  RELACE "C" NULL_CHAR      BS2403 01060000
         LA    R2,ENTRY12              ADDRESS OF ENTRY NAME            01070000
****************************************************************        01080000
*    CALCULATE REAL LENGTH OF ENTRY NAME                                01090000
****************************************************************        01100000
         LA    R1,ENTRY12+8            MAX ENTRY NAME ADDR              01110000
         TRT   ENTRY12(8),BLANKTAB                                      01120000
         S     R1,=A(ENTRY12)                                           01130000
         LTR   R6,R1                   LENGTH = 0 ?                     01140000
         BNZ   LUSRLNZ                 NO,SKIP                          01150000
*-----------------------------------------------------------------      01160000
*   LENGTH=0 . VALID FOR 'NEXT' OPCODE                                  01170000
*   IT MEANS SCAN DATABASE FROM THE BEGINING                            01180000
*-----------------------------------------------------------------      01190000
LUSRLZ   DS    0H                      LENGTH = 0                       01200000
         MVI   ENTRY11,1               INITIAL LENGTH = 1               01210000
         XC    ENTRY12,ENTRY12         CLEAR ENTRY NAME                 01220000
         B     LUSRPP                                                   01230000
LUSRLNZ  DS    0H                                                       01240000
         STC   R6,ENTRY11              STORE REAL LENGTH OF ENTRY       01250000
LUSRPP   DS    0H                      PREPARE PARAMETERS               01260000
         L     R2,AOPTION              OPTION CODE / LOCATE / NEXTC /   01270000
         MVC   OPTCDE(8),0(R2)         MOVE OPTION CODE                 01280000
         TR    OPTCDE(8),TAB           CONVERT OPTION TO UPPERCASE      01290000
         XC    PLCATEG,PLCATEG         CLEAR POINTER CATEG. AREA        01300000
         L     R5,TSTLU                EXIT-TEST ROUTINE                01310000
         USING TESTLU,R5                                                01320000
         MVC   PTRCTGAS(4),=A(LCATEG)  STATIC PTR  TO CATEG.AREA        01330000
         MVC   PTRCTGAD(4),=A(PLCATEG) DYNAMIC PTR TO CATEG.AREA        01340000
         MVC   DBGCNN(1),DEBUGL        DEBUG LEVEL                      01350000
         DROP  R5                                                       01360000
*****************************************************************       01370000
*   LIST USER PROCESS. GET ICHENTRY ADDR ACCORDING RACF VERSION         01380000
*****************************************************************       01390000
LU       DS    0H                                                       01400000
         CTSCALL GETLUPRM,,LINK=INT                                     01410000
         LR    R3,R15                  ICHEINTY ADDR OF PARM LIST       01420000
*                                                                       01430000
****************************************************************        01440000
*     LOCATE/NEXT EXTRACTOR OPERATION                                   01450000
****************************************************************        01460000
*                                                                       01470000
LUSROPCD DS    0H                                                       01480000
         CLC   OPTCDE(6),=CL6'LOCATE'                                   01490000
         BNE   LUSRNEXT                                                 01500000
LUSRLOCT DS    0H                                                       01510000
         CTSFAGR LOCATE,RC=RETCODE,MF=(E,(R3))                          01520000
         B     LUSR5                                                    01530000
LUSRNEXT DS    0H                                                       01540000
         CTSFAGR NEXTC,RC=RETCODE,MF=(E,(R3))                           01550000
         B     LUSR5                                                    01560000
LUSR5    DS    0H                                                       01570000
         LTR   R15,R15                 WAS EXTRACTOR/RACF ERROR ?       01580000
         BNZ   LUSRRET                 Y, RETURN                        01590000
*        B     LUSRCNT1                                                 01600000
         B     LUSRCNT2                                                 01610000
************************************************************            01620000
*    DEFINITION DEFAULT GROUP ACCESS PARAMETERS                         01630000
*    NOT USED NOW                                                       01640000
************************************************************            01650000
LUSRCNT1 DS    0H                                                       01660000
         L     R5,TSTGRP            TEST ROUTINE                        01670000
         USING TESTGRP,R5                                               01680000
         MVC   DBGGRP(1),DEBUGL     DEBUG LEVEL                         01690000
         LA    R8,USERID            ADDR OF USERID FIELD IN TST/PROG    01700000
         MVC   USERID(8),=CL8' '    CLEAR USERID FIELD                  01710000
         SR    R6,R6                                                    01720000
         IC    R6,ENTRY1            LENGTH OF ENTRY NAME                01730000
         BCTR  R6,0                 DECR FOR EX COMMAND                 01740000
         EX    R6,MVCUSER           MOVE USERID TST/PROGRAM             01750000
         DROP  R5                                                       01760000
         L     R5,TSTLU             EXIT TEST ROUTINE                   01770000
         USING TESTLU,R5                                                01780000
*---------------------------------------------------------------        01790000
*   MOVE DEFAULT GROUP VALUE TO EXIT TESTLU PROGRAM                     01800000
*---------------------------------------------------------------        01810000
         MVC   EDFLTGRP+1(8),DFLTGRP DEFAULT GROUP FIELD                01820000
         DROP  R5                                                       01830000
* -----------------------------------------------------------------     01840000
*     DEFINITION REAL LENGTH OF DEFAULT GROUP                           01850000
*     EDFLTGRP FIELD STRUCTURE :                                        01860000
*            1 BYTE  - FIELD LEN                                        01870000
*            2-...   - FIELD VALUE                                      01880000
* -----------------------------------------------------------------     01890000
         LA    R1,EDFLTGRP+9        MAX ENTRY NAME ADDR                 01900000
         TRT   EDFLTGRP+1(8),BLANKTAB                                   01910000
         S     R1,=A(EDFLTGRP+1)                                        01920000
         STC   R1,EDFLTGRP          STORE LENGTH OF ENTRY               01930000
LUSRGRGT CTSFAGR LOCATE,                                               101940000
               TYPE='GRP',OUTEP=OUTP,OUTAREA=AAREA,FORMAT=INTERNAL,    201950000
               DATAMAP=NEW,ENTRY=EDFLTGRP,RC=RETCODF,DEBUG=DEBUG,      301960000
               EOE=NO,GETPRG=CTSFRXT,TEST=TSTGRP,                      401970000
               (TXTL='GROUP=',IGNORE=YES),                             *01980000
               (ACLCNT,E,X,TXTL='ACLCNT'),                             *01990000
               (USERID,L,C,TXTL='USERID',EOL=NO),                      *02000000
               (USERACS,L,X,TXTL='AUTHORITY',TRN=TRTAU,EOL=NO)          02010000
************************************************************            02020000
LUSRGRF  DS    0H                                                       02030000
*------------------------------------------------------------           02040000
*  FROM 'USR' PROFILE CAN CONSIST ONLY CODE OF CATEGORIES               02050000
*                                        AND SEC. LEVEL                 02060000
*  NOW - SEARCH TEXT EQUVIVALENTS                                       02070000
*------------------------------------------------------------           02080000
LUSRCNT2 DS    0H                                                       02090000
         L     R5,PLCATEG              DYNAMIC AREA PTR                 02100000
         LTR   R5,R5                   DYNAMIC AREA WAS USED ?          02110000
         BNZ   LUSRCTG0                                                 02120000
         LA    R5,LCATEG               STATIC AREA                      02130000
LUSRCTG0 DS    0H                                                       02140000
         L     R9,TSTLU                TEST ROUTINE                     02150000
         USING TESTLU,R9                                                02160000
         SR    R7,R7                                                    02170000
         CLI   SECLVL,X'FF'            DEFAULT SECURITY LEVEL ?         02180000
         BNE   LUSRCTG1                NO . NEED ACCESS TO              02190000
*                                      GENERAL RESOURCE PROFILE         02200000
*                                      ABOUT SEC. LEVEL                 02210000
         CLC   4(4,R5),=F'0'           COUNT OF CATEGORIES = 0 ?        02220000
         BE    LUSRGENF                NOT NEED ACCESS TO GENERAL       02230000
*                                      RESOURCE  PROFILE                02240000
LUSRCTG1 DS    0H                                                       02250000
         IC    R7,SECLVL               SEC.LEVEL FROM CONNECT TEST/R    02260000
         DROP  R9                                                       02270000
         L     R6,TSTGRES              TEST ROUTINE                     02280000
         USING TESTGRES,R6                                              02290000
         MVC   DBGGRS(1),DEBUGL        DEBUG LEVEL                      02300000
         ST    R5,AREAPTR              CURRENT PTR OF CATEG. LIST       02310000
         STC   R7,SCLV                 SEC.LEVEL TO GEN.RES TEST/R      02320000
         DROP  R6                                                       02330000
         MVI   ENTRY1R,1               | CLEAR ENTRY NAME               02340000
         XC    ENTRY2R,ENTRY2R         | FOR ACCESS                     02350000
LUSRGENR CTSFAGR NEXT,                                                 102360000
               TYPE='GEN',OUTEP=OUTP,OUTAREA=AAREA,FORMAT=INTERNAL,    202370000
               DATAMAP=NEW,ENTRY=ENTRYR,RC=RETCODF,TEST=TSTGRES,       302380000
               EOE=NO,GETPRG=CTSFRXT,CLASS=CLASS,DEBUG=DEBUG,          402390000
               (TXTL='RESOURCE-NAME=',REPEAT=YES,IGNORE=YES),          *02400000
               (MEMCNT,E,X,TXTL='MEMCNT'),                             *02410000
               (MEMLST,L,C,TXTL='CATEGORY'),                           *02420000
               (CLASTYPE,E,X,TXTL='INFO.UNKNOWNCAT'),                  *02430000
               (LEVEL,E,C,TXTL='SECLEVEL')                              02440000
         LTR   R15,R15                                                  02450000
         BZ    LUSRGENR                                                 02460000
LUSRGENF DS    0H                                                       02470000
         L     R5,PLCATEG              DYNAMIC AREA PTR                 02480000
         LTR   R5,R5                   DYNAMIC AREA WAS USED ?          02490000
         BZ    LUSRNDN                 NO                               02500000
         L     R6,PLCATEG+4            DYNAMIC AREA LENGTH              02510000
         FREEMAIN RC,LV=(R6),A=(R5)                                     02520000
         LTR   R15,R15                                                  02530000
         BZ    LUSRRET                                                  02540000
         ST    R15,RETCODE+4                                            02550000
         LA    R15,32                  INVALID FREEMAIN                 02560000
         ST    R15,RETCODE+8                                            02570000
LUSRNDN  DS    0H                                                       02580000
*------------------------------------------------------------           02590000
*     RETURN CURRENT ENTRY NAME TO CALLER                               02600000
*------------------------------------------------------------           02610000
LUSRRET  DS    0H                                                       02620000
         L     R2,AENTRY                                                02630000
         MVC   0(8,R2),=CL8' '                                          02640000
         SR    R6,R6                                                    02650000
         IC    R6,ENTRY11              LENGTH OF ENTRY NAME             02660000
         BCTR  R6,0                                                     02670000
         EX    R6,MVCENTRY                                              02680000
* --------------------     1  - RACF RETURN CODE                        02690000
* --------------------     2  - RACF REASON CODE                        02700000
* --------------------     3  - EXTRACTOR RETURN CODE                   02710000
*------------------------------------------------------------           02720000
*     MOVE RETURN CODES TO CALLER                                       02730000
*------------------------------------------------------------           02740000
         L     R2,ARCFRET                                               02750000
         MVC   0(4,R2),RETCODE                                          02760000
         L     R2,AREASON                                               02770000
         MVC   0(4,R2),RETCODE+4                                        02780000
         L     R15,RETCODE+8                                            02790000
EXIT     DS    0H                                                       02800000
         CTSADBG 'EXITING WITH RC=~',(?R15),                           102810000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02820000
         BRTRN (15)                                                     02830000
*                                                                       02840000
         LTORG                                                          02850000
*                                                                       02860000
SEP      DS   CL1                      SEPARATOR                        02870000
AAREA    DS   F                        ADDRESS OUTPUT AREA AREA         02880000
DEBUG    DS   F                        DEBUG LEVEL                      02890000
DEBUGL   DS   CL1                      DEBUG LEVEL                      02900000
*                                                                       02910000
ENTRY1   DS   0H                       | ENTRY NAME                     02920000
ENTRY11  DS   AL1                      |    FOR                         02930000
ENTRY12  DS   CL256                    | 'USR' PROFILE           PS0402 02940000
* PS0402 ENTRY12  DS   CL10                                             02950000
*                                                                       02960000
ENTRYR   DS   0H                       | ENTRY NAME FOR GENERAL         02970000
ENTRY1R  DS   AL1                      | RESOURCE                       02980000
ENTRY2R  DS   CL256                    | PROFILE                        02990000
*                                                                       03000000
EDFLTGRP DS   CL10                     DEFAULT GROUP FIELD+LENGTH       03010000
OPTCDE   DS   CL8                      OPCODE:   LOCATE / NEXTC         03020000
CLASS    DC   CL8'SECDATA'                                              03030000
OUTP     DC   A(DUMMYU)                EXTERNAL OUTPUT ROUTINE          03040000
CTSFRXT  DC   V(CTSFRXT)               EXTRACTOR NAME                   03050000
TSTLU    DC   A(TESTLU)                TEST ROUTINE FOR LU              03060000
TSTGRP   DC   A(TESTGRP)               TEST ROUTINE GROUP               03070000
TSTGRES  DC   A(TESTGRES)              TEST ROUTINE GENERAL RESOURCE    03080000
RETCODE  DS   3F                                                        03090000
* --------------------     1  - RACF RETURN CODE                        03100000
* --------------------     2  - RACF REASON CODE                        03110000
* --------------------     3  - EXTRACTOR RETURN CODE                   03120000
RETCODF  DS   3F                                                        03130000
LCATEG   DC   F'512'                   MAX LENGTH OF AREA               03140000
         DS   F                        COUNT OF CATEGORIES              03150000
         DS   512CL1                   LIST OF CATEGORIES INDEXES       03160000
PLCATEG  DS   D                        PTR TO AREA FOR LIST OF CATEG    03170000
*                                      1-ST WORD - ADDRESS              03180000
*                                      2-ND WORD - LENGTH               03190000
*                                      IN CASE GETMAIN                  03200000
BLANKTAB DC    256AL1(00)                                               03210000
         ORG   BLANKTAB+X'40'                                           03220000
         DC    X'FF'                                                    03230000
         ORG   ,                                                        03240000
*                                                                       03250000
MVCUSER  MVC   0(0,R8),ENTRY12         MOVE USERID                      03260000
MVCENTRY MVC   0(0,R2),ENTRY12         MOVE ENTRY NAME                  03270000
TAB      DC    256AL1(*-TAB)           TRANSLATE TABLE TO UPPERCASE     03280000
         ORG   TAB                                                      03290000
         DC    40C' '                                                   03300000
         ORG   TAB+C'A'-X'40'                                           03310000
         DC    C'ABCDEFGHI'                                             03320000
         ORG   TAB+C'J'-X'40'                                           03330000
         DC    C'JKLMNOPQR'                                             03340000
         ORG   TAB+C'S'-X'40'                                           03350000
         DC    C'STUVWXYZ'                                              03360000
         ORG   ,                                                        03370000
*                                                                       03380000
REPL_C_NULL  DC  256AL1(*-REPL_C_NULL)   REPLACE "C" NULL_CHAR   BS2403 03390000
         ORG   REPL_C_NULL                                       BS2403 03400000
         DC    40C' '                                            BS2403 03410000
         ORG   ,                                                 BS2403 03420000
*                                                                       03430000
         DROP  ,                                                        03440000
****************************************************************        03450000
*                                                              *        03460000
* FUNCTION    : DEFINITION PARAMETER LIST ACCORDING RACF VERS. *        03470000
* -------------                                                *        03480000
* PARAMETERS  : RACF VERSION/RELEASE                           *        03490000
* -------------                                                *        03500000
* RETURN CODES: NONE                                           *        03510000
* -------------                                                *        03520000
* RETURN VALUE: R15 - ADDR ICHEINTY TABLE                      *        03530000
* -------------                                                *        03540000
*                                                              *        03550000
****************************************************************        03560000
*                                                                       03570000
GETLUPRM BEGIN                                                          03580000
         L     R15,=A(GTUSRB)                                           03590000
         BRTRN (15)                                                     03600000
         LTORG                                                          03610000
****************************************************************        03620000
*        EXTRACTOR DEFINITION TABLES                                    03630000
****************************************************************        03640000
*                                                                       03650000
GTUSRB   CTSFAGR NEXTC,MF=L,CHAIN=GTUSR,                               103660000
               TYPE='USR',OUTEP=OUTP,OUTAREA=AAREA,                    203670000
               ENTRY=ENTRY1,RC=RETCODE,TEST=TSTLU,                     303680000
               EOE=NO,GETPRG=CTSFRXT,DEBUG=DEBUG,                      403690000
               (TXTL='USERID'),                                        *03700000
               (AUTHOR,E,C,TXTL='OWNER'),                              *03710000
               (FLAG1,E,X,TXTL='ADSP',TRN=T1),                         *03720000
               (FLAG2,E,X,TXTL='SPECIAL',TRN=T1),                      *03730000
               (FLAG3,E,X,TXTL='OPERATIONS',TRN=T1),                   *03740000
               (FLAG5,E,X,TXTL='GRPACC',TRN=T1),                       *03750000
               (FLAG7,E,X,TXTL='NOPASSWORD',TRN=TFLAG7),   PS0460      *03760000
               (PASSINT,E,X,TXTL='INTERVAL'),                          *03770000
               (PASSINT,E,C,TXTL='INTERVAL'),                          *03780000
               (PASSWORD,E,X,TXTL='INFO.PASSWORD'),                    *03790000
               (PASSDATE,E,C,TXTL='INFO.PASSCHG_DATE'),                *03800000
               (PHRDATE,E,C,TXTL='INFO.PHRSCHG_DATE'),         IS10147A*03810000
               (AUTHDATE,E,C,TXTL='INFO.CREATE_DATE'),                 *03820000
               (LJTIME,E,T,TXTL='INFO.LAST_LOGIN_TIME'),               *03830000
               (LJDATE,E,C,TXTL='INFO.LAST_LOGIN_DATE'),               *03840000
               (PGMRNAME,E,C,TXTL='NAME',TRN=TRNNM),                   *03850000
               (DFLTGRP,E,C,TXTL='DFLTGRP'),                           *03860000
               (INSTDATA,E,C,TXTL='DATA'),                             *03870000
               (UAUDIT,E,X,TXTL='UAUDIT',TRN=T1),                      *03880000
               (FLAG6,E,X,TXTL='AUDITOR',TRN=T1),                      *03890000
               (FLAGROA,E,X,TXTL='ROAUDIT',TRN=T1),             WS10070*03891000
               (FLAG8,E,X,TXTL='OIDCARD',TRN=T1),                      *03900000
               (FLAG9,E,X,TXTL='RESTRICTED',TRN=T1)      WS2377         03910000
*************************************************************** WS10053 03920000
*                                                               WS10053 03930000
* THE FOLLOWING EXPLAINS THIS MODIFICATION:                     WS10053 03940000
*                                                               WS10053 03950000
* 1) ADD THE 3 LINES TO EXTRACT THE %%NMAPCT COUNTER FIELD AND  WS10053 03960000
*    THE DCERTMAP.NMAPNAME.%%NMAPCT FIELD.  THE NMAPNAME FIELD  WS10053 03970000
*    IS A 17-BYTE FIELD, IN THE FORMAT ABCDEFGH.ABCDEFGH,       WS10053 03980000
*    WHICH ENABLES US (IN CTSFDGT) TO GET ALL OF THE NECESSARY  WS10053 03990000
*    RACDCERT MAP FIELDS.                                       WS10053 04000000
*                                                               WS10053 04010000
* 2) BEFORE THIS MODIFICATION, THE PS0292 CHANGE BELOW LOOKED   WS10053 04020000
*    LIKE THE FOLLOWING:                                        WS10053 04030000
*     (CERTCT,E,X,TXTL='%%CERTCT'),                    PS0292 * WS10053 04040000
*     (CERTNAME,L,C,TXTL='DCERT.CERTNAME.%%CERTCT',    PS0292 * WS10053 04050000
*     TXTR='0',EOL=NO),                                PS0292 * WS10053 04060000
*     (CERTLABL,L,C,TXTL='DCERT.CERTLABL.%%CERTCT',    PS0292 * WS10053 04070000
*     TXTR='1',EOL=NO),                                PS0292 * WS10053 04080000
*     (CERTRSV1,L,C,TXTL='DCERT.CERTSRV1.%%CERTCT',    PS0292 * WS10053 04090000
*     TXTR='2',EOL=NO),                                PS0292 * WS10053 04100000
*     (CERTRSV2,L,C,TXTL='DCERT.CERTSRV2.%%CERTCT',    PS0292 * WS10053 04110000
*     TXTR='3',EOL=YES),                               PS0292 * WS10053 04120000
*    BASED ON THE CODE IN CSRC(CTSREXT) WHICH CREATES AND       WS10053 04130000
*    AND HANDLES THE IDX_FLD FIELD (ALSO RELATED TO THE         WS10053 04140000
*    PS0292 CHANGE), THE AFOREMENTIONED LINES ARE A MISTAKE.    WS10053 04150000
*    SINCE CERTRSV1 AND CERTRSV2 ARE NOT REAL FIELDS, THOSE     WS10053 04160000
*    CTSFAGR LINES ARE IGNORED AND THEREFORE THE EOL=YES        WS10053 04170000
*    (END OF LIST) SUBPARAMETER IS ALSO IGNORED. THE WAY THESE  WS10053 04180000
*    LINES WERE WRITTEN, THERE WAS NO EOL=YES SUBPARAMETER      WS10053 04190000
*    UNTIL THE EOL=YES RELATED TO THE %%NMAPCT FIELD. THIS      WS10053 04200000
*    CAUSED THE MULTIPLE GROUP FIELDS OF CERTNAME AND           WS10053 04210000
*    CERTLABEL TO APPEAR ONLY AFTER THE NMAPNAME FIELD.         WS10053 04220000
*    IN OUR TEST CASE, WHERE THERE WERE 2 DIGITAL CERTIFICATES  WS10053 04230000
*    AND 2 MAPS, THIS IS HOW CTSFAGR RETURNED THE RACF DATA:    WS10053 04240000
*      %%CERTCT                                                 WS10053 04250000
*      DCERT.CERTNAME.%%CERTCT - THIS WAS RESOLVED PROPERLY     WS10053 04260000
*      DCERT.CERTLABL.%%CERTCT - THIS WAS RESOLVED PROPERLY     WS10053 04270000
*      %%NMAPCT                                                 WS10053 04280000
*      DCERTMAP.NMAPNAME.%%NMAPCT - THIS WAS RESOLVED PROPERLY  WS10053 04290000
*      DCERT.CERTNAME.%%CERTCT - THIS WAS NOT RESOLVED!!!       WS10053 04300000
*      DCERT.CERTLABL.%%CERTCT - THIS WAS NOT RESOLVED!!!       WS10053 04310000
*      DCERTMAP.NMAPNAME.%%NMAPCT - THIS WAS RESOLVED PROPERLY  WS10053 04320000
*    TO UNDERSTAND WHY THE 2 FIELDS WERE NOT RESOLVED, YOU      WS10053 04330000
*    MUST ANALYZE THE IDX_FLD CODE AND LOOP IN CSRC(CTSREXT).   WS10053 04340000
*                                                               WS10053 04350000
*    THE PROBLEM WAS FIXED BY REMOVING THE CERTRSV1 AND         WS10053 04360000
*    CERTRSV2 FIELDS AND PLACING THE EOL=YES SUBPARAMETER       WS10053 04370000
*    ON THE CERTLABL LINE.                                      WS10053 04380000
*                                                               WS10053 04390000
*************************************************************** WS10053 04400000
GTUSR    CTSFAGR NEXTC,MF=L,CHAIN=GTUSRT,                              104410000
               (TXTL='USERID'),                                        *04420000
               (MAGSTRIP,E,C,TXTL='MAGSTRIP'),                         *04430000
               (MODELNAM,E,C,TXTL='MODEL'),                            *04440000
               (SECLEVEL,E,X,TXTL='SECLEVEL'),                         *04450000
               (NUMCTGY,E,X,TXTL='NUMCTGY'),                           *04460000
               (CATEGORY,L,C,TXTL='CATEGORY'),                         *04470000
               (CERTCT,E,X,TXTL='%%CERTCT'),                    PS0292 *04480000
               (CERTNAME,L,C,TXTL='DCERT.CERTNAME.%%CERTCT',    PS0292 *04490000
               TXTR='0',EOL=NO),                                PS0292 *04500000
               (CERTLABL,L,C,TXTL='DCERT.CERTLABL.%%CERTCT',    PS0292 *04510000
               TXTR='1',EOL=YES),                               PS0292 *04520000
               (REVOKEDT,E,C,TXTL='REVOKE_DATE'),                      *04530000
               (RESUMEDT,E,C,TXTL='RESUME_DATE'),                      *04540000
               (FLAG4,E,X,TXTL='REVOKED',TRN=T1),                      *04550000
               (LOGDAYS,E,X,TXTL='WHEN.DAYS',TRN=TD00),                *04560000
               (LOGDAYS,E,X,TXTL='WHEN.DAYS',TRN=TD01),                *04570000
               (LOGTIME,E,C,TXTL='WHEN.TIME'),                         *04580000
               (SECLABEL,E,C,TXTL='SECLABEL',TRN=TRN0),                *04590000
               (NMAPCT,E,X,TXTL='%%NMAPCT'),                    WS10053*04600000
               (NMAPNAME,L,C,TXTL='DCERTMAP.NMAPNAME.%%NMAPCT', WS10053*04610000
               TXTR='0',EOL=YES),                               WS10053*04620000
               (CLNAME,L,C,TXTL='CLAUTH'),                             *04630000
               (CGGRPNM,L,C,TXTL='GROUPS',EOL=NO),               CIQ#6 *04640000
               (CGFLAG2,L,X,TXTL='GROUPS.SPECIAL',              WS10070*04641000
               TRN=T1,EOL=NO),                                  WS10070*04641100
               (CGFLAG3,L,X,TXTL='GROUPS.OPERATIONS',           WS10070*04642000
               TRN=T1,EOL=NO),                                  WS10070*04642100
               (CGGRPAUD,L,X,TXTL='GROUPS.AUDITOR',             WS10070*04643000
               TRN=T1,EOL=YES),                                 WS10070*04644000
               (CGUACC,L,X,TXTL='UACC',TRN=TRTUA,IGNORE=YES),          *04650000
               (MFAFLBK,E,X,TXTL='MFA.PWFALLBACK',TRN=TFLBK),   WS10081*04651007
               (FACTORN,E,X,TXTL='MFA.FACTORN',IGNORE=YES),     WS10081*04652007
               (FACTOR,L,C,TXTL='MFA.FACTORS',EOL=NO),          WS10081*04652107
               (FACACDT,L,X,TXTL='MFA.ACTIVE',EOL=NO),          WS10081*04653007
               (FACTAGS,L,C,TXTL='MFA.TAGS',EOL=YES),           WS10081*04654007
               (MFAPOLN,E,X,TXTL='MFA.FOLICYN',IGNORE=YES),     WS10081*04654107
               (MFAPOLNM,L,C,TXTL='MFA.POLICIES',EOL=YES)       WS10081 04655007
GTUSRT   CTSFAGR NEXTC,MF=L,CHAIN=GTUSRC,SEGMENT=TSO,                  104660000
               (TXTL='USERID'),                                        *04670000
               (TACCNT,E,C,TXTL='TSO.ACCTNUM'),                        *04680000
               (TCOMMAND,E,C,TXTL='TSO.COMMAND'),               PS0163 *04690000
               (TDEST,E,C,TXTL='TSO.DEST'),                            *04700000
               (THCLASS,E,C,TXTL='TSO.HOLDCLASS'),                     *04710000
               (TJCLASS,E,C,TXTL='TSO.JOBCLASS'),                      *04720000
               (TLPROC,E,C,TXTL='TSO.PROC'),                           *04730000
               (TLSIZE,E,X,TXTL='TSO.SIZE'),                           *04740000
               (TMCLASS,E,C,TXTL='TSO.MSGCLASS'),                      *04750000
               (TMSIZE,E,X,TXTL='TSO.MAXSIZE'),                        *04760000
               (TSCLASS,E,C,TXTL='TSO.SYSOUTCLASS'),                   *04770000
               (TUDATA,E,C,TXTL='TSO.USERDATA'),                       *04780000
               (TUNIT,E,C,TXTL='TSO.UNIT'),                            *04790000
               (TSOSLABL,E,C,TXTL='TSO.SECLABEL')                       04800000
GTUSRC   CTSFAGR NEXTC,MF=L,CHAIN=GTUSRD,SEGMENT=CICS,                 104810000
               (TXTL='USERID'),                                        *04820000
               (OPIDENT,E,C,TXTL='CICS.OPIDENT'),                      *04830000
               (OPCLASSN,E,X,TXTL='CICS.OPCLASSN',IGNORE=YES),         *04840000
               (OPCLASS,L,X,TXTL='CICS.OPCLASS'),                      *04850000
               (OPPRTY,E,X,TXTL='CICS.OPPRTY'),                        *04860000
               (XRFSOFF,E,X,TXTL='CICS.XRFSOFF',TRN=TSOFF),            *04870000
               (TIMEOUT,E,C,TXTL='CICS.TIMEOUT')                        04880000
GTUSRD   CTSFAGR NEXTC,MF=L,CHAIN=GTUSRL,SEGMENT=DFP,                  104890000
               (TXTL='USERID'),                                        *04900000
               (DATAAPPL,E,C,TXTL='DFP.DATAAPPL'),                     *04910000
               (DATACLAS,E,C,TXTL='DFP.DATACLAS'),                     *04920000
               (MGMTCLAS,E,C,TXTL='DFP.MGMTCLAS'),                     *04930000
               (STORCLAS,E,C,TXTL='DFP.STORCLAS')                       04940000
GTUSRL   CTSFAGR NEXTC,MF=L,CHAIN=GTUSRO,SEGMENT=LANGUAGE,             104950000
               (TXTL='USERID'),                                        *04960000
               (USERNL1,E,C,TXTL='LANGUAGE.PRIMARY',TRN=TRNL),         *04970000
               (USERNL2,E,C,TXTL='LANGUAGE.SECONDARY',TRN=TRNL)         04980000
GTUSRO   CTSFAGR NEXTC,MF=L,CHAIN=GTUSRW,SEGMENT=OPERPARM,             104990000
               (TXTL='USERID'),                                        *05000000
               (OPERSTOR,E,X,TXTL='OPERPARM.STORAGE'),                 *05010000
               (OPERAUTH,E,X,TXTL='OPERPARM.AUTH',TRN=TAUTH),          *05020000
               (OPERMFRM,E,X,TXTL='OPERPARM.MFORM',TRN=TFRM),          *05030000
               (OPERLEVL,E,X,TXTL='OPERPARM.LEVEL',TRN=TLEV),          *05040000
               (OPERMON,E,X,TXTL='OPERPARM.MONITOR',TRN=TMON),         *05050000
               (OPERROUT,E,C,TXTL='OPERPARM.ROUTCODE'),                *05060000
               (OPERLOGC,E,X,TXTL='OPERPARM.LOGCMDRESP',TRN=TRESP),    *05070000
               (OPERMGID,E,X,TXTL='OPERPARM.MIGID',TRN=T1G),           *05080000
               (OPERDOM,E,X,TXTL='OPERPARM.DOM',TRN=TDOM),             *05090000
               (OPERKEY,E,C,TXTL='OPERPARM.KEY'),                      *05100000
               (OPERCMDS,E,C,TXTL='OPERPARM.CMDSYS'),                  *05110000
               (OPERUD,E,X,TXTL='OPERPARM.UD',TRN=T1G),                *05120000
               (OPERMCNT,E,X,TXTL='OPERPARM.OPERMCNT'),                *05130000
               (OPERMSCP,L,C,TXTL='OPERPARM.MSCOPE'),                  *05140000
               (OPERALTG,E,C,TXTL='OPERPARM.ALTGRP'),                  *05150000
               (OPERAUTO,E,X,TXTL='OPERPARM.AUTO',TRN=T1G)              05160000
GTUSRW   CTSFAGR NEXTC,MF=L,SEGMENT=WORKATTR,CHAIN=GTUSRM,             105170000
               (TXTL='USERID'),                                        *05180000
               (WAEMAIL,E,C,TXTL='WORKATTR.WAEMAIL'),    /*WS10087*/   *05190010
               (WANAME,E,C,TXTL='WORKATTR.WANAME'),                    *05191010
               (WABLDG,E,C,TXTL='WORKATTR.WABLDG'),                    *05200000
               (WADEPT,E,C,TXTL='WORKATTR.WADEPT'),                    *05210000
               (WAROOM,E,C,TXTL='WORKATTR.WAROOM'),                    *05220000
               (WAADDR1,E,C,TXTL='WORKATTR.WAADDR1'),                  *05230000
               (WAADDR2,E,C,TXTL='WORKATTR.WAADDR2'),                  *05240000
               (WAADDR3,E,C,TXTL='WORKATTR.WAADDR3'),                  *05250000
               (WAADDR4,E,C,TXTL='WORKATTR.WAADDR4'),                  *05260000
               (WAACCNT,E,C,TXTL='WORKATTR.WAACCNT')                    05270000
GTUSRM   CTSFAGR NEXTC,MF=L,SEGMENT=OMVS,CHAIN=GTUSRV,                 105280000
               (TXTL='USERID'),                                        *05290000
               (UID,E,X,TXTL='OMVS.UID'),                              *05300000
               (HOME,E,C,TXTL='OMVS.HOME'),                            *05310000
               (PROGRAM,E,C,TXTL='OMVS.PROGRAM'),                      *05320000
               (CPUTIME,E,X,TXTL='OMVS.CPUTIMEMAX'),            PS0391 *05330000
               (ASSIZE,E,X,TXTL='OMVS.ASSIZEMAX'),              PS0391 *05340000
               (FILEPROC,E,X,TXTL='OMVS.FILEPROCMAX'),          PS0391 *05350000
               (PROCUSER,E,X,TXTL='OMVS.PROCUSERMAX'),          PS0391 *05360000
               (THREADS,E,X,TXTL='OMVS.THREADSMAX'),            PS0391 *05370000
               (MMAPAREA,E,X,TXTL='OMVS.MMAPAREAMAX')           PS0391  05380000
GTUSRV   CTSFAGR NEXTC,MF=L,SEGMENT=NETVIEW,CHAIN=GTUDCE,              105390000
               (TXTL='USERID'),                                        *05400000
               (IC,E,C,TXTL='NETVIEW.IC'),                             *05410000
               (CONSNAME,E,C,TXTL='NETVIEW.CONSNAME'),                 *05420000
               (CTL,E,X,TXTL='NETVIEW.CTL',TRN=TRTCTL),                *05430000
               (NGMFVSPN,E,C,TXTL='NETVIEW.NGMFVSPN'),          PS0169 *05440000
               (MSGRECVR,E,X,TXTL='NETVIEW.MSGRECVR',TRN=TRTMRCV),     *05450000
               (OPCLASSN,E,X,TXTL='NETVIEW.OPCLASSN',IGNORE=YES),      *05460000
               (OPCLASS,L,X,TXTL='NETVIEW.OPCLASS'),                   *05470000
               (DOMAINSN,E,X,TXTL='NETVIEW.DOMAINSN',IGNORE=YES),      *05480000
               (DOMAINS,L,C,TXTL='NETVIEW.DOMAINS'),                   *05490000
               (NGMFADMN,E,X,TXTL='NETVIEW.NGMFADMN',TRN=TRTADM)        05500000
GTUDCE   CTSFAGR NEXTC,MF=L,SEGMENT=DCE,CHAIN=GTUOVM,                  105510000
               (TXTL='USERID'),                                        *05520000
               (UUID,E,C,TXTL='DCE.UUID',TRN=TRNUUID),                 *05530000
               (DCENAME,E,C,TXTL='DCE.DCENAME'),                       *05540000
               (HOMECELL,E,C,TXTL='DCE.HOMECELL'),                     *05550000
               (HOMEUUID,E,C,TXTL='DCE.HOMEUUID',TRN=TRNUUID),         *05560000
               (DCEFLAGS,E,X,TXTL='DCE.AUTOLOGIN',TRN=TRTDCEL)          05570000
* PS0391 GTUOVM   CTSFAGR NEXTC,MF=L,SEGMENT=OVM,               PS0163  05580000
GTUOVM   CTSFAGR NEXTC,MF=L,SEGMENT=OVM,CHAIN=GTLNOTS,          PS0391 105590000
               (TXTL='USERID'),                                 PS0163 *05600000
               (FSROOT,E,C,TXTL='OVM.FSROOT'),                  PS0169 *05610000
               (UID,E,X,TXTL='OVM.UID'),                        PS0163 *05620000
               (HOME,E,C,TXTL='OVM.HOME'),                      PS0163 *05630000
               (PROGRAM,E,C,TXTL='OVM.PROGRAM')                 PS0163  05640000
GTNLNOTS CTSFAGR NEXTC,MF=L,SEGMENT=LNOTES,CHAIN=GTNDS,         PS0391 105650000
               (TXTL='USERID'),                                 PS0391 *05660000
               (SNAME,E,C,TXTL='LNOTES.SNAME')                  PS0391  05670000
*IS10076 GTNDS    CTSFAGR NEXTC,MF=L,SEGMENT=NDS,             PS0391 1  05680000
GTNDS    CTSFAGR NEXTC,MF=L,SEGMENT=NDS,CHAIN=GTCSDATA,        IS10076 105690000
               (TXTL='USERID'),                                 PS0391 *05700000
               (UNAME,E,C,TXTL='NDS.UNAME')                     PS0391  05710000
GTCSDATA CTSFAGR NEXTC,MF=L,SEGMENT=CSDATA,                    IS10076 105720000
               (TXTL='USERID'),                                IS10076 *05730000
               (CSCNT,E,X,TXTL='CSDATA.COUNT',IGNORE=YES),     IS10076 *05740000
               (CSCDATA,E,C,TXTL='CSDATA.CSCDATA')             IS10076  05750000
*                                                                       05760000
* -------------------------------------------------------               05770000
*     TRANSLATE TABLE                                                   05780000
* -------------------------------------------------------               05790000
TRTADM   DC    AL1(1),X'80'            FOR NETVIEW.NGMADMN DATA         05800000
         DC    AL1(3),CL3'YES'                                          05810000
         DC    AL1(1),X'00'                                             05820000
         DC    AL1(2),CL2'NO'                                           05830000
         DC    AL1(0)                                                   05840000
* -------------------------------------------------------               05850000
TRTMRCV  DC    AL1(1),X'80'            FOR NETVIEW.MSGRECVR DATA        05860000
         DC    AL1(3),CL3'YES'                                          05870000
         DC    AL1(1),X'00'                                             05880000
         DC    AL1(2),CL2'NO'                                           05890000
         DC    AL1(0)                                                   05900000
* -------------------------------------------------------               05910000
TRTCTL   DC    AL1(1),X'80'            FOR NETVIEW.CTL DATA             05920000
         DC    AL1(6),CL6'GLOBAL'                                       05930000
         DC    AL1(1),X'40'                                             05940000
         DC    AL1(7),CL7'GENERAL'                                      05950000
         DC    AL1(1),X'00'                                             05960000
         DC    AL1(8),CL8'SPECIFIC'                                     05970000
         DC    AL1(0)                                                   05980000
* -------------------------------------------------------               05990000
TRTAU    DC    AL1(1),X'80'            FOR AUTHORITY DATA               06000000
         DC    AL1(4),CL4'JOIN'                                         06010000
         DC    AL1(1),X'40'                                             06020000
         DC    AL1(7),CL7'CONNECT'                                      06030000
         DC    AL1(1),X'20'                                             06040000
         DC    AL1(6),CL6'CREATE'                                       06050000
         DC    AL1(1),X'10'                                             06060000
         DC    AL1(3),CL3'USE'                                          06070000
         DC    AL1(0)                                                   06080000
* -------------------------------------------------------               06090000
TRTUA    DC    AL1(1),X'80'            FOR UACC DATA                    06100000
         DC    AL1(5),CL5'ALTER'                                        06110000
         DC    AL1(1),X'40'                                             06120000
         DC    AL1(7),CL7'CONTROL'                                      06130000
         DC    AL1(1),X'20'                                             06140000
         DC    AL1(6),CL6'UPDATE'                                       06150000
         DC    AL1(1),X'10'                                             06160000
         DC    AL1(4),CL4'READ'                                         06170000
         DC    AL1(1),X'08'                                             06180000
         DC    AL1(7),CL7'EXECUTE'                                      06190000
         DC    AL1(1),X'01'                                             06200000
         DC    AL1(4),CL4'NONE'                                         06210000
         DC    AL1(0)                                                   06220000
* -------------------------------------------------------               06230000
TLEV     DC    XL1'FF'                 LEVELS TABLE(OPERPARM.LEVEL)     06240000
         DC    B'10000000',AL1(1),CL1'R'                                06250000
         DC    B'01000000',AL1(1),CL1'I'                                06260000
         DC    B'00100000',AL1(2),CL2'CE'                               06270000
         DC    B'00010000',AL1(1),CL1'E'                                06280000
         DC    B'00001000',AL1(2),CL2'IN'                               06290000
         DC    B'00000100',AL1(2),CL2'NB'                               06300000
         DC    B'00000010',AL1(3),CL3'ALL'                              06310000
         DC    B'00000000'             END OF TABLE                     06320000
* -------------------------------------------------------               06330000
TFRM     DC    XL1'FF'                 MFORM  TABLE(OPERPARM.MFORM)     06340000
         DC    B'10000000',AL1(1),CL1'T'                                06350000
         DC    B'01000000',AL1(1),CL1'S'                                06360000
         DC    B'00100000',AL1(1),CL1'J'                                06370000
         DC    B'00010000',AL1(1),CL1'M'                                06380000
         DC    B'00001000',AL1(1),CL1'X'                                06390000
         DC    B'00000000'             END OF TABLE                     06400000
* -------------------------------------------------------               06410000
TMON     DC    XL1'FF'                 MONITOR TABLE(OPERPARM.MONITOR)  06420000
         DC    B'10000000',AL1(8),CL8'JOBNAMES'                         06430000
         DC    B'01000000',AL1(9),CL9'JOBNAMEST'                        06440000
         DC    B'00100000',AL1(4),CL4'SESS'                             06450000
         DC    B'00010000',AL1(5),CL5'SESST'                            06460000
         DC    B'00001000',AL1(6),CL6'STATUS'                           06470000
         DC    B'00000000'             END OF TABLE                     06480000
* -------------------------------------------------------               06490000
TRESP    DC    AL1(1),X'80'            OPERPARM.LOGCMDRESP              06500000
         DC    AL1(6),CL6'SYSTEM'                                       06510000
         DC    AL1(1),X'40'                                             06520000
         DC    AL1(2),CL2'NO'                                           06530000
         DC    AL1(0)                                                   06540000
* -------------------------------------------------------               06550000
TDOM     DC    AL1(1),X'80'            OPERPARM.DOM                     06560000
         DC    AL1(6),CL6'NORMAL'                                       06570000
         DC    AL1(1),X'40'                                             06580000
         DC    AL1(3),CL3'ALL'                                          06590000
         DC    AL1(1),X'20'                                             06600000
         DC    AL1(4),CL4'NONE'                                         06610000
         DC    AL1(0)                  END-OF-TABLE                     06620000
* -------------------------------------------------------               06630000
TAUTH    DC    XL1'FF'                 OPERPARM.AUTH            AS2706  06640000
         DC    B'10000000',AL1(6),CL6'MASTER'                   AS2706  06650000
         DC    B'01000000',AL1(3),CL3'ALL'                      AS2706  06660000
         DC    B'00100000',AL1(3),CL3'SYS'                      AS2706  06670000
         DC    B'00010000',AL1(2),CL2'IO'                       AS2706  06680000
         DC    B'00001000',AL1(4),CL4'CONS'                     AS2706  06690000
         DC    B'00000100',AL1(4),CL4'INFO'                     AS2706  06700000
         DC    B'00000000'             END OF TABLE             AS2706  06710000
*                                                                       06720000
*AS2706 TAUTH    DC    AL1(2),X'8000'          OPERPARM.AUTH            06730000
*AS2706  DC    AL1(6),CL6'MASTER'                                       06740000
*AS2706  DC    AL1(2),X'4000'                                           06750000
*AS2706  DC    AL1(3),CL3'ALL'                                          06760000
*AS2706  DC    AL1(2),X'2000'                                           06770000
*AS2706  DC    AL1(3),CL3'SYS'                                          06780000
*AS2706  DC    AL1(2),X'1000'                                           06790000
*AS2706  DC    AL1(2),CL2'IO'                                           06800000
*AS2706  DC    AL1(2),X'0800'                                           06810000
*AS2706  DC    AL1(4),CL4'CONS'                                         06820000
*AS2706  DC    AL1(2),X'0400'                                           06830000
*AS2706  DC    AL1(4),CL4'INFO'                                         06840000
*AS2706  DC    AL1(0)                  END-OF-TABLE                     06850000
* -------------------------------------------------------               06860000
*                                      NAME IF EQUAL DON'T PUT          06870000
TRNNM    DC    AL1(20),CL20'####################'                       06880000
         DC    AL1(0)                                                   06890000
         DC    AL1(20),20X'FF'                                  SPR132  06900000
         DC    AL1(0)                                           SPR132  06910000
         DC    AL1(0)                                                   06920000
* -------------------------------------------------------               06930000
*                                      NAME IF EQUAL DON'T PUT          06940000
TRNUUID  DC    AL1(36),36X'FF'         FIELD : UUID, HOMEUUID           06950000
         DC    AL1(0)                                                   06960000
         DC    AL1(0)                                                   06970000
* -------------------------------------------------------               06980000
* PS0169 TRTDCEL  DC    AL1(1),X'80'            FOR DCE.AUTOLOGIN       06990000
TRTDCEL  DC    AL1(1),X'01'            FOR DCE.AUTOLOGIN         PS0169 07000000
         DC    AL1(3),CL3'YES'                                   PS0163 07010000
         DC    AL1(1),X'00'                                      PS0163 07020000
         DC    AL1(2),CL2'NO'                                    PS0163 07030000
         DC    AL1(0)                                            PS0163 07040000
* -------------------------------------------------------               07050000
*                                      LANGUAGE.PRIMARY                 07060000
*                                      LANGUAGE.SECONDARY               07070000
TRNL     DC    AL1(3),XL3'00'                                           07080000
         DC    AL1(0)                                                   07090000
         DC    AL1(0)                                                   07100000
* -------------------------------------------------------               07110000
TRN0     DC    AL1(8),XL8'00'          SECLABEL                         07120000
         DC    AL1(0)                                                   07130000
         DC    AL1(0)                                                   07140000
* -------------------------------------------------------               07150000
TSOFF    DC    AL1(1),X'80'            CICS.XRFSOFF                     07160000
         DC    AL1(5),CL5'FORCE'                                        07170000
         DC    AL1(1),X'00'                                             07180000
         DC    AL1(7),CL7'NOFORCE'                                      07190000
* -------------------------------------------------------               07200000
*                                      FLAGS TRANSLATE TABLE :          07210000
*                                      ADSP                             07220000
*                                      SPECIAL                          07230000
*                                      OPERATIONS                       07240000
*                                      REVOKED                          07250000
*                                      GRPACC                           07260000
*                                      UAUDIT                           07270000
*                                      AUDITOR                          07280000
*                                      OIDCARD                          07290000
*                                      RESTRICTED WS2377                07300000
T1       DC    AL1(1),X'80'                                             07310000
         DC    AL1(1),CL1'Y'                                            07320000
         DC    AL1(1),X'00'                                             07330000
         DC    AL1(1),CL1'N'                                            07340000
         DC    AL1(0)                                                   07350000
* -------------------------------------------------------               07351002
TFLBK    DC    AL1(1),X'81'   TRANSLATE PWFALLBACK FLAG       WS10081   07352007
         DC    AL1(1),CL1'Y'                                  WS10081   07353007
         DC    AL1(1),X'01'                                   WS10081   07354009
         DC    AL1(1),CL1'N'                                  WS10081   07355007
         DC    AL1(1),X'00'                                   WS10081   07356009
         DC    AL1(1),CL1' '                                  WS10081   07357009
         DC    AL1(0)                                         WS10081   07358007
* -------------------------------------------------------               07360000
TFLAG7   DC    AL1(1),X'80'  NOPASSWORD & OIDCARD             PS0460    07370000
         DC    AL1(1),CL1'N'                                  PS0460    07380000
         DC    AL1(1),X'40'                                   PS0460    07390000
         DC    AL1(1),CL1'Y' PROTECTED=NOPASSWORD & NOOIDCARD PS0460    07400000
         DC    AL1(1),X'00'                                   PS0460    07410000
         DC    AL1(1),CL1'N' NO NOPASSWORD                    PS0460    07420000
         DC    AL1(0)                                         PS0460    07430000
* -------------------------------------------------------               07440000
*                                      OPERPARM.MIGID                   07450000
*                                      OPERPARM.UD                      07460000
*                                      OPERPARM.AUTO                    07470000
T1G      DC    AL1(1),X'80'                                             07480000
         DC    AL1(3),CL3'YES'                                          07490000
         DC    AL1(1),X'40'                                             07500000
         DC    AL1(2),CL2'NO'                                           07510000
         DC    AL1(0)                                                   07520000
* -------------------------------------------------------               07530000
*                                      FLAGS TRANSLATE TABLE :          07540000
*                                      WHEN.DAYS                        07550000
TD00     DC    AL1(1),X'82'                                             07560000
         DC    AL1(8),CL8'WEEKDAYS'                                     07570000
         DC    AL1(1),X'00'                                             07580000
         DC    AL1(6),CL6'ANYDAY'                                       07590000
         DC    AL1(0)                                                   07600000
* -------------------------------------------------------               07610000
TD01     DC    XL1'FF'                 FLAGS TABLE                      07620000
*                                      WHEN.DAYS                        07630000
         DC    B'10000000',AL1(6),CL6'SUNDAY'                           07640000
         DC    B'01000000',AL1(6),CL6'MONDAY'                           07650000
         DC    B'00100000',AL1(7),CL7'TUESDAY'                          07660000
         DC    B'00010000',AL1(9),CL9'WEDNESDAY'                        07670000
         DC    B'00001000',AL1(8),CL8'THURSDAY'                         07680000
         DC    B'00000100',AL1(6),CL6'FRIDAY'                           07690000
         DC    B'00000010',AL1(8),CL8'SATURDAY'                         07700000
         DC    B'00000000'             END OF TABLE                     07710000
* -------------------------------------------------------               07720000
         DROP  ,                                                        07730000
****************************************************************        07740000
*                                                              *        07750000
* FUNCTION    : TEST ROUTINE FOR LISTUSER PROCESSING           *        07760000
* -------------                                                *        07770000
* PARAMETERS  : SEE MEMBERS : CTSFXPR, CTSFXPF                 *        07780000
* -------------                                                *        07790000
* RETURN CODES:                                                *        07800000
* -------------                                                *        07810000
*               0 - PUT DATA                                   *        07820000
*               4 - DON'T PUT DATA                             *        07830000
*                                                              *        07840000
****************************************************************        07850000
*                                                                       07860000
TESTLU BEGIN *,R7                                                       07870000
*--------------------------------------------------------------------   07880000
*     ADDRESSABILITY MAIN PARAMETERS                                    07890000
*--------------------------------------------------------------------   07900000
         USING PARMM,R1                                                 07910000
         L     R2,XPROPCD                                               07920000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 07930000
         BE    LSTART                           RACF DATA BASE          07940000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 07950000
         BE    LENTRY                           RACF DATA BASE          07960000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         07970000
         BE    LELEMN                                                   07980000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               07990000
         BE    LLIST                                                    08000000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      08010000
         BE    LEND                             EXTRACTOR               08020000
         B     RET0                                                     08030000
*                                                                       08040000
********************************************************************    08050000
*        START                                                          08060000
********************************************************************    08070000
*                                                                       08080000
LSTART   DS    0H                                                       08090000
         MVI   FLAGS,0                 START TREATMENT LINE             08100000
         XC    DFLTGRP,DFLTGRP         CLEAR DEFAULT GROUP FIELD        08110000
         XC    FLAG7,FLAG7                                              08120000
         XC    WORKPTR,WORKPTR         CLEAR WORK PTR FOR STORE         08130000
*                                      CATEGORIES CODES                 08140000
         MVI   PASSINT,0               PASSWORD INTERVAL FIELD  SPR137  08150000
         B     RET0                                                     08160000
*                                                                       08170000
********************************************************************    08180000
*        ENTRY                                                          08190000
********************************************************************    08200000
*                                                                       08210000
LENTRY   DS    0H                                                       08220000
         L     R3,XPRENTRY                                              08230000
         L     R5,0(R3)                ENTRY NAME LENGTH                08240000
         L     R4,XPRPRFXY                                              08250000
         L     R4,0(R4)                                                 08260000
         USING RETAREA,R4                                               08270000
*                                                                       08280000
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X08290000
               (?R5,4(R3),?R5,XPFFLGS,1),                              X08300000
               LEVEL=(DBGCNN,5,6,7),RAREA=RAREA                         08310000
*                                                                       08320000
         DROP  R4                                                       08330000
         MVI   SECLVL,X'FF'            DEFAULT SECURITY LEVEL           08340000
         XC    FLGDT,FLGDT             FLAG LOGDAYS FIELD               08350000
         B     RET0                                                     08360000
*                                                                       08370000
********************************************************************    08380000
*        ELEMNTRY FIELD                                                 08390000
********************************************************************    08400000
*                                                                       08410000
LELEMN   DS    0H                                                       08420000
         MVI   FLAGS,0                 START TREATMENT LINE             08430000
         L     R3,XPRFNME              RACF FIELD NAME                  08440000
         L     R4,XPRFADRE             RACF FIELD VALUE                 08450000
         L     R5,0(R4)                FIELD LENGTH                     08460000
*                                                                       08470000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          X08480000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      X08490000
               LEVEL=(DBGCNN,5,6,7),RAREA=RAREA                         08500000
*                                                                       08510000
         CLC   =CL8'DFLTGRP',0(R3)     DEFAULT GROUP                    08520000
         BE    LDFLTGRP                                                 08530000
         CLC   =CL8'FLAG7',0(R3)       PASSWORD NOT NEED FLAG           08540000
         BE    LFLAG7                                                   08550000
         CLC   =CL8'PASSWORD',0(R3)    PASSWORD                         08560000
         BE    LPSWRD                                                   08570000
         CLC   =CL8'NUMCTGY',0(R3)     COUNT OF CATEGORIES              08580000
         BE    LNUMCTGY                                                 08590000
         CLC   =CL8'SECLEVEL',0(R3)    SEC LEVEL                        08600000
         BE    LSECL                                                    08610000
         CLC   =CL8'LOGDAYS',0(R3)     LOGDAYS                          08620000
         BE    LLOGDAYS                                                 08630000
         CLC   =CL8'LOGTIME',0(R3)     LOGTIME                          08640000
         BE    LLOGTIME                                                 08650000
         CLC   =CL8'REVOKEDT',0(R3)    REVOKE DATE                      08660000
         BE    LREV                                                     08670000
         CLC   =CL8'RESUMEDT',0(R3)    RESUME DATE                      08680000
         BE    LRES                                                     08690000
         CLC   =CL8'FLAG4',0(R3)       REVOKE FLAG                      08700000
         BE    LFLG4                                                    08710000
         CLC   =CL8'AUTHDATE',0(R3)    CREATE DATE                      08720000
         BE    LAUTH                                                    08730000
         CLC   =CL8'LJDATE',0(R3)      LAST LOGIN DATE                  08740000
         BE    LLJDATE                                                  08750000
         CLC   =CL8'PASSDATE',0(R3)    PASSWORD CHANGE DATE             08760000
         BE    LPASDT                                                   08770000
         CLC   =CL8'PHRDATE',0(R3)     PSWD PHRASE CHANGE DATE IS10147A 08780000
         BE    LPASDT                                          IS10147A 08790000
         CLC   =CL8'OPERROUT',0(R3)    OPERPARM.ROUTCODE                08800000
         BE    LROUT0                                                   08810000
         CLC   =CL8'TUDATA',0(R3)      TSO.USERDATA                     08820000
         BE    LTUDATA                                                  08830000
         CLC   =CL8'PASSINT',0(R3)     PASSWORD INTERVAL CHANGE         08840000
         BE    LPASSINT                                                 08850000
         CLC   =CL8'UID',0(R3)                          ISAR0001        08860000
         BE    LUID                                     ISAR0001        08870000
         CLC   =CL8'TIMEOUT',0(R3)                      ISAR0001        08880000
         BE    LTMOUT                                   ISAR0001        08890000
         CLC   =CL8'CPUTIME',0(R3)                      PS0391          08900000
         BE    LUID                                     PS0391          08910000
         CLC   =CL8'ASSIZE',0(R3)                       PS0391          08920000
         BE    LUID                                     PS0391          08930000
         CLC   =CL8'FILEPROC',0(R3)                     PS0391          08940000
         BE    LUID                                     PS0391          08950000
         CLC   =CL8'PROCUSER',0(R3)                     PS0391          08960000
         BE    LUID                                     PS0391          08970000
         CLC   =CL8'THREADS',0(R3)                      PS0391          08980000
         BE    LUID                                     PS0391          08990000
         CLC   =CL8'MMAPAREA',0(R3)                     PS0391          09000000
         BE    LUID                                     PS0391          09010000
         B     RET0                                                     09020000
******************************************************* ISAR0001        09030000
*   CICS.TIMEOUT                                        ISAR0001        09040000
******************************************************* ISAR0001        09050000
LTMOUT   DS    0H                                       ISAR0001        09060000
         CLC   0(4,R4),=F'2'           LEN = 2          ISAR0001        09070000
         BNE   RET4                    N, DON'T PUT     ISAR0001        09080000
*                                                                       09090000
*BSR2032 XC    TMOUTW,TMOUTW                            ISAR0001        09100000
*BSR2032 MVC   TMOUTW+3(1),4(R4)       HH               ISAR0001        09110000
*BSR2032 L     R5,TMOUTW                                ISAR0001        09120000
*BSR2032 CVD   R5,PDEC                                  ISAR0001        09130000
*BSR2032 UNPK  PDECT(2),PDEC+6(2)                       ISAR0001        09140000
*BSR2032 OI    PDECT+1,X'F0'                            ISAR0001        09150000
*BSR2032                                                ISAR0001        09160000
*BSR2032 XC    TMOUTW,TMOUTW                            ISAR0001        09170000
*BSR2032 MVC   TMOUTW+3(1),5(R4)       MM               ISAR0001        09180000
*BSR2032 L     R5,TMOUTW                                ISAR0001        09190000
*BSR2032 CVD   R5,PDEC                                  ISAR0001        09200000
*BSR2032 UNPK  PDECT+2(2),PDEC+6(2)                     ISAR0001        09210000
*BSR2032 OI    PDECT+3,X'F0'                            ISAR0001        09220000
*BSR2032 CLC   PDECT(2),=CL2'00'       HH = '00' ?      ISAR0001        09230000
*BSR2032 BE    LTMOUT1                 Y, DON'T PUT     ISAR0001        09240000
*BSR2032 MVC   0(4,R4),=F'4'           PUT FIELD LENGTH ISAR0001        09250000
*BSR2032 MVC   4(4,R4),PDECT           PUT FIELD VALUE  ISAR0001        09260000
*BSR2032 B     RET0                                     ISAR0001        09270000
*BSR2032  LTMOUT1  DS    0H                             ISAR0001        09280000
*BSR2032 MVC   0(4,R4),=F'2'           PUT FIELD LENGTH ISAR0001        09290000
*BSR2032 MVC   4(2,R4),PDECT+2         PUT FIELD VALUE  ISAR0001        09300000
*BSR2032 B     RET0                                     ISAR0001        09310000
*                                                                       09320000
         SR    R6,R6                                    BSR2032         09330000
         ICM   R6,X'3',4(R4)           HHMM             BSR2032         09340000
         LTR   R6,R6                                    BSR2032         09350000
         BZ    TMOUT0                                   BSR2032         09360000
         SR    R6,R6                                    BSR2032         09370000
         IC    R6,4(R4)                HH               BSR2032         09380000
         MH    R6,=H'100'                               BSR2032         09390000
         SR    R7,R7                                    BSR2032         09400000
         IC    R7,5(R4)                MM               BSR2032         09410000
         AR    R6,R7                                    BSR2032         09420000
         CVD   R6,PDEC                                  BSR2032         09430000
         MVC   PATTRN(6),TMOUTP                         BSR2032         09440000
         ED    PATTRN(6),PDEC+5                         BSR2032         09450000
         CLC   PATTRN+1(2),=CL2'00'    HH OBTAINED ?    BSR2032         09460000
         BE    TMOUTMM                                  BSR2032         09470000
         B     TMOUTHM                                  BSR2032         09480000
*                                                       BSR2032         09490000
TMOUT0   DS    0H                      TMOUT=0          BSR2032         09500000
         MVC   0(4,R4),=F'1'           PUT FIELD LENGTH BSR2032         09510000
         MVC   4(1,R4),=CL1'0'         PUT FIELD VALUE  BSR2032         09520000
         B     RET0                                     BSR2032         09530000
TMOUTMM  DS    0H                      MM FORMAT        BSR2032         09540000
         MVC   0(4,R4),=F'2'           PUT FIELD LENGTH BSR2032         09550000
         MVC   4(2,R4),PATTRN+3        PUT FIELD VALUE  BSR2032         09560000
         B     RET0                                     BSR2032         09570000
TMOUTHM  DS    0H                      HHMM FORMAT      BSR2032         09580000
         MVC   0(4,R4),=F'4'           PUT FIELD LENGTH BSR2032         09590000
         MVC   4(4,R4),PATTRN+1        PUT FIELD VALUE  BSR2032         09600000
         B     RET0                                     BSR2032         09610000
******************************************************* ISAR0001        09620000
*   OMVS.UID                                            ISAR0001        09630000
******************************************************* ISAR0001        09640000
LUID     DS    0H                                       ISAR0001        09650000
         CLC   0(4,R4),=F'4'           LEN = 4          ISAR0001        09660000
         BNE   RET4                    N, DON'T PUT     ISAR0001        09670000
         CLC   4(4,R4),=4X'FF'         UID NOT DEFINED ?ISAR0001        09680000
         BE    RET4                    Y, DON'T PUT     ISAR0001        09690000
         B     RET0                                     ISAR0001        09700000
LPASSINT DS    0H                                                       09710000
*--------------------------------------------------------------         09720000
* PASSINT RETRIEVIED FROM RACF DATA BASE TWO TIMES WITH                 09730000
* DIFFERENT OUTPUT DESCRIPTION. 1-ST - HEX NUMBER                       09740000
*                               2-ND - CHAR ( FOR RETURN 'NO' )         09750000
* SEE. SPR137                                                           09760000
*---------------------------------------------------------------        09770000
         CLC   0(4,R4),=F'0'           LEN = 0                          09780000
         BE    RET4                    Y, DON'T PUT                     09790000
         CLI   4(R4),X'FF'             PASSWORD INTERVAL AVAILABLE ?    09800000
*SPR137  BE    RET4                    NO, DON'T PUT                    09810000
*SPR137  B     RET0                    YES                              09820000
         BE    INTRVNO                 PASSWORD INTERVAL 'NO' SPR137    09830000
         TM    FLAG7,X'C0'             PS0460                           09840000
         BNZ   INTRVNO                 PS0460                           09850000
         B     INTRVYES                GOTO RETURN            SPR137    09860000
INTRVNO  DS    0H                                             SPR137    09870000
         CLI   PASSINT,0               FIRST ENTRY ?          SPR137    09880000
         BE    INTERVX                 Y,PASS                 SPR137    09890000
         MVC   0(4,R4),=F'2'           PUT FIELD LENGTH       SPR137    09900000
         MVC   4(2,R4),=CL2'NO'        PUT FIELD VALUE        SPR137    09910000
         B     RET0                    PUT FIELD              SPR137    09920000
INTERVX  DS    0H                                             SPR137    09930000
         MVI   PASSINT,1               SWITCH FLAG TO NEXT    SPR137    09940000
         B     RET4                    DON'T PUT FIELD        SPR137    09950000
INTRVYES DS    0H                                             SPR137    09960000
         CLI   PASSINT,0               FIRST ENTRY ?          SPR137    09970000
         BNE   RET4                    N,DON'T PUT FIELD      SPR137    09980000
         MVI   PASSINT,1               SWITCH FLAG TO NEXT    SPR137    09990000
         B     RET0                    PUT FIELD              SPR137    10000000
*----------------------------------------------------------------       10010000
*    TSO.USERDATA                                                       10020000
*----------------------------------------------------------------       10030000
LTUDATA  DS    0H                      TSO.USERDATA                     10040000
         LTR   R5,R5                   LEN=0 ?                          10050000
         BE    RET4                    Y, DON'T PUT                     10060000
         SR    R2,R2                                                    10070000
         XC    TDAT,TDAT                                                10080000
         MVC   TDAT(2),4(R4)                                            10090000
         UNPK  TDATX(5),TDAT(3)                                         10100000
         TR    TDATX(5),TRTX-X'F0'     CONVERT TO CHAR HEX NUMBERS      10110000
         MVC   0(4,R4),=F'4'           RESULT LENGTH                    10120000
         MVC   4(4,R4),TDATX           RESULT DATA                      10130000
         B     RET0                                                     10140000
*----------------------------------------------------------------       10150000
*    OPERPARM.ROUTCODE                                                  10160000
*----------------------------------------------------------------       10170000
LROUT0   DS    0H                      OPERPARM.ROUTCODE                10180000
         ST    R4,AROUT                ADDRESS OPERROUT FIELD           10190000
*                                      R5 = FIELD LENGTH                10200000
         LA    R4,4(R4)                BRANCH OVER THE LENGTH           10210000
         SR    R6,R6                                                    10220000
         IC    R6,0(R4)                GET BITE-FLAGS(ROUTCODES)        10230000
         LTR   R6,R6                                                    10240000
         BZ    LROUT1                  YES ROUT CODES                   10250000
         STC   R6,ROUTFLAG                                              10260000
         TM    ROUTFLAG,X'80'                                           10270000
         BO    LROUTALL                ROUTCODE=ALL                     10280000
         TM    ROUTFLAG,X'40'                                           10290000
         BO    LROUTNON                ROUTCODE=NONE                    10300000
         B     RET4                                                     10310000
LROUTALL DS    0H                                                       10320000
         L     R4,AROUT                                                 10330000
         MVC   0(4,R4),=F'3'           LENGTH OF FIELD                  10340000
         MVC   4(3,R4),=CL3'ALL'       ROUT CODES - ALL                 10350000
         B     RET0                                                     10360000
LROUTNON DS    0H                                                       10370000
         L     R4,AROUT                                                 10380000
         MVC   0(4,R4),=F'4'           LENGTH OF FIELD                  10390000
         MVC   4(4,R4),=CL4'NONE'      ROUT CODES - NONE                10400000
         B     RET0                                                     10410000
*---------------------------------------------------------------        10420000
*    DEFINITION LIST OF ROUTCODES                                       10430000
*    R5 - FIELD LENGTH                                                  10440000
*---------------------------------------------------------------        10450000
LROUT1   DS    0H                      YES ROUT CODES                   10460000
         LA    R4,1(R4)                BRANCH OVER THE FLAGS PART       10470000
         BCTR  R5,0                    LENGTH -= 1 ( WITHOUT FLAGS)     10480000
         LTR   R5,R5                   HAVE A LIST OF CODES ?           10490000
         BM    RET4                    N, DON'T PUT                     10500000
         BZ    RET4                    N, DON'T PUT                     10510000
LROUT2   DS    0H                                                       10520000
         SR    R10,R10                 COUNTER ROUT CODES               10530000
         SR    R11,R11                 TOTAL LENGTH OF ROUT INFORMATION 10540000
         ST    R11,ROUTN               CURRENT ROUT NUMBER              10550000
         ST    R11,ALIST               ADDR LIST INFORMATION            10560000
         ST    R11,ALEN                ADDR OF LENGTH                   10570000
         MVI   FLAGLIST,1              DEFAULT:LIST INFORMATION         10580000
         LA    R3,RCODES+4             ADDRESS RESULT FIELD             10590000
LROUT2A  DS    0H                                                       10600000
         SR    R8,R8                                                    10610000
         IC    R8,0(R4)                GET CURRENT ROUT INFORMATION     10620000
         LA    R4,1(R4)                BRANCH OVER                      10630000
         LA    R9,8                    LOOP COUNT VIA BITS              10640000
LROUT3   DS    0H                                                       10650000
         STC   R8,ROUTCODE                                              10660000
         CLI   ROUTCODE,X'00'          CURRENT INFO INCLUDE ROUTCODE?   10670000
         BNE   LROUT3A                 N,SKIP                           10680000
         AR    R10,R9                  WAS PASSED 8 ROUTCODES           10690000
         B     ENDLR9                  GET NEXT INFO                    10700000
*------------------------------------------------------------------     10710000
*   CURRENT INFO INCLUDE ROUTCODES                                      10720000
*------------------------------------------------------------------     10730000
LROUT3A  DS    0H                                                       10740000
         LA    R10,1(R10)              COUNTER ROUT CODE += 1           10750000
         TM    ROUTCODE,X'80'          HAVE THE ROUTCODE                10760000
         BZ    ROUT0                   NO  ROUT CODE                    10770000
*------------------------------------------------------------------     10780000
* HAVE THE ROUT CODE.                                                   10790000
* CREATE OUTPUT INFORMATION LIKE    ROUTCODE1:ROUTCODE10  OR            10800000
*                                   ROUTCODE1,ROUTCODE5,                10810000
*------------------------------------------------------------------     10820000
         CLC   ROUTN,=F'0'          WAS STORED PREVIOUS ROUT CODE       10830000
         BE    LNMB                 N, SKIP                             10840000
         L     R2,ROUTN             GET PREVIOUS ROUTCODE               10850000
         SR    R2,R10               PREVIOUS ROUT CODE - CURRENT        10860000
         LPR   R2,R2                MODULE                              10870000
         C     R2,=F'1'             DIFFENRENCE = 1                     10880000
         BNE   LNO1                 N,SKIP                              10890000
*---------------------------------------------------------------        10900000
*   DIFFERENCE BETWEEN CURRENT AND PREVIOUS ROUT CODES = 1              10910000
*   POSSIBLE TO BUILD INFORMATION IN FORM   AAA:BBBB                    10920000
*---------------------------------------------------------------        10930000
         L     R3,ALIST                RESTORE ADDR OF OUTPUT FIELD     10940000
         L     R11,ALEN                RESTORE LENGTH OF OUTPUT FIELD   10950000
         MVI   0(R3),C':'              STORE ":"                        10960000
         LA    R3,1(R3)                INCR RESULT ADDRESS              10970000
         LA    R11,1(R11)              INCR TOTAL LENGTH                10980000
         MVI   FLAGLIST,0              NOLIST , RANGE INFORMATION       10990000
         B     LNMB                    GO CONVERT AND PUT ROUTCODE      11000000
*---------------------------------------------------------------        11010000
*   DIFFERENCE BETWEEN CURRENT AND PREVIOUS ROUT CODES > 1              11020000
*   POSSIBLE TO BUILD INFORMATION IN FORM   AAA,BBBB,CCCC,              11030000
*---------------------------------------------------------------        11040000
LNO1     DS    0H                                                       11050000
         ST    R10,R10SV               SAVE R10                         11060000
         L     R10,=A(SEP)             SEPARATOR                        11070000
         MVC   0(1,R3),0(R10)          PUT SEPARATOR                    11080000
         L     R10,R10SV               RESTORE R10                      11090000
*        MVI   0(R3),C','              STORE ","                        11100000
         LA    R3,1(R3)                INCR RESULT ADDRESS              11110000
         LA    R11,1(R11)              INCR TOTAL LENGTH                11120000
         MVI   FLAGLIST,1              LIST INFORMATION                 11130000
         B     LNMB                    GO CONVERT AND PUT ROUTCODE      11140000
LNMB     DS    0H                                                       11150000
         ST    R10,ROUTN               STORE CURRENT ROUT CODE NUMBER   11160000
* -----------------------------------------------------------------     11170000
* CONVERT CURRENT NUMBER FROM HEX TO CHAR                               11180000
* -----------------------------------------------------------------     11190000
         DS    0H                                                       11200000
         CVD   R10,PDEC                CONVERT TO DECIMAL               11210000
         MVC   PATTRN(16),PATTRND                                       11220000
         LA    R1,PATTRN                                                11230000
         EDMK  PATTRN(16),PDEC                                          11240000
         LA    R12,PATTRN+15           END ADDRESS OF FIELD             11250000
         SR    R12,R1                  LENGTH - 1                       11260000
         EX    R12,MVCCD               MOVE CONVERT DATA                11270000
         LA    R12,1(R12)                                               11280000
         AR    R3,R12                  INCR ADDRESS                     11290000
         AR    R11,R12                 INCR TOTAL LENGTH                11300000
         CLI   FLAGLIST,1              LIST  INFORMATION                11310000
         BNE   NOLIST                                                   11320000
         ST    R3,ALIST                STORE CURRENT FILL ADDRESS       11330000
         ST    R11,ALEN                STORE CURRENT LENGTH             11340000
NOLIST   DS    0H                                                       11350000
         C     R11,=F'255'             OVERFLOW CHECKING                11360000
         BH    ROUTFIN                 OVERFLOW !                       11370000
         ST    R3,ALIST2               STORE CURRENT FILL ADDRESS       11380000
         ST    R11,ALEN2               STORE CURRENT LENGTH             11390000
*                                                                       11400000
ROUT0    DS    0H                                                       11410000
         SLL   R8,1                    R8 <<= 1 GET NEXT ROUTCODE       11420000
         CTSADBG 'ROUT0 R10=# R11=# LINE=#/_',                         111430000
               (?R10,?R11,ALEN2,RCODES+4,ALEN2),                       211440000
               LEVEL=(DBGCNN,6,7),RAREA=RAREA                           11450000
         BCT   R9,LROUT3               LOOP THROUGH BITS                11460000
*                                                                       11470000
ENDLR9   DS    0H                      END OF LOOP THROUGH R9           11480000
         BCT   R5,LROUT2A              LOOP TGROUGH ROUTCODES INFO      11490000
ROUTFIN  DS    0H                                                       11500000
         L     R11,ALEN2               GET LENGTH                       11510000
         ST    R11,RCODES                                               11520000
         L     R4,AROUT                ADDR OF OUTPUT AREA              11530000
         LA    R11,3(R11)              LENGTH=LENGTH + 4 - 1            11540000
         EX    R11,MOVRES              MOVE LENGTH+RESULT               11550000
         CTSADBG 'RESULT LINE=#/_',(ALEN2,4(R4),ALEN2),                111560000
               LEVEL=(DBGCNN,6,7),RAREA=RAREA                           11570000
         B     RET0                    PUT INFO TO OUTPUT AREA          11580000
LAUTH    DS    0H                                                       11590000
         CLC   0(4,R4),=F'3'                                            11600000
         BNE   RET4                                                     11610000
         ST    R4,RDT4                                                  11620000
         CALL  CTSADTE,(RDT4)          CREATE DATE                      11630000
         B     RET0                                                     11640000
LLJDATE  DS    0H                                                       11650000
         CLC   0(4,R4),=F'3'                                            11660000
         BNE   RET4                                                     11670000
         ST    R4,RDT4                                                  11680000
         CALL  CTSADTE,(RDT4)          LOGIN DATE                       11690000
         B     RET0                                                     11700000
LPASDT   DS    0H                      CHANGE PASSWORD DATE             11710000
         CLC   0(4,R4),=F'3'                                            11720000
         BNE   RET4                                                     11730000
         ST    R4,RDT4                                                  11740000
         CALL  CTSADTE,(RDT4)          CHANGE PASSWORD DATE             11750000
         B     RET0                                                     11760000
LREV     DS    0H                                                       11770000
         XC    REVDT,REVDT                                              11780000
         CLC   0(4,R4),=F'3'                                            11790000
         BNE   RET4                                                     11800000
         MVC   REVDT(3),4(R4)          SAVE REVOKE DATE                 11810000
         ST    R4,RDT4                                                  11820000
         CALL  CTSADTE,(RDT4)          REVOKE DATE                      11830000
         B     RET0                                                     11840000
LRES     DS    0H                                                       11850000
         CLC   0(4,R4),=F'3'                                            11860000
         BNE   RET4                                                     11870000
         ST    R4,RDT4                                                  11880000
         CALL  CTSADTE,(RDT4)          RESUME DATE                      11890000
         B     RET0                                                     11900000
LFLG4    DS    0H                                                       11910000
*BS10001 L     R5,REVDT                |REVOKE DATE                     11920000
*BS10001 LTR   R5,R5                   |   WAS NOT OBTAINED             11930000
*BS10001 BZ    RET0                    |     RETURN REVOKE FLAG         11940000
*BS10001 MVI   4(R4),X'00'             |OBTAINED REVOKE DATE.           11950000
         B     RET0                    |   USER NO REVOKED !            11960000
LLOGTIME DS    0H                                                       11970000
         CLC   0(4,R4),=F'0'                 LENGTH = 0 ?               11980000
         BE    LOGANYT                 YES. LOG ANYTIME.                11990000
*                                      IF LENGTH NOT EQ 0. MUST BE 6    12000000
*                                      3 BYTE TIME FROM  DEC PACK       12010000
*                                      3 BYTE TIME TO    DEC PACK       12020000
         CLC   0(4,R4),=F'6'                                            12030000
         BNE   RET4                                                     12040000
         MVC   TIME(3),4(R4)           TIME FROM                        12050000
         UNPK  TIMEF(5),TIME(3)                                         12060000
         MVC   TIME(3),7(R4)           TIME TO                          12070000
         UNPK  TIMET(5),TIME(3)                                         12080000
         MVC   0(4,R4),=F'9'           LENGTH OF RESULT FIELD           12090000
         MVC   4(4,R4),TIMEF+1         TIME FROM                        12100000
         MVI   8(R4),C':'              :                                12110000
         MVC   9(4,R4),TIMET+1         TIME TO                          12120000
         B     RET0                                                     12130000
LOGANYT  DS    0H                      YES. LOG ANYTIME.                12140000
         MVC   0(4,R4),=F'7'                                            12150000
         MVC   4(7,R4),=CL7'ANYTIME'                                    12160000
         B     RET0                                                     12170000
LLOGDAYS DS    0H                                                       12180000
         CLI   FLGDT,0                 FLAG LOGDAYS FIELD.FIRST FIELD?  12190000
         BE    LGD1                    YES                              12200000
*                                      SECOND FIELD LOGDAYS             12210000
         CLI   4(R4),X'82'             WEEKDAYS ?                       12220000
         BE    RET4                    YES. NOT NEED .                  12230000
         CLI   4(R4),X'00'             ANYDAY   ?                       12240000
         BE    RET4                    YES. NOT NEED .                  12250000
         XI    4(R4),X'FF'             CHANGE FLAGS FROM 0 -> 1         12260000
         B     RET0                                                     12270000
LGD1     DS    0H                                                       12280000
         MVI   FLGDT,1                 FLAG LOGDAYS FIELD.              12290000
         B     RET0                                                     12300000
LDFLTGRP DS    0H                                                       12310000
         MVC   DFLTGRP(8),4(R4)        KEEP DEFAULT GROUP               12320000
         B     RET0                                                     12330000
LFLAG7   DS    0H                                                       12340000
         MVC   FLAG7(1),4(R4)          FLAG7 FIELD NEED/NOT PASSWORD    12350000
*PS0460  B     RET4                                                     12360000
         B     RET0                    PS0460                           12370000
LPSWRD   DS    0H                                                       12380000
*PS0460  TM    FLAG7,X'80'                                              12390000
*PS0460  BZ    RET0                    NEED PASSWORD                    12400000
*PS0460  B     RET4                    NOT NEED PASSWORD                12410000
         TM    FLAG7,X'C0'             PS0460 CHECK BIT0 AND BIT1       12420000
         BNZ   RET4                    PS0460 PASSWORD NOT NEEDED       12430000
         B     RET0                    PS0460 PASSWORD NEEDED           12440000
LNUMCTGY DS    0H                      NUMBER OF CATEGORIES             12450000
         LR    R6,R5                   FIELD LENGTH                     12460000
         LR    R5,R4                   ADDRESS OF VALUE                 12470000
         LA    R5,4(R5)                BRANCH OVER THE LENGTH           12480000
         MVC   NUMCTGY(4),0(R5)        MOVE VALUE                       12490000
         L     R5,NUMCTGY                                               12500000
         SLL   R5,1                    COUNT *= 2. EACH CODE  2 BYTE    12510000
         L     R6,PTRCTGAS             PTR TO STATIC AREA               12520000
         C     R5,0(R6)                CHECK LENGTH OF STATIC AREA      12530000
         BH    GTDYN                   NOT ENOUGH SPACE TO STATIC AREA  12540000
*                                      BRANCH TO GET DYNAMIC AREA       12550000
* -------------------------------------ENOUGH SPACE TO STATIC AREA      12560000
         MVC   4(4,R6),NUMCTGY         STORE COUNT OF CATEGORIES        12570000
         LA    R6,8(R6)                BRANCH OVER THE SERVICE AREA     12580000
         ST    R6,WORKPTR              STORE WORK PTR                   12590000
         ST    R6,WORKPTR0             STORE WORK PTR                   12600000
         B     RET4                    NOT NEED PUT DATA TO OUTPUT AREA 12610000
* -------------------------------------NOT ENOUGH SPACE TO STATIC AREA  12620000
GTDYN    DS    0H                                                       12630000
         LA    R5,8(R5)                LENGTH OF AREA + 8 BYTE          12640000
*                                      1 - ST WORD NOT USE              12650000
*                                      2 - ND WORD COUNT OF CATEGORIES  12660000
         GETMAIN RC,LV=(5)                                              12670000
         LTR   R15,R15                                                  12680000
         BNZ   RET4                                                     12690000
         L     R6,PTRCTGAD             PTR TO STORE DYNAMIC AREA INF    12700000
         ST    R1,0(R6)                STORE ADDRESS                    12710000
         ST    R5,4(R6)                STORE LENGTH                     12720000
         ST    R1,WORKPTR              STORE WORK PTR                   12730000
         MVC   4(4,R1),NUMCTGY         STORE COUNT OF CATEGORIES        12740000
         L     R5,WORKPTR                                               12750000
         LA    R5,8(R5)                BRANCH OVER THE SERVICE AREA     12760000
         ST    R5,WORKPTR              STORE WORK PTR                   12770000
         ST    R5,WORKPTR0             STORE WORK PTR                   12780000
         B     RET4                    NOT NEED PUT DATA TO OUTPUT AREA 12790000
LSECL    DS    0H                                                       12800000
         MVC   SECLVL(1),4(R4)         STORE SECURITY LEVEL CODE        12810000
         B     RET4                    NOT NEED PUT TO OUTPUT AREA      12820000
*                                                                       12830000
********************************************************************    12840000
*        LIST FIELD                                                     12850000
********************************************************************    12860000
*                                                                       12870000
LLIST    DS    0H                                                       12880000
         L     R3,XPRFNML                                               12890000
         L     R4,XPRFADRL                                              12900000
         L     R5,0(R4)                FIELD LENGTH                     12910000
*                                                                       12920000
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *12930000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *12940000
               LEVEL=(DBGCNN,5,6,7),RAREA=RAREA                         12950000
         CLC   =CL8'CATEGORY',0(R3)    CATEGORIES                       12960000
         BE    LCATEGR                                                  12970000
         CLC   =CL8'CGGRPNM',0(R3)     CONNECTIONS GROUPS NAME          12980000
         BE    LCGGRPNM                                                 12990000
*BS2715  CLI   FLAGS,1                 WAS FOUND DEFAULT GROUP ?        13000000
*BS2715  BNE   RET0                    PUT DATA TO ADDINFO              13010000
         B     RET0                    PUT DATA TO ADDINFO       BS2715 13020000
*----------------------------------------------------------------       13030000
* ADDITIONAL CONNECT INFORMATION FOR DEFAULT GROUP                      13040000
*----------------------------------------------------------------       13050000
*BS2715  CLI   FLAGEQ,1                DEFAULT GROUP FOUND ?            13060000
*BS2715  BE    RET0                    Y,PUT INFORMATION                13070000
*BS2715  B     RET4                    N,SKIP INFORMATION               13080000
LCATEGR  DS    0H                                                       13090000
         LR    R6,R5                   FIELD LENGTH                     13100000
         LR    R5,R4                   ADDRESS OF VALUE                 13110000
         LA    R5,4(R5)                BRANCH OVER THE LENGTH           13120000
         XC    CATEGORY,CATEGORY                                        13130000
         MVC   CATEGORY(2),0(R5)       MOVE VALUE                       13140000
         L     R6,WORKPTR                                               13150000
         LTR   R6,R6                                                    13160000
         BZ    RET4                    WORK PTR = 0 ? WHY ?             13170000
         MVC   0(2,R6),0(R5)                                            13180000
         LA    R6,2(R6)                INCR WORK PTR                    13190000
         ST    R6,WORKPTR              STORE CURR ADDR FOR STORE CATEG  13200000
         B     RET4                    DON'T PUT CATEG CODE TO OUTPUT   13210000
LCGGRPNM DS    0H                      CONNECT GROUP ENTRY              13220000
         MVI   FLAGS,1                 NOW TREATMENT CONNECTION INF     13230000
         CLC   DFLTGRP(8),4(R4)        COMPARE DEFGRP WITH CONN.ENTRY   13240000
         BE    EQ                      YES,SKIP                         13250000
NOTEQ    DS    0H                      NO                               13260000
         MVI   FLAGEQ,0                                                 13270000
         CTSADBG 'DFLTGRP=_/$ NOTEQ FIELD=_ VALUE=_/$',                *13280000
               (DFLTGRP,8,DFLTGRP,8,0(R3),8,4(R4),8,4(R4),8),          *13290000
               LEVEL=(DBGCNN,6,7),RAREA=RAREA                           13300000
         B     RET0                    PUT TO OUTPUT AREA               13310000
EQ       DS    0H                                                       13320000
         MVI   FLAGEQ,1                CURR GROUP NAME = DEAFULT GROUP  13330000
         CTSADBG 'DFLTGRP=_/$    EQ FIELD=_ VALUE=_/$',                *13340000
               (DFLTGRP,8,DFLTGRP,8,0(R3),8,4(R4),8,4(R4),8),          *13350000
               LEVEL=(DBGCNN,6,7),RAREA=RAREA                           13360000
         B     RET0                    PUT TO OUTPUT AREA               13370000
*                                                                       13380000
*        END                                                            13390000
*                                                                       13400000
LEND     DS    0H                                                       13410000
         B     RET0                                                     13420000
RET0     DS    0H                                                       13430000
         SR    R15,R15                                                  13440000
         B     RETT                                                     13450000
RET4     DS    0H                                                       13460000
         LA    R15,4                                                    13470000
         B     RETT                                                     13480000
RET8     DS    0H                                                       13490000
         LA    R15,8                                                    13500000
         B     RETT                                                     13510000
RETT     DS    0H                                                       13520000
         BRTRN (15)                                                     13530000
********************************************************************    13540000
*       W O R K  A R E A  A N D   C O N S T A N T S                     13550000
********************************************************************    13560000
RAREA    DS    64F                     WORKAREA FOR DIAG                13570000
FLAG7    DS    CL10                    FLAG7 FIELD                      13580000
DFLTGRP  DS    CL8                     DEFAULT GROUP FIELD              13590000
SECLVL   DS    CL1                     SECURITY LEVEL                   13600000
DBGCNN   DS    CL1                     DEBUG LEVEL                      13610000
FLAGEQ   DS    CL1                                                      13620000
FLAGS    DS    CL1                                                      13630000
R10SV    DS    F                       RESTORE R10                      13640000
REVDT    DS    F                       REVOKE DATE                      13650000
NUMCTGY  DS    F                       NUMBER OF CATEGORIES             13660000
CATEGORY DS    F                       CATEGORY                         13670000
PTRCTGAS DS    F                       PTR TO CATEGORIES AREA STATIC    13680000
PTRCTGAD DS    F                       PTR TO CATEGORIES AREA DYNAMIC   13690000
WORKPTR  DS    F                       WORK PTR                         13700000
WORKPTR0 DS    F                       WORK PTR START VALUE             13710000
TMOUTW   DS    F                                      ISAR0001          13720000
PASSINT  DS    CL1                     PASSWORD INTERVAL FIELD  SPR137  13730000
FLGDT    DS    CL1                     FLAG LOGDAYS FIELD               13740000
TIME     DS    CL3                     TIME                             13750000
TIMEF    DS    CL5                     TIME FROM                        13760000
TIMET    DS    CL5                     TIME TO                          13770000
********************************************************************    13780000
*       W O R K  A R E A  A N D   C O N S T A N T S                     13790000
********************************************************************    13800000
RDT4     DS    F                                                        13810000
AROUT    DS    F                       ADDRESS OPERROUT FIELD           13820000
ALIST    DS    F                       ADDRESS        SYMBOL :          13830000
ALEN     DS    F                       LENGTH  BEFORE SYMBOL :          13840000
ALIST2   DS    F                       ADDRESS        SYMBOL :          13850000
ALEN2    DS    F                       LENGTH  BEFORE SYMBOL :          13860000
ROUTN    DS    F                       CURRENT ROUT NUMBER              13870000
FLAGLIST DS    CL1                                                      13880000
ROUTFLAG DS    CL1                     ROUT FLAGS                       13890000
ROUTCODE DS    CL1                     ROUT CODES INFORMATION           13900000
RCODES   DS    F                       OUTPUT LINE. LENGTH              13910000
         DS    CL256                                CODES               13920000
PDEC     DS    D                       DEC DATA                         13930000
PDECT    DS    CL16                                                     13940000
MVCCD    MVC   0(0,R3),0(R1)           MOVE CHAR DATA                   13950000
MOVRES   MVC   0(0,R4),RCODES          MOVE RESULT                      13960000
PATTRN   DS    CL16                                                     13970000
PATTRND  DC    X'4020202020202020'     EDIT TABLE DEC -> CHAR           13980000
         DC    X'2020202020202020'                                      13990000
TMOUTP   DC    XL6'212020202020'                  BSR2032               14000000
********************************************************************    14010000
*       W O R K  A R E A  A N D   C O N S T A N T S                     14020000
********************************************************************    14030000
TDAT     DS    CL2                                                      14040000
         DC    X'00'                                                    14050000
TDATX    DS    CL5                                                      14060000
* --------------------------------------TRANSLATE TABLE CONVERT NUMBERS 14070000
TRTX     DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'                      14080000
         LTORG                                                          14090000
         DROP  ,                                                        14100000
*                                                                       14110000
****************************************************************        14120000
*                                                              *        14130000
* FUNCTION    : TEST ROUTINE FOR LISTUSER PROCESSING           *        14140000
*               DEFINITIONS ADDITIONAL INFO FOR DEFAULT GROUP  *        14150000
* -------------                                                *        14160000
* PARAMETERS  : SEE MEMBERS : CTSFXPR, CTSFXPF                 *        14170000
* -------------                                                *        14180000
* RETURN CODES:                                                *        14190000
* -------------                                                *        14200000
*               0 - PUT DATA                                   *        14210000
*               4 - DON'T PUT DATA                             *        14220000
*                                                              *        14230000
****************************************************************        14240000
*                                                                       14250000
TESTGRP  BEGIN                                                          14260000
*--------------------------------------------------------------------   14270000
*     ADDRESSABILITY MAIN PARAMETERS                                    14280000
*--------------------------------------------------------------------   14290000
         USING PARMM,R1                                                 14300000
         L     R2,XPROPCD                                               14310000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 14320000
         BE    LSTARTG                          RACF DATA BASE          14330000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 14340000
         BE    LENTRYG                          RACF DATA BASE          14350000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         14360000
         BE    LELEMNG                                                  14370000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               14380000
         BE    LLISTG                                                   14390000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      14400000
         BE    LENDG                            EXTRACTOR               14410000
         B     RET0G                                                    14420000
*                                                                       14430000
********************************************************************    14440000
*        START                                                          14450000
********************************************************************    14460000
*                                                                       14470000
LSTARTG  DS    0H                                                       14480000
         MVI   FLAGSG,0                START TREATMENT LINE             14490000
         B     RET0G                                                    14500000
*                                                                       14510000
********************************************************************    14520000
*        ENTRY                                                          14530000
********************************************************************    14540000
*                                                                       14550000
LENTRYG  DS    0H                                                       14560000
         B     RET0G                                                    14570000
*                                                                       14580000
********************************************************************    14590000
*        ELEMNTRY FIELD                                                 14600000
********************************************************************    14610000
*                                                                       14620000
LELEMNG  DS    0H                                                       14630000
         MVI   FLAGSG,0                START TREATMENT LINE             14640000
         L     R3,XPRFNME                                               14650000
         L     R4,XPRFADRE                                              14660000
         L     R5,0(R4)                FIELD LENGTH                     14670000
         CTSADBG 'ELMN FIELD=_ VALUE=#/_/$',                           *14680000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *14690000
               LEVEL=(DBGGRP,5,6,7)                                     14700000
         CLC   =CL8'ACLCNT',0(R3)      COUNT OF USERS CONNECT TO        14710000
*                                      GROUP THAT FOR REQUESTED         14720000
*                                      USER IS DEFAULT GROUP            14730000
         BE    LACLCNT                                                  14740000
         B     RET0G                                                    14750000
LACLCNT  DS    0H                                                       14760000
*                                      R5 = FIELD LENGTH                14770000
         LA    R6,ACLCNT               ACLCNT FIELD                     14780000
         BCTR  R5,0                    DECR FOR EX COMMAND              14790000
         EX    R5,MOVEG                                                 14800000
         B     RET4G                   NOT NEED PUT DATA TO OUTPUT AREA 14810000
*                                                                       14820000
********************************************************************    14830000
*        LIST FIELD                                                     14840000
********************************************************************    14850000
*                                                                       14860000
LLISTG   DS    0H                                                       14870000
         L     R3,XPRFNML                                               14880000
         L     R4,XPRFADRL                                              14890000
         L     R5,0(R4)                FIELD LENGTH                     14900000
         CTSADBG 'LIST FLAGSG=$ FLAGEQG=$ FIELD=_ VALUE=#/_/$',        114910000
               (FLAGSG,1,FLAGEQG,1,0(R3),8,?R5,4(R4),?R5,4(R4),?R5),   214920000
               LEVEL=(DBGGRP,5,6,7)                                     14930000
         CLC   =CL8'USERID',0(R3)      USERID LIST DATA                 14940000
         BE    LUSERID                                                  14950000
         CLI   FLAGSG,1                WAS FOUND USERID LIST INF ?      14960000
         BNE   RET0G                   NOT YET, PUT DATA                14970000
* ------------------------------------------------------------------    14980000
*  WAS FOUND USERID LIST DATA                                           14990000
* ------------------------------------------------------------------    15000000
         CLI   FLAGEQG,1               USERID FROM LIST=REQUEST.USERID? 15010000
         BE    RET0G                   Y,PUT INFORMATION                15020000
         B     RET4G                   N,PASS INFORMATION               15030000
LUSERID  DS    0H                      CONNECT GROUP ENTRY              15040000
         MVI   FLAGSG,1                NOW TREATMENT CONNECTION INF     15050000
         CLC   USERID(8),4(R4)         COMPARE USERID WITH ENTRY        15060000
         BE    EQG                     Y,SKIP                           15070000
NOTEQG   DS    0H                                                       15080000
         MVI   FLAGEQG,0               N                                15090000
         CTSADBG 'USERID=_/$ NOTEQ FIELD=_ VALUE=_/$',                 *15100000
               (USERID,8,USERID,8,0(R3),8,4(R4),8,4(R4),8),            *15110000
               LEVEL=(DBGGRP,5,6,7)                                     15120000
         B     RET4G                   PASS THIS INFORMATION            15130000
EQG      DS    0H                                                       15140000
         MVI   FLAGEQG,1                                                15150000
         CTSADBG 'USERID=_/$   TEQ FIELD=_ VALUE=_/$',                 *15160000
               (USERID,8,USERID,8,0(R3),8,4(R4),8,4(R4),8),            *15170000
               LEVEL=(DBGGRP,5,6,7)                                     15180000
         B     RET4G                   PUT INFORMATION ( RET0G )        15190000
LENDG    DS    0H                                                       15200000
         B     RET0G                                                    15210000
RET0G    DS    0H                                                       15220000
         SR    R15,R15                                                  15230000
         B     RETTG                                                    15240000
RET4G    DS    0H                                                       15250000
         LA    R15,4                                                    15260000
         B     RETTG                                                    15270000
RET8G    DS    0H                                                       15280000
         LA    R15,8                                                    15290000
         B     RETTG                                                    15300000
RETTG    DS    0H                                                       15310000
         BRTRN (15)                                                     15320000
********************************************************************    15330000
*       W O R K  A R E A  A N D   C O N S T A N T S                     15340000
********************************************************************    15350000
USERID   DS    CL8                     USERID                           15360000
ACLCNT   DS    F                       NUMBERS OF CONNECT ENTRIES       15370000
MOVEG    MVC   0(0,R6),4(R4)           MOVE DATA                        15380000
FLAGEQG  DS    CL1                                                      15390000
FLAGSG   DS    CL1                                                      15400000
DBGGRP   DS    CL1                     DEBUG LEVEL                      15410000
         LTORG                                                          15420000
         DROP  ,                                                        15430000
*                                                                       15440000
****************************************************************        15450000
*                                                              *        15460000
* FUNCTION    : TEST ROUTINE FOR LISTUSER PROCESSING           *        15470000
*               DEFINITIONS SEC LEVEL AND CATEGORIES INFORMATION        15480000
* -------------                                                *        15490000
* PARAMETERS  : SEE MEMBERS : CTSFXPR, CTSFXPF                 *        15500000
* -------------                                                *        15510000
* RETURN CODES:                                                *        15520000
* -------------                                                *        15530000
*               0 - PUT DATA                                   *        15540000
*               4 - DON'T PUT DATA                             *        15550000
*                                                              *        15560000
****************************************************************        15570000
*                                                                       15580000
TESTGRES BEGIN                                                          15590000
*--------------------------------------------------------------------   15600000
*     ADDRESSABILITY MAIN PARAMETERS                                    15610000
*--------------------------------------------------------------------   15620000
         USING PARMM,R1                                                 15630000
         L     R2,XPROPCD                                               15640000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 15650000
         BE    LSTARTS                          RACF DATA BASE          15660000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 15670000
         BE    LENTRYS                          RACF DATA BASE          15680000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         15690000
         BE    LELEMNS                                                  15700000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               15710000
         BE    LLISTS                                                   15720000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      15730000
         BE    LENDS                            EXTRACTOR               15740000
         B     RET0S                                                    15750000
*                                                                       15760000
********************************************************************    15770000
*        START                                                          15780000
********************************************************************    15790000
*                                                                       15800000
LSTARTS  DS    0H                                                       15810000
         MVI   YCTGF,0                 YES-CATEGORIES-FLAG              15820000
         MVI   YSLVF,0                 YES-SECLEVELS-FLAG               15830000
         MVI   GSLVF,0                 JUST-GETTING-SECLEVELS-FLAG      15840000
         XC    TSCLV,TSCLV             TEXT SEC LEVEL                   15850000
         B     RET0S                                                    15860000
*                                                                       15870000
********************************************************************    15880000
*        ENTRY                                                          15890000
********************************************************************    15900000
*                                                                       15910000
LENTRYS  DS    0H                                                       15920000
         L     R3,XPRENTRY             FIELD ADDR                       15930000
         L     R5,0(R3)                ENTRY NAME LENGTH                15940000
         L     R4,XPRPRFXY             FIELD VALUE                      15950000
         L     R4,0(R4)                                                 15960000
         USING RETAREA,R4                                               15970000
*                                                                       15980000
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X15990000
               (?R5,4(R3),?R5,XPFFLGS,1),                              X16000000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          16010000
*                                                                       16020000
         DROP  R4                                                       16030000
*                                      R5 = FIELD LENGTH                16040000
         LA    R3,4(R3)                BRANCH OVER THE LENGTH           16050000
         CLC   =CL8'CATEGORY',0(R3)                                     16060000
         BE    YCTG                                                     16070000
         CLC   =CL8'SECLEVEL',0(R3)                                     16080000
         BE    YSLV                                                     16090000
         B     RET0S                                                    16100000
YCTG     DS    0H                                                       16110000
         MVI   YCTGF,1                                                  16120000
         MVI   YSLVF,0                                                  16130000
         B     RET0S                                                    16140000
YSLV     DS    0H                                                       16150000
         MVI   YCTGF,0                                                  16160000
         MVI   YSLVF,1                                                  16170000
         B     RET0S                                                    16180000
*                                                                       16190000
********************************************************************    16200000
*        ELEMNTRY FIELD                                                 16210000
********************************************************************    16220000
*                                                                       16230000
LELEMNS  DS    0H                                                       16240000
         L     R3,XPRFNME                                               16250000
         L     R4,XPRFADRE                                              16260000
         L     R5,0(R4)                FIELD LENGTH                     16270000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          *16280000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *16290000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          16300000
         CLC   =CL8'MEMCNT',0(R3)      LIST OF CATEGORIES NAME          16310000
*                                      OR SEC. LAVELS NAME              16320000
         BE    LMEMCNT                                                  16330000
         CLC   =CL8'CLASTYPE',0(R3)    FOR STORE INFO.UNKNOWN CATEG     16340000
         BE    LCLST                                                    16350000
         CLC   =CL8'LEVEL',0(R3)       FOR STORE SEC.LEVEL VALUE        16360000
         BE    LLEV                                                     16370000
         B     RET0S                                                    16380000
LLEV     DS    0H                                                       16390000
         CLI   YSLVF,1                 SEC. LEVEL ENTRY ?               16400000
         BNE   RET4S                   NO                               16410000
         CLI   YCTGF,1                 CATEG. ENTRY     ?               16420000
         BE    RET4S                   YES                              16430000
         CLI   SCLV,X'FF'              DEFAULT SEC. LEVEL ?             16440000
         BE    RET4S                   Y, DON'T PUT DATA                16450000
         CLC   TSCLV(4),=F'0'          SEC.LEVEL FOUND ?                16460000
*SPR124  BNE   LLEVF                   Y, PUT DATA                      16470000
*SPR124  B     RET4S                   DON'T PUT DATA                   16480000
         BNE   LLEVF                   Y, PUT IT                SPR124  16490000
*                                                               SPR124  16500000
*   CONVERT SEC LEVEL CODE TO TEXT                              SPR124  16510000
*                                                               SPR124  16520000
         SR    R5,R5                                            SPR124  16530000
         IC    R5,SCLV                                          SPR124  16540000
         LTR   R5,R5                   SEC LEVEL =0             SPR124  16550000
         BZ    RET4S                   Y, DON'T PUT DATA        SPR124  16560000
         CVD   R5,PACDEC                                        SPR124  16570000
         UNPK  NMBR(9),PACDEC(8)                                SPR124  16580000
         OI    NMBR+8,X'F0'            FIX UP LAST DIGIT        SPR124  16590000
         MVC   TSCLV(4),=F'3'          RESULT LENGTH            SPR124  16600000
         MVC   TSCLV+4(3),NMBR+6       MOVE RESULT              SPR124  16610000
*                                                               SPR124  16620000
LLEVF    DS    0H                      PUT SEC LEVEL TO OUTPUT AREA     16630000
         L     R5,TSCLV                LENGTH SEC.LEVEL TXT             16640000
*                                                                       16650000
         CTSADBG 'RESULT SEC.LEVEL=#/_/$',                             *16660000
               (?R5,TSCLV+4,?R5,TSCLV+4,?R5),                          *16670000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          16680000
*                                                                       16690000
         LA    R5,3(R5)                LENGTH=LENGTH + 4 - 1            16700000
         EX    R5,MOVSLV               MOVE SEC LEVEL TO OUTPUT AREA    16710000
         B     RET0S                   PUT DATA TO OUTPUT AREA          16720000
*                                                                       16730000
LMEMCNT  DS    0H                      NUMBER OF CATEGORIES             16740000
         B     RET4S                   DON'T PUT TO OUTPUT AREA         16750000
*-----------------------------------------------------------------      16760000
*   CREATE  INFO.UNKNOWNCAT   INFORMATION                               16770000
*-----------------------------------------------------------------      16780000
LCLST    DS    0H                                                       16790000
         CLI   YSLVF,1                 SEC. LEVEL ENTRY ?               16800000
         BE    RET4S                   YES, EXIT NOT FOR THIS ENTRY     16810000
         CLI   YCTGF,1                 CATEG. ENTRY     ?               16820000
         BNE   RET4S                   NO , RETURN                      16830000
         L     R7,AREAPTR              CURRENT USING WORK PTR           16840000
*                                      FOR STORE CATEG CODES            16850000
         LA    R7,4(R7)                BRANCH OVER THE MAX LENGTH       16860000
         L     R8,0(R7)                GET NUMBER OF CATEGORIES         16870000
         LTR   R8,R8                                                    16880000
         BZ    RET4S                   NUMBERS OF CATEG = 0. WHY ?      16890000
         LA    R7,4(R7)                BRANCH OVER THE COUNTER          16900000
         SR    R9,R9                   COUNTER UNKNOWN CATEGORIES       16910000
LPCTGF0  DS    0H                                                       16920000
         CLC   0(2,R7),=XL2'FFFF'      CATEG. WAS GETTING ?             16930000
         BE    LPCTGF1                 Y, SKIP                          16940000
         LA    R9,1(R9)                INCR COUNT UNKNOWN CATEG.        16950000
LPCTGF1  DS    0H                                                       16960000
         LA    R7,2(R7)                GOTO NEXT CATEG. CODE            16970000
         BCT   R8,LPCTGF0              LOOP THROUGH CATEG               16980000
         LTR   R9,R9                                                    16990000
         BZ    RET4S                   UNKNOWN. CATEG. NOT FOUND        17000000
         MVC   0(4,R4),=F'4'           LENGTH OF COUNTER                17010000
         ST    R9,4(R4)                STORE COUNTER                    17020000
*                                                                       17030000
         CTSADBG 'INFO.UNKNOWNCATEG=#/$',                              *17040000
               (?R9,4(R4),4),                                          *17050000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          17060000
*                                                                       17070000
         B     RET0S                   PUT DATA TO OUTPUT AREA          17080000
*                                                                       17090000
********************************************************************    17100000
*        LIST FIELD                                                     17110000
********************************************************************    17120000
*                                                                       17130000
LLISTS   DS    0H                                                       17140000
         L     R3,XPRFNML                                               17150000
         L     R4,XPRFADRL                                              17160000
         L     R5,0(R4)                FIELD LENGTH                     17170000
*                                                                       17180000
         CTSADBG 'LIST FIELD=_ VALUE=#/_/$',                           *17190000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *17200000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          17210000
*                                                                       17220000
         CLC   =CL8'MEMLST',0(R3)      CATEGORIES                       17230000
         BE    LMEMLST                                                  17240000
         B     RET4S                   INTERESTING ONLY CATEGORIES      17250000
LMEMLST  DS    0H                      CONNECT GROUP ENTRY              17260000
         CLI   YCTGF,1                 THIS LIST OF CATEGORIES ?        17270000
         BNE   MEMLLV                  N, LIST OF SEC LEVELS            17280000
*-----------------------------------------------------------------      17290000
*    CATEGORIES                                                         17300000
*-----------------------------------------------------------------      17310000
MEMLG    DS    0H                      Y, LIST OF CATEGORIES            17320000
         L     R7,AREAPTR                                               17330000
         LA    R7,4(R7)                BRANCH OVER THE MAX LENGTH       17340000
         L     R8,0(R7)                GET NUMBER OF CATEGORIES         17350000
         LTR   R8,R8                                                    17360000
         BZ    RET4S                   NUMBERS OF CATEG = 0. WHY ?      17370000
*                                      EXPLANATION 3(R4) :              17380000
*                                      4    - FIELD LENGTH              17390000
*                                      1-2  - CATEG. CODE               17400000
*                                      3... - CATEG. NAME               17410000
         CLI   6(R4),X'40'             FIRST BYTE CATEG. NAME=" "       17420000
         BE    RET4S                   YES . SPECIAL RACF NAME=HWS !    17430000
         LA    R7,4(R7)                BRANCH OVER THE COUNTER          17440000
LPCTG0   DS    0H                                                       17450000
*                                                                       17460000
         CTSADBG 'SEARCH CATEG NAME:TBL CODE=$ CURRENT RACF CODE=$',   117470000
               (0(R7),2,4(R4),2),                                      217480000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          17490000
*                                                                       17500000
         CLC   0(2,R7),4(R4)           COMPARE CODES OF CATEGORIES      17510000
         BE    LPCTG1                                                   17520000
         LA    R7,2(R7)                GOTO NEXT CATEG. CODE            17530000
         BCT   R8,LPCTG0                                                17540000
* -------------------------------------CATEG. CODE NOT FOUND            17550000
         B     RET4S                   DONT'T PUT TO OUTPUT AREA        17560000
LPCTG1   DS    0H                      CATEG FOUND                      17570000
         MVC   0(2,R7),=XL2'FFFF'      SIGN CATEG. WAS GETTING          17580000
         L     R6,0(R4)                                                 17590000
         BCTR  R6,0                    | LENGTH=LENGTH - 2 (CODE LEN)   17600000
         BCTR  R6,0                    | CODE OF CATEG                  17610000
*                                      TOTAL LENGTH OF CATEG.           17620000
*                                      2 BYTE - CODE                    17630000
*                                      OTHER  - TEXT                    17640000
*                                                                       17650000
         CTSADBG 'FOUND CATEG TEXT=#/_',(?R6,6(R4),?R6),               117660000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          17670000
*                                                                       17680000
         ST    R6,0(R4)                STORE LENGTH OF CATEG. TEXT      17690000
         BCTR  R6,0                    DECR FOR EX COMMAND              17700000
         LTR   R6,R6                   CHECK LENGTH OF TEXT             17710000
         BM    RET4S                   LENGTH < 0 ? WHY ?               17720000
         EX    R6,MVCTG                MOVE CATEG TO OUTPUT AREA        17730000
         B     RET0S                   PUT TO OUTPUT AREA               17740000
* ---------------------------------------------------------             17750000
*  SECURITY LEVEL                                                       17760000
* ---------------------------------------------------------             17770000
MEMLLV   DS    0H                                                       17780000
         CLI   YSLVF,1                 THIS LIST OF SEC. LEVELS?        17790000
         BNE   RET4S                   NO,RETURN                        17800000
         CLI   SCLV,X'FF'              DEFAULT SEC LEVEL ?              17810000
         BE    RET4S                   Y,DON'T PUT TO OUTPUT AREA       17820000
         CLI   GSLVF,1                 SEC LEVEL WAS FOUND ?            17830000
         BE    RET4S                   Y,NOT INTERESTING NOW            17840000
*                                      DON'T PUT TO OUTPUT AREA         17850000
         MVC   CSCLV(2),4(R4)          MOVE CURRENT SEC.LEVEL           17860000
         SR    R8,R8                                                    17870000
         LH    R8,CSCLV                CURRENT SEC.LEVEL                17880000
         SR    R9,R9                                                    17890000
         IC    R9,SCLV                 SEC LEVEL FROM USER PROFILE      17900000
*                                                                       17910000
         CTSADBG 'USER.SEC.LEVEL(R9)=~ CURRENT RACF SEC.LEVEL(R8)=~',  117920000
               (?R9,?R8),                                              217930000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          17940000
*                                                                       17950000
         CR    R8,R9                   SEC.LEVEL FROM USER PROFILE=     17960000
*                                      SEC.LEVEL FROM GENERAL RES PROF  17970000
         BNE   RET4S                   NO,DON'T PUT TO OUTPUT AREA      17980000
         LA    R9,TSCLV                SAVE SEC LVL TXT TO INTERNAL VAR 17990000
         L     R6,0(R4)                TOTAL LENGTH OF SEC LEVL         18000000
*                                      2 BYTE - CODE                    18010000
*                                      OTHER  - TEXT                    18020000
         BCTR  R6,0                    | LENGTH - LENGTH OF CODE        18030000
         BCTR  R6,0                    | 2 BYTE                         18040000
         ST    R6,0(R9)                STORE LENGTH OF CATEG. TEXT      18050000
         BCTR  R6,0                    DECR FOR EX COMMAND              18060000
         LTR   R6,R6                                                    18070000
         BM    RET4S                   LENGTH < 0 ? WHY ?               18080000
         EX    R6,MVCLV                MOVE LEVEL TO INTERNAL AREA      18090000
         LA    R6,1(R6)                RESTORE LENGTH                   18100000
         MVI   GSLVF,1                 SEC LEVEL FOUND !                18110000
*                                                                       18120000
         CTSADBG 'FOUND SEC.LEVEL TXT=#/_/$',                          *18130000
               (?R6,TSCLV+4,?R6,TSCLV+4,?R6),                          *18140000
               LEVEL=(DBGGRS,6,7),RAREA=RAREAS                          18150000
*                                                                       18160000
         B     RET4S                                                    18170000
LENDS    DS    0H                                                       18180000
         B     RET0S                                                    18190000
RET0S    DS    0H                                                       18200000
         SR    R15,R15                                                  18210000
         B     RETTS                                                    18220000
RET4S    DS    0H                                                       18230000
         LA    R15,4                                                    18240000
         B     RETTS                                                    18250000
RET8S    DS    0H                                                       18260000
         LA    R15,8                                                    18270000
         B     RETTS                                                    18280000
RETTS    DS    0H                                                       18290000
         BRTRN (15)                                                     18300000
********************************************************************    18310000
*       W O R K  A R E A  A N D   C O N S T A N T S                     18320000
********************************************************************    18330000
PACDEC   DS    D                                                        18340000
NMBR     DS    CL9                                                      18350000
YCTGF    DS    CL1                     YES-CATEG-FLAG                   18360000
YSLVF    DS    CL1                     YES-SECLEV-FLAG                  18370000
SCLV     DS    CL1                     SEC.LEVEL                        18380000
GSLVF    DS    CL1                     JUST-GETTING-SECLEVELS-FLAG      18390000
DBGGRS   DS    CL1                     DEBUG LEVEL                      18400000
AREAPTR  DS    F                       PTR TO LIST OF CATEGORIES        18410000
MVCTG    MVC   4(0,R4),6(R4)           MOVE CATEG TO OUTPUT AREA        18420000
MVCLV    MVC   4(0,R9),6(R4)           MOVE LEVEL TO INTERNAL AREA      18430000
MOVSLV   MVC   0(0,R4),TSCLV           MOVE INTERNAL SEC. LEVEL VALUE   18440000
CSCLV    DS    H                       CURRENT SEC.LEVEL CODE           18450000
TSCLV    DS    F                       LENGTH                           18460000
         DS    CL256                   CURRENT SEC.LEVEL TEXT           18470000
RAREAS   DS    64F                                                      18480000
         LTORG                                                          18490000
         DROP  ,                                                        18500000
* ---------------------------------------------------------------       18510000
DUMMYU   DS   0H           DUMMY OUTPUT SECTION                         18520000
         BR   R14                                                       18530000
         DROP  ,                                                        18540000
**************************************************************          18550000
*    MAIN PARAMETERS LIST FOR TEST ROUTINES                             18560000
**************************************************************          18570000
PARMM    DSECT                                                          18580000
         COPY  CTSFXPR                                                  18590000
******************************************************************      18600000
*       RETURN AREA FROM RACF                                           18610000
******************************************************************      18620000
RETAREA  DSECT                                                          18630000
         COPY  CTSFXPF                                                  18640000
         END   CTSFRLU                                                  18650000
