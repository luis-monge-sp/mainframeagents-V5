         TITLE 'RETRIEVE NUMBER OF ACE ENTRIES FROM RACF DATA BASE'     00010000
****************************************************************        00020000
****                                                        ****        00030000
****     CONTROL-SA  RELEASE 3.0.0                          ****        00040000
****                                                        ****        00050000
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00060000
****                                                        ****        00070000
****************************************************************        00080000
*                                                                       00090000
****************************************************************        00100000
*                                                              *        00110000
* TITLE            : CTSFGAN                                   *        00120000
*                                                              *        00130000
* FILE NAME        : CTSFGAN                                   *        00140000
*                                                              *        00150000
* AUTHOR           : ALEXANDER SHVARTSMAN                      *        00160000
*                                                              *        00170000
* CREATION DATE    : 24/12/97                                  *        00180000
*                                                              *        00190000
* DESCRIPTION      : RETRIEVE ACE AND CONDITIONAL ACE NUMBER   *        00200000
*                                                              *        00210000
* ASSUMPTIONS AND                                              *        00220000
*   CONSIDERATIONS : CALLER MUST BE APF AUTHORIZED             *        00230000
*                                                              *        00240000
****************************************************************        00250000
****************************************************************        00260000
* MOD.ID   WHO      WHEN     DESCRIPTION                       *        00270000
* -------- -------- -------- --------------------------------- *        00280000
* IS10186  AVNERL   21/01/24 RECOMP WITH CTSFXPR               *        00290002
* IS10188  AVNERL   06/10/24 MOVE OUR MODULES ABOVE 16M LINE   *        00293002
****************************************************************        00300000
*        PARAMETER LIST DSECT                                           00310000
****************************************************************        00320000
*                                                                       00330000
PARMLIST DSECT                                                          00340000
AOPTION  DS    A                       OPTION CODE ( LOCATE/NEXT) - IN  00350000
AENTYP   DS    A                       ENTRY TYPE = 'DATASET',    - IN  00360000
*                                      OR GENERAL RESOURCE CLASS  - IN  00370000
AENTRY   DS    A                       ENTRY NAME                 - IN  00380000
AFGEN    DS    A                       GENERIC FLAG               - IN  00390000
AVOLUME  DS    A                       VOLUME                     - IN  00391000
AUNIT    DS    A                       UNIT                       - IN  00392000
AACL     DS    A                       ACE'S NUMBER               - OUT 00394000
AOUT     DS    A                       OUTPUT LINE                - IN  00400000
ADEBUG   DS    A                       DEBUG LEVEL                - IN  00410000
ARCFRET  DS    A                       RACF RETURN CODE           - OUT 00420000
AREASON  DS    A                       RACF REASON CODE           - OUT 00430000
ASEP     DS    A                       SEPARATOR                  - IN  00440000
*                                                                       00450000
****************************************************************        00460000
*        INITIALIZE                                                     00470000
****************************************************************        00480000
*                                                                       00490000
CTSFGAN  CSECT                                                          00500000
CTSFGAN  AMODE 31                                                       00510000
*IS10188 CTSFGAN  RMODE 24       (FOR CTSADBG)                          00520002
CTSFGAN  RMODE ANY                                              IS10188 00521003
*        PRINT NOGEN                                                    00530000
         BEGIN *,R12,R11                                                00540000
         CTSEQUR                                                        00541000
         CTSLEVEL                                                       00550000
         LR    R10,R1                                                   00560000
         USING PARMLIST,R10            ADDRESABILITY PARAMETERS         00570000
*                                                                       00580000
*        SET DEBUG LEVEL                                                00590000
*                                                                       00600000
         L     R2,ADEBUG               R2 -> DEBUG LEVEL (4 BYTES)      00610000
         XC    DEBUGL,DEBUGL           STORE DEBUG LEVEL                00620000
         XC    DEBUG,DEBUG             STORE DEBUG LEVEL                00630000
         ICM   R2,15,0(R2)             DEBUG LEVEL                      00640000
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00650000
         STC   R2,DEBUGL               STORE DEBUG LEVEL (1 BYTE)       00660000
         ST    R2,DEBUG                STORE DEBUG LEVEL (1 BYTE)       00670000
NODEBUG  DS    0H                                                       00680000
         CTSADBG 'ENTERING',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=ANAREA       00690000
*                                                                       00700000
****************************************************************        00710000
*        PREPARE FOR EXTRACTOR CALL                                     00720000
****************************************************************        00730000
*                                                                       00740000
         L     R2,ASEP                 SEPARATOR                        00750000
         MVC   SEP(1),0(R2)            SAVE SEPARATOR                   00760000
         L     R2,AOUT                 EXTRACT AREA                     00770000
         ST    R2,AAREA                SAVE EXTRACT AREA ADDR           00780000
         NI    AAREA,X'7F'             CLEAR 0 - BYTE ( C-CONVENTIONS)  00790000
****************************************************************        00921000
*        ENTRY NAME HANDLING                                            00922000
****************************************************************        00923000
         MVI   ENTRY11,0               CLEAR LENGTH OF ENTRY FIELD      00923100
         L     R2,AENTRY                                                00923200
         MVC   ENTRY12(L'ENTRY12),0(R2)                                 00923300
         TR    ENTRY12(L'ENTRY12),TAB  CONVERT TO UPPERCASE             00923400
         LA    R1,ENTRY12+L'ENTRY12    MAX ENTRY NAME ADDR              00924000
         TRT   ENTRY12(L'ENTRY12),BLANKTAB                              00925000
         S     R1,=A(ENTRY12)                                           00926000
         LTR   R6,R1                   LENGTH = 0 ?                     00927000
         BNZ   LDSRLNZ                 NO,SKIP                          00928000
*-----------------------------------------------------------------      00930000
*        LENGTH=0 . VALID FOR 'NEXT' OPCODE                             00940000
*        IT MEANS SCAN DATABASE FROM THE BEGINING                       00950000
*-----------------------------------------------------------------      00960000
LDSRLZ   DS    0H                      LENGTH = 0                       00970000
         LA    R6,1                    LENGTH = 1                       00971000
         MVI   ENTRY11,1               INITIAL LENGTH = 1               00980000
         XC    ENTRY12,ENTRY12         CLEAR ENTRY NAME                 00990000
         B     LDSGCLS                                                  01000000
LDSRLNZ  DS    0H                                                       01010000
         STC   R6,ENTRY11              STORE REAL LENGTH OF ENTRY       01020000
LDSGCLS  DS    0H                                                       01021000
* -------------------------------------------------------               01030000
*        GET RESOURCE CLASS NAME                                        01040000
* -------------------------------------------------------               01050000
         MVC   CLASSR(8),=CL8' '                                        01060000
         L     R2,AENTYP               ADDR. CLASS-NAME                 01070000
         MVC   CLASSR(8),0(R2)                                          01080000
         TR    CLASSR(8),TAB           CONVERT CLASS  TO UPPERCASE      01090000
*                                                                       01100000
         CTSADBG 'CLASS=_ RESOURCE=#/_',LEVEL=(DEBUGL,3,4,5,6,7),      101110000
               (CLASSR,8,?R6,ENTRY12,?R6),RAREA=ANAREA                  01120000
*                                                                       01130000
* -------------------------------------------------------               01130200
*        GET VOLUME PARAMETER                                           01130300
* -------------------------------------------------------               01130400
*                                                                       01130500
         MVC   VOLUME(6),=CL6' '                                        01130600
         L     R2,AVOLUME              VOLUME                           01130700
         MVC   VOLUME(6),0(R2)                                          01130800
         TR    VOLUME(6),TAB           CONVERT VOLUME TO UPPERCASE      01130900
*                                                                       01131000
         CTSADBG 'VOLUME=_/$',LEVEL=(DEBUGL,3,4,5,6,7),                101131100
               (VOLUME,6,VOLUME,6),RAREA=ANAREA                         01131200
*                                                                       01132000
* -------------------------------------------------------               01132100
*        GET OPCODE PARAMETER                                           01133000
* -------------------------------------------------------               01133100
*                                                                       01134000
         L     R2,AOPTION              OPTION CODE / LOCATE / NEXTC /   01160000
         MVC   OPTCDE(8),0(R2)         MOVE OPTION CODE                 01170000
         TR    OPTCDE(8),TAB           CONVERT OPTION TO UPPERCASE      01180000
*                                                                       01181000
         CTSADBG 'OPTION=_',LEVEL=(DEBUGL,3,4,5,6,7),RAREA=ANAREA,     101182000
               (OPTCDE,8)                                               01183000
*                                                                       01184000
*        MOVE PARAMETERS TO TEST PROGRAM (FOR DATASET PROCESSING)       01185000
*                                                                       01185100
         L     R5,DRACCTST             'DS'  EXIT-TEST ROUTINE          01200000
         USING TESTDACL,R5                                              01210000
         MVC   DBGRESD(1),DEBUGL       DEBUG LEVEL                      01240000
         MVC   TCLASSD(8),CLASSR       RESOURCE CLASS                   01241000
         DROP  R5                                                       01250000
*                                                                       01250100
*        MOVE PARAMETERS TO TEST PROGRAM (FOR GENERAL RES PROCESSING)   01250200
*                                                                       01250300
         L     R5,GRACCTST             'GEN' EXIT-TEST ROUTINE          01251000
         USING TESTGACL,R5                                              01252000
         MVC   DBGRESG(1),DEBUGL       DEBUG LEVEL                      01253000
         MVC   TCLASSG(8),CLASSR       RESOURCE CLASS                   01254000
         DROP  R5                                                       01257000
*****************************************************************       01260000
*        LIST RESOURCE PROCESS. GET ICHENTRY ADDR                       01270000
*****************************************************************       01280000
         CLC   CLASSR(8),=CL8'DATASET' DATASET RESCOURCE CLASS ?        01290000
         BE    LDTSET                                                   01300000
         B     LGRSET                                                   01310000
LDTSET   DS    0H                                                       01320000
         CTSCALL GETLDPRM,,LINK=INT                                     01330000
         LR    R3,R15                  ICHEINTY ADDR OF PARM LIST       01340000
         B     LDSROPCD                                                 01350000
LGRSET   DS    0H                                                       01360000
         CTSCALL GETLGPRM,,LINK=INT                                     01370000
         LR    R3,R15                  ICHEINTY ADDR OF PARM LIST       01380000
         B     LDSROPCD                                                 01390000
*                                                                       01400000
****************************************************************        01410000
*        GENERIC, VOLUME PARAMETER HANDLING                             01420000
****************************************************************        01430000
*                                                                       01440000
LDSROPCD DS    0H                                                       01450000
         SR    R7,R7                   VOLUME ADDR DEFAULT (NO VOLUME)  01450100
         CLI   VOLUME,C' '             OBTAINED VOLUME ?                01451000
         BE    LDSRV0                  Y, SKIP                          01452000
         LA    R7,VOLUME               VOLUME ADDR                      01452100
LDSRV0   DS    0H                                                       01453000
         USING RXTPRM,R3               ADDRESSABILITY EXTRACTOR PARAMS  01460000
         L     R4,RXTRSGLT             SEGMENT'S LIST ADDR              01460100
         LA    R4,4(R4)                SKIP THE CONTROL WORD            01461000
LDSRV1   DS    0H                                                       01462000
         L     R5,8(R4)                ADDRESS OF ICHEINTY MACRO        01470000
         LTR   R5,R5                   END-OF-LIST ?                    01470100
         BZ    LDSRV2                  Y, SKIP                          01470200
*                                                                       01470300
         CTSADBG 'ICHEINTY=~ SET VOLUME=_ VOL.ADDR=~',                 101470400
               LEVEL=(DEBUGL,3,4,5,6,7),                               201470500
               (?R5,VOLUME,6,?R7),RAREA=ANAREA                          01470600
*                                                                       01470700
         ICHEINTY VOLUME=(R7),OPTIONS=(NOEXEC),                        X01470800
               RELEASE=1.8,MF=(E,(R5))                                  01470900
*                                                                       01471000
         LA    R4,16(R4)               GET NEXT ENTRY FROM TABLE        01472000
         B     LDSRV1                  LOOP                             01480000
*                                                                       01490000
LDSRV2   DS    0H                                                       01491000
         MVC   GENERIC(6),=CL6'UNCOND'                                  01500000
         L     R5,AFGEN                                                 01510000
         L     R6,0(R5)                                                 01520000
         LTR   R6,R6                                                    01560000
         BNZ   LDSRLCOP                                                 01570000
         MVC   GENERIC(6),=CL6'NO'                                      01580000
*                                                                       01580100
****************************************************************        01580200
*        LOCATE EXTRACTOR OPERATION                                     01580300
****************************************************************        01580400
*                                                                       01580500
LDSRLCOP DS    0H                                                       01580600
*                                                                       01580700
         CTSADBG 'OPCODE=_ GENERIC=_ RESET=_',RAREA=ANAREA,            X01580800
               (OPTCDE,6,GENERIC,6,RESET,3),LEVEL=(DEBUGL,3,4,5,6,7)    01580900
*                                                                       01582100
*        LOCATE OPCODE (FOR DATASET, GENERAL RESOURCE PROFILES)         01582200
*                                                                       01582300
LDSRLOCT DS    0H                                                       01583000
         XC    UDL11,UDL11             CLEAR OUTPUT DATA AREA           01584000
         XC    UDD12,UDD12                                              01585000
         XC    UDL21,UDL21                                              01586000
         XC    UDD22,UDD22                                              01587000
         CTSFAGR LOCATE,RC=RETCODE,MF=(E,(R3))                          01600000
*                                                                       01711000
*        DIAG TRACE                                                     01711100
*                                                                       01712000
         L     R4,0(R3)                ICHEINTY MACRO PARAM LIST        01713000
         L     R5,20(R4)               RACF PREFIX AREA                 01714000
         SR    R6,R6                                                    01714100
         IC    R6,ENTRY11                                               01714200
         USING RETAREA,R5                                               01715000
*                                                                       01715100
         CTSADBG 'RC=#/#/# ENTRY=#/_ GENERIC=$ DUPCNT=# RBA=$',        *01715200
               (RETCODE,RETCODE+4,RETCODE+8,?R6,ENTRY12,?R6,           *01715300
               XPFFLGS,1,XPFDDSC,XPFRBA,6),RAREA=ANAREA,               *01715400
               LEVEL=(DEBUGL,5,6,7)                                     01715500
*                                                                       01715600
         DROP  R5                                                       01715700
*------------------------------------------------------------           02310000
*     RETURN CURRENT ENTRY NAME TO CALLER, ACE'S NUMBER                 02320000
*------------------------------------------------------------           02330000
LDSRRET  DS    0H                                                       02340000
         L     R2,AACL                 ACE'S NUMBER                     02350100
         ICM   R3,X'F',UDD12                                            02351000
         ICM   R4,X'F',UDD22                                            02353000
         AR    R3,R4                                                    02354000
         ST    R3,0(R2)                RETURN TOTAL ACL'S NUMBER        02355000
         L     R2,AENTRY               ENTRY ADDR                       02356000
         MVC   0(256,R2),=CL256' '                                      02360000
         SR    R6,R6                                                    02370000
         IC    R6,ENTRY11              LENGTH OF ENTRY NAME             02380000
*                                                                       02381000
         CTSADBG 'RETURNED ENTRY=#/_',RAREA=ANAREA,                    *02382000
               (?R6,ENTRY12,?R6),                                      *02383000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02384000
*                                                                       02385000
         BCTR  R6,0                                                     02390000
         EX    R6,MVCENTRY                                              02400000
* --------------------     1  - RACF RETURN CODE                        02410000
* --------------------     2  - RACF REASON CODE                        02420000
* --------------------     3  - EXTRACTOR RETURN CODE                   02430000
*------------------------------------------------------------           02440000
*        MOVE RETURN CODES TO CALLER                                    02450000
*------------------------------------------------------------           02460000
         L     R2,ARCFRET                                               02470000
         MVC   0(4,R2),RETCODE                                          02480000
         L     R2,AREASON                                               02490000
         MVC   0(4,R2),RETCODE+4                                        02500000
         L     R15,RETCODE+8                                            02510000
*                                                                       02510100
         SR    R6,R6                                                    02510200
         IC    R6,ENTRY11                                               02510300
         CTSADBG 'ENTRY=#/_ ACCESS LIST=$/$ COND ACCESS LIST=$/$',     102510400
               (?R6,ENTRY12,?R6,UDL11,4,UDD12,4,UDL21,4,UDD22,4),      202510500
               LEVEL=(DEBUGL,3,4,5,6,7),RAREA=ANAREA                    02511000
*                                                                       02512000
EXIT     DS    0H                                                       02520000
         CTSADBG 'EXITING WITH RC=~',(?R15),RAREA=ANAREA,              102530000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02540000
         BRTRN (15)                                                     02550000
*                                                                       02560000
         LTORG                                                          02570000
*                                                                       02580000
ANAREA   DS   32D                      DEBUG WORK AREA                  02581000
SEP      DS   CL1                      SEPARATOR                        02590000
AAREA    DS   F                        ADDRESS OUTPUT AREA AREA         02600000
DEBUG    DS   F                        DEBUG LEVEL                      02610000
DEBUGL   DS   CL1                      DEBUG LEVEL                      02620000
*                                                                       02630000
ENTRY1   DS   0H                       | ENTRY NAME                     02662000
ENTRY11  DS   AL1                      |    FOR                         02663000
ENTRY12  DS   CL256                    | RESOURCE PROFILE               02664000
*                                                                       02670000
OPTCDE   DS   CL8                      OPCODE:   LOCATE / NEXTC         02720000
CLASSR   DS   CL8                      RESOURCE CLASS FOR GET           02730000
VOLUME   DS   CL6                      VOLUME PARAMETER                 02740000
OUTP     DC   A(DUMMY)                 EXTERNAL OUTPUT ROUTINE          02750000
CTSFRXT  DC   V(CTSFRXT)               EXTRACTOR PROGRAM NAME           02760000
DRACCTST DC   A(TESTDACL)                                               02771000
GRACCTST DC   A(TESTGACL)                                               02780000
*                                      CLASS=SECDATA                    02791000
RETCODE  DS   3F                                                        02800000
* --------------------     1  - RACF RETURN CODE                        02810000
* --------------------     2  - RACF REASON CODE                        02820000
* --------------------     3  - EXTRACTOR RETURN CODE                   02830000
BLANKTAB DC    256AL1(00)                                               02920000
         ORG   BLANKTAB+X'40'                                           02930000
         DC    X'FF'                                                    02940000
         ORG   ,                                                        02950000
*                                                                       02960000
MVCENTRY MVC   0(0,R2),ENTRY12         MOVE ENTRY NAME                  02980000
*                                                                       02981000
TAB      DC    256AL1(*-TAB)           TRANSLATE TABLE TO UPPERCASE     02990000
         ORG   TAB                                                      03000000
         DC    40C' '                                                   03010000
         ORG   TAB+C'A'-X'40'                                           03020000
         DC    C'ABCDEFGHI'                                             03030000
         ORG   TAB+C'J'-X'40'                                           03040000
         DC    C'JKLMNOPQR'                                             03050000
         ORG   TAB+C'S'-X'40'                                           03060000
         DC    C'STUVWXYZ'                                              03070000
         ORG   ,                                                        03080000
*                                                                       03090000
* -------------------------------------------------------               03100000
*        ADDITIONAL PARAMETERS FOR DATASET PROCESSING                   03110000
* -------------------------------------------------------               03120000
RESET    DC   CL8'NO'                  RESET PREFIX PART RETURN         03130000
GENERIC  DC   CL8'UNCOND'              GENERIC PARAMETER                03140000
*                                                                       03141000
*******************************************************************     03142000
*        INTERNAL RACF RETURN WORK AREA                                 03143000
*******************************************************************     03144000
*                                                                       03145000
NUMINFO  DS    0F                                                       03146000
RETALEN  DC    F'280'                  LENGTH OF AREA                   03147000
RETRBA   DC    XL6'00'                 RBA                              03148000
RETFLGS  DC    X'00'                   GENERIC FLAG                     03149000
RETRES1  DC    X'00'                   RESERVED                         03149100
RETDDSC  DC    F'0'                    DUPLICATE DATASET NAME COUNT     03149200
RETRES2  DC    XL8'00'                 RESERVED                         03149300
USERDATA DS    0CL256                                                   03149400
UDL00    DS    AL4                     TOTAL DATA LEBGTH                03149500
UDL11    DS    AL4                     DATA LENGTH                      03149600
UDD12    DS    CL4                     ACCESS LIST ENTRIES NUMBER       03149700
UDL21    DS    AL4                     DATA LENGTH                      03149800
UDD22    DS    CL4                     COND ACCESS LIST ENTRIES NUMBER  03149900
UDDRR    DS    CL252                   RESERVED                         03150000
*                                                                       03150100
         DROP  ,                                                        03151000
****************************************************************        03160000
*                                                              *        03170000
* FUNCTION    : SET PARAMETER LIST ADDR                        *        03180000
* -------------                                                *        03190000
* RETURN CODES: NONE                                           *        03200000
* -------------                                                *        03210000
* RETURN VALUE: R15 - ADDR ICHEINTY TABLE                      *        03220000
* -------------                                                *        03230000
*                                                              *        03240000
****************************************************************        03250000
*                                                                       03260000
GETLDPRM BEGIN                                                          03270000
         L     R15,=A(GETDV1)                                           03280000
         BRTRN (15)                                                     03290000
****************************************************************        03290200
*        EXTRACTOR DEFINITION TABLES                                    03290300
****************************************************************        03290400
GETDV1   CTSFAGR LOCATE,MF=L,WKAREA=NUMINFO,                           103290700
               TYPE='DS',OUTEP=OUTP,OUTAREA=AAREA,ENTRY=ENTRY1,        203290800
               TEST=DRACCTST,GENERIC=GENERIC,RESET=RESET,              303291000
               EOE=NO,GETPRG=CTSFRXT,DEBUG=DEBUG,                      403291200
               (TXTL='RESNAME'),                                       *03291300
               (ACLCNT,E,X,TXTL='ACLCNT',IGNORE=YES),                  *03291500
               (ACL2CNT,E,X,TXTL='ACL2CNT',IGNORE=YES)                  03291800
*                                                                       03292300
         LTORG                                                          03300000
         DROP  ,                                                        04630000
****************************************************************        04640000
*                                                              *        04650000
* FUNCTION    : SET PARAMETER LIST ADDR                        *        04660000
* -------------                                                *        04670000
* RETURN CODES: NONE                                           *        04680000
* -------------                                                *        04690000
* RETURN VALUE: R15 - ADDR ICHEINTY TABLE                      *        04700000
* -------------                                                *        04710000
*                                                              *        04720000
****************************************************************        04730000
*                                                                       04740000
GETLGPRM BEGIN                                                          04750000
         L     R15,=A(GETG1)                                            04760000
         BRTRN (15)                                                     04770000
****************************************************************        04770100
*        EXTRACTOR DEFINITION TABLES                                    04770200
****************************************************************        04770300
GETG1    CTSFAGR LOCATE,MF=L,WKAREA=NUMINFO,                           104770600
               TYPE='GEN',OUTEP=OUTP,OUTAREA=AAREA,                    204770700
               TEST=GRACCTST,GENERIC=GENERIC,RESET=RESET,ENTRY=ENTRY1, 304770900
               EOE=NO,GETPRG=CTSFRXT,CLASS=CLASSR,DEBUG=DEBUG,         404771100
               (TXTL='RESNAME'),                                       *04771200
               (ACLCNT,E,X,TXTL='ACLCNT',IGNORE=YES),                  *04771400
               (ACL2CNT,E,X,TXTL='ACL2CNT',IGNORE=YES)                  04771700
*                                                                       04772200
         LTORG                                                          04780000
         DROP  ,                                                        06610000
****************************************************************        06620000
*                                                              *        06630000
* FUNCTION    : TEST ROUTINE FOR LIST RESOURCES ACE'S          *        06640000
*                                                              *        06650000
****************************************************************        06660000
*                                                                       06670000
TESTDACL BEGIN                                                          06680000
*--------------------------------------------------------------------   06690000
*        ADDRESSABILITY MAIN PARAMETERS                                 06700000
*--------------------------------------------------------------------   06710000
         USING PARMM,R1                                                 06720000
         L     R2,XPROPCD                                               06730000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 06740000
         BE    LSTARTD                          RACF DATA BASE          06750000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 06760000
         BE    LENTRYD                          RACF DATA BASE          06770000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         06780000
         BE    LELEMND                                                  06790000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               06800000
         BE    LLISTD                                                   06810000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      06820000
         BE    LENDD                            EXTRACTOR               06830000
         B     RET0D                                                    06840000
*                                                                       06850000
********************************************************************    06860000
*        START                                                          06870000
********************************************************************    06880000
*                                                                       06890000
LSTARTD  DS    0H                                                       06900000
         B     RET0D                                                    06911000
*                                      CATEGORIES CODES                 06920000
********************************************************************    06930000
*        ENTRY                                                          06940000
********************************************************************    06950000
*                                                                       06960000
LENTRYD  DS    0H                                                       06970000
         L     R3,XPRENTRY                                              06980000
         L     R5,0(R3)                ENTRY NAME LENGTH                06990000
         L     R4,XPRPRFXY                                              07000000
         L     R4,0(R4)                                                 07010000
         USING RETAREA,R4                                               07020000
*                                                                       07030000
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X07040000
               (?R5,4(R3),?R5,XPFFLGS,1),                              X07050000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       07060000
*                                                                       07070000
         DROP  R4                                                       07140000
         B     RET0D                   Y, RETURN (ACCEPT)               07156000
*                                                                       07160000
********************************************************************    07170000
*        ELEMNTRY FIELD                                                 07180000
********************************************************************    07190000
*                                                                       07200000
LELEMND  DS    0H                                                       07210000
         L     R3,XPRFNME              RACF FIELD NAME                  07220000
         L     R4,XPRFADRE             RACF FIELD VALUE                 07230000
         L     R5,0(R4)                FIELD LENGTH                     07240000
*                                                                       07250000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          X07260000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      X07270000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       07280000
*                                                                       07290000
         B     RET0D                                                    07480000
*                                                                       07910100
********************************************************************    08340000
*        LIST FIELD                                                     08350000
********************************************************************    08360000
*                                                                       08370000
LLISTD   DS    0H                                                       08380000
         L     R3,XPRFNML                                               08390000
         L     R4,XPRFADRL                                              08400000
         L     R5,0(R4)                FIELD LENGTH                     08410000
*                                                                       08420000
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *08430000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *08440000
               LEVEL=(DBGRESD,5,6,7),RAREA=RAREAD                       08450000
*                                                                       08460000
         B     RET0D                   PUT DATA TO ADDINFO              08490000
* --------------------------------------------------------              08660000
*        END                                                            08670000
* --------------------------------------------------------              08680000
LENDD    DS    0H                                                       08690000
         B     RET0D                                                    08700000
* --------------------------------------------------------              08710000
*        EXITING                                                        08720000
* --------------------------------------------------------              08730000
RET0D    DS    0H                                                       08740000
         SR    R15,R15                                                  08750000
         B     RETTD                                                    08760000
RET4D    DS    0H                                                       08770000
         LA    R15,4                                                    08780000
         B     RETTD                                                    08790000
RET8D    DS    0H                                                       08800000
         LA    R15,8                                                    08810000
         B     RETTD                                                    08820000
RETTD    DS    0H                                                       08830000
         BRTRN (15)                                                     08840000
********************************************************************    08850000
*        W O R K  A R E A  A N D   C O N S T A N T S                    08860000
********************************************************************    08870000
*                                                                       08880000
RAREAD   DS    64F                                                      08880100
DBGRESD  DS    XL1                     DEBUG LEVEL                      08930000
TCLASSD  DS    CL8                     CLASS NAME                       09010500
********************************************************************    09020000
*       W O R K  A R E A  A N D   C O N S T A N T S                     09030000
********************************************************************    09040000
         LTORG                                                          09050000
         DROP  ,                                                        12060000
*                                                                       12070000
****************************************************************        12070100
*                                                              *        12070200
* FUNCTION    : TEST ROUTINE FOR LIST RESOURCES ACE'S          *        12070300
*                                                              *        12070400
****************************************************************        12070500
*                                                                       12070600
TESTGACL BEGIN                                                          12070700
*--------------------------------------------------------------------   12070800
*        ADDRESSABILITY MAIN PARAMETERS                                 12070900
*--------------------------------------------------------------------   12071000
         USING PARMM,R1                                                 12071100
         L     R2,XPROPCD                                               12071200
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 12071300
         BE    LSTARTG                          RACF DATA BASE          12071400
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 12071500
         BE    LENTRYG                          RACF DATA BASE          12071600
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         12071700
         BE    LELEMNG                                                  12071800
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               12071900
         BE    LLISTG                                                   12072000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      12072100
         BE    LENDG                            EXTRACTOR               12072200
         B     RET0G                                                    12072300
*                                                                       12072400
********************************************************************    12072500
*        START                                                          12072600
********************************************************************    12072700
*                                                                       12072800
LSTARTG  DS    0H                                                       12072900
         B     RET0G                                                    12073000
*                                      CATEGORIES CODES                 12073100
********************************************************************    12073200
*        ENTRY                                                          12073300
********************************************************************    12073400
*                                                                       12073500
LENTRYG  DS    0H                                                       12073600
         L     R3,XPRENTRY                                              12073700
         L     R5,0(R3)                ENTRY NAME LENGTH                12073800
         L     R4,XPRPRFXY                                              12073900
         L     R4,0(R4)                                                 12074000
         USING RETAREA,R4                                               12074300
*                                                                       12074400
         CTSADBG 'ENTRY=#/_ FLAG=$',                                   X12074500
               (?R5,4(R3),?R5,XPFFLGS,1),                              X12074600
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       12074700
*                                                                       12074800
         DROP  R4                                                       12074900
         B     RET0G                   Y, RETURN (ACCEPT)               12075700
*                                                                       12075800
********************************************************************    12075900
*        ELEMNTRY FIELD                                                 12076000
********************************************************************    12076100
*                                                                       12076200
LELEMNG  DS    0H                                                       12076300
         L     R3,XPRFNME              RACF FIELD NAME                  12076400
         L     R4,XPRFADRE             RACF FIELD VALUE                 12076500
         L     R5,0(R4)                FIELD LENGTH                     12076600
*                                                                       12076700
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          X12076800
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      X12076900
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       12077000
*                                                                       12077100
         B     RET0G                                                    12077600
*                                                                       12077700
********************************************************************    12078300
*        LIST FIELD                                                     12078400
********************************************************************    12078500
*                                                                       12078600
LLISTG   DS    0H                                                       12078700
         L     R3,XPRFNML                                               12078800
         L     R4,XPRFADRL                                              12078900
         L     R5,0(R4)                FIELD LENGTH                     12079000
*                                                                       12079100
         CTSADBG 'LIST  FIELD=_ VALUE=#/_/$',                          *12079200
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *12079300
               LEVEL=(DBGRESG,5,6,7),RAREA=RAREAG                       12079400
*                                                                       12079500
         B     RET0G                   PUT DATA TO ADDINFO              12079600
* --------------------------------------------------------              12079700
*        END                                                            12079800
* --------------------------------------------------------              12079900
LENDG    DS    0H                                                       12080000
         B     RET0G                                                    12080100
* --------------------------------------------------------              12080200
*        EXITING                                                        12080300
* --------------------------------------------------------              12080400
RET0G    DS    0H                                                       12080500
         SR    R15,R15                                                  12080600
         B     RETTG                                                    12081000
RET4G    DS    0H                                                       12082000
         LA    R15,4                                                    12083000
         B     RETTG                                                    12084000
RET8G    DS    0H                                                       12085000
         LA    R15,8                                                    12086000
         B     RETTG                                                    12087000
RETTG    DS    0H                                                       12088000
         BRTRN (15)                                                     12089000
********************************************************************    12089100
*        W O R K  A R E A  A N D   C O N S T A N T S                    12089200
********************************************************************    12089300
*                                                                       12089400
RAREAG   DS    64F                                                      12089500
DBGRESG  DS    XL1                     DEBUG LEVEL                      12090200
TCLASSG  DS    CL8                     CLASS NAME                       12091000
********************************************************************    12092000
*       W O R K  A R E A  A N D   C O N S T A N T S                     12093000
********************************************************************    12094000
         LTORG                                                          12095000
         DROP  ,                                                        12096000
* ---------------------------------------------------------------       12097000
*        DUMMY OUTPUT FUNCTION                                          12100100
* ---------------------------------------------------------------       12100200
DUMMY    DS    0H                                                       12100300
         BR    R14                                                      12104400
         DROP  ,                                                        12120000
******************************************************************      12167600
*        MAIN PARAMETERS LIST FOR TEST FUNCTIONS                        12167700
******************************************************************      12167800
PARMM    DSECT                                                          12167900
         COPY  CTSFXPR                                                  12168000
******************************************************************      12169000
*        RACF RETURN AREA PREFIX                                        12170000
******************************************************************      12180000
RETAREA  DSECT                                                          12190000
         COPY  CTSFXPF                                                  12200000
******************************************************************      12210000
*        MAIN EXTRACTOR PARAMETERS LIST                                 12220000
******************************************************************      12221000
RXTPRM   DSECT                                                          12221100
RXTINTY  DS    A                       ADDRESS ICHEINTY MACRO           12221200
RXTEXT   DS    A                       ADDRESS GET PROGRAM              12221300
RXTDBG   DS    A                       DEBUG LEVEL                      12221400
RXTRC    DS    A                       RETURN CODE - 3 WORDS            12221500
*                                       1  - RACF RETURN CODE           12221600
*                                       2  - RACF REASON CODE           12221700
*                                       3  - EXTRACTOR RC               12221800
*                                                                       12221900
RXTOP    DS    CL8                     OPERATION  ( NEXT / LOCATE )     12222000
RXTPRF   DS    CL8                     PROFILE TYPE ( USR,GRP,..  )     12222100
RXTENTRY DS    A                       ENTRY VALUE                      12222200
RXTFLDS  DS    A                       ADDR FIELDS DESCRIPTIONS         12222300
RXTETXT  DS    A                       TEXT FOR ENTRY FIELD             12222400
RXTOUT   DS    A                       EXT OUTPUT ROUT. ( V - CONTST)   12222500
RXTEXTA  DS    A                       ADDR OUTPUT AREA                 12222600
RXT1LINE DS    A                       ONE LINE PARAMETER               12222700
RXTALST  DS    A                       ADDRESS ACTION LIST              12222800
RXTRULE  DS    A                       ADDR RULE LIST                   12222900
RXTGEN   DS    A                       ADDRESS GENERIC PARAMETER        12223000
RXTRST   DS    A                       ADDRESS RESET PARAMETER          12223100
RXTTSTP  DS    A                       ADDRESS EXIT TEST ROUTINE        12223200
RXTPRX   DS    A                       ICHEINTY MIN. WORK AREA          12223300
RXTMAP   DS    A                       ADDR MAP PARAMETER               12223400
RXTDELAY DS    A                       DELAY PARAMETER LIST             12223500
*                                                                       12223600
*   ADDITIONAL PARAMETERS  (2.1.0)                                      12223700
*                                                                       12223800
RXTRAREA DS    A                       RACF RETURN AREA                 12223900
RXTRSGLT DS    A                       SEGMENT'S LIST ADDR              12224000
*                                      HL2:0- UPDATE ICHEINTY REQUIRED  12224100
*                                          1- UPDATE ICHEINTY DONE      12224200
*                                      HL2: NUMBER OF SEGMENTS          12224300
*                                      CL8'SEGM-NAME',A(ICHEINTY-ADDR), 12224400
*                                                     A(0)-SEGM EXISTS  12225000
         END   CTSFGAN                                                  12230000
