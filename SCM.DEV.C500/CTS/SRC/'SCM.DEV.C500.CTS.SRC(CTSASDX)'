*                                                                       00010005
****************************************************************        00020005
****                                                        ****        00030005
****     CONTROL-SA  RELEASE 1.3.0                          ****        00040005
****                                                        ****        00050005
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00060005
****                                                        ****        00070005
****************************************************************        00080005
*                                                                       00090005
****************************************************************        00100005
*                                                              *        00110005
* TITLE            : CTSASDX                                   *        00120005
*                                                              *        00130005
* FILE NAME        : CTSASDX                                   *        00140005
*                                                              *        00150005
* AUTHOR           : DORON COHEN                               *        00160005
*                                                              *        00170005
* CREATION DATE    : 06/10/94                                  *        00180005
*                                                              *        00190005
* DESCRIPTION      : DYNAMIC INSTALLATION OF SMF AND RACF EXITS*        00200005
*                                                              *        00210005
* ASSUMPTIONS AND                                              *        00220005
*   CONSIDERATIONS :                                           *        00230005
*                                                              *        00240005
****************************************************************        00250005
*                                                              *        00260005
* FUNCTION:                                                    *        00270005
* ---------                                                    *        00280005
*                                                              *        00290005
*    THIS MODULE EXAMINES, DYNAMICALY INSTALLS AND DELETES     *        00300005
*    THE FOLLOWING EXITS :                                     *        00310005
*                                                              *        00320005
*    1.  IEFU83   - SMF RECORD EXIT                            *        00330005
*    2.  ICHRIX02 - RACF RACINIT POST PROCESSING EXIT          *        00340005
*    3.  ICHPWX01 - RACF NEW PASSWORD EXIT                     *        00350005
*                                                              *        00360005
* PARAMETERS:                                                  *        00370005
* -----------                                                  *        00380005
*                                                              *        00390005
*    1. FUNCTION - INIT/LOAD/ENABLE/DISABLE/DELETE/TERM/DISC   *        00400005
*    2. SUBSYSTEM NAME                                         *        00410005
*    3. JOBNAME (OF XMM BLOCK)                                 *        00420005
*    4. EXIT NAME                                              *        00430005
*    5. DEBUG LEVEL                                            *        00440005
*                                                              *        00450005
* DATA AREAS:                                                  *        00460005
* -----------                                                  *        00470005
*                                                              *        00480005
*     XMM HEADER -> XSH  -> XST TABLE                          *        00490005
*                                                              *        00500005
*       EACH XST TABLE CONTAIN AN ENTRY PER SUPPORTED EXIT.    *        00510005
*       THE EXIT STATUS AND ADDRESS IS POINTED BY THE XST      *        00520005
*       ENTRY .                                                *        00530005
*                                                              *        00540005
* NOTES :                                                      *        00550005
* -------                                                      *        00560005
*                                                              *        00570005
*     ALL OPERATIONS OF THIS ROUTINE IS SERIALIZED VIA         *        00580005
*     AN ENQ LOCK (SCOPE=SYSTEM) TO INSURE THAT NO TABLES      *        00590005
*     OR FRONT ENDS ARE CHANGED BY US DURING ITS OPERATION.    *        00600005
*                                                              *        00610005
****************************************************************        00620005
*--------------------- CTS V 1.3.0 ----------------------------*        00630005
* *CTS1  07.06.95 DC USE X'FFFFFFFF' TO INDICATE NO PREVIOUS   *        00640005
*                    EXIT IN EXPPREV FIELD                     *        00650005
* *CTS2  13.06.95 DC DO NOT INSTALL SMF EXIT IN MVS 5.         *        00660005
*--------------------- CTS V 3.0.1 ----------------------------*        00670005
* WS2356 24.08.99 YB USE NAME/TOKEN INSTEAD OF SSCT/SSVT       *        00680005
*--------------------- CTS V 3.2.0 ----------------------------*        00690005
* BS2706  16.03.06 AL S0C4 IN ICHPWX01. RECOMPILE. (AS BS2690) *        00700005
* WS10047 14.09.14 NY SUPPORT JOB STARTED TASKS - TAKE         *        00710005
*                    STARTED TASK ID FROM CSCB INSTEAD OF      *        00720005
*                    TIOT.                                     *        00730005
*--------------------- CTS V 4.0.0 ----------------------------*        00740005
* SAS2IBMN 10.01.17 NURITY REMOVE ALL REFERENCE TO SSCT.       *        00750005
* WS10064  03.10.17 MEIRSH SUPPORT PHRASE .                    *        00760005
* IS10188  06.10.24 NURITY MOVE OUR MODULES ABOVE 16M LINE     *        00761005
****************************************************************        00762005
*IS10188 GBLC   &AMODUSE                                                00763005
*IS10188 &AMODUSE SETC   'CVT'                                          00764005
*                                                                       00765005
CTSASDX  CSECT                                                          00766005
CTSASDX  AMODE 31                                                       00767005
*IS10188 CTSASDX  RMODE 24                                              00768005
CTSASDX  RMODE ANY                                             IS10188  00769005
*                                                                       00770005
****************************************************************        00780005
*        INITIALIZE                                                     00790005
****************************************************************        00800005
*                                                                       00810005
         BEGIN *                                                        00820005
         CTSEQUR                                                        00830005
         CTSLEVEL ,                                                     00840005
*                                                                       00850005
         L     R10,=A(COMMON)          R10 -> COMMON DATA AREA          00860005
         USING COMMON,R10              MAPPING                          00870005
         ST    R1,ADDRPARM             SAVE PARAM BLOCK                 00880005
         LR    R11,R1                  R11 -> PARAM BLOCK               00890005
         USING PARM,R11                MAPPING OF PARAM BLOCK           00900005
*                                                                       00910005
*IS10188 CTSAMOD 31,R=R2               INSURE WE ARE IN AMODE 31        00920005
*IS10188 ST R2,AMODE                   SAVE ORIGINAL AMODE              00930005
         CTSAAMD 31,AMODSAV=AMODE                              IS10188  00940005
*                                                                       00950005
         L     R1,PARMDBG              R1 -> DEBUG LEVEL (4 BYTES)      00960005
         XC    DBGLEVEL,DBGLEVEL       STORE DEBUG LEVEL                00970005
         ICM   R1,15,0(R1)             DEBUG LEVEL                      00980005
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00990005
         STC   R1,DBGLEVEL             STORE DEBUG LEVEL (1 BYTE)       01000005
NODEBUG  DS    0H                                                       01010005
*                                                                       01020005
         XC    RC,RC                   INITIALIZE RC                    01030005
         XC    REASON,REASON           INITIALIZE REASON CODE           01040005
*                                                                       01050005
         CTSCALL GETID,LINK=INT        ENVIRONMENT DATA                 01060005
*                                                                       01070005
****************************************************************        01080005
*        OBTAIN SDX LOCK  (ENQ FOR SERIALIZATION)                       01090005
****************************************************************        01100005
*                                                                       01110005
         CTSCALL LOCK,LINK=INT                                          01120005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01130005
               '(SDX) LOCK RC = #',?R15                                 01140005
         LTR   R15,R15                 SERIALIZED ?                     01150005
         BZ    FUNCSCAN                YES, CHECK FUNCTION              01160005
         ST    R15,REASON              SET ENQ RC AS REASON CODE        01170005
         MVC   RC,=F'36'               SET LOCK FAILURE RC              01180005
         B     EXIT                    FINISHED                         01190005
*                                                                       01200005
****************************************************************        01210005
*        LOCATE FUNCTION IN FUNCTIONS TABLE                             01220005
****************************************************************        01230005
*                                                                       01240005
FUNCSCAN DS    0H                                                       01250005
         L     R15,PARMFUNC                                             01260005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01270005
               '(SDX) FUNC = _ (~~)',(0(R15),8,0(R15),4(R15))           01280005
*                                                                       01290005
         LA    R2,FUNCTABL             R2 -> FUNCTIONS TABLE            01300005
         LA    R3,FUNCNUM              R3 = FUNCION NUMBER              01310005
FUNCLOOP DS    0H                                                       01320005
         CLC   0(8,R2),0(R15)          REQUESTED FUNCTION ?             01330005
         BE    FUNCCALL                YES, CALL ROUTINE                01340005
         LA    R2,12(,R2)              NEXT ENTRY                       01350005
         BCT   R3,FUNCLOOP             TRY AGAIN                        01360005
*                                                                       01370005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01380005
               '(SDX) ERROR - INVALID FUNCTION'                         01390005
*                                                                       01400005
         MVC   RC,=F'40'               SET FUNCTION ERROR CODE          01410005
         B     EXIT                                                     01420005
*                                                                       01430005
****************************************************************        01440005
*        BRANCH TO THE REQUESTED FUNCTION                               01450005
****************************************************************        01460005
*                                                                       01470005
FUNCCALL DS    0H                                                       01480005
         L     R15,8(,R2)              R15 -> FUNCTION CODE             01490005
         CALL  (15)                    CALL FUNCTION                    01500005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01510005
               '(SDX) FUNC RC =#',?R15                                  01520005
*                                                                       01530005
****************************************************************        01540005
*        FINISH                                                         01550005
****************************************************************        01560005
*                                                                       01570005
EXIT     DS    0H                                                       01580005
*                                                                       01590005
***  RELEASE SDX LOCK (DEQ)                                             01600005
*                                                                       01610005
         CTSCALL UNLOCK,LINK=INT                                        01620005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01630005
               '(SDX) UNLOCK RC = #',?R15                               01640005
*                                                                       01650005
***  SET RETURN AND REASON CODES                                        01660005
*                                                                       01670005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X01680005
               '(SDX) SDX RC = # REASON = #',(RC,REASON)                01690005
         L     R15,PARMRC                                               01700005
         MVC   0(4,R15),RC                                              01710005
         L     R15,PARMRS                                               01720005
         MVC   0(4,R15),REASON                                          01730005
*                                                                       01740005
***  RESTORE AMODE                                                      01750005
*                                                                       01760005
*IS10188 L     R2,AMODE                                                 01770005
*IS10188 CTSAMOD RESTORE,R=R2                                           01780005
         CTSAAMD RESTORE,AMODSAV=AMODE                         IS10188  01790005
         L     R15,RC                                                   01800005
         BRTRN (15)                                                     01810005
*                                                                       01820005
****************************************************************        01830005
*        DATA AREAS                                                     01840005
****************************************************************        01850005
*                                                                       01860005
FUNCTABL DS    0F                                                       01870005
         DC    CL8'INIT    ',A(INIT)                                    01880005
         DC    CL8'TERM    ',A(TERM)                                    01890005
         DC    CL8'LOAD    ',A(LOAD)                                    01900005
         DC    CL8'DELETE  ',A(DELETE)                                  01910005
         DC    CL8'ENABLE  ',A(ENABLE)                                  01920005
         DC    CL8'DISABLE ',A(DISABLE)                                 01930005
         DC    CL8'SNAP    ',A(SNAP)                                    01940005
         DC    CL8'DISC    ',A(DISC)                                    01950005
FUNCTEND EQU   *                                                        01960005
FUNCNUM  EQU   (FUNCTEND-FUNCTABL)/12                                   01970005
*                                                                       01980005
         LTORG ,                                                        01990005
         DROP  ,                                                        02000005
*                                                                       02010005
*                                                                       02020005
****************************************************************        02030005
*        INIT - ALLOCATE AND INITIALIZE EXITS TABLE            *        02040005
****************************************************************        02050005
*                                                              *        02060005
* RETURN CODES:                                                *        02070005
* -------------                                                *        02080005
*                                                              *        02090005
*       0 - OK                                                 *        02100005
*       4 - XSH ALREADY ACTIVE                                 *        02110005
*       8 - NO SUBSYS                                          *        02120005
*      12 - XSH & XST'S GETMAIN FAILED                         *        02130005
*      16 - XSH ACTIVATION FAILED                              *        02140005
*      20 - XSH CLEANUP HAS FAILED (AFTER ACTIVATION ERROR)    *        02150005
*                                                              *        02160005
****************************************************************        02170005
*                                                                       02180005
INIT     DS    0F                                                       02190005
*                                                                       02200005
* 1) INITIALIZE                                                         02210005
*                                                                       02220005
         BEGIN                                                          02230005
         L     R10,=A(COMMON)                                           02240005
         USING COMMON,R10                                               02250005
         L     R11,ADDRPARM                                             02260005
         USING PARM,R11                                                 02270005
         MVI   FLAGAUTH,C'N'                                            02280005
*                                                                       02290005
* 2) LOCATE XMM HEADER                                                  02300005
*                                                                       02310005
         CTSCALL GETXMMH,LINK=INT                                       02320005
         ST    R15,REASON                                               02330005
         LTR   R15,R15                                                  02340005
         BNZ   INIT8                                                    02350005
         L     R9,ADDRXMMH                                              02360005
         USING XMMHDR,R9                                                02370005
*                                                                       02380005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X02390005
               '(INIT) XMM HEADER AT ~, XSH AT ~',(?R9,XMMXSH)          02400005
*                                                                       02410005
* 3) VERIFY THAT NO XSH IS ALREADY ACTIVE                               02420005
*                                                                       02430005
         CLC   =A(0),XMMXSH                                             02440005
         BNE   INIT4                                                    02450005
*                                                                       02460005
* 4) OBTAIN PSW AUTHORITY                                               02470005
*                                                                       02480005
         MODESET MODE=SUP,KEY=ZERO     WE NEED SUPERVISOR STATE         02490005
         MVI   FLAGAUTH,C'Y'           FLAG WE MOVED INTO SUP STATE     02500005
*                                                                       02510005
* 5) ALLOCATE XSH AND XST'S AREA IN CSA                                 02520005
*                                                                       02530005
         LA    R5,XSTLEN               R5 = LENGTH OF XST ENTRY         02540005
         MH    R5,=AL2(EXITS#)         SIZE OF ALL XST'S                02550005
         AH    R5,=AL2(XSHLEN)           PLUS HEADER (XSH)              02560005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X02570005
               '(INIT) ALLOCATING # BYTES FOR EXITS TABLE',(?R5)        02580005
*                                                                       02590005
*IS10188 CTSAXGR GETMAIN,LV=(R5),SP=241,BLOCKID=XSHT                    02600005
         CTSAXGR GETMAIN,LV=(R5),SP=241,BLOCKID=XSHT,LOC=ANY   IS10188  02610005
         ST    R15,REASON              SAVE REASON CODE                 02620005
         LTR   R15,R15                 HANDLE GETMAIN ERRORS            02630005
         BNZ   INIT12                  NO, ERROR                        02640005
         ST    R1,ADDRXSH              SAVE XSH ADDR                    02650005
*                                                                       02660005
         LR    R8,R1                   R8 -> XSH                        02670005
         USING XSH,R8                  MAP XSH                          02680005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X02690005
               '(INIT) XSH AREA ALLOCATED AT ~ SIZE=#',(?R8,?R5)        02700005
*                                                                       02710005
* 6) CLEAR GETMAINED AREA                                               02720005
*                                                                       02730005
         LR    R0,R8                   CLEAR THE AREA                   02740005
         LR    R1,R5                   SET LENGTH                       02750005
         XR    R15,R15                 PADD WITH X'00'                  02760005
         MVCL  R0,R14                  CLEAR                            02770005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X02780005
               '(INIT) XSH AREA CLEARED'                                02790005
*                                                                       02800005
* 7) FORMAT XSH                                                         02810005
*                                                                       02820005
         MVC   XSHXSH,=CL4'XSH'                                         02830005
         MVC   XSHVRSN,=A(XSHVER1)                                      02840005
         ST    R5,XSHMEMSZ                                              02850005
         MVC   XSHSTAT,=A(XSHFREE)                                      02860005
         MVC   XSHCOUNT,=A(EXITS#)                                      02870005
         MVC   XSHESIZE,=A(XSTLEN)                                      02880005
         LA    R7,XSH+XSHLEN                                            02890005
         USING XST,R7                                                   02900005
         ST    R7,XSHXST                                                02910005
*                                                                       02920005
* 8) FORMAT XST'S                                                       02930005
*                                                                       02940005
         L     R6,XSHCOUNT                                              02950005
         LA    R4,EXITS                                                 02960005
         USING EXENTRY,R4                                               02970005
*                                                                       02980005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X02990005
               '(INIT) XSH FORMATTED FOR # EXITS. FIRST XST AT ~',     X03000005
               (?R6,?R7)                                                03010005
FXSTLOOP DS    0H                                                       03020005
         MVC   XSTXST,=CL4'XST'                                         03030005
         MVC   XSTXNAME,EXLMOD                                          03040005
         MVC   XSTXSTAT,=A(XSTXFREE)                                    03050005
*                                                                       03060005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X03070005
               '(INIT) XST FOR EXIT _ FORMATTED AT ~',(EXLMOD,8,?R7)    03080005
*                                                                       03090005
         LA    R4,EXLEN(,R4)                                            03100005
         LA    R7,XSTLEN(R7)                                            03110005
         BCT   R6,FXSTLOOP                                              03120005
         DROP  R4                                                       03130005
*                                                                       03140005
* 9) SET XMM HEADER POINTER TO XSH                                      03150005
*                                                                       03160005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X03170005
               '(INIT) XMM HEADER AT ~ XMMXSH = ~ NEW XMMXSH = ~',     X03180005
               (?R9,XMMXSH,?R8)                                         03190005
*                                                                       03200005
         XR    R0,R0                                                    03210005
         LA    R1,XSH                                                   03220005
         CS    R0,R1,XMMXSH                                             03230005
         BZ    INIT0                                                    03240005
*                                                                       03250005
* 10) CLEANUP AFTER XMM HEADER POINTER FAILURE - FREE GETMAINED AREA    03260005
*                                                                       03270005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X03280005
               '(INIT) XMMXSH CS ERROR. FREEMAIN AT ~ LEN=#',          X03290005
               (?R8,XSHMEMSZ)                                           03300005
*                                                                       03310005
         L     R0,XSHMEMSZ                                              03320005
         LA    R1,XSH                                                   03330005
         CTSAXGR FREEMAIN,LV=(R0),A=(R1),SP=241,BLOCKID=XSHT            03340005
*                                                                       03350005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X03360005
               '(INIT) FREEMAIN RC = #',?R15                            03370005
*                                                                       03380005
         ST    R15,REASON                                               03390005
         LTR   R15,R15                                                  03400005
         BZ    INIT16                                                   03410005
         B     INIT20                                                   03420005
*                                                                       03430005
* 11) RETURN TO MAIN                                                    03440005
*                                                                       03450005
INIT20   DS    0H                                                       03460005
         MVC   RC,=F'20'                                                03470005
         B     INITEXIT                                                 03480005
INIT16   DS    0H                                                       03490005
         MVC   RC,=F'16'                                                03500005
         B     INITEXIT                                                 03510005
INIT12   DS    0H                                                       03520005
         MVC   RC,=F'12'                                                03530005
         B     INITEXIT                                                 03540005
INIT8    DS    0H                                                       03550005
         MVC   RC,=F'8'                                                 03560005
         B     INITEXIT                                                 03570005
INIT4    DS    0H                                                       03580005
         MVC   RC,=F'4'                                                 03590005
         B     INITEXIT                                                 03600005
INIT0    DS    0H                                                       03610005
         XC    RC,RC                                                    03620005
         B     INITEXIT                                                 03630005
*                                                                       03640005
INITEXIT DS    0H                                                       03650005
*                                                                       03660005
*        RESTORE PSW STATE (SUPERVISOR/PROBLEM) AND KEY                 03670005
*                                                                       03680005
         CLI   FLAGAUTH,C'N'                                            03690005
         BE    AUTHOK                                                   03700005
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             03710005
AUTHOK   DS    0H                                                       03720005
         L     R15,RC                                                   03730005
         BRTRN (15)                                                     03740005
         LTORG ,                                                        03750005
         DROP  ,                                                        03760005
*                                                                       03770005
****************************************************************        03780005
*        TERM - FREE XSH AND XST'S                             *        03790005
****************************************************************        03800005
*                                                              *        03810005
* RETURN CODES:                                                *        03820005
* -------------                                                *        03830005
*                                                              *        03840005
*       0 - OK                                                 *        03850005
*       4 - NO SUBSYS                                          *        03860005
*       8 - NOT ALL XST ARE FREE                               *        03870005
*      12 - XSH EYE CATCHER ERROR                              *        03880005
*      16 - NO XST'S EXIST                                     *        03890005
*      20 - XST EYE CATCHER ERROR                              *        03900005
*      24 - DEACTIVATION OF XSH FAILED                         *        03910005
*      28 - FREEMAIN OF XSH & XST'S HAS FAILED                 *        03920005
*                                                              *        03930005
****************************************************************        03940005
*                                                                       03950005
TERM     DS    0F                                                       03960005
*                                                                       03970005
* 1) INITIALIZE                                                         03980005
*                                                                       03990005
         BEGIN                                                          04000005
         L     R10,=A(COMMON)                                           04010005
         USING COMMON,R10                                               04020005
         L     R11,ADDRPARM                                             04030005
         USING PARM,R11                                                 04040005
         MVI   FLAGAUTH,C'N'                                            04050005
*                                                                       04060005
* 2) LOCATE XMM HEADER                                                  04070005
*                                                                       04080005
         CTSCALL GETXMMH,LINK=INT                                       04090005
         LTR   R15,R15                                                  04100005
         BZ    TERMOKXM                                                 04110005
         ST    R15,REASON                                               04120005
         B     TERM4                                                    04130005
*                                                                       04140005
TERMOKXM DS    0H                                                       04150005
         L     R9,ADDRXMMH                                              04160005
         USING XMMHDR,R9                                                04170005
*                                                                       04180005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04190005
               '(TERM) XMM HEADER AT ~, XSH AT ~',(?R9,XMMXSH)          04200005
*                                                                       04210005
* 3) VERIFY THAT ALL XST'S ARE FREE                                     04220005
*                                                                       04230005
         ICM   R8,15,XMMXSH            R8 -> XSH                        04240005
         BZ    TERM0                   NO, THAN WE ARE DONE             04250005
         USING XSH,R8                  MAP XSH                          04260005
         CLC   XSHXSH,=CL4'XSH'        REALLY AN XSH ?                  04270005
         BNE   TERM12                  NO, ERROR                        04280005
         ICM   R7,15,XSHXST            R7 -> FIRST XST                  04290005
         BZ    TERM16                  NO, ERROR                        04300005
         USING XST,R7                  MAP XST                          04310005
         ICM   R6,15,XSHCOUNT          R6 = NUMBER OF XSTS              04320005
         BZ    TERM16                  NONE, ERROR                      04330005
*                                                                       04340005
CHKXST   DS    0H                                                       04350005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04360005
               '(TERM) CHECKING XST AT ~ (# LEFT) NAME=_ STAT=~',      X04370005
               (?R7,?R6,XSTXNAME,8,XSTXSTAT)                            04380005
         CLC   XSTXST,=CL4'XST'        DO WE STILL HAVE AN XST ?        04390005
         BNE   TERM20                  NO, ERROR                        04400005
         CLC   XSTXSTAT,=A(XSTXFREE)   IS XST FREE ?                    04410005
         BNE   TERM8                   NO, CAN NOT DELETE IT            04420005
         LA    R7,XSTLEN(R7)           NEXT XST                         04430005
         BCT   R6,CHKXST               TRY IF ANY XST LEFT              04440005
*                                                                       04450005
* 4) GO INTO SUPERVISOR STATE / KEY 0                                   04460005
*                                                                       04470005
         MODESET MODE=SUP,KEY=ZERO WE NEED SUPERVISOR STATE             04480005
         MVI   FLAGAUTH,C'Y'                                            04490005
*                                                                       04500005
* 5) CLEAR XSH POINTER IN XMM HEADER                                    04510005
*                                                                       04520005
         LA    R0,XSH                  R0 -> XSH                        04530005
         XR    R1,R1                   R1 = NULL POINTER                04540005
         CS    R0,R1,XMMXSH            CLEAR XMM BLOCK POINTER          04550005
         BNZ   TERM24                  NO, ERROR                        04560005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04570005
               '(TERM) XMMXSH CLEARED'                                  04580005
*                                                                       04590005
* 5) FREE XSH AND XSTS                                                  04600005
*                                                                       04610005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04620005
               '(TERM) GOING TO FREE XSH AT ~ LEN=#',                  X04630005
               (?R8,XSHMEMSZ)                                           04640005
         L     R0,XSHMEMSZ                                              04650005
         LA    R1,XSH                                                   04660005
         CTSAXGR FREEMAIN,LV=(R0),A=(R1),SP=241,BLOCKID=XSHT            04670005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04680005
               '(TERM) FREEMAIN RC = #',?R15                            04690005
         ST    R15,REASON                                               04700005
         LTR   R15,R15                                                  04710005
         BNZ   TERM28                                                   04720005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X04730005
               '(TERM) XSH AND XST BUFFERS FREED'                       04740005
         B     TERM0                                                    04750005
*                                                                       04760005
* 6) RETURN TO MAIN                                                     04770005
*                                                                       04780005
TERM36   DS    0H                                                       04790005
         MVC   RC,=F'36'                                                04800005
         B     TERMEXIT                                                 04810005
TERM32   DS    0H                                                       04820005
         MVC   RC,=F'32'                                                04830005
         B     TERMEXIT                                                 04840005
TERM28   DS    0H                                                       04850005
         MVC   RC,=F'28'                                                04860005
         B     TERMEXIT                                                 04870005
TERM24   DS    0H                                                       04880005
         MVC   RC,=F'24'                                                04890005
         B     TERMEXIT                                                 04900005
TERM20   DS    0H                                                       04910005
         MVC   RC,=F'20'                                                04920005
         B     TERMEXIT                                                 04930005
TERM16   DS    0H                                                       04940005
         MVC   RC,=F'16'                                                04950005
         B     TERMEXIT                                                 04960005
TERM12   DS    0H                                                       04970005
         MVC   RC,=F'12'                                                04980005
         B     TERMEXIT                                                 04990005
TERM8    DS    0H                                                       05000005
         MVC   RC,=F'8'                                                 05010005
         B     TERMEXIT                                                 05020005
TERM4    DS    0H                                                       05030005
         MVC   RC,=F'4'                                                 05040005
         B     TERMEXIT                                                 05050005
TERM0    DS    0H                                                       05060005
         XC    RC,RC                                                    05070005
         B     TERMEXIT                                                 05080005
*                                                                       05090005
TERMEXIT DS    0H                                                       05100005
*                                                                       05110005
*        RESTORE PSW STATE (SUPERVISOR/PROBLEM) AND KEY                 05120005
*                                                                       05130005
         CLI   FLAGAUTH,C'N'                                            05140005
         BE    TERMAUTH                                                 05150005
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             05160005
TERMAUTH DS    0H                                                       05170005
         L     R15,RC                                                   05180005
         BRTRN (15)                                                     05190005
         LTORG ,                                                        05200005
         DROP  ,                                                        05210005
*                                                                       05220005
****************************************************************        05230005
*        DISC - EMERGENCY DISCONNECT OF EXITS TABLE FROM XMM   *        05240005
****************************************************************        05250005
*                                                              *        05260005
* DESCRIPTION                                                  *        05270005
* ------------                                                 *        05280005
*                                                              *        05290005
*  THE FUNCTION DISCONNECTS THE XSH BLOCK FROM THE XMM HEADER  *        05300005
*  BLOCK BY CLEARING THE POINTER TO THE XSH .                  *        05310005
*  IT IS USED FOR EMERGENCY SO THE SUBSYS AND XMM HEADER CAN   *        05320005
*  BE REUSED.                                                  *        05330005
*                                                              *        05340005
* NOTE :                                                       *        05350005
* ------                                                       *        05360005
*                                                              *        05370005
*   THE FUNCTION INTENTIONALLY DOES NOT FREE THE XSH/XST TABLE *        05380005
*   TO ALLOW DIAGNOSTICS .                                     *        05390005
*                                                              *        05400005
* RETURN CODES:                                                *        05410005
* -------------                                                *        05420005
*                                                              *        05430005
*       0 - OK                                                 *        05440005
*       4 - NO SUBSYS                                          *        05450005
*       8 - INVALID XSH                                        *        05460005
*      12 - DEACTIVATION OF XSH FAILED                         *        05470005
*                                                              *        05480005
****************************************************************        05490005
*                                                                       05500005
DISC     DS    0F                                                       05510005
*                                                                       05520005
* 1) INITIALIZE                                                         05530005
*                                                                       05540005
         BEGIN                                                          05550005
         L     R10,=A(COMMON)                                           05560005
         USING COMMON,R10                                               05570005
         L     R11,ADDRPARM                                             05580005
         USING PARM,R11                                                 05590005
*                                                                       05600005
* 2) LOCATE XMM HEADER                                                  05610005
*                                                                       05620005
         CTSCALL GETXMMH,LINK=INT                                       05630005
         LTR   R15,R15                                                  05640005
         BZ    DISCOKXM                                                 05650005
         ST    R15,REASON                                               05660005
         B     DISC4                                                    05670005
*                                                                       05680005
DISCOKXM DS    0H                                                       05690005
         L     R9,ADDRXMMH                                              05700005
         USING XMMHDR,R9                                                05710005
*                                                                       05720005
* 3) VERIFY XSH EXISTS                                                  05730005
*                                                                       05740005
         ICM   R8,15,XMMXSH            R8 -> XSH                        05750005
         BZ    DISCOK                  NO, THAN WE ARE DONE             05760005
         USING XSH,R8                  MAP XSH                          05770005
         CLC   XSHXSH,=CL4'XSH'        REALLY AN XSH ?                  05780005
         BNE   DISC8                   NO, ERROR                        05790005
*                                                                       05800005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X05810005
               '(DISC) XMM HEADER AT ~, XSH AT ~',(?R9,XMMXSH)          05820005
*                                                                       05830005
* 3) CLEAR XSH POINTER IN XMM HEADER                                    05840005
*                                                                       05850005
         MODESET MODE=SUP,KEY=ZERO     OBTAIN AUTHORIZATION             05860005
         LA    R0,XSH                  R0 -> XSH                        05870005
         XR    R1,R1                   R1 = NULL POINTER                05880005
         CS    R0,R1,XMMXSH            CLEAR XMM BLOCK POINTER          05890005
         BNZ   DISC12                  NO, ERROR                        05900005
         MODESET MODE=PROB,KEY=NZERO   BACK TO PROBLEM STATE            05910005
*                                                                       05920005
* 4) DISCONNECT SUSCCES MESSAGE                                         05930005
*                                                                       05940005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X05950005
               '(DISC) XMMXSH CLEARED'                                  05960005
         ST    R8,DISCBIN                                               05970005
         UNPK  DISCCHAR(9),DISCBIN(5)                                   05980005
         TR    DISCCHAR(8),HEX2CHAR                                     05990005
         L     R2,=A(MSG308I)                                           06000005
         CTSCALL MSGSDX,((R2),DISCCHAR),LINK=INT                        06010005
         B     DISC0                                                    06020005
*                                                                       06030005
* 5) ALREADY DISCONNECTED MESSAGE                                       06040005
*                                                                       06050005
DISCOK   DS    0H                                                       06060005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X06070005
               '(DISC) ALREADY DISCONNECTED'                            06080005
         L     R2,=A(MSG309W)                                           06090005
         CTSCALL MSGSDX,((R2)),LINK=INT                                 06100005
         B     DISC0                                                    06110005
*                                                                       06120005
* 4) RETURN TO MAIN                                                     06130005
*                                                                       06140005
DISC12   DS    0H                                                       06150005
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             06160005
         MVC   RC,=F'12'                                                06170005
         B     DISCEXIT                                                 06180005
DISC8    DS    0H                                                       06190005
         MVC   RC,=F'8'                                                 06200005
         B     DISCEXIT                                                 06210005
DISC4    DS    0H                                                       06220005
         MVC   RC,=F'4'                                                 06230005
         B     DISCEXIT                                                 06240005
DISC0    DS    0H                                                       06250005
         XC    RC,RC                                                    06260005
         B     DISCEXIT                                                 06270005
*                                                                       06280005
DISCEXIT DS    0H                                                       06290005
*                                                                       06300005
*        RESTORE PSW STATE (SUPERVISOR/PROBLEM) AND KEY                 06310005
*                                                                       06320005
DISCAUTH DS    0H                                                       06330005
         L     R15,RC                                                   06340005
         BRTRN (15)                                                     06350005
         LTORG ,                                                        06360005
HEX2CHAR DC    256AL1(*-HEX2CHAR)                                       06370005
         ORG   HEX2CHAR+X'FA'                                           06380005
         DC    CL6'ABCDEF'                                              06390005
         ORG   ,                                                        06400005
*                                                                       06410005
DISCBIN  DS    F                                                        06420005
         DS    XL1            PADDING BYTE                              06430005
*                                                                       06440005
DISCCHAR DS    CL9                                                      06450005
         DROP  ,                                                        06460005
*                                                                       06470005
****************************************************************        06480005
*        LOAD - EXIT TO CSA                                    *        06490005
****************************************************************        06500005
*                                                              *        06510005
* RETURN CODES:                                                *        06520005
* -------------                                                *        06530005
*                                                              *        06540005
*       0 - OK                                                 *        06550005
*       4 - EXIT IS ALREADY LOADED                             *        06560005
*       8 - NO SUBSYS                                          *        06570005
*      12 - XSH NOT ENABLED                                    *        06580005
*      16 - NO XST'S EXIST                                     *        06590005
*      20 - EXIT MODULE NOT FOUND                              *        06600005
*      24 - EXIT LOAD FAILED                                   *        06610005
*                                                              *        06620005
****************************************************************        06630005
*                                                                       06640005
LOAD     DS    0F                                                       06650005
         BEGIN                                                          06660005
         L     R10,=A(COMMON)                                           06670005
         USING COMMON,R10                                               06680005
         L     R11,ADDRPARM                                             06690005
         USING PARM,R11                                                 06700005
*                                                                       06710005
* 1) LOCATE XST OF REQUESTED LOAD                                       06720005
*                                                                       06730005
         CTSCALL GETXST,LINK=INT                                        06740005
*                                                                       06750005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X06760005
               '(LOAD) GETXST RC=# XST=~',(?R15,ADDRXST)                06770005
*                                                                       06780005
         B     *+4(R15)                                                 06790005
         B     GOTLXST                                                  06800005
         B     LOAD8                   NO SUBSYS                        06810005
         B     LOAD12                  NO XSH                           06820005
         B     LOAD16                  NO XST                           06830005
GOTLXST  DS    0H                                                       06840005
*                                                                       06850005
* 2) VERIFY THAT EXIT IS NOT LOADED/ENABLED                             06860005
*                                                                       06870005
         L     R7,ADDRXST                                               06880005
         USING XST,R7                                                   06890005
*                                                                       06900005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X06910005
               '(LOAD) XST STATUS = #',(XSTXSTAT)                       06920005
*                                                                       06930005
         CLC   XSTXSTAT,=A(XSTXFREE)                                    06940005
         BNE   LOAD4                                                    06950005
*                                                                       06960005
* 3) LOAD EXIT INTO CSA                                                 06970005
*                                                                       06980005
*IS10188 CTSCALL GETSIZE,LINK=INT                                       06990005
*IS10188 LTR   R15,R15                                                  07000005
*IS10188 BNZ   LOAD20                                                   07010005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X07020005
               '(LOAD) EXIT SIZE= #',(EXITLEN)                          07030005
*                                                                       07040005
         CTSCALL LODEXIT,LINK=INT                                       07050005
         CTSADBG LEVEL=(DBGLEVEL,1),                           IS10188 X07060005
               'LODEXIT RC = #',(?R15)                         IS10188  07070005
         LTR   R15,R15                                                  07080005
         BNZ   LOAD24                                                   07090005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X07100005
               '(LOAD) EXIT ADDR=~',(EXITADDR)                          07110005
*                                                                       07120005
* 4) SET XST                                                            07130005
*                                                                       07140005
         MODESET MODE=SUP,KEY=ZERO     WE NEED SUPERVISOR STATE         07150005
*                                                                       07160005
         TIME  DEC                                                      07170005
         STM   R0,R1,XSTLTIME                                           07180005
         MVC   XSTLNAME,JOBNAME                                         07190005
*                                                                       07200005
         XC    XSTNTIME,XSTNTIME       CLEAR OLD STATISTICS             07210005
         XC    XSTNNAME,XSTNNAME       CLEAR OLD STATISTICS             07220005
         XC    XSTFTIME,XSTFTIME       CLEAR OLD STATISTICS             07230005
         XC    XSTFNAME,XSTFNAME       CLEAR OLD STATISTICS             07240005
*                                                                       07250005
         MVC   XSTXADDR,EXITADDR                                        07260005
         OI    XSTXADDR,X'80' <=== ASSUME AMODE31                       07270005
         MVC   XSTXSIZE,EXITLEN                                         07280005
         MVC   XSTXSTAT,=A(XSTXLOAD)                                    07290005
         DROP  R7                                                       07300005
*                                                                       07310005
         MODESET MODE=PROB,KEY=NZERO    BACK TO PROBLEM STATE           07320005
         B     LOAD0                                                    07330005
*                                                                       07340005
* 5) RETURN TO MAIN                                                     07350005
*                                                                       07360005
LOAD36   DS    0H                                                       07370005
         MVC   RC,=F'36'                                                07380005
         B     LOADEXIT                                                 07390005
LOAD32   DS    0H                                                       07400005
         MVC   RC,=F'32'                                                07410005
         B     LOADEXIT                                                 07420005
LOAD28   DS    0H                                                       07430005
         MVC   RC,=F'28'                                                07440005
         B     LOADEXIT                                                 07450005
LOAD24   DS    0H                                                       07460005
         ST    R15,REASON              SET LODEXIT RC AS RS.   IS10188  07470005
         MVC   RC,=F'24'                                                07480005
         B     LOADEXIT                                                 07490005
LOAD20   DS    0H                                                       07500005
         MVC   RC,=F'20'                                                07510005
         B     LOADEXIT                                                 07520005
LOAD16   DS    0H                                                       07530005
         MVC   RC,=F'16'                                                07540005
         B     LOADEXIT                                                 07550005
LOAD12   DS    0H                                                       07560005
         MVC   RC,=F'12'                                                07570005
         B     LOADEXIT                                                 07580005
LOAD8    DS    0H                                                       07590005
         MVC   RC,=F'8'                                                 07600005
         B     LOADEXIT                                                 07610005
LOAD4    DS    0H                                                       07620005
         MVC   RC,=F'4'                                                 07630005
         B     LOADEXIT                                                 07640005
LOAD0    DS    0H                                                       07650005
         XC    RC,RC                                                    07660005
         B     LOADEXIT                                                 07670005
*                                                                       07680005
LOADEXIT DS    0H                                                       07690005
         L     R15,RC                                                   07700005
         BRTRN (15)                                                     07710005
         LTORG ,                                                        07720005
         DROP  ,                                                        07730005
*                                                                       07740005
****************************************************************        07750005
*        DELETE - EXIT FROM CSA                                *        07760005
****************************************************************        07770005
*                                                              *        07780005
* RETURN CODES:                                                *        07790005
* -------------                                                *        07800005
*                                                              *        07810005
*       0 - OK                                                 *        07820005
*       4 - EXIT IS NOT DELETED                                *        07830005
*           REASON :  4 - NO SUBSYS                            *        07840005
*                     8 - NO XSH                               *        07850005
*                    12 - EXIT IS NOT LOADED                   *        07860005
*       8 - EXIT CAN NOT BE DELETED , IT IS IN USE             *        07870005
*      12 - EXIT IS ENABLED AND CAN NOT BE DELETED             *        07880005
*      16 - INTERNAL ERROR - NO XSTS                           *        07890005
*      20 - INTERNAL ERROR - EXIT HAS NO EXP                            07900005
*      24 - INTERNAL ERROR - EXIT BECAME IN USE WHEN DISABLED  *        07910005
*                                                              *        07920005
****************************************************************        07930005
*                                                                       07940005
DELETE   DS    0F                                                       07950005
         BEGIN                                                          07960005
         L     R10,=A(COMMON)                                           07970005
         USING COMMON,R10                                               07980005
         L     R11,ADDRPARM                                             07990005
         USING PARM,R11                                                 08000005
*                                                                       08010005
* 1) LOCATE XST OF REQUESTED EXIT                                       08020005
*                                                                       08030005
         CTSCALL GETXST,LINK=INT                                        08040005
*                                                                       08050005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X08060005
               '(DELETE) GETXST RC=# XST=~',(?R15,ADDRXST)              08070005
*                                                                       08080005
         B     *+4(R15)                                                 08090005
         B     GOTDXST                                                  08100005
         B     DELT4R4                 NO SUBSYS                        08110005
         B     DELT4R8                 NO XSH                           08120005
         B     DELT16                  NO XST                           08130005
GOTDXST  DS    0H                                                       08140005
*                                                                       08150005
* 2) VERIFY THAT EXIT IS LOADED AND DISABLED                            08160005
*                                                                       08170005
         L     R7,ADDRXST                                               08180005
         USING XST,R7                                                   08190005
*                                                                       08200005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X08210005
               '(DELETE) XST STATUS = #',(XSTXSTAT)                     08220005
*                                                                       08230005
         CLC   XSTXSTAT,=A(XSTXFREE)                                    08240005
         BE    DELT4R12                                                 08250005
         CLC   XSTXSTAT,=A(XSTXLOAD)                                    08260005
         BNE   DELT12                                                   08270005
*                                                                       08280005
* 3) CHECK THAT USE COUNT OF EXIT = 0, AND NO ZOMBI STATUS              08290005
*                                                                       08300005
         L     R1,XSTXADDR                                              08310005
         LA    R1,0(R1)                                                 08320005
         S     R1,=A(EXPLEN)       BACKSPACE HEADER                     08330005
         USING EXP,R1                                                   08340005
         CLC   @EXP,EXPID          IS IT A MODULE HEADER?               08350005
         BNE   DELT20              ..NO, EXIT                           08360005
         CLC   =A(0),EXPUSECT                                           08370005
         BNE   DELT8               NO...  DO NOT DELETE.                08380005
         TM    EXPFLAGS,EXPZOMBI   CAN EXIT COPY BE DELETED ?           08390005
         BO    DELT8               NO...  ZOMBI STATUS                  08400005
         DROP  R1                                                       08410005
*                                                                       08420005
* 4) DELETE EXIT FROM CSA                                               08430005
*                                                                       08440005
         MVC   EXITADDR,XSTXADDR                                        08450005
         MVC   EXITLEN,XSTXSIZE                                         08460005
         CTSCALL DELEXIT,LINK=INT                                       08470005
         LTR   R15,R15                                                  08480005
         BNZ   DELT24                                                   08490005
*                                                                       08500005
* 5) CLEAR XST                                                          08510005
*                                                                       08520005
         MODESET MODE=SUP,KEY=ZERO WE NEED SUPERVISOR STATE             08530005
*                                                                       08540005
         XC    XSTXADDR,XSTXADDR                                        08550005
         XC    XSTXSIZE,XSTXSIZE                                        08560005
         XC    XSTLTIME,XSTLTIME                                        08570005
         XC    XSTLNAME,XSTLNAME                                        08580005
         XC    XSTNTIME,XSTNTIME                                        08590005
         XC    XSTNNAME,XSTNNAME                                        08600005
         XC    XSTFTIME,XSTFTIME                                        08610005
         XC    XSTFNAME,XSTFNAME                                        08620005
         MVC   XSTXSTAT,=A(XSTXFREE)                                    08630005
*                                                                       08640005
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             08650005
*                                                                       08660005
* 6) SET RC                                                             08670005
*                                                                       08680005
         XC    RC,RC                                                    08690005
         B     DELTEXIT                                                 08700005
*                                                                       08710005
DELT24   DS    0H                                                       08720005
         ST    R15,REASON                                               08730005
         MVC   RC,=F'24'                                                08740005
         B     DELTEXIT                                                 08750005
DELT20   DS    0H                                                       08760005
         MVC   RC,=F'20'                                                08770005
         B     DELTEXIT                                                 08780005
DELT16   DS    0H                                                       08790005
         MVC   RC,=F'16'                                                08800005
         B     DELTEXIT                                                 08810005
DELT12   DS    0H                                                       08820005
         MVC   RC,=F'12'                                                08830005
         B     DELTEXIT                                                 08840005
DELT8    DS    0H                                                       08850005
         MVC   RC,=F'8'                                                 08860005
         B     DELTEXIT                                                 08870005
DELT4R4  DS    0H                                                       08880005
         MVC   REASON,=F'4'                                             08890005
         B     DELT4                                                    08900005
DELT4R8  DS    0H                                                       08910005
         MVC   REASON,=F'8'                                             08920005
         B     DELT4                                                    08930005
DELT4R12 DS    0H                                                       08940005
         MVC   REASON,=F'12'                                            08950005
         B     DELT4                                                    08960005
DELT4    DS    0H                                                       08970005
         MVC   RC,=F'4'                                                 08980005
         B     DELTEXIT                                                 08990005
*                                                                       09000005
*  6) RETURN TO CALLER                                                  09010005
*                                                                       09020005
DELTEXIT DS    0H                                                       09030005
         L     R15,RC                                                   09040005
         BRTRN (15)                                                     09050005
         LTORG ,                                                        09060005
         DROP  ,                                                        09070005
*                                                                       09080005
****************************************************************        09090005
*        ENABLE - EXIT                                         *        09100005
****************************************************************        09110005
*                                                              *        09120005
* RETURN CODES:                                                *        09130005
* -------------                                                *        09140005
*                                                              *        09150005
*       0 - OK                                                 *        09160005
*       4 - EXIT IS ALREADY ENABLED                            *        09170005
*       8 - EXIT IS NOT LOADED                                 *        09180005
*      12 - NO XSH                                             *        09190005
*      16 - NO XSH                                             *        09200005
*      20 - NO XSTS                                            *        09210005
*      24 - EXIT NOT IN EXITS TABLE                            *        09220005
*      28 - EXIT HAS NO ACTIVATION ROUTINE                     *        09230005
*      32 - ACTIVATION ROUTINE ERROR                           *        09240005
*           REASON CODE IS ACTIVATION ROUTINE RC               *        09250005
*                                                              *        09260005
****************************************************************        09270005
*                                                                       09280005
ENABLE   DS    0F                                                       09290005
*                                                                       09300005
* 1) INITIALIZE                                                         09310005
*                                                                       09320005
         BEGIN                                                          09330005
         L     R10,=A(COMMON)                                           09340005
         USING COMMON,R10                                               09350005
         L     R11,ADDRPARM                                             09360005
         USING PARM,R11                                                 09370005
         MVI   FLAGENB,C'Y'                                             09380005
*                                                                       09390005
* 2) LOCATE XST OF REQUESTED EXIT                                       09400005
*                                                                       09410005
         CTSCALL GETXST,LINK=INT                                        09420005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X09430005
               '(ENABLE) GETXST RC=# XST=~',(?R15,ADDRXST)              09440005
         B     *+4(R15)                                                 09450005
         B     CALLENB                                                  09460005
         B     ENBL12                  NO SUBSYS                        09470005
         B     ENBL16                  NO XSH                           09480005
         B     ENBL20                  NO XST                           09490005
CALLENB  DS    0H                                                       09500005
         L     R7,ADDRXST              R7 -> XST                        09510005
         USING XST,R7                  MAP IT                           09520005
*                                                                       09530005
* 3) LOCATE EXIT IN EXITS TABLE                                         09540005
*                                                                       09550005
         LA    R6,EXITS#               R6 = EXITS TABLE ENTRIES#        09560005
         LA    R4,EXITS                R4 -> EXITS TABLE                09570005
         USING EXENTRY,R4              MAP CURRENT ENTRY                09580005
LOCACT   DS    0H                                                       09590005
         CLC   XSTXNAME,EXLMOD         REQUESTED ENTRY ?                09600005
         BE    HAVEACT                 YES, TAKE ACT ROUTINE            09610005
         LA    R4,EXLEN(,R4)           NEXT TABLE ENTRY                 09620005
         BCT   R6,LOCACT               TRY AGAIN IF ENTRIES LEFT        09630005
         B     ENBL24                  NOT FOUND - SET ERROR RC         09640005
HAVEACT  DS    0H                                                       09650005
         MVC   EXITNAME,EXNAME         SET EXIT NAME FOR MSGS           09660005
*                                                                       09670005
* 4) VERIFY THAT EXIT STATUS IS 'LOADED'                                09680005
*                                                                       09690005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X09700005
               '(ENABLE) XST STATUS = #',(XSTXSTAT)                     09710005
         CLC   XSTXSTAT,=A(XSTXLOAD)   EXIT LOADED ?                    09720005
         BE    ENBACT                  YES, THEN ENABLE IT              09730005
         CLC   XSTXSTAT,=A(XSTXENB)    EXIT ALREADY ENABLED             09740005
         BNE   ENBL8                   NO, SET ERROR RC                 09750005
         L     R2,=A(MSG310W)                                           09760005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        09770005
         B     ENBL4                   SET ALREADY ENABLED RC           09780005
*                                                                       09790005
* 5) ENABLE EXIT BY APPROPRIATE ENABLE ROUTINE                          09800005
*                                                                       09810005
ENBACT   DS    0H                                                       09820005
         ICM   R15,15,EXFUNC           R15 -> ACTIVATION ROUTINE        09830005
         BZ    ENBL28                  NO, ACTIVATION ROUTINE ERROR     09840005
         LA    R1,XSTXADDR             R1 -> EXIT EP ADDRESS            09850005
         CTSCALL (15),LINK=INT         CALL ACTIVATION ROUTINE          09860005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X09870005
               '(ENABLE) ACT ROUTINE FOR _ RC=#',(XSTXNAME,8,?R15)      09880005
         CH    R15,=H'4'               ENABLED ?                        09890005
         BH    ENBL32                  NO ,SET ERROR RC                 09900005
         DROP  R4                                                       09910005
*                                                                       09920005
* 6) SET XST                                                            09930005
*                                                                       09940005
         MODESET MODE=SUP,KEY=ZERO     WE NEED SUPERVISOR STATE         09950005
*                                                                       09960005
         TIME  DEC                     SET ENABLE STATISTICS            09970005
         STM   R0,R1,XSTLTIME          SET ENABLE STATISTICS            09980005
         MVC   XSTFNAME,JOBNAME        SET ENABLE STATISTICS            09990005
         XC    XSTFTIME,XSTFTIME       CLEAR OLD STATISTICS             10000005
         XC    XSTFNAME,XSTFNAME       CLEAR OLD STATISTICS             10010005
         MVC   XSTXSTAT,=A(XSTXENB)    SET EXIT STATUS                  10020005
*                                                                       10030005
         MODESET MODE=PROB,KEY=NZERO   BACK TO PROBLEM STATE            10040005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X10050005
               '(ENABLE) XST UPDATED'                                   10060005
         B     ENBL0                                                    10070005
*                                                                       10080005
* 6) SET RC AND EXIT                                                    10090005
*                                                                       10100005
ENBL32   DS    0H                                                       10110005
         ST    R15,REASON                                               10120005
         MVC   RC,=F'32'                                                10130005
         B     ENBLEXIT                                                 10140005
ENBL28   DS    0H                                                       10150005
         MVC   RC,=F'28'                                                10160005
         B     ENBLEXIT                                                 10170005
ENBL24   DS    0H                                                       10180005
         MVC   RC,=F'24'                                                10190005
         B     ENBLEXIT                                                 10200005
ENBL20   DS    0H                                                       10210005
         MVC   RC,=F'20'                                                10220005
         B     ENBLEXIT                                                 10230005
ENBL16   DS    0H                                                       10240005
         MVC   RC,=F'16'                                                10250005
         B     ENBLEXIT                                                 10260005
ENBL12   DS    0H                                                       10270005
         MVC   RC,=F'12'                                                10280005
         B     ENBLEXIT                                                 10290005
ENBL8    DS    0H                                                       10300005
         MVC   RC,=F'8'                                                 10310005
         B     ENBLEXIT                                                 10320005
ENBL4    DS    0H                                                       10330005
         MVC   RC,=F'4'                                                 10340005
         B     ENBLEXIT                                                 10350005
ENBL0    DS    0H                                                       10360005
         XC    RC,RC                                                    10370005
         B     ENBLEXIT                                                 10380005
ENBLEXIT DS    0H                                                       10390005
         L     R15,RC                                                   10400005
         BRTRN (15)                                                     10410005
         LTORG ,                                                        10420005
         DROP  ,                                                        10430005
*                                                                       10440005
****************************************************************        10450005
*        DISABLE                                               *        10460005
****************************************************************        10470005
*                                                              *        10480005
* RETURN CODES:                                                *        10490005
* -------------                                                *        10500005
*                                                              *        10510005
*       0 - OK                                                 *        10520005
*       4 - EXIT IS NOT ENABLED                                *        10530005
*           REASON :  4 - NO SUBSYS                            *        10540005
*                     8 - NO XSH                               *        10550005
*                    12 - STATUS IS NOT ENABLED                *        10560005
*      12 - INTERNAL ERROR - EXIT NOT FOUND IN EXITS TABLE     *        10570005
*      16 - INTERNAL ERROR - NO ACTIVATION ROUTINE FOR EXIT    *        10580005
*      20 - DISABLE ROUTINE FAILURE                            *        10590005
*           REASON :  RC FROM DISABLE ROUTINE                  *        10600005
*                                                              *        10610005
****************************************************************        10620005
*                                                                       10630005
DISABLE  DS    0F                                                       10640005
*                                                                       10650005
* 1) INITIALIZE                                                         10660005
*                                                                       10670005
         BEGIN                                                          10680005
         L     R10,=A(COMMON)                                           10690005
         USING COMMON,R10                                               10700005
         L     R11,ADDRPARM                                             10710005
         USING PARM,R11                                                 10720005
         MVI   FLAGENB,C'N'                                             10730005
*                                                                       10740005
* 2) LOCATE XST OF REQUESTED EXIT                                       10750005
*                                                                       10760005
         CTSCALL GETXST,LINK=INT                                        10770005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X10780005
               '(DISABLE) GETXST RC=# XST=~',(?R15,ADDRXST)             10790005
         B     *+4(R15)                                                 10800005
         B     CALLDIS                                                  10810005
         B     DISA4R4                 NO SUBSYS                        10820005
         B     DISA4R8                 NO XSH                           10830005
         B     DISA8                   NO XST                           10840005
CALLDIS  DS    0H                                                       10850005
*                                                                       10860005
* 3) VERIFY THAT EXIT STATUS IS 'ENABLED'                               10870005
*                                                                       10880005
         L     R7,ADDRXST                                               10890005
         USING XST,R7                                                   10900005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X10910005
               '(DISABLE) XST STATUS = #',(XSTXSTAT)                    10920005
         CLC   XSTXSTAT,=A(XSTXENB)                                     10930005
         BNE   DISA4R12                                                 10940005
*                                                                       10950005
* 4) DISABLE EXIT BY APPROPRIATE DISABLE ROUTINE                        10960005
*                                                                       10970005
         LA    R6,EXITS#                                                10980005
         LA    R4,EXITS                                                 10990005
         USING EXENTRY,R4                                               11000005
LOCDIS   DS    0H                                                       11010005
         CLC   XSTXNAME,EXLMOD                                          11020005
         BE    HAVEDIS                                                  11030005
         LA    R4,EXLEN(,R4)                                            11040005
         BCT   R6,LOCDIS                                                11050005
         B     DISA12                                                   11060005
HAVEDIS  DS    0H                                                       11070005
         ICM   R15,15,EXFUNC                                            11080005
         BZ    DISA16                                                   11090005
         MVC   EXITNAME,EXNAME                                          11100005
         LA    R1,XSTXADDR                                              11110005
         CTSCALL (15),LINK=INT                                          11120005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X11130005
               '(DISABLE) ROUTINE FOR _ RC=#',(XSTXNAME,8,?R15)         11140005
         CH    R15,=H'4'                                                11150005
         BH    DISA20                                                   11160005
         DROP  R4                                                       11170005
*                                                                       11180005
* 5) SET XST                                                            11190005
*                                                                       11200005
         MODESET MODE=SUP,KEY=ZERO WE NEED SUPERVISOR STATE             11210005
*                                                                       11220005
         TIME  DEC                                                      11230005
         STM   R0,R1,XSTFTIME                                           11240005
         MVC   XSTFTIME,JOBNAME                                         11250005
         MVC   XSTXSTAT,=A(XSTXLOAD)                                    11260005
*                                                                       11270005
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             11280005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X11290005
               '(DISABLE) XST STATUS UPDATED'                           11300005
         B     DISA0                                                    11310005
*                                                                       11320005
* 6) SET RC AND EXIT                                                    11330005
*                                                                       11340005
DISA20   DS    0H                                                       11350005
         ST    R15,REASON                                               11360005
         MVC   RC,=F'20'                                                11370005
         B     DISAEXIT                                                 11380005
DISA16   DS    0H                                                       11390005
         MVC   RC,=F'16'                                                11400005
         B     DISAEXIT                                                 11410005
DISA12   DS    0H                                                       11420005
         MVC   RC,=F'12'                                                11430005
         B     DISAEXIT                                                 11440005
DISA8    DS    0H                                                       11450005
         MVC   RC,=F'8'                                                 11460005
         B     DISAEXIT                                                 11470005
DISA4R4  DS    0H                                                       11480005
         MVC   REASON,=F'4'                                             11490005
         B     DISA4                                                    11500005
DISA4R8  DS    0H                                                       11510005
         MVC   REASON,=F'8'                                             11520005
         B     DISA4                                                    11530005
DISA4R12 DS    0H                                                       11540005
         MVC   REASON,=F'12'                                            11550005
         B     DISA4                                                    11560005
DISA4    DS    0H                                                       11570005
         MVC   RC,=F'4'                                                 11580005
         B     DISAEXIT                                                 11590005
DISA0    DS    0H                                                       11600005
         XC    RC,RC                                                    11610005
         B     DISAEXIT                                                 11620005
*                                                                       11630005
DISAEXIT DS    0H                                                       11640005
         L     R15,RC                                                   11650005
         BRTRN (15)                                                     11660005
         LTORG ,                                                        11670005
         DROP  ,                                                        11680005
*                                                                       11690005
****************************************************************        11700005
*        SNAP AREAS                                                     11710005
****************************************************************        11720005
*                                                                       11730005
SNAP     DS    0F                                                       11740005
         BEGIN                                                          11750005
         L     R10,=A(COMMON)                                           11760005
         USING COMMON,R10                                               11770005
         L     R11,ADDRPARM                                             11780005
         USING PARM,R11                                                 11790005
*                                                                       11800005
*  1) SNAP RCVT                                                         11810005
*                                                                       11820005
         L     R2,FLCCVT-PSA                                            11830005
         ICM   R2,15,CVTRAC-CVT(R2)                                     11840005
*IS10188 BZ    SNPNOCVT                                                 11850005
         BZ    SNPNOSMC                                        IS10188  11860005
         LA    R3,ENDRCVT-1-RCVT(,R2)                                   11870005
         CTSADBG TYPE=SNAP,ID=9,HDR='** RCVT **',                      X11880005
               ADDR=(0(R2),0(R3))                                       11890005
*IS10188 SNPNOCVT DS    0H                                              11900005
*IS10188                                                                11901005
*IS10188                                                                11902005
*IS10188 2) SNAP SMF TABLES                                             11903005
*IS10188                                                                11904005
*IS10188 L     R2,FLCCVT-PSA                                            11905005
*IS10188 ICM   R2,15,CVTSMCA-CVT(R2)                                    11906005
*IS10188 BZ    SNPNOSMC                                                 11907005
*IS10188 LA    R3,SMCAEND-1-SMCABASE(R2)                                11908005
*IS10188 CTSADBG TYPE=SNAP,ID=9,HDR='** SMCA **',                      X11909005
               ADDR=(0(R2),0(R3))                                       11910005
*IS10188                                                                11920005
*IS10188 LH    R4,SMCANSST-SMCABASE(,R2)                                11930005
*IS10188 LTR   R4,R4                                                    11940005
*IS10188 BZ    SNPNOSMC                                                 11950005
*IS10188                                                                11960005
*IS10188 LH    R5,SMCALSST-SMCABASE(,R2)                                11970005
*IS10188                                                                11980005
*IS10188 LR    R3,R4                                                    11990005
*IS10188 MH    R3,SMCALSST-SMCABASE(,R2)                                12000005
*IS10188 ICM   R2,15,SMCASSTP-SMCABASE(R2)                              12010005
*IS10188 BZ    SNPNOSMC                                                 12020005
*IS10188 AR    R3,R2                                                    12030005
*IS10188 BCTR  R3,0                                                     12040005
*IS10188 CTSADBG TYPE=SNAP,ID=9,HDR='** SST **',                       X12050005
               ADDR=(0(R2),0(R3))                                       12060005
*IS10188                                                                12070005
*IS10188 LR    R6,R2                                                    12080005
*IS10188 SMFEXTB8 DS    0H                                              12090005
*IS10188 ICM   R2,15,48(R6)                                             12100005
*IS10188 BZ    NXTEXTB                                                  12110005
*IS10188 L     R3,4(R2)                                                 12120005
*IS10188 MH    R3,=H'16'                                                12130005
*IS10188 AR    R3,R2                                                    12140005
*IS10188 LA    R3,8(R3)                                                 12150005
*IS10188 BCTR  R3,0                                                     12160005
*IS10188 CTSADBG TYPE=SNAP,ID=9,HDR='** SMF EXITS TABLE ***',          X12170005
               ADDR=(0(R2),0(R3))                                       12180005
*IS10188 NXTEXTB8 DS    0H                                              12190005
*IS10188 AR    R6,R5                                                    12200005
*IS10188 BCT   R4,SMFEXTB                                               12210005
*                                                                       12220005
SNPNOSMC DS    0H                                                       12230005
*                                                                       12240005
* 4) SNAP XMM HEADER                                                    12250005
*                                                                       12260005
         CTSCALL GETXMMH,LINK=INT                                       12270005
         LTR   R15,R15                                                  12280005
         BNZ   SNAPEXIT                                                 12290005
         L     R9,ADDRXMMH                                              12300005
         USING XMMHDR,R9                                                12310005
         CTSADBG TYPE=SNAP,ID=9,HDR='** XMM HEADER **',                X12320005
               ADDR=(XMMHDR,XMMHDR+XMMHDRLN-1)                          12330005
*                                                                       12340005
* 5) SNAP XSH                                                           12350005
*                                                                       12360005
         ICM   R8,15,XMMXSH                                             12370005
         BZ    SNAPEXIT                                                 12380005
         USING XSH,R8                                                   12390005
         CLC   XSHXSH,=CL4'XSH'                                         12400005
         BNE   SNAPEXIT                                                 12410005
*                                                                       12420005
         LR    R2,R8                                                    12430005
         L     R3,XSHMEMSZ                                              12440005
         AR    R3,R2                                                    12450005
         BCTR  R3,0                                                     12460005
         CTSADBG TYPE=SNAP,ID=9,HDR='** XSH AND XST POOL **',          X12470005
               ADDR=(0(R2),0(R3))                                       12480005
*                                                                       12490005
* 6) SNAP LOADED EXITS LOAD MODULES                                     12500005
*                                                                       12510005
         ICM   R7,15,XSHXST                                             12520005
         BZ    SNAPEXIT                                                 12530005
         USING XST,R7                                                   12540005
         ICM   R6,15,XSHCOUNT                                           12550005
         BZ    SNAPEXIT                                                 12560005
*                                                                       12570005
SNPXST   DS    0H                                                       12580005
         CLC   XSTXSTAT,=A(XSTXFREE)                                    12590005
         BE    NXTSNP                                                   12600005
*                                                                       12610005
         ICM   R2,15,XSTXADDR                                           12620005
         BZ    NXTSNP                                                   12630005
         ICM   R3,15,XSTXSIZE                                           12640005
         BZ    NXTSNP                                                   12650005
***      CH    R3,=F'1024'                                              12660005
***      BNH   SNPEXIT                                                  12670005
***      LA    R3,1024                                                  12680005
SNPEXIT  DS    0H                                                       12690005
         AR    R3,R2                                                    12700005
         BCTR  R3,0                                                     12710005
         S     R2,=A(EXPLEN)                                            12720005
         CTSADBG TYPE=SNAP,ID=9,HDR='** EXIT SNAP **',                 X12730005
               ADDR=(0(R2),0(R3))                                       12740005
NXTSNP   DS    0H                                                       12750005
         LA    R7,XSTLEN(R7)                                            12760005
         BCT   R6,SNPXST                                                12770005
         B     SNAPEXIT                                                 12780005
*                                                                       12790005
SNAPEXIT DS    0H                                                       12800005
         BRTRN 0                                                        12810005
         LTORG ,                                                        12820005
         DROP  ,                                                        12830005
*                                                                       12840005
****************************************************************        12850005
*                                                              *        12860005
*        GETID: INITIALIZE ADDRESS SPACE STATS                 *        12870005
*                                                              *        12880005
****************************************************************        12890005
*                                                                       12900005
GETID    DS    0F                                                       12910005
*                                                                       12920005
*        INITIALIZE                                                     12930005
*                                                                       12940005
         BEGIN                                                          12950005
         L     R10,=A(COMMON)                                           12960005
         USING COMMON,R10                                               12970005
*                                                                       12980005
*        SETUP JOBNAME                                                  12990005
*                                                                       13000005
         L     R1,PSATOLD-PSA          POINT TO TCB                     13010005
*WS10047 L     R1,TCBTIO-TCB(R1)       POINT TO TIOT                    13020005
*WS10047 USING TIOT,R1                                                  13030005
*WS10047 MVC   JOBNAME,TIOCNJOB        GET JOB NAME                     13040005
*WS10047 CLI   TIOCSTEP,C' '                                            13050005
*WS10047 BNH   JOBNAMOK                                                 13060005
*WS10047 MVC   JOBNAME,TIOCSTEP        GET JOB NAME                     13070005
*WS10047 DROP  R1                                                       13080005
         LHI   R15,0                                           WS10047  13090005
         ICM   R15,B'0111',TCBJSTCA-TCB(R1) R15 -> JSTCB       WS10047  13100005
         ICM   R15,B'0111',TCBJSCBB-TCB(R15) R15 -> JSCB       WS10047  13110005
         L     R15,JSCBCSCB-IEZJSCB(,R15) R15 -> CSCB.         WS10047  13120005
         LA    R4,CHKEY-CSCB(,R15)    R4 -> STC ID.            WS10047  13130005
         CLI   0(R4),C' '               ID EXISTS ?            WS10047  13140005
         BH    JOBNAMOK                ..YES - USE IT.         WS10047  13150005
         LA    R4,CHCLS-CSCB(,R15)    R4 -> JOBNAME.           WS10047  13160005
JOBNAMOK DS    0H                                                       13170005
         MVC   JOBNAME,0(R4)                                   WS10047  13180005
         CTSADBG LEVEL=(DBGLEVEL,1),                           WS10047 X13190005
               'JOBNAME = _',(JOBNAME,8)                       WS10047  13200005
*                                                                       13210005
*        FINISH                                                         13220005
*                                                                       13230005
         BRTRN 0                                                        13240005
         LTORG ,                                                        13250005
         DROP  ,                                                        13260005
*                                                                       13270005
*    THIS ROUTINE IS REMOVED BECAUSE IT IS NOT USED SINCE      IS10188  13280005
*    Z/OS SUPPORTS DYNAMIC LOAD OF SMF EXITS.                  IS10188  13290005
*IS10188                                                                13300005
****************************************************************        13310005
*IS10188                                                       *        13320005
*IS10188 GETSMF: GET SMF SMCA INFO                             *        13330005
*IS10188                                                       *        13340005
****************************************************************        13350005
*IS10188                                                                13360005
*IS10188 GETSMF   DS    0F                                              13370005
*IS10188                                                                13380005
*IS10188 INITIALIZE                                                     13390005
*IS10188                                                                13400005
*IS10188 BEGIN                                                          13410005
*IS10188 L     R10,=A(COMMON)                                           13420005
*IS10188 USING COMMON,R10                                               13430005
*IS10188                                                                13440005
*IS10188 LA    R15,4                                                    13450005
*IS10188 XC    ADDRSMCA,ADDRSMCA                                        13460005
*IS10188 XC    ADDRSSTP,ADDRSSTP                                        13470005
*IS10188 XC    NUMSST,NUMSST                                            13480005
*IS10188 XC    SIZESST,SIZESST                                          13490005
*IS10188                                                                13500005
*IS10188 LOCATE SMF TABLES                                              13510005
*IS10188                                                                13520005
*IS10188 L     R3,FLCCVT-PSA           R3 -> CVT                        13530005
*IS10188 ICM   R3,15,CVTSMCA-CVT(R3)   R3 -> SMCA                       13540005
*IS10188 BZ    GETSMFE                                                  13550005
*IS10188 ST    R3,ADDRSMCA                                              13560005
*IS10188 USING SMCABASE,R3             MAP SMCA                         13570005
*IS10188                                                                13580005
*IS10188 LH    R6,SMCANSST             R6 = NUMBER OF SST ENTRIES       13590005
*IS10188 LTR   R6,R6                                                    13600005
*IS10188 BZ    GETSMFE                                                  13610005
*IS10188 ST    R6,NUMSST                                                13620005
*IS10188                                                                13630005
*IS10188 LH    R7,SMCALSST             R7 = SIZE OF EACH SST ENTRY      13640005
*IS10188 LTR   R7,R7                                                    13650005
*IS10188 BZ    GETSMFE                                                  13660005
*IS10188 ST    R7,SIZESST                                               13670005
*IS10188                                                                13680005
*IS10188 ICM   R3,15,SMCASSTP          R3 -> FIRST SST ENTRY            13690005
*IS10188 BZ    GETSMFE                                                  13700005
*IS10188 ST    R3,ADDRSSTP                                              13710005
*IS10188                                                                13720005
*IS10188 XR    R15,R15                                                  13730005
*IS10188                                                                13740005
*IS10188 FINISH                                                         13750005
*IS10188                                                                13760005
*IS10188 GETSMFE  DS    0H                                              13770005
*IS10188 BRTRN (15)                                                     13780005
*IS10188 LTORG ,                                                        13790005
*IS10188 DROP  ,                                                        13800005
*                                                                       13810005
****************************************************************        13820005
*                                                              *        13830005
*        LOCK: ISSUE ENQ TO SERIALIZE SDX                      *        13840005
*                                                              *        13850005
****************************************************************        13860005
*                                                                       13870005
LOCK     DS    0F                                                       13880005
*                                                                       13890005
*        INITIALIZE                                                     13900005
*                                                                       13910005
         BEGIN                                                          13920005
         L     R10,=A(COMMON)                                           13930005
         USING COMMON,R10                                               13940005
         L     R11,ADDRPARM                                             13950005
         USING PARM,R11                                                 13960005
         MVI   FLAGLOCK,C'Y'                                            13970005
*                                                                       13980005
*        SETUP RNAME                                                    13990005
*                                                                       14000005
         MVC   RNAME,@RNAME                                             14010005
         TRT   RNAME,BLNKTAB                                            14020005
         MVI   0(R1),C'.'                                               14030005
         L     R15,PARMSSN                                              14040005
         MVC   1(8,R1),0(R15)                                           14050005
*                                                                       14060005
         TRT   RNAME,BLNKTAB                                            14070005
         MVI   0(R1),C'.'                                               14080005
         L     R15,PARMJBN                                              14090005
         MVC   1(8,R1),0(R15)                                           14100005
*                                                                       14110005
*        ISSUE ENQ                                                      14120005
*                                                                       14130005
         ENQ   (QNAME,RNAME,E,44,SYSTEM),RET=USE                        14140005
         LTR   R15,R15             SUCCESSFUL ?                         14150005
         BZ    EXITLOCK            Y,PASS                               14160005
*                                                                       14170005
*        ENQ FAILED                                                     14180005
*                                                                       14190005
         MVI   FLAGLOCK,C'N'                                            14200005
         XR    R1,R1                                                    14210005
         IC    R1,3(R15)           GET RETURN CODE                      14220005
         LR    R15,R1              MOVE RET CODE TO REG.15              14230005
EXITLOCK DS    0H                                                       14240005
         BRTRN (15)                                                     14250005
BLNKTAB  DS    256X'00'                                                 14260005
         ORG   BLNKTAB+C' '                                             14270005
         DC    C' '                                                     14280005
         ORG   ,                                                        14290005
         LTORG ,                                                        14300005
         DROP  ,                                                        14310005
*                                                                       14320005
****************************************************************        14330005
*                                                              *        14340005
*        UNLOCK: RELEASE ENQ                                   *        14350005
*                                                              *        14360005
****************************************************************        14370005
*                                                                       14380005
UNLOCK   DS    0F                                                       14390005
*                                                                       14400005
*        INITIALIZE                                                     14410005
*                                                                       14420005
         BEGIN                                                          14430005
         L     R10,=A(COMMON)                                           14440005
         USING COMMON,R10                                               14450005
         L     R11,ADDRPARM                                             14460005
         USING PARM,R11                                                 14470005
         CLI   FLAGLOCK,C'Y'                                            14480005
         BNE   EXITULCK                                                 14490005
*                                                                       14500005
*        ISSUE DEQ                                                      14510005
*                                                                       14520005
         MVI   FLAGLOCK,C'N'                                            14530005
         DEQ   (QNAME,RNAME,44,SYSTEM),RET=HAVE                         14540005
         LTR   R15,R15             SUCCESSFUL ?                         14550005
         BZ    EXITULCK            Y,PASS                               14560005
*                                                                       14570005
*        DEQ FAILED                                                     14580005
*                                                                       14590005
         MVI   FLAGLOCK,C'Y'                                            14600005
         XR    R1,R1                                                    14610005
         IC    R1,3(R15)           GET RETURN CODE                      14620005
         LR    R15,R1              MOVE RET CODE TO REG.15              14630005
EXITULCK DS    0H                                                       14640005
         BRTRN (15)                                                     14650005
         LTORG ,                                                        14660005
         DROP  ,                                                        14670005
*                                                                       14680005
****************************************************************        14690005
*                                                              *        14700005
*        GETXMMH: GET XMM HEADER ADDRESS                       *        14710005
*                                                              *        14720005
****************************************************************        14730005
*                                                                       14740005
GETXMMH  DS    0F                                                       14750005
*                                                                       14760005
*        INITIALIZE                                                     14770005
*                                                                       14780005
         BEGIN                                                          14790005
         L     R10,=A(COMMON)                                           14800005
         USING COMMON,R10                                               14810005
         L     R11,ADDRPARM                                             14820005
         USING PARM,R11                                                 14830005
*                                                                       14840005
*        CLEAR OUTPUT FIELDS                                            14850005
*                                                                       14860005
*SAS2IBMN XC    ADDRSSCT,ADDRSSCT                                       14870005
*SAS2IBMN XC    ADDRSSVT,ADDRSSVT                                       14880005
         XC    ADDRXMMH,ADDRXMMH                                        14890005
*                                                                       14900005
*        LOCATE NAME/TOKEN                                              14910005
*                                                                       14920005
         L     R3,PARMSSN                                               14930005
*WS2356  GETSSCT R4,0(R3)              R4 -> SSCT OF THE SUBSYSTEM      14940005
*WS2356  LTR   R4,R4                   SUCCESSFULL?                     14950005
*WS2356  BZ    NOSSCT                  NO, FAILED                       14960005
*WS2356  USING SSCT,R4                                                  14970005
*WS2356  ST    R4,ADDRSSCT                                              14980005
*WS2356                                                                 14990005
*WS2356  LOCATE SSVT                                                    15000005
*WS2356                                                                 15010005
*WS2356  ICM   R4,B'1111',SSCTSUSE     IS THERE AN SSVT ?               15020005
*WS2356  BZ    NOSSVT                  NOBODY IS PERFECT                15030005
*WS2356  USING SSVT,R4                                                  15040005
*WS2356  LR    R5,R4                                                    15050005
*WS2356  S     R5,=F'4'                R5 -> SSVT HEADER                15060005
*WS2356  CLC   =CL4'SSVT',0(R5)        SSVT HDR EXISTS ?                15070005
*WS2356  BNE   WRNGSSVT                MAY BE WRONG IOA RELEASE         15080005
*WS2356  ST    R4,ADDRSSVT                                              15090005
*                                                                       15100005
*        LOCATE XMM BLOCK                                               15110005
*                                                                       15120005
         CTSANT FUNC=RETRIEVE,LEVEL=SYSTEM,NAME=CTSAINST,       WS2356 *15130005
               TOKEN=ICB_PTR                                    WS2356  15140005
         LTR   R15,R15                                          WS2356  15150005
         BNZ   TOKNFD                                           WS2356  15160005
         L     R4,ICB_PTR                                       WS2356  15170005
         USING ICBSTART,R4                                      WS2356  15180005
ICBLOOP  DS    0H                                               WS2356  15190005
         CLC   ICBNAME,0(R3)           OUR INSTALLATION ?       WS2356  15200005
         BE    ICBFOUND                FOUND                    WS2356  15210005
         ICM   R4,B'1111',ICBNEXT      GET NEXT ICB ENTRY       WS2356  15220005
         BNZ   ICBLOOP                 EXISTS ? - LOOP          WS2356  15230005
         B     TOKNFD                  NO - ERROR               WS2356  15240005
ICBFOUND DS    0H                                               WS2356  15250005
         L     R3,PARMJBN                                               15260005
         LA    R4,ICBXMMA              R4 -> FIRST XMM ADDRESS  WS2356  15270005
         DROP  R4                                                       15280005
*WS2356  LA    R4,SUSEXMMA             R4 -> FIRST XMM ADDRESS          15290005
         USING XMMHDR,R4                                                15300005
LOOPXMM  DS    0H                                                       15310005
         ICM   R4,B'1111',0(R4)        GET NEXT XMM HEADER              15320005
         BZ    NOXMM                   NO XMM,                          15330005
         CLC   XMMMNAME,0(R3)          THIS ENTRY HAS OUR JOBNAME?      15340005
         BNE   LOOPXMM                                                  15350005
HAVEXMM  DS    0H                                                       15360005
         ST    R4,ADDRXMMH                                              15370005
*                                                                       15380005
         XR    R15,R15                                                  15390005
*SAS2IBMNB     RETSSVT                                                  15400005
         B     RETXMMH                                         SAS2IBMN 15410005
*                                                                       15420005
*        RETURN TO CALLER                                               15430005
*                                                                       15440005
WRNGSSVT DS    0H                                                       15450005
         LA    R15,16                                                   15460005
*SAS2IBMNB     RETSSVT                                                  15470005
         B     RETXMMH                                         SAS2IBMN 15480005
*                                                                       15490005
NOXMM    DS    0H                                                       15500005
         LA    R15,12                                                   15510005
*SAS2IBMNB     RETSSVT                                                  15520005
         B     RETXMMH                                         SAS2IBMN 15530005
*                                                                       15540005
TOKNFD   DS    0H                                                WS2356 15550005
         CTSADBG 'TOKEN NOT FOUND RC = #',                     WS2356  X15560005
               (?R15)                                          WS2356   15570005
         LA    R15,8                                             WS2356 15580005
*SAS2IBMNB     RETSSVT                                          WS2356  15590005
         B     RETXMMH                                         SAS2IBMN 15600005
*                                                                       15610005
*SAS2IBMN NOSSVT   DS    0H                                             15620005
*SAS2IBMNLA    R15,8                                                    15630005
*SAS2IBMNB     RETSSVT                                                  15640005
         B     RETXMMH                                         SAS2IBMN 15650005
*                                                                       15660005
*SAS2IBMN NOSSCT   DS    0H                                             15670005
*SAS2IBMNLA    R15,4                                                    15680005
*SAS2IBMNB     RETSSVT                                                  15690005
*                                                                       15700005
*SAS2IBMN RETSSVT  DS    0H                                             15710005
RETXMMH  DS    0H                                              SAS2IBMN 15720005
*                                                                       15730005
*WS2356  CTSADBG LEVEL=(DBGLEVEL,1),                                  X 15740005
*WS2356        '(GETXMMH) RC=# SSCT=~ SSVT=~ XMMH=~',                 X 15750005
*WS2356        (?R15,ADDRSSCT,ADDRSSVT,ADDRXMMH)                        15760005
*                                                                       15770005
         CTSADBG LEVEL=(DBGLEVEL,1),                           WS2356  X15780005
               '(GETXMMH) RC=# ICB =~ XMMH=~',                 WS2356  X15790005
               (?R15,ICB_PTR,ADDRXMMH)                         WS2356   15800005
*                                                                       15810005
         BRTRN (15)                                                     15820005
         LTORG ,                                                        15830005
         DROP  ,                                                        15840005
*                                                                       15850005
****************************************************************        15860005
*                                                              *        15870005
*        GETXST: GET EXIT TABLE ENTRY                          *        15880005
*                                                              *        15890005
****************************************************************        15900005
*                                                              *        15910005
* RETURN CODES:                                                *        15920005
*                                                              *        15930005
*       0 - OK                                                 *        15940005
*       4 - NO SUBSYS                                          *        15950005
*       8 - XSH NOT ACTIVE                                     *        15960005
*      12 - NO XST                                             *        15970005
*                                                              *        15980005
****************************************************************        15990005
*                                                              *        16000005
GETXST   DS    0F                                                       16010005
         BEGIN                                                          16020005
*                                                                       16030005
*        INITIALIZE                                                     16040005
*                                                                       16050005
         L     R10,=A(COMMON)                                           16060005
         USING COMMON,R10                                               16070005
         L     R11,ADDRPARM                                             16080005
         USING PARM,R11                                                 16090005
*                                                                       16100005
         XC    ADDRXSH,ADDRXSH         ASSUME NO XSH                    16110005
         XC    ADDRXST,ADDRXST         ASSUME NO XST                    16120005
*                                                                       16130005
*        GET XMM HEADER                                                 16140005
*                                                                       16150005
         CTSCALL GETXMMH,LINK=INT      GET XMM HEADER                   16160005
         LTR   R15,R15                 NONE ?                           16170005
         BNZ   NOSUBS                  ERROR                            16180005
         L     R9,ADDRXMMH             R9 -> XMM HEADER                 16190005
         USING XMMHDR,R9               MAP IT                           16200005
*                                                                       16210005
*        GET XSH ADDR                                                   16220005
*                                                                       16230005
         ICM   R8,15,XMMXSH            R8 -> XSH                        16240005
         BZ    NOXSH                   NO, ERROR                        16250005
         USING XSH,R8                  MAP IT                           16260005
         CLC   =CL4'XSH',XSHXSH        REALLY AN XSH ?                  16270005
         BNE   NOXSH                   NO, ERROR                        16280005
         CLC   =A(XSHVER1),XSHVRSN     CORRECT VERSION ?                16290005
         BNE   NOXSH                   NO, ERROR                        16300005
         ST    R8,ADDRXSH              SET XSH ADDRESS                  16310005
*                                                                       16320005
*        GET FIRST XST                                                  16330005
*                                                                       16340005
         LA    R6,1                    WS10064                          16350005
         ICM   R7,15,XSHXST            R7 -> FIRST XST                  16360005
         BZ    NOXST                   NO, ERROR                        16370005
         USING XST,R7                  MAP IT                           16380005
         L     R4,PARMEXIT             R4 -> REQUIRED XST               16390005
         L     R3,XSHCOUNT             R3 -> NUMBER OF XSTS             16400005
         LA    R6,2                    WS10064                          16410005
         LTR   R3,R3                   NONE ?                           16420005
         BNP   NOXST                   ERROR                            16430005
*                                                                       16440005
*        LOCATE XST                                                     16450005
*                                                                       16460005
LOOPXST  DS    0H                                                       16470005
         LA    R6,3                    WS10064                          16480005
         CLC   =CL4'XST',XSTXST        REALLY AN XST ?                  16490005
         BNE   NOXST                   NO, ERROR                        16500005
         CLC   XSTXNAME,0(R4)          REQUESTED XST ?                  16510005
         BE    HAVEXST                 YES, RETURN IT                   16520005
         A     R7,XSHESIZE             NEXT XST                         16530005
         BCT   R3,LOOPXST              TRY AGAIN IF ANY LEFT            16540005
         LA    R6,4                    WS10064                          16550005
         B     NOXST                   XST NOT FOUND                    16560005
HAVEXST  DS    0H                                                       16570005
         ST    R7,ADDRXST              SAVE XST ADDRESS                 16580005
         XR    R15,R15                 SET SUCCESS RC                   16590005
         B     RETXST                  FINISH                           16600005
*                                                                       16610005
*        RETURN TO CALLER                                               16620005
*                                                                       16630005
NOSUBS   DS    0H                                                       16640005
         LA    R15,4                                                    16650005
         B     RETXST                                                   16660005
NOXSH    DS    0H                                                       16670005
         LA    R15,8                                                    16680005
         B     RETXST                                                   16690005
NOXST    DS    0H                                                       16700005
         LA    R15,12                                                   16710005
         B     RETXST                                                   16720005
*                                                                       16730005
RETXST   DS    0H                                                       16740005
*                                                                       16750005
*WS10064 CTSADBG LEVEL=(DBGLEVEL,1),                                   X16760005
               '(GETXST) RC=# XSH=~ XST=~',                            X16770005
               (?R15,ADDRXSH,ADDRXST)                                   16780005
*                                                                       16790005
         CTSADBG LEVEL=(DBGLEVEL,1),                           WS10064 X16800005
               '(GETXST) RC=# XSH=~ XST=~ RSN=# NM=_',         WS10064 X16810005
               (?R15,ADDRXSH,ADDRXST,?R6,0(R4),8)              WS10064  16820005
*                                                                       16830005
         BRTRN (15)                                                     16840005
         LTORG ,                                                        16850005
         DROP  ,                                                        16860005
*                                                                       16870005
***  THIS ROUTINE IS MOVED INTO LODEXIT TO PREVENT MULTIPLE    IS10188  16880005
***  OPEN AND CLOSE OF THE STEPLIB DCB.                        IS10188  16890005
*IS10188                                                                16900005
****************************************************************        16910005
*IS10188                                                       *        16920005
*IS10188 GETSIZE: GET THE EXIT SIZE                            *        16930005
*IS10188                                                       *        16940005
****************************************************************        16950005
*IS10188                                                                16960005
*IS10188 GETSIZE  DS    0F                                              16970005
*IS10188                                                                16980005
*IS10188 INITIALIZE                                                     16990005
*IS10188                                                                17000005
*IS10188 BEGIN                                                          17010005
*IS10188 L     R10,=A(COMMON)                                           17020005
*IS10188 USING COMMON,R10                                               17030005
*IS10188 L     R11,ADDRPARM                                             17040005
*IS10188 USING PARM,R11                                                 17050005
*IS10188 L     R3,PARMEXIT                                              17060005
*IS10188                                                                17070005
*IS10188                                                                17080005
*IS10188                                                                17090005
*IS10188 OPEN LOAD LIBRARY                                              17100005
*IS10188                                                                17110005
*IS10188 XC    DCBAAD,DCBAAD                                   IS10188  17120005
*IS10188 CTSAMOD 24                                                     17130005
*IS10188 OPEN  STEPLIB             OPEN THE STEPLIB                     17140005
*IS10188 CTSAMOD 31                                                     17150005
*IS10188                                                                17160005
*IS10188 TM    DCBOFLGS-IHADCB+STEPLIB,DCBOFOPN                         17170005
*IS10188 BZ    NOLIB               ..STEPLIB IS UNAVAILABLE, ERROR      17180005
*IS10188                                                                17190005
*IS10188 GET EXIT MODULE                                                17200005
*IS10188                                                                17210005
*IS10188 LOAD  EPLOC=(R3),DCB=STEPLIB,ERRET=NOSIZE                      17220005
*IS10188 LR    R5,R1               R5 = SIZE OF LMOD (DBLWORDS)         17230005
*IS10188 SLL   R5,8                DROP THE FIRST BYTE                  17240005
*IS10188 SRL   R5,5                MULTIPLY BY 8                        17250005
*IS10188 ST    R5,EXITLEN          SAVE SIZE OF LMOD (BYTES)            17260005
*IS10188                                                                17270005
*IS10188 CLOSE LOAD LIBRARY                                             17280005
*IS10188                                                                17290005
*IS10188 CTSAMOD 24                                                     17300005
*IS10188 CLOSE STEPLIB             DROP THE STEPLIB                     17310005
*IS10188 CTSAMOD 31                                                     17320005
*IS10188                                                                17330005
*IS10188 DELETE THE EXIT MODULE                                         17340005
*IS10188                                                                17350005
*IS10188 DELETE EPLOC=(R3)         DELETE THE MODULE (LOADED LATER)     17360005
*IS10188 XR    R15,R15                                                  17370005
*IS10188 B     RETSIZE                                                  17380005
*IS10188                                                                17390005
*IS10188 FINISH                                                         17400005
*IS10188                                                                17410005
*IS10188 NOSIZE   DS    0H                                              17420005
*IS10188 CTSAMOD 24                                                     17430005
*IS10188 CLOSE STEPLIB             DROP THE STEPLIB                     17440005
*IS10188 CTSAMOD 31                                                     17450005
*IS10188 LA    R15,4                                                    17460005
*IS10188 B     RETSIZE                                                  17470005
*IS10188 NOLIB    DS    0H                                              17480005
*IS10188 LA    R15,8                                                    17490005
*IS10188 B     RETSIZE                                                  17500005
*IS10188                                                                17510005
*IS10188 RETSIZE  DS    0H                                              17520005
*IS10188                                                                17530005
*IS10188 BRTRN (15)                                                     17540005
*IS10188 LTORG ,                                                        17550005
*IS10188 DROP  ,                                                        17560005
*                                                                       17570005
****************************************************************        17580005
*                                                              *        17590005
*        LODEXIT: LOAD THE EXIT TO CSA                         *        17600005
*                                                              *        17610005
****************************************************************        17620005
*                                                                       17630005
LODEXIT  DS    0F                                                       17640005
         BEGIN                                                          17650005
         L     R10,=A(COMMON)                                           17660005
         USING COMMON,R10                                               17670005
         L     R11,ADDRPARM                                             17680005
         USING PARM,R11                                                 17690005
*                                                                       17700005
         L     R3,PARMEXIT                                              17710005
         L     R4,PARMSSN                                               17720005
         L     R5,PARMJBN                                               17730005
         XC    DCBAAD,DCBAAD                                   IS10188  17740005
         XC    EXITLEN,EXITLEN                                 IS10188  17740105
         XC    EXITADDR,EXITADDR                               IS10188  17740205
         XC    EXPADDR,EXPADDR                                 IS10188  17740305
         MVI   MODESUP,0                                       IS10188  17740405
*                                                              IS10188  17740505
**   GET EXIT LENGTH                                           IS10188  17740605
*                                                              IS10188  17740705
         LA    R8,STEPLIB              R8 -> DCB.              IS10188  17740805
         CLM   R8,B'1000',=X'00'       DCB BELOW THE LINE?     IS10188  17740905
         BE    GETSIZE                                         IS10188  17741005
         GETMAIN RC,LV=DCBALEN,LOC=24 AREA FOR DCB    IS10188  IS10188  17741105
         CHI   R15,0                                           IS10188  17741205
         BNE   NOGETM                                          IS10188  17741305
         ST    R1,DCBAAD               SAVE DCB AREA ADDRESS.  IS10188  17741405
         LR    R8,R1                   R8 -> DCB AREA          IS10188  17741505
         MVC   0(L'DCBAID,R8),DCBAID   SET EYE-CATCHER.        IS10188  17741605
         LA    R8,L'DCBAID(,R8)        R8 -> DCB               IS10188  17741705
         MVC   0(STEPLIBL,R8),STEPLIB  MOVE DCB                IS10188  17741805
GETSIZE  DS    0H                                              IS10188  17741905
         OPEN  ((R8),INPUT),MODE=31    OPEN THE STEPLIB        IS10188  17742005
         TM    DCBOFLGS-IHADCB(R8),DCBOFOPN                    IS10188  17742105
         BZ    NOLIB               ..STEPLIB IS UNAVAILABLE,   IS10188  17742205
*                                                                       17742305
         LOAD  EPLOC=(R3),DCB=(R8),ERRET=NOMOD                 IS10188  17742405
         LR    R9,R1               R9 = SIZE OF LMOD (DBLWORDS)IS10188  17742505
         SLL   R9,8                DROP THE FIRST BYTE         IS10188  17742605
         SRL   R9,5                MULTIPLY BY 8               IS10188  17742705
         ST    R9,EXITLEN          SAVE SIZE OF LMOD (BYTES)   IS10188  17742805
*                                                              IS10188  17742905
         DELETE EPLOC=(R3)         DELETE THE MODULE.          IS10188  17743005
*                                                                       17744005
**  LOAD THE EXIT TO CSA.                                               17745005
*                                                                       17746005
         MODESET MODE=SUP,KEY=ZERO WE NEED SUPERVISOR STATE             17747005
         MVI   MODESUP,1                                       IS10188  17748005
*                                                                       17749005
*IS10188 L     R6,EXITLEN          GET MODULE LENGTH                    17750005
*IS10188 LA    R6,EXPLEN(,R6)      ADD PREFIX LENGTH                    17760005
         LA    R6,EXPLEN(,R9)      R6 = EXIT AND PREFIX LENGTH IS10188  17770005
*                                                                       17780005
*IS10188 CTSAXGR GETMAIN,LV=(R6),SP=241,BLOCKID=EXPX                    17790005
         CTSAXGR GETMAIN,LV=(R6),SP=241,BLOCKID=EXPX,LOC=ANY   IS10188  17800005
         LTR   R15,R15             HANDLE GETMAIN ERRORS                17810005
         BNZ   LODEXITX                                                 17820005
         ST    R1,EXPADDR              SAVE AREA ADDRESS.      IS10188  17830005
*                                                                       17840005
         USING EXP,R1                                                   17850005
         XC    0(EXPLEN,R1),0(R1)  CLEAR THE EXP                        17860005
         MVC   EXPID,@EXP          SET EYECATCHER IN HEADER             17870005
         MVC   EXPSSNAM,0(R4)      SET SUBSYSTEM NAME IN HEADER         17880005
         MVC   EXPJOBNM,0(R5)      SET XMM JOB NAME IN HEADER           17890005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   17900005
         ST    R6,EXPMODLN         SET GETMAINED LENGTH IN HDR          17910005
         DROP  R1                                                       17920005
*                                                                       17930005
         LA    R6,EXPLEN(,R1)      GET ADDRESS OF ENTRY POINT           17940005
*                                                                       17950005
*IS10188 CTSAMOD 24                                                     17960005
*IS10188 OPEN  STEPLIB             OPEN THE STEPLIB                     17970005
*IS10188 CTSAMOD 31                                                     17980005
*                                                                       17990005
*IS10188 LOAD  EPLOC=(R3),ADDR=(R6),DCB=STEPLIB,ERRET=NOLOAD            18000005
         LOAD  EPLOC=(R3),ADDR=(R6),DCB=(R8),ERRET=NOLOAD      IS10188  18001005
*                                                                       18002005
*IS10188 CTSAMOD 24                                                     18003005
*IS10188 CLOSE STEPLIB                                                  18004005
*IS10188 CTSAMOD 31                                                     18005005
*                                                                       18006005
         ST    R6,EXITADDR                                              18007005
         SR    R15,R15                                                  18008005
         B     LODEXITX                                                 18009005
*                                                                       18010005
NOLOAD   DS    0H                                                       18020005
*IS10188 CTSAMOD 24                                                     18030005
*IS10188 CLOSE STEPLIB                                                  18040005
*IS10188 CTSAMOD 31                                                     18050005
         LA    R15,4                                                    18060005
         B     LODEXITX                                                 18070005
*                                                                       18080005
NOMEM    DS    0H                                                       18090005
         LA    R15,8                                                    18100005
         B     LODEXITX                                                 18110005
*                                                                       18120005
NOLIB    DS    0H                                              IS10188  18130005
         LA    R15,12                                          IS10188  18140005
         B     LODEXITX                                        IS10188  18150005
*                                                                       18160005
NOGETM   DS    0H                                              IS10188  18170005
         LA    R15,16                                          IS10188  18180005
         B     LODEXITX                                        IS10188  18190005
*                                                                       18200005
NOMOD    DS    0H                                              IS10188  18201005
         LA    R15,20                                          IS10188  18202005
         B     LODEXITX                                        IS10188  18203005
*                                                                       18204005
LODEXITX DS    0H                      CLEANUP AND RETURN.              18205005
*IS10188 LR    R5,R15                                                   18206005
         LTR   R5,R15                  IF ENDED OK...          IS10188  18207005
         BZ    SETPROB                 ...NO NEED TO FREE CSA. IS10188  18208005
         L     R1,EXPADDR              AREA WAS ALLOCATED ?    IS10188  18209005
         CHI   R1,0                                            IS10188  18210005
         BE    SETPROB                                         IS10188  18220005
         L     R0,EXPMODLN-EXP(R1)     R0 = AREA LENGTH.       IS10188  18220105
         XC    EXPADDR,EXPADDR                                 IS10188  18220205
         CTSAXGR FREEMAIN,LV=(0),A=(1),SP=241,BLOCKID=EXPX     IS10188  18220305
SETPROB  DS    0H                                              IS10188  18220405
         CLI   MODESUP,0               PROBLEM STATE ?         IS10188  18220505
         BE    CHKCLS                                          IS10188  18220605
         MODESET MODE=PROB,KEY=NZERO  BACK TO PROBLEM STATE             18220705
         MVI   MODESUP,0                                       IS10188  18220805
CHKCLS   DS    0H                                              IS10188  18220905
         TM    DCBOFLGS-IHADCB(R8),DCBOFOPN  OPEN ?            IS10188  18221005
         BZ    CHKFRDCB              ..NO - SKIP.              IS10188  18222005
         CLOSE ((R8),),MODE=31                                 IS10188  18223005
CHKFRDCB DS    0H                                              IS10188  18224005
         L     R1,DCBAAD                                       IS10188  18225005
         CHI   R1,0                    DCB WAS ALLOCATED ?     IS10188  18226005
         BE    RETURN                                          IS10188  18227005
         XC    DCBAAD,DCBAAD                                   IS10188  18228005
         FREEMAIN RC,LV=DCBALEN,A=(1)  FREE THE DCB AREA       IS10188  18229005
RETURN   DS    0H                                              IS10188  18230005
         LR    R15,R5                                                   18240005
*                                                                       18250005
         BRTRN (15)                                                     18260005
         LTORG ,                                                        18270005
         DROP  ,                                                        18280005
*                                                                       18290005
****************************************************************        18300005
*                                                              *        18310005
*        DELEXIT: DELETE THE EXIT FROM CSA                     *        18320005
*                                                              *        18330005
****************************************************************        18340005
*                                                                       18350005
DELEXIT  DS    0F                                                       18360005
         BEGIN                                                          18370005
         L     R10,=A(COMMON)                                           18380005
         USING COMMON,R10                                               18390005
*                                                                       18400005
         XC    DELRC,DELRC         ASSUME MODULE DELETED                18410005
         MODESET MODE=SUP,KEY=ZERO                                      18420005
         ICM   R1,15,EXITADDR      GET MODULE ADDRESS                   18430005
         BZ    DELEXCSX            ..ZERO,EXIT                          18440005
*                                                                       18450005
         LA    R1,0(R1)                                                 18460005
         S     R1,=A(EXPLEN)       BACKSPACE HEADER                     18470005
         USING EXP,R1                                                   18480005
         CLC   @EXP,EXPID          IS IT A MODULE HEADER?               18490005
         BNE   DELEXCSX            ..NO, EXIT                           18500005
         SLR   R14,R14             FOR CS                               18510005
         CS    R14,R14,EXPUSECT    USE COUNT = 0 ?                      18520005
         BNZ   DELEXCS4            NO...  DO NOT DELETE.                18530005
*                                  YES... --->                          18540005
         ICM   R0,B'1111',EXPMODLN GET MODULE LENGTH                    18550005
         BZ    DELEXCSX            ..ZERO,EXIT                          18560005
         CTSAXGR FREEMAIN,LV=(0),A=(1),SP=241,BLOCKID=EXPX              18570005
         B     DELEXCSX            EXIT                                 18580005
*                                                                       18590005
DELEXCS4 EQU   *                                                        18600005
         MVC   DELRC,=F'4'         INDICATE MODULE IN USE               18610005
DELEXCSX EQU   *                                                        18620005
         DROP  R1                                                       18630005
         MODESET MODE=PROB,KEY=NZERO                                    18640005
         L     R15,DELRC           GET RC                               18650005
         BRTRN (15)                                                     18660005
*                                                                       18670005
DELRC    DC    A(0)                                                     18680005
         LTORG ,                                                        18690005
         DROP  ,                                                        18700005
*                                                                       18710005
***   SINCE SMF EXITS ARE SUPORTED BY Z/OS DYNAMIC EXITS       IS10188  18710105
***   WE NO LONGER LOAD THIS EXIT SO THIS CODE IS REMOVED.     IS10188  18710205
*                                                                       18710305
****************************************************************        18710405
*                                                              *        18710505
*        ACTU83: ENABLE ROUTINE FOR IEFU83                     *        18710605
*                                                              *        18710705
****************************************************************        18710805
*                                                              *        18710905
*  SMF TABLES STRUCTURE :                                      *        18711005
*  ----------------------                                      *        18712005
*                                                              *        18713005
*      CVT  ---> SMCA   --->  SST (SMF SUBSYSTEM TABLES) --+   *        18714005
*                                                          |   *        18715005
*                             SMF SUBSYSTEM EXITS TABLE  <-+   *        18716005
*                                                              *        18717005
*   EACH SMF SUBSYSTEM HAS ITS OWN EXITS TABLE WHICH POINTS    *        18718005
*   TO THE SMF EXITS TO BE ACTIVATED FOR THAT SUSBSYTEM.       *        18719005
*                                                              *        18720005
****************************************************************        18730005
*IS10188                                                                18740005
*IS10188 ACTU83   DS    0F                                              18750005
*IS10188                                                                18760005
*----------------------------------------------------------*            18770005
*IS10188 INITIALIZE                                                     18780005
*----------------------------------------------------------*            18790005
*IS10188                                                                18800005
*IS10188 BEGIN ,                                                        18810005
*IS10188 L     R10,=A(COMMON)          R10 -> COMMON DATA AREA          18820005
*IS10188 USING COMMON,R10              MAP IT                           18830005
*IS10188 L     R11,ADDRPARM            R11 -> SDX PARAMETERS BLOCK      18840005
*IS10188 USING PARM,R11                MAP IT                           18850005
*IS10188                                                        *CTS2   18860005
*IS10188 FAIL ACTIVATION IF MVS SP5 OR ABOVE                    *CTS2   18870005
*IS10188                                                        *CTS2   18880005
*IS10188 L     R15,FLCCVT-PSA          R15 -> CVT               *CTS2   18890005
*IS10188 SH    R15,=AL2(CVT-CVTFIX)    R15 -> CVT PREFIX        *CTS2   18900005
*IS10188 USING CVTFIX,R15                                       *CTS2   18910005
*IS10188 CLC   =CL3'SP4',CVTPRODN                               *CTS2   18920005
*IS10188 BE    U83MVSOK                                         *CTS2   18930005
*IS10188 CLC   =CL3'SP3',CVTPRODN                               *CTS2   18940005
*IS10188 BE    U83MVSOK                                         *CTS2   18950005
*IS10188 CLC   =CL3'SP2',CVTPRODN                               *CTS2   18960005
*IS10188 BE    U83MVSOK                                         *CTS2   18970005
*IS10188 DROP  R15                                              *CTS2   18980005
*IS10188 L     R2,=A(MSG304E)                                   *CTS2   18990005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                *CTS2   19000005
*IS10188 L     R2,=A(MSG311W)                                   *CTS2   19010005
*IS10188 CTSCALL MSGSDX,((R2)),LINK=INT                         *CTS2   19020005
*IS10188 B     U83NOSMF                                         *CTS2   19030005
*IS10188 U83MVSOK DS    0H                                  *CTS2       19040005
*IS10188                                                                19050005
*IS10188 L     R4,0(R1)                R4 -> ADDR OF EXIT ROUTINE       19060005
*IS10188 LR    R5,R4                   R5 -> EXIT ROUTINE               19070005
*IS10188 S     R5,=A(EXPLEN)           R5 -> EXIT PREFIX AREA           19080005
*IS10188 USING EXP,R5                  MAP IT                           19090005
*IS10188                                                                19100005
*IS10188 MODESET MODE=SUP,KEY=ZERO     OBTAIN SOME MUSCLE               19110005
*IS10188                                                                19120005
*IS10188 CLC   @EXP,EXPID              IS IT A MODULE HEADER?           19130005
*IS10188 BNE   U83EXP                  NO, SOMETHING WENT WRONG         19140005
*IS10188                                                                19150005
*----------------------------------------------------------*            19160005
*IS10188 PHASE 1 - ZOMBI EXIT - SPECIAL CASE                            19170005
*----------------------------------------------------------*            19180005
*IS10188                                                                19190005
*IS10188 U83PHS1  DS    0H                                              19200005
*IS10188 TM    EXPFLAGS,EXPZOMBI       WAS EXIT MARKED AS ZOMBI ?       19210005
*IS10188 BZ    U83PHS2                 NO, START WITH PHASE 2           19220005
*IS10188                                                                19230005
*IS10188 ENABLE OF ZOMBI EXIT                                           19240005
*IS10188                                                                19250005
*IS10188 CLI   FLAGENB,C'Y'            ENABLE REQUEST ?                 19260005
*IS10188 BNE   U83ZMBDS                NO, CHECK EXP FOR DISABLE        19270005
*IS10188 NI    EXPFLAGS,255-EXPZOMBI   CLEAR ZOMBI FLAG                 19280005
*IS10188 L     R2,=A(MSG300I)                                           19290005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        19300005
*IS10188 B     U83ZOMBI                FINISH                           19310005
*IS10188                                                                19320005
*IS10188 DISABLE OF A ZOMBI EXIT                                        19330005
*IS10188                                                                19340005
*IS10188 U83ZMBDS DS    0H                                              19350005
*IS10188 B     U83ZOMBI                EXIT IS ALREADY DISABLED         19360005
*IS10188                                                                19370005
*----------------------------------------------------------*            19380005
*IS10188 PHASE 2 - PRE ACTIVATION CHECKS                                19390005
*IS10188      ESPECIALLY - CONSISTENSY ACROSS SUBSYSTEMS                19400005
*----------------------------------------------------------*            19410005
*IS10188                                                                19420005
*IS10188 U83PHS2  DS    0H                                              19430005
*IS10188                                                                19440005
*IS10188 GENERAL CHECKS                                                 19450005
*IS10188                                                                19460005
*IS10188 CTSCALL GETSMF,LINK=INT       INITIALIAZE SMF INFO             19470005
*IS10188 LTR   R15,R15                 WAS SMF DATA AREAS LOCATED ?     19480005
*IS10188 BNZ   U83NOSMF                NO, WE ARE IN TROUBLE            19490005
*IS10188                                                                19500005
*IS10188 ENBALE CHECKS                                                  19510005
*IS10188                                                                19520005
*IS10188 CLI   FLAGENB,C'Y'            ENABLE REQUEST ?                 19530005
*IS10188 BNE   U83PHS2D                NO, CHECK EXP FOR DISABLE        19540005
*IS10188 CLC   EXPPREV,=XL4'FFFFFFFF'  IS THERE A PREVIOUS EXIT ?       19550005
*IS10188 BNE   U83NPREV                YES, NOT ALLOWED TO ACTIVATE     19560005
*IS10188 CTSCALL CKE83,((R5)),         CHECK THAT SMF TABLES ARE OK    X19570005
               LINK=INT                                                 19580005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X19590005
               '(ACTU83) CKE83 RC = #',?R15                             19600005
*IS10188 LTR   R15,R15                 PASSED ENABLE CHECKS ?           19610005
*IS10188 BNZ   U83CKF                  NO, ERROR ACTIVATING U83         19620005
*IS10188 B     U83PHS3                 YES, PROCEED WITH ACTIVATION     19630005
*IS10188                                                                19640005
*IS10188 DISABLE CHECKS                                                 19650005
*IS10188                                                                19660005
*IS10188 U83PHS2D DS    0H                                              19670005
*IS10188 CLC   EXPPREV,=XL4'FFFFFFFF'  IS THERE A PREVIOUS EXIT ?       19680005
*IS10188 BE    U83NPREV                NO, NOTHING TO DEACTIVATE        19690005
*IS10188 CTSCALL CKD83,((R5)),         CHECK THAT SMF TABLES ARE OK    X19700005
               LINK=INT                                                 19710005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X19720005
               '(ACTU83) CKD83 RC = #',?R15                             19730005
*IS10188 CH    R15,=H'4'               PASSED DISABLE CHECKS ?          19740005
*IS10188 BH    U83CKF                  NO, ERROR DEACTIVATING U83       19750005
*IS10188 BE    U83ZOMBI                MAYBE - EXIT IS ZOMBI            19760005
*IS10188                                                                19770005
*----------------------------------------------------------*            19780005
*IS10188 PHASE 3 - SCAN SMF TABLES AND REPLACE EXITS POINTERS           19790005
*----------------------------------------------------------*            19800005
*IS10188                                                                19810005
*IS10188 U83PHS3  DS    0H                                              19820005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X19830005
               '(ACTU83) STARTING LOOP. ENABLE FLAG = _',(FLAGENB,1)    19840005
*IS10188                                                                19850005
*IS10188 L     R3,ADDRSSTP             R3 -> FIRST SST ENTRY            19860005
*IS10188 L     R6,NUMSST               R6 = NUMBER OF SST ENTRIES       19870005
*IS10188 L     R7,SIZESST              R7 = SIZE OF EACH SST ENTRY      19880005
*IS10188                                                                19890005
*IS10188 LOOP ON SST ENTRIES (ONE PER SMF SUBSYS)                       19900005
*IS10188                                                                19910005
*IS10188 LOOPSSTE DS    0H                                              19920005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X19930005
               '(ACTU83) SSTE AT ~ SUBSYS=_ EXITS TABLE AT ~',         X19940005
               (?R3,0(R3),4,48(R3))                                     19950005
*IS10188 MVC   SMFSUB,0(R3)            COPY CURRENT SMF SUBSYS NAME     19960005
*IS10188 ICM   R2,15,48(R3)            R2 -> EXITS TABLE                19970005
*IS10188 BZ    NEXTSSTE                NO EXITS                         19980005
*IS10188 USING SEXT,R2                 MAP EXITS TABLE                  19990005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X20000005
               '(ACTU83) EXIT TABLE AT ~ CONTAINS # ENTRIES',          X20010005
               (?R2,SEXTCNT)                                            20020005
*IS10188 ICM   R8,15,SEXTCNT           R9 = NUMBER OF EXITS IN TABLE    20030005
*IS10188 BZ    NEXTSSTE                NO EXITS                         20040005
*IS10188                                                                20050005
*----------------------------------------------------------*            20060005
*IS10188 LOCATE IEFU83 ENTRY IN CURRENT EXITS TABLE                     20070005
*----------------------------------------------------------*            20080005
*IS10188                                                                20090005
*IS10188 LOOPSEXT DS    0H                                              20100005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X20110005
               '(ACTU83) SEARCH REACHED EXIT _',                       X20120005
               (SEXTNAME,8)                                             20130005
*IS10188 CLC   =CL8'IEFU83',SEXTNAME   DO WE HAVE U83 ?                 20140005
*IS10188 BE    U83FOUND                YES, REPLACE POINTER             20150005
*IS10188 LA    R2,SEXTELEN(,R2)        NEXT ENTRY                       20160005
*IS10188 BCT   R8,LOOPSEXT             TRY NEXT EXIT                    20170005
*IS10188 B     NEXTSSTE                CONTINUE SEARCHING               20180005
*IS10188 U83FOUND DS    0H                                              20190005
*IS10188 CLI   FLAGENB,C'Y'            ENABLE REQUEST ?                 20200005
*IS10188 BE    ENBEXT                  YES, DO IT                       20210005
*IS10188 B     DISEXT                  NO, DISABLE                      20220005
*IS10188                                                                20230005
*----------------------------------------------------------*            20240005
*IS10188 ENABLE IEFU83                                                  20250005
*----------------------------------------------------------*            20260005
*IS10188                                                                20270005
*IS10188 ENBEXT   DS    0H                                              20280005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X20290005
               '(ACTU83) ACTIVE AT ~, NEW AT ~ PREV  AT ~',            X20300005
               (SEXTADDR,?R4,EXPPREV)                                   20310005
*IS10188                                                                20320005
*IS10188 SAVE CURRENT IEFU83 EXIT ENTRY POINT IN EXP                    20330005
*IS10188                                                                20340005
*IS10188 MVI   FLAGCLR,C'Y'            EXP SHOULD BE CLEARED ON FAILURE 20350005
*IS10188 L     R0,SEXTADDR             R0 -> CURRENT U83 ENTRY POINT    20360005
*IS10188 L     R1,=XL4'FFFFFFFF'       IF PREV PTR IN EXP IS NOT SET,   20370005
*IS10188 CS    R1,R0,EXPPREV              THEN REPLACE IT               20380005
*IS10188 BZ    ENBPREV                    AND CONTINUE ..               20390005
*IS10188 MVI   FLAGCLR,C'N'            DON'T CLEAR EXP ON FAILURE       20400005
*IS10188 C     R0,EXPPREV              ELSE, IS CURRENT EXIT = PREV ?   20410005
*IS10188 BNE   NEXTSSTE                NO, MIXED CURRENT U83 EXITS      20420005
*IS10188 ENBPREV  DS    0H                                              20430005
*IS10188                                                                20440005
*IS10188 REPLACE IEFU83 EXIT ENTRY POINT WITH NEW ONE                   20450005
*IS10188                                                                20460005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X20470005
               '(ACTU83) NEW EXIT AT ~ ACTIVE AT ~',                   X20480005
               (?R4,SEXTADDR)                                           20490005
*IS10188 LR    R1,R4                   R1 -> NEXT EXIT ADDRESS          20500005
*IS10188 CR    R1,R0                   PREVIOUS = CURRENT ?             20510005
*IS10188 BE    NEXTSSTE                YES, NO NEED TO REPLACE          20520005
*IS10188 CS    R0,R1,SEXTADDR          REPLACE                          20530005
*IS10188 BZ    NEXTSSTE                NO NEWS, GOOD NEWS !             20540005
*IS10188 CLI   FLAGCLR,C'Y'            FAILED, SHOULD WE CLEAR EXP ?    20550005
*IS10188 BNE   ENBEXT                  NO, DON'T CLEAR PREVIOUS FIELD   20560005
*IS10188 MVC   EXPPREV,=XL4'FFFFFFFF'  CLEAR PREVIOUS FIELD IN EXP!     20570005
*IS10188 B     ENBEXT                  SET ERROR CODE                   20580005
*IS10188                                                                20590005
*----------------------------------------------------------*            20600005
*IS10188 DISABLE IEFU83                                                 20610005
*----------------------------------------------------------*            20620005
*IS10188                                                                20630005
*IS10188 DISEXT   DS    0H                                              20640005
*IS10188 CTSADBG LEVEL=(DBGLEVEL,1),                                   X20650005
               '(ACTU83) ACTIVE AT ~, DISABLED AT ~ PREV  AT ~',       X20660005
               (SEXTADDR,?R4,EXPPREV)                                   20670005
*IS10188                                                                20680005
*IS10188 RESTORE PREVIOUS IEFU83 EXIT POINTER                           20690005
*IS10188                                                                20700005
*IS10188 L     R0,SEXTADDR             R0 -> CURRENT EXIT ADDRESS       20710005
*IS10188 L     R1,EXPPREV              R1 -> PREVIOUS EXIT ADDRESS      20720005
*IS10188 CR    R0,R1                   IS CURRENT EXIT EQ PREVIOUS ?    20730005
*IS10188 BE    NEXTSSTE                YES, NOTHING TO DISABLE          20740005
*IS10188 C     R4,SEXTADDR             IS OUR EXIT THE ACTIVE ONE ?     20750005
*IS10188 BE    DISPTR                  YES, DEACTIVATE                  20760005
*IS10188 OI    EXPFLAGS,EXPZOMBI       SET EXITS ZOMBI STATUS           20770005
*IS10188 B     NEXTSSTE                AND CONTINUE ...                 20780005
*IS10188                                                                20790005
*IS10188 DISPTR   DS    0H                                              20800005
*IS10188 CS    R0,R1,SEXTADDR          RESTORE TO PREVIOUS EXIT         20810005
*IS10188 BNZ   DISEXT                  FAILED, ISSUE ERROR CODE         20820005
*IS10188                                                                20830005
*IS10188 B     NEXTSSTE                                                 20840005
*IS10188                                                                20850005
*----------------------------------------------------------*            20860005
*IS10188 NEXT SMF SUBSYSTEM                                             20870005
*----------------------------------------------------------*            20880005
*IS10188                                                                20890005
*IS10188 NEXTSSTE DS    0H                                              20900005
*IS10188 AR    R3,R7                   R3 -> NEXT SSTE                  20910005
*IS10188 BCT   R6,LOOPSSTE             ENABLE FOR NEW SSTE              20920005
*IS10188                                                                20930005
*----------------------------------------------------------*            20940005
*IS10188 WE HANDLED ALL OF THE SUBSYSTEMS                               20950005
*----------------------------------------------------------*            20960005
*IS10188                                                                20970005
*IS10188 CLI   FLAGENB,C'Y'            ENABLE REQUEST ?                 20980005
*IS10188 BNE   U83DCK                  YES, THEN WE ARE DONE            20990005
*IS10188 L     R2,=A(MSG301I)                                           21000005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        21010005
*IS10188 B     U83OK                                                    21020005
*IS10188 U83DCK   DS    0H                                              21030005
*IS10188 TM    EXPFLAGS,EXPZOMBI       WAS EXIT MARKED AS ZOMBI         21040005
*IS10188 BZ    U83DCK1                 NO, CLEAR PREVIOUS POINTER       21050005
*IS10188 L     R2,=A(MSG303W)                                           21060005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        21070005
*IS10188 B     U83ZOMBI                YES, THEN SET ZOMBI RC           21080005
*IS10188 U83DCK1  DS    0H                                              21090005
*IS10188 MVC   EXPPREV,=XL4'FFFFFFFF'                                   21100005
*IS10188 L     R2,=A(MSG302I)                                           21110005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        21120005
*IS10188 B     U83OK                                                    21130005
*IS10188                                                                21140005
*----------------------------------------------------------*            21150005
*IS10188 SET RETURN CODE                                                21160005
*----------------------------------------------------------*            21170005
*IS10188                                                                21180005
*IS10188 U83OK    DS    0H                                              21190005
*IS10188 XR    R15,R15                                                  21200005
*IS10188 B     U83EXIT                                                  21210005
*IS10188 U83ZOMBI DS    0H                                              21220005
*IS10188 LA    R15,4                                                    21230005
*IS10188 B     U83EXIT                                                  21240005
*IS10188 U83NOSMF DS    0H                                              21250005
*IS10188 LA    R15,8                                                    21260005
*IS10188 B     U83EXIT                                                  21270005
*IS10188 U83EXP   DS    0H                                              21280005
*IS10188 LA    R15,12                                                   21290005
*IS10188 B     U83EXIT                                                  21300005
*IS10188 U83NPREV DS    0H                                              21310005
*IS10188 LA    R15,16                                                   21320005
*IS10188 B     U83EXIT                                                  21330005
*IS10188 U83CKF   DS    0H                                              21340005
*IS10188 LA    R15,40(,R15)                                             21350005
*IS10188 B     U83EXIT                                                  21360005
*IS10188                                                                21370005
*IS10188 DROP  R5                                                       21380005
*IS10188                                                                21390005
*----------------------------------------------------------*            21400005
*IS10188 RESET PSW AUTH                                                 21410005
*----------------------------------------------------------*            21420005
*IS10188                                                                21430005
*IS10188 U83EXIT  DS    0H                                              21440005
*IS10188 LR    R5,R15                                                   21450005
*IS10188 MODESET MODE=PROB,KEY=NZERO                                    21460005
*IS10188 LR    R15,R5                                                   21470005
*IS10188                                                                21480005
*IS10188                                                                21490005
*----------------------------------------------------------*            21500005
*IS10188 RETURN TO CALLER                                               21510005
*----------------------------------------------------------*            21520005
*IS10188                                                                21530005
*IS10188 BRTRN (15)                                                     21540005
*IS10188 LTORG ,                                                        21550005
*IS10188 FLAGCLR  DC    CL1' '                                          21560005
*IS10188 DROP  ,                                                        21570005
*IS10188                                                                21580005
*IS10188                                                                21590005
****************************************************************        21600005
*                                                              *        21610005
*        PRE ENABLE VALIDITY CHECKS FOR IEFU83                 *        21620005
*                                                              *        21630005
****************************************************************        21640005
*                                                              *        21650005
*  THE ROUTINE CHECKS THAT ALL SMF SUBSYS HAVE AN ENTRY FOR    *        21660005
*  IEFU83 AND ALL POINT TO THE SAME IEFU83 ENTRY POINT .       *        21670005
*  OTHERWISE, IT ISSUES AND ERROR MESSAGE AND RETURNS THE      *        21680005
*  FOLLOWING RETURN CODES:                                     *        21690005
*                                                              *        21700005
*    0 - ALL IS OK                                             *        21710005
*    4 - SUBSYSTEM WITH NO EXITS AT ALL                        *        21720005
*    8 - SUBSYSTEM WITHOUT IEFU83 EXIT                         *        21730005
*   12 - DIFFERNET EXIT POINTER FOR DIFFERENT SUBSYSTEMS .     *        21740005
*                                                              *        21750005
****************************************************************        21760005
*IS10188                                                                21770005
*IS10188 CKE83    DS    0F                                              21780005
*IS10188                                                                21790005
*IS10188 INITIALIZE                                                     21800005
*IS10188                                                                21810005
*IS10188 BEGIN                                                          21820005
*IS10188 L     R5,0(R1)                                                 21830005
*IS10188 USING EXP,R5                                                   21840005
*IS10188 L     R10,=A(COMMON)                                           21850005
*IS10188 USING COMMON,R10                                               21860005
*IS10188                                                                21870005
*IS10188 LOOP ON SST ENTRIES (ONE PER SMF SUBSYS)                       21880005
*IS10188                                                                21890005
*IS10188 L     R3,ADDRSSTP             R3 -> FIRST SST ENTRY            21900005
*IS10188 L     R6,NUMSST               R6 = NUMBER OF SST ENTRIES       21910005
*IS10188 L     R7,SIZESST              R7 = SIZE OF EACH SST ENTRY      21920005
*IS10188 CKE83L1 DS     0H                                              21930005
*IS10188 MVC   SMFSUB,0(R3)            COPY CURRENT SMF SUBSYS NAME     21940005
*IS10188 CLI   0(R3),C' '              VALID SUBSYS ?                   21950005
*IS10188 BNH   CKE83NX1                NO, IGNORE IT                    21960005
*IS10188 ICM   R2,15,48(R3)            R2 -> EXITS TABLE                21970005
*IS10188 BZ    CKE83R4                 NO EXITS                         21980005
*IS10188 USING SEXT,R2                 MAP EXITS TABLE                  21990005
*IS10188 ICM   R8,15,SEXTCNT           R9 = NUMBER OF EXITS IN TABLE    22000005
*IS10188 BZ    CKE83R4                 NO EXITS                         22010005
*IS10188                                                                22020005
*IS10188 LOCATE IEFU83 ENTRY IN CURRENT EXITS TABLE                     22030005
*IS10188                                                                22040005
*IS10188 CKE83L2  DS     0H                                             22050005
*IS10188 CLC   =CL8'IEFU83',SEXTNAME   DO WE HAVE U83 ?                 22060005
*IS10188 BE    CKE83FND                YES, REPLACE POINTER             22070005
*IS10188 LA    R2,SEXTELEN(,R2)        NEXT ENTRY                       22080005
*IS10188 BCT   R8,CKE83L2              TRY NEXT EXIT                    22090005
*IS10188 B     CKE83R8                 NO, FUNNY                        22100005
*IS10188                                                                22110005
*IS10188 CHECK EXIT VALIDITY                                            22120005
*IS10188                                                                22130005
*IS10188 CKE83FND DS    0H                                              22140005
*IS10188 L     R0,SEXTADDR             R0 -> CURRENT U83 ENTRY POINT    22150005
*IS10188 XR    R1,R1                   IF PREV PTR IN EXP IS NOT SET,   22160005
*IS10188 CS    R1,R0,CKE83ADR             THEN REPLACE IT               22170005
*IS10188 BZ    CKE83NX1                   AND CONTINUE ..               22180005
*IS10188 C     R0,CKE83ADR             ELSE, IS CURRENT EXIT = PREV ?   22190005
*IS10188 BNE   CKE83R12                NO, MIXED CURRENT U83 EXITS      22200005
*IS10188                                                                22210005
*IS10188 NEXT SMF SUBSYSTEM                                             22220005
*IS10188                                                                22230005
*IS10188 CKE83NX1 DS    0H                                              22240005
*IS10188 AR    R3,R7                   R3 -> NEXT SSTE                  22250005
*IS10188 BCT   R6,CKE83L1              CONTINUE WITH NEW SSTE           22260005
*IS10188 B     CKE83R0                                                  22270005
*IS10188                                                                22280005
*IS10188 SET RC AND ERROR MESSAGE                                       22290005
*IS10188                                                                22300005
*IS10188 CKE83R0  DS    0H                                              22310005
*IS10188 XR    R15,R15                                                  22320005
*IS10188 B     CKE83END                                                 22330005
*IS10188                                                                22340005
*IS10188 CKE83R4  DS    0H                                              22350005
*IS10188 L     R2,=A(MSG304E)                                           22360005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        22370005
*IS10188 L     R2,=A(MSG307I)                                           22380005
*IS10188 CTSCALL MSGSDX,((R2),SMFSUB),LINK=INT                          22390005
*IS10188 LA    R15,4                                                    22400005
*IS10188 B     CKE83END                                                 22410005
*IS10188                                                                22420005
*IS10188 CKE83R8  DS    0H                                              22430005
*IS10188 L     R2,=A(MSG304E)                                           22440005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        22450005
*IS10188 L     R2,=A(MSG305I)                                           22460005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME,SMFSUB),LINK=INT                 22470005
*IS10188 LA    R15,8                                                    22480005
*IS10188 B     CKE83END                                                 22490005
*IS10188                                                                22500005
*IS10188 CKE83R12 DS    0H                                              22510005
*IS10188 L     R2,=A(MSG304E)                                           22520005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        22530005
*IS10188 L     R2,=A(MSG306I)                                           22540005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME,SMFSUB),LINK=INT                 22550005
*IS10188 LA    R15,12                                                   22560005
*IS10188 B     CKE83END                                                 22570005
*IS10188                                                                22580005
*IS10188 RETURN TO CALLER                                               22590005
*IS10188                                                                22600005
*IS10188 CKE83END DS    0H                                              22610005
*IS10188 BRTRN (15)                                                     22620005
*IS10188 CKE83ADR DS   A                                                22630005
*IS10188 LTORG ,                                                        22640005
*IS10188 DROP  ,                                                        22650005
*IS10188                                                                22660005
****************************************************************        22670005
*                                                              *        22680005
*        PRE DISABLE VALIDITY CHECKS FOR IEFU83                *        22690005
*                                                              *        22700005
****************************************************************        22710005
*                                                              *        22720005
*  THE ROUTINE CHECKS THAT THE EXIT IS NOT A ZOMBI EXIT        *        22730005
*  AND RETURNS THE FOLLOWING RETURN CODES:                     *        22740005
*                                                              *        22750005
*    0 - ALL IS OK                                             *        22760005
*    4 - EXIT IS A ZOMBI                                       *        22770005
*                                                              *        22780005
****************************************************************        22790005
*IS10188                                                                22800005
*IS10188                                                                22810005
*IS10188 CKD83    DS    0F                                              22820005
*IS10188                                                                22830005
*IS10188 INITIALIZE                                                     22840005
*IS10188                                                                22850005
*IS10188 BEGIN                                                          22860005
*IS10188 L     R5,0(R1)                                                 22870005
*IS10188 USING EXP,R5                                                   22880005
*IS10188 L     R10,=A(COMMON)                                           22890005
*IS10188 USING COMMON,R10                                               22900005
*IS10188                                                                22910005
*IS10188 LOOP ON SST ENTRIES (ONE PER SMF SUBSYS)                       22920005
*IS10188                                                                22930005
*IS10188 L     R3,ADDRSSTP             R3 -> FIRST SST ENTRY            22940005
*IS10188 L     R6,NUMSST               R6 = NUMBER OF SST ENTRIES       22950005
*IS10188 L     R7,SIZESST              R7 = SIZE OF EACH SST ENTRY      22960005
*IS10188 CKD83L1 DS     0H                                              22970005
*IS10188 CLI   0(R3),C' '              VALID SUBSYS ?                   22980005
*IS10188 BNH   CKD83NX1                NO, IGNORE IT                    22990005
*IS10188 ICM   R2,15,48(R3)            R2 -> EXITS TABLE                23000005
*IS10188 BZ    CKD83R0                 NO EXITS                         23010005
*IS10188 USING SEXT,R2                 MAP EXITS TABLE                  23020005
*IS10188 ICM   R8,15,SEXTCNT           R9 = NUMBER OF EXITS IN TABLE    23030005
*IS10188 BZ    CKD83R0                 NO EXITS                         23040005
*IS10188                                                                23050005
*IS10188 LOCATE IEFU83 ENTRY IN CURRENT EXITS TABLE                     23060005
*IS10188                                                                23070005
*IS10188 CKD83L2  DS     0H                                             23080005
*IS10188 CLC   =CL8'IEFU83',SEXTNAME   DO WE HAVE U83 ?                 23090005
*IS10188 BE    CKD83FND                YES, REPLACE POINTER             23100005
*IS10188 LA    R2,SEXTELEN(,R2)        NEXT ENTRY                       23110005
*IS10188 BCT   R8,CKD83L2              TRY NEXT EXIT                    23120005
*IS10188 B     CKD83NX1                                                 23130005
*IS10188                                                                23140005
*IS10188 VERIFY THAT WE ARE NOT IN A ZOMBI SITUATION                    23150005
*IS10188                                                                23160005
*IS10188 CKD83FND DS    0H                                              23170005
*IS10188 CLC   SEXTADDR,EXPPREV        ACTIVE EXIT = PREVIOUS ?         23180005
*IS10188 BE    CKD83NX1                YES, THEN ITS OK                 23190005
*IS10188 C     R4,SEXTADDR             ARE WE THE ACTIVE EXIT ?         23200005
*IS10188 BE    CKD83NX1                YES, THEN WE ARE OK              23210005
*IS10188 OI    EXPFLAGS,EXPZOMBI       NO, WE ARE ZOMBI                 23220005
*IS10188 B     CKD83R4                 THATS ALL                        23230005
*IS10188                                                                23240005
*IS10188 NEXT SMF SUBSYSTEM                                             23250005
*IS10188                                                                23260005
*IS10188 CKD83NX1 DS   0H                                               23270005
*IS10188 AR    R3,R7                   R3 -> NEXT SSTE                  23280005
*IS10188 BCT   R6,CKD83L1              CONTINUE WITH NEW SSTE           23290005
*IS10188 B     CKD83R0                                                  23300005
*IS10188                                                                23310005
*IS10188 SET RC AND ERROR MESSAGE                                       23320005
*IS10188                                                                23330005
*IS10188 CKD83R0  DS    0H                                              23340005
*IS10188 XR    R15,R15                                                  23350005
*IS10188 B     CKD83END                                                 23360005
*IS10188 CKD83R4  DS    0H                                              23370005
*IS10188 L     R2,=A(MSG303W)                                           23380005
*IS10188 CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        23390005
*IS10188 LA    R15,4                                                    23400005
*IS10188 B     CKD83END                                                 23410005
*IS10188                                                                23420005
*IS10188 RETURN TO CALLER                                               23430005
*IS10188                                                                23440005
*IS10188 CKD83END DS    0H                                              23450005
*IS10188 BRTRN (15)                                                     23460005
*IS10188 LTORG ,                                                        23470005
*IS10188 DROP  ,                                                        23480005
*                                                                       23490005
****************************************************************        23500005
*                                                              *        23510005
*        ACTRIX02: ENABLE ROUTINE FOR ICHRIX02                 *        23520005
*                                                              *        23530005
****************************************************************        23540005
*                                                                       23550005
ACTRIX02 DS    0F                                                       23560005
*                                                                       23570005
*----------------------------------------------------------*            23580005
*  INITIALIZE                                                           23590005
*----------------------------------------------------------*            23600005
*                                                                       23610005
         BEGIN                                                          23620005
         L     R10,=A(COMMON)                                           23630005
         USING COMMON,R10                                               23640005
         L     R11,ADDRPARM                                             23650005
         USING PARM,R11                                                 23660005
*                                                                       23670005
         L     R4,0(R1)                R4 -> ADDR OF EXIT ROUTINE       23680005
         LR    R5,R4                   R5 -> EXIT ROUTINE               23690005
         S     R5,=A(EXPLEN)           R5 -> EXIT PREFIX AREA           23700005
         USING EXP,R5                                                   23710005
         CLC   @EXP,EXPID              IS IT A MODULE HEADER?           23720005
         BNE   RIXEXP                                                   23730005
*                                                                       23740005
         MODESET MODE=SUP,KEY=ZERO                                      23750005
*                                                                       23760005
*----------------------------------------------------------*            23770005
*  IF EXIT IN ZOMBI STATUS, JUST CLEAR THE ZOMBI FLAG                   23780005
*----------------------------------------------------------*            23790005
*                                                                       23800005
         TM    EXPFLAGS,EXPZOMBI       EXIT IN ZOMBI STATUS ?           23810005
         BNO   LOCRIX                  NO, REAL ACTIVATION NEEDED       23820005
         NI    EXPFLAGS,255-EXPZOMBI   YES, JUST CLEAR THE FLAG         23830005
         L     R2,=A(MSG300I)                                           23840005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        23850005
         B     RIXOK                   WE ARE OK                        23860005
*                                                                       23870005
*----------------------------------------------------------*            23880005
*  LOCATE RCVT                                                          23890005
*----------------------------------------------------------*            23900005
*                                                                       23910005
LOCRIX   DS    0H                                                       23920005
         L     R3,FLCCVT-PSA           R3 -> CVT                        23930005
         ICM   R3,15,CVTRAC-CVT(R3)    R3 -> RCVT                       23940005
         BZ    RIXNOCVT                NO , RACF NOT ACTIVE ERROR       23950005
         USING RCVT,R3                                                  23960005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X23970005
               '(ACTRIX02) RCVT AT ~',?R3                               23980005
         CLC   RCVTID,=CL4'RCVT'       REALLY RCVT ?                    23990005
         BNE   RIXWCVT                 NO, MUST BE AN ERROR             24000005
*                                                                       24010005
*----------------------------------------------------------*            24020005
*  ENABLE/DISABLE ACCORDING TO CALL TYPE                                24030005
*----------------------------------------------------------*            24040005
*                                                                       24050005
         CLI   FLAGENB,C'Y'                                             24060005
         BE    ENBRIXP                                                  24070005
         B     DISRIXP                                                  24080005
*                                                                       24090005
*----------------------------------------------------------*            24100005
*  ENABLE ICHRIX02                                                      24110005
*----------------------------------------------------------*            24120005
*                                                                       24130005
ENBRIXP  DS    0H                                                       24140005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X24150005
               '(ACTRIX02) ACTIVE EXIT AT ~, NEW EXIT AT ~',           X24160005
               (RCVTRIXP,?R4)                                           24170005
*                                                                       24180005
*        UPDATE RCVT POINTER TO ICHRIX02                                24190005
*                                                                       24200005
         C     R4,RCVTRIXP             OUR EXIT ALREADY ACTIVE ?        24210005
         BE    RIXOKMSG                YES, THEN WE ARE OK              24220005
         CLC   EXPPREV,=XL4'FFFFFFFF'  HAVE A PREVIOUS EXIT ?           24230005
         BNE   RIXNPREV                YES, TOUCH NOTHING               24240005
*                                                                       24250005
         XC    EXPUSECT,EXPUSECT       CLEAR USE COUNT BEFORE ENABLE    24260005
         L     R0,RCVTRIXP             R0 -> ACTIVE EXIT                24270005
         LR    R1,R4                   R1 -> NEW EXIT                   24280005
         ST    R0,EXPPREV              SAVE ACTIVE EXIT IN EXP          24290005
         CS    R0,R1,RCVTRIXP          REPLACE EXIT POINTER             24300005
         BNZ   RIXERRP                 ERROR, SET ERROR CODE            24310005
RIXOKMSG DS    0H                                                       24320005
         L     R2,=A(MSG301I)                                           24330005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        24340005
         B     RIXOK                                                    24350005
*                                                                       24360005
*        ERROR - REPLACEMENT OF EXIT POINTER HAS FAILED                 24370005
*                                                                       24380005
RIXERRP  DS    0H                                                       24390005
         MVC   EXPPREV,=XL4'FFFFFFFF'  CLEAR PREVIOUS POINTER           24400005
         B     RIXNOCS                 SET ERROR RC                     24410005
*                                                                       24420005
*----------------------------------------------------------*            24430005
*  DISABLE ICHRIX02                                                     24440005
*----------------------------------------------------------*            24450005
*                                                                       24460005
DISRIXP  DS    0H                                                       24470005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X24480005
               '(ACTRIX02) ACTIVE AT ~, OUR EXIT AT ~, PREVIOUS AT ~', X24490005
               (RCVTRIXP,?R4,EXPPREV)                                   24500005
*                                                                       24510005
*        UPDATE RCVT POINTER                                            24520005
*                                                                       24530005
         C     R4,RCVTRIXP             IS OUR EXIT THE ACTIVE ONE ?     24540005
         BNE   RIXZOMBI                NO, TURN INTO A ZOMBI            24550005
         CLC   EXPPREV,=XL4'FFFFFFFF'  SAVED PREVIOUS EXIT ?            24560005
         BE    RIXNPREV                NO, TOUCH NOTHING                24570005
*                                                                       24580005
         LR    R0,R4                   R0 -> NEW EXIT                   24590005
         L     R1,EXPPREV              R1 -> PREVIOUS EXIT              24600005
         CS    R0,R1,RCVTRIXP          UPDATE RCVT                      24610005
         BNZ   RIXNOCS                 ERROR, UPDATE                    24620005
*                                                                       24630005
*        EXIT REPLACEMENT SUCCESS                                       24640005
*                                                                       24650005
         MVC   EXPPREV,=XL4'FFFFFFFF'  CLEAR PREVOIUS POINTER           24660005
         L     R2,=A(MSG302I)                                           24670005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        24680005
         B     RIXOK                                                    24690005
*                                                                       24700005
*----------------------------------------------------------*            24710005
*  SET RETURN CODE AND FINISH                                           24720005
*----------------------------------------------------------*            24730005
*                                                                       24740005
RIXOK    DS    0H                                                       24750005
         XR    R15,R15                                                  24760005
         B     RIXEXIT                                                  24770005
RIXZOMBI DS    0H                                                       24780005
         OI    EXPFLAGS,EXPZOMBI                                        24790005
         L     R2,=A(MSG303W)                                           24800005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        24810005
         LA    R15,4                                                    24820005
         B     RIXEXIT                                                  24830005
RIXNOCVT DS    0H                                                       24840005
         LA    R15,8                                                    24850005
         B     RIXEXIT                                                  24860005
RIXWCVT  DS    0H                                                       24870005
         LA    R15,12                                                   24880005
         B     RIXEXIT                                                  24890005
RIXNOCS  DS    0H                                                       24900005
         LA    R15,16                                                   24910005
         B     RIXEXIT                                                  24920005
RIXEXP   DS    0H                                                       24930005
         LA    R15,20                                                   24940005
         B     RIXEXIT                                                  24950005
RIXNPREV DS    0H                                                       24960005
         LA    R15,24                                                   24970005
         B     RIXEXIT                                                  24980005
*                                                                       24990005
         DROP  R3,R5                                                    25000005
*                                                                       25010005
*----------------------------------------------------------*            25020005
*  RESET PSW AUTHORITY                                                  25030005
*----------------------------------------------------------*            25040005
*                                                                       25050005
RIXEXIT  DS    0H                                                       25060005
         LR    R5,R15                                                   25070005
         MODESET MODE=PROB,KEY=NZERO                                    25080005
         LR    R15,R5                                                   25090005
*                                                                       25100005
*----------------------------------------------------------*            25110005
*  RETURN TO CALLER                                                     25120005
*----------------------------------------------------------*            25130005
*                                                                       25140005
         BRTRN (15)                                                     25150005
         LTORG ,                                                        25160005
         DROP  ,                                                        25170005
*                                                                       25180005
****************************************************************        25190005
*                                                              *        25200005
*        ACTPWX01: ENABLE ROUTINE FOR ICHPWX01                 *        25210005
*                                                              *        25220005
****************************************************************        25230005
*                                                                       25240005
ACTPWX01 DS    0F                                                       25250005
*                                                                       25260005
*----------------------------------------------------------*            25270005
*  INITIALIZE                                                           25280005
*----------------------------------------------------------*            25290005
*                                                                       25300005
         BEGIN                                                          25310005
         L     R10,=A(COMMON)                                           25320005
         USING COMMON,R10                                               25330005
         L     R11,ADDRPARM                                             25340005
         USING PARM,R11                                                 25350005
*                                                                       25360005
         L     R4,0(R1)                R4 -> ADDR OF EXIT ROUTINE       25370005
         LR    R5,R4                   R5 -> EXIT ROUTINE               25380005
         S     R5,=A(EXPLEN)           R5 -> EXIT PREFIX AREA           25390005
         USING EXP,R5                                                   25400005
         CLC   @EXP,EXPID              IS IT A MODULE HEADER?           25410005
         BNE   PWXEXP                                                   25420005
*                                                                       25430005
         MODESET MODE=SUP,KEY=ZERO                                      25440005
*                                                                       25450005
*----------------------------------------------------------*            25460005
*  IF EXIT IN ZOMBI STATUS, JUST CLEAR THE ZOMBI FLAG                   25470005
*----------------------------------------------------------*            25480005
*                                                                       25490005
         TM    EXPFLAGS,EXPZOMBI       EXIT IN ZOMBI STATUS ?           25500005
         BNO   LOCPWX                  NO, REAL ACTIVATION NEEDED       25510005
         NI    EXPFLAGS,255-EXPZOMBI   YES, JUST CLEAR THE FLAG         25520005
         L     R2,=A(MSG300I)                                           25530005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        25540005
         B     PWXOK                   WE ARE OK                        25550005
*                                                                       25560005
*----------------------------------------------------------*            25570005
*  LOCATE RCVT                                                          25580005
*----------------------------------------------------------*            25590005
*                                                                       25600005
LOCPWX   DS    0H                                                       25610005
         L     R3,FLCCVT-PSA           R3 -> CVT                        25620005
         ICM   R3,15,CVTRAC-CVT(R3)    R3 -> RCVT                       25630005
         BZ    PWXNOCVT                NO, RACF NOT ACTIVE ERROR        25640005
         USING RCVT,R3                                                  25650005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X25660005
               '(ACTPWX01) RCVT AT ~',?R3                               25670005
         CLC   RCVTID,=CL4'RCVT'       REALLY RCVT ?                    25680005
         BNE   PWXWCVT                 NO, ERROR                        25690005
*                                                                       25700005
*----------------------------------------------------------*            25710005
*  ENABLE/DISABLE ACCORDING TO CALL TYPE                                25720005
*----------------------------------------------------------*            25730005
*                                                                       25740005
         CLI   FLAGENB,C'Y'                                             25750005
         BE    ENBPWXP                                                  25760005
         B     DISPWXP                                                  25770005
*                                                                       25780005
*----------------------------------------------------------*            25790005
*  ENABLE ICHPWX01                                                      25800005
*----------------------------------------------------------*            25810005
*                                                                       25820005
ENBPWXP  DS    0H                                                       25830005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X25840005
               '(ACTPWX01) ACTIVE EXIT AT ~, NEW EXIT AT ~',           X25850005
               (RCVTPWDX,?R4)                                           25860005
*                                                                       25870005
*        UPDATE RCVT POINTER TO ICHPWX01                                25880005
*                                                                       25890005
         C     R4,RCVTPWDX             IS OUR EXIT ALREADY ACTIVE ?     25900005
         BE    PWXOK                   YES, THEN NOTHING TO DO          25910005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     25920005
         BNE   PWXNPREV                YES, ERROR                       25930005
*                                                                       25940005
         XC    EXPUSECT,EXPUSECT       CLEAR USE COUNT BEFORE ENABLE    25950005
         L     R0,RCVTPWDX             R0 -> ACTIVE EXIT                25960005
         LR    R1,R4                   R1 -> NEW EXIT                   25970005
         ST    R0,EXPPREV              SAVE OLD EXIT IN EXP             25980005
         CS    R0,R1,RCVTPWDX          SWAP EXITS                       25990005
         BNZ   PWXERRP                 ERROR, ....                      26000005
         L     R2,=A(MSG301I)                                           26010005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        26020005
         B     PWXOK                   FINISHED                         26030005
*                                                                       26040005
*        ERROR - REPLACEMENT OF EXIT POINTER HAS FAILED                 26050005
*                                                                       26060005
PWXERRP  DS    0H                                                       26070005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   26080005
         B     PWXNOCS                                                  26090005
*                                                                       26100005
*----------------------------------------------------------*            26110005
*  DISABLE ICHPWX01                                                     26120005
*----------------------------------------------------------*            26130005
*                                                                       26140005
DISPWXP  DS    0H                                                       26150005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X26160005
               '(ACTPWX01) ACTIVE AT ~, OUR EXIT AT ~, PREVIOUS AT ~', X26170005
               (RCVTPWDX,?R4,EXPPREV)                                   26180005
*                                                                       26190005
*        UPDATE RCVT POINTER                                            26200005
*                                                                       26210005
         C     R4,RCVTPWDX             OUR EXIT THE ACTIVE ONE ?        26220005
         BNE   PWXZOMBI                NO, TURN INTO A ZOMBI            26230005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     26240005
         BE    PWXNPREV                NO,ERROR                         26250005
         LR    R0,R4                   R0 -> ACTIVE EXIT                26260005
         L     R1,EXPPREV              R1 -> OLD EXIT                   26270005
         CS    R0,R1,RCVTPWDX          SWAP POINTERS                    26280005
         BNZ   PWXNOCS                 ERROR ....                       26290005
*                                                                       26300005
*        EXIT REPLACEMENT SUCCESS                                       26310005
*                                                                       26320005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   26330005
         L     R2,=A(MSG302I)                                           26340005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        26350005
         B     PWXOK                                                    26360005
*                                                                       26370005
*----------------------------------------------------------*            26380005
*  SET RETURN CODE AND ERROR MESSAGES                                   26390005
*----------------------------------------------------------*            26400005
*                                                                       26410005
PWXOK    DS    0H                                                       26420005
         XR    R15,R15                                                  26430005
         B     PWXEXIT                                                  26440005
PWXZOMBI DS    0H                                                       26450005
         OI    EXPFLAGS,EXPZOMBI                                        26460005
         L     R2,=A(MSG303W)                                           26470005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        26480005
         LA    R15,4                                                    26490005
         B     PWXEXIT                                                  26500005
PWXNOCVT DS    0H                                                       26510005
         LA    R15,8                                                    26520005
         B     PWXEXIT                                                  26530005
PWXWCVT  DS    0H                                                       26540005
         LA    R15,12                                                   26550005
         B     PWXEXIT                                                  26560005
PWXNOCS  DS    0H                                                       26570005
         LA    R15,16                                                   26580005
         B     PWXEXIT                                                  26590005
PWXEXP   DS    0H                                                       26600005
         LA    R15,20                                                   26610005
         B     PWXEXIT                                                  26620005
PWXNPREV DS    0H                                                       26630005
         LA    R15,24                                                   26640005
         B     PWXEXIT                                                  26650005
         DROP  R3,R5                                                    26660005
*                                                                       26670005
*----------------------------------------------------------*            26680005
*  RESET PSW AUTHORITY                                                  26690005
*----------------------------------------------------------*            26700005
*                                                                       26710005
PWXEXIT  DS    0H                                                       26720005
         LR    R5,R15                                                   26730005
         MODESET MODE=PROB,KEY=NZERO                                    26740005
         LR    R15,R5                                                   26750005
*                                                                       26760005
*----------------------------------------------------------*            26770005
*  RETURN TO CALLER                                                     26780005
*----------------------------------------------------------*            26790005
*                                                                       26800005
         BRTRN (15)                                                     26810005
         LTORG ,                                                        26820005
         DROP  ,                                                        26830005
*        WS10064 START                                                  26840005
****************************************************************        26850005
*                                                              *        26860005
*        ACTPWX11: ENABLE ROUTINE FOR ICHPWX11                 *        26870005
*                                                              *        26880005
****************************************************************        26890005
ACTPWX11 DS    0F                                                       26900005
*                                                                       26910005
*----------------------------------------------------------*            26920005
*  INITIALIZE                                                           26930005
*----------------------------------------------------------*            26940005
*                                                                       26950005
         BEGIN                                                          26960005
         L     R10,=A(COMMON)                                           26970005
         USING COMMON,R10                                               26980005
         L     R11,ADDRPARM                                             26990005
         USING PARM,R11                                                 27000005
*                                                                       27010005
         L     R4,0(R1)                R4 -> ADDR OF EXIT ROUTINE       27020005
         LR    R5,R4                   R5 -> EXIT ROUTINE               27030005
         S     R5,=A(EXPLEN)           R5 -> EXIT PREFIX AREA           27040005
         USING EXP,R5                                                   27050005
         CLC   @EXP,EXPID              IS IT A MODULE HEADER?           27060005
         BNE   P11EXP                                                   27070005
*                                                                       27080005
         MODESET MODE=SUP,KEY=ZERO                                      27090005
*                                                                       27100005
*----------------------------------------------------------*            27110005
*  IF EXIT IN ZOMBI STATUS, JUST CLEAR THE ZOMBI FLAG                   27120005
*----------------------------------------------------------*            27130005
*                                                                       27140005
         TM    EXPFLAGS,EXPZOMBI       EXIT IN ZOMBI STATUS ?           27150005
         BNO   LOCP11                  NO, REAL ACTIVATION NEEDED       27160005
         NI    EXPFLAGS,255-EXPZOMBI   YES, JUST CLEAR THE FLAG         27170005
         L     R2,=A(MSG300I)                                           27180005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        27190005
         B     P11OK                   WE ARE OK                        27200005
*                                                                       27210005
*----------------------------------------------------------*            27220005
*  LOCATE RCVT                                                          27230005
*----------------------------------------------------------*            27240005
*                                                                       27250005
LOCP11   DS    0H                                                       27260005
         L     R3,FLCCVT-PSA           R3 -> CVT                        27270005
         ICM   R3,15,CVTRAC-CVT(R3)    R3 -> RCVT                       27280005
         BZ    P11NOCVT                NO, RACF NOT ACTIVE ERROR        27290005
         USING RCVT,R3                                                  27300005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X27310005
               '(ACTPWX11) RCVT AT ~',?R3                               27320005
         CLC   RCVTID,=CL4'RCVT'       REALLY RCVT ?                    27330005
         BNE   P11WCVT                 NO, ERROR                        27340005
*                                                                       27350005
*----------------------------------------------------------*            27360005
*  ENABLE/DISABLE ACCORDING TO CALL TYPE                                27370005
*----------------------------------------------------------*            27380005
*                                                                       27390005
         CLI   FLAGENB,C'Y'                                             27400005
         BE    ENBP11P                                                  27410005
         B     DISP11P                                                  27420005
*                                                                       27430005
*----------------------------------------------------------*            27440005
*  ENABLE ICHPWX11                                                      27450005
*----------------------------------------------------------*            27460005
*                                                                       27470005
ENBP11P  DS    0H                                                       27480005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X27490005
               '(ACTPWX11) ACTIVE EXIT AT ~, NEW EXIT AT ~',           X27500005
               (RCVTPHRX,?R4)                                           27510005
*                                                                       27520005
*        UPDATE RCVT POINTER TO ICHPWX11                                27530005
*                                                                       27540005
         C     R4,RCVTPHRX             IS OUR EXIT ALREADY ACTIVE ?     27550005
         BE    P11OK                   YES, THEN NOTHING TO DO          27560005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     27570005
         BNE   P11NPREV                YES, ERROR                       27580005
*                                                                       27590005
         XC    EXPUSECT,EXPUSECT       CLEAR USE COUNT BEFORE ENABLE    27600005
         L     R0,RCVTPHRX             R0 -> ACTIVE EXIT                27610005
         LR    R1,R4                   R1 -> NEW EXIT                   27620005
         ST    R0,EXPPREV              SAVE OLD EXIT IN EXP             27630005
         CS    R0,R1,RCVTPHRX          SWAP EXITS                       27640005
         BNZ   P11ERRP                 ERROR, ....                      27650005
         L     R2,=A(MSG301I)                                           27660005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        27670005
         B     P11OK                   FINISHED                         27680005
*                                                                       27690005
*        ERROR - REPLACEMENT OF EXIT POINTER HAS FAILED                 27700005
*                                                                       27710005
P11ERRP  DS    0H                                                       27720005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   27730005
         B     P11NOCS                                                  27740005
*                                                                       27750005
*----------------------------------------------------------*            27760005
*  DISABLE ICHPWX11                                                     27770005
*----------------------------------------------------------*            27780005
*                                                                       27790005
DISP11P  DS    0H                                                       27800005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X27810005
               '(ACTPWX11) ACTIVE AT ~, OUR EXIT AT ~, PREVIOUS AT ~', X27820005
               (RCVTPHRX,?R4,EXPPREV)                                   27830005
*                                                                       27840005
*        UPDATE RCVT POINTER                                            27850005
*                                                                       27860005
         C     R4,RCVTPHRX             OUR EXIT THE ACTIVE ONE ?        27870005
         BNE   P11ZOMBI                NO, TURN INTO A ZOMBI            27880005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     27890005
         BE    P11NPREV                NO,ERROR                         27900005
         LR    R0,R4                   R0 -> ACTIVE EXIT                27910005
         L     R1,EXPPREV              R1 -> OLD EXIT                   27920005
         CS    R0,R1,RCVTPHRX          SWAP POINTERS                    27930005
         BNZ   P11NOCS                 ERROR ....                       27940005
*                                                                       27950005
*        EXIT REPLACEMENT SUCCESS                                       27960005
*                                                                       27970005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   27980005
         L     R2,=A(MSG302I)                                           27990005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        28000005
         B     P11OK                                                    28010005
*                                                                       28020005
*----------------------------------------------------------*            28030005
*  SET RETURN CODE AND ERROR MESSAGES                                   28040005
*----------------------------------------------------------*            28050005
*                                                                       28060005
P11OK    DS    0H                                                       28070005
         XR    R15,R15                                                  28080005
         B     P11EXIT                                                  28090005
P11ZOMBI DS    0H                                                       28100005
         OI    EXPFLAGS,EXPZOMBI                                        28110005
         L     R2,=A(MSG303W)                                           28120005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        28130005
         LA    R15,4                                                    28140005
         B     P11EXIT                                                  28150005
P11NOCVT DS    0H                                                       28160005
         LA    R15,8                                                    28170005
         B     P11EXIT                                                  28180005
P11WCVT  DS    0H                                                       28190005
         LA    R15,12                                                   28200005
         B     P11EXIT                                                  28210005
P11NOCS  DS    0H                                                       28220005
         LA    R15,16                                                   28230005
         B     P11EXIT                                                  28240005
P11EXP   DS    0H                                                       28250005
         LA    R15,20                                                   28260005
         B     P11EXIT                                                  28270005
P11NPREV DS    0H                                                       28280005
         LA    R15,24                                                   28290005
         B     P11EXIT                                                  28300005
         DROP  R3,R5                                                    28310005
*                                                                       28320005
*----------------------------------------------------------*            28330005
*  RESET PSW AUTHORITY                                                  28340005
*----------------------------------------------------------*            28350005
*                                                                       28360005
P11EXIT  DS    0H                                                       28370005
         LR    R5,R15                                                   28380005
         MODESET MODE=PROB,KEY=NZERO                                    28390005
         LR    R15,R5                                                   28400005
*                                                                       28410005
*----------------------------------------------------------*            28420005
*  RETURN TO CALLER                                                     28430005
*----------------------------------------------------------*            28440005
*                                                                       28450005
         BRTRN (15)                                                     28460005
         LTORG ,                                                        28470005
         DROP  ,                                                        28480005
*        WS10064 END                                                    28490005
*                                                                       28500005
*                                                                       28510005
*                                                                       28520005
****************************************************************        28530005
*                                                              *        28540005
*        ACTNPXIT: ENABLE ROUTINE FOR ACFNPXIT                 *        28550005
*                                                              *        28560005
****************************************************************        28570005
*                                                                       28580005
ACTNPXIT DS    0F                                                       28590005
*                                                                       28600005
*----------------------------------------------------------*            28610005
*  INITIALIZE                                                           28620005
*----------------------------------------------------------*            28630005
*                                                                       28640005
         BEGIN                                                          28650005
         L     R10,=A(COMMON)                                           28660005
         USING COMMON,R10                                               28670005
         L     R11,ADDRPARM                                             28680005
         USING PARM,R11                                                 28690005
*                                                                       28700005
         L     R4,0(R1)                R4 -> ADDR OF EXIT ROUTINE       28710005
         LR    R5,R4                   R5 -> EXIT ROUTINE               28720005
         S     R5,=A(EXPLEN)           R5 -> EXIT PREFIX AREA           28730005
         USING EXP,R5                                                   28740005
         CLC   @EXP,EXPID              IS IT A MODULE HEADER?           28750005
         BNE   NPXEXP                                                   28760005
*                                                                       28770005
         MODESET MODE=SUP,KEY=ZERO                                      28780005
*                                                                       28790005
*----------------------------------------------------------*            28800005
*  IF EXIT IN ZOMBI STATUS, JUST CLEAR THE ZOMBI FLAG                   28810005
*----------------------------------------------------------*            28820005
*                                                                       28830005
         TM    EXPFLAGS,EXPZOMBI       EXIT IN ZOMBI STATUS ?           28840005
         BNO   LOCNPX                  NO, REAL ACTIVATION NEEDED       28850005
         NI    EXPFLAGS,255-EXPZOMBI   YES, JUST CLEAR THE FLAG         28860005
         L     R2,=A(MSG300I)                                           28870005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        28880005
         B     NPXOK                   WE ARE OK                        28890005
*                                                                       28900005
*----------------------------------------------------------*            28910005
*  LOCATE ACCVT                                                         28920005
*----------------------------------------------------------*            28930005
*                                                                       28940005
LOCNPX   DS    0H                                                       28950005
         ACFINCVT R3,NONE=NPXNOCVT                                      28960005
         USING ACCVT,R3                                                 28970005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X28980005
               '(ACTNPX01) ACCVT AT ~',?R3                              28990005
*                                                                       29000005
*----------------------------------------------------------*            29010005
*  ENABLE/DISABLE ACCORDING TO CALL TYPE                                29020005
*----------------------------------------------------------*            29030005
*                                                                       29040005
         L     R6,PARMEXIT                                      WS10064 29050005
         CLI   FLAGENB,C'Y'                                             29060005
         BE    ENBNPXP                                                  29070005
         B     DISNPXP                                                  29080005
*                                                                       29090005
*----------------------------------------------------------*            29100005
*  ENABLE ACFNPXIT                                                      29110005
*----------------------------------------------------------*            29120005
*                                                                       29130005
ENBNPXP  DS    0H                                                       29140005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X29150005
               '(ACTNPX01) ACTIVE EXIT AT ~, NEW EXIT AT ~, NAME=_',   X29160005
               (ACCNPXIT,?R4,0(R6),8)                           WS10064 29170005
*WS10064       (ACCNPXIT,?R4)                                           29180005
*                                                                       29190005
*        UPDATE ACCVT POINTER TO ACFNPXIT                               29200005
*                                                                       29210005
         LA    R7,ACCNPXIT             ASSUME PSWD XT TO ENABLE WS10064 29220005
         LARL  R1,NHXIT                POINT TO PASSPHRASE ENT  WS10064 29230005
         CLC   0(8,R1),0(R6)           IS IT PASSPHRASE EXIT?   WS10064 29240005
         BNE   *+8                     NO, SKIP                 WS10064 29250005
         LA    R7,ACC_PWPEXIT          TAKE PASSPHRASE ENT ADDR WS10064 29260005
*WS10064 C     R4,ACCNPXIT             IS OUR EXIT ALREADY ACTIVE 4     29270005
         C     R4,0(0,R7)              IS OUR EXIT ALREADY ACT  WS10064 29280005
         BE    NPXOK                   YES, THEN NOTHING TO DO          29290005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     29300005
         BNE   NPXNPREV                YES, ERROR                       29310005
*                                                                       29320005
         XC    EXPUSECT,EXPUSECT       CLEAR USE COUNT BEFORE ENABLE    29330005
*WS10064 L     R0,ACCNPXIT             R0 -> ACTIVE EXIT                29340005
         L     R0,0(0,R7)              R0 -> ACTIVE EXIT        WS10064 29350005
         LR    R1,R4                   R1 -> NEW EXIT                   29360005
         ST    R0,EXPPREV              SAVE OLD EXIT IN EXP             29370005
*WS10064 CS    R0,R1,ACCNPXIT          SWAP EXITS                       29380005
         CS    R0,R1,0(R7)             SWAP EXITS               WS10064 29390005
         BNZ   NPXERRP                 ERROR, ....                      29400005
         L     R2,=A(MSG301I)                                           29410005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        29420005
         B     NPXOK                   FINISHED                         29430005
*                                                                       29440005
*        ERROR - REPLACEMENT OF EXIT POINTER HAS FAILED                 29450005
*                                                                       29460005
NPXERRP  DS    0H                                                       29470005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   29480005
         B     NPXNOCS                                                  29490005
*                                                                       29500005
*----------------------------------------------------------*            29510005
*  DISABLE ACFNPXIT                                                     29520005
*----------------------------------------------------------*            29530005
*                                                                       29540005
DISNPXP  DS    0H                                                       29550005
         CTSADBG LEVEL=(DBGLEVEL,1),                                   X29560005
               '(ACTNPX01) ACTIVE AT ~, OUR EXIT AT ~, PREVIOUS AT ~', X29570005
               (ACCNPXIT,?R4,EXPPREV)                                   29580005
*                                                                       29590005
*        UPDATE ACCVT POINTER                                           29600005
*                                                                       29610005
         LA    R7,ACCNPXIT             ASSUME PSWD XT TO ENABLE WS10064 29620005
         LARL  R1,NHXIT                POINT TO PASSPHRASE ENT  WS10064 29630005
         CLC   0(8,R1),0(R6)           IS IT PASSPHRASE EXIT?   WS10064 29640005
         BNE   *+8                     NO, SKIP                 WS10064 29650005
         LA    R7,ACC_PWPEXIT          TAKE PASSPHRASE ENT ADDR WS10064 29660005
*WS10064 C     R4,ACCNPXIT             IS OUR EXIT ALREADY ACTIVE 4     29670005
         C     R4,0(0,R7)              IS OUR EXIT ALREADY ACT  WS10064 29680005
         BE    DISNPXP1                YES, DISCONNECT                  29690005
*WS10064 CLC   EXPPREV,ACCNPXIT        IS THE PREVIOUS ONE ACTIVE ?     29700005
         CLC   EXPPREV,0(R7)           IS THE PREVIOUS ONE ACTIVE ?     29710005
         BNE   NPXZOMBI                NO, TURN INTO A ZOMBI            29720005
         B     DISNPXP2                YES, ALREADY DISCONNECTED !      29730005
DISNPXP1 DS    0H                                                       29740005
         CLC   EXPPREV,=XL4'FFFFFFFF'  DO WE HAVE A PREVIOUS EXIT ?     29750005
         BE    NPXNPREV                NO, NO NEED TO RESTORE           29760005
         LR    R0,R4                   R0 -> ACTIVE EXIT                29770005
         L     R1,EXPPREV              R1 -> OLD EXIT                   29780005
*WS10064 CS    R0,R1,ACCNPXIT          SWAP POINTERS                    29790005
         CS    R0,R1,0(R7)             SWAP POINTERS                    29800005
         BNZ   NPXNOCS                 ERROR ....                       29810005
DISNPXP2 DS    0H                                                       29820005
*                                                                       29830005
*        EXIT REPLACEMENT SUCCESS                                       29840005
*                                                                       29850005
         MVC   EXPPREV,=XL4'FFFFFFFF'                                   29860005
         L     R2,=A(MSG302I)                                           29870005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        29880005
         B     NPXOK                                                    29890005
*                                                                       29900005
*----------------------------------------------------------*            29910005
*  SET RETURN CODE AND ERROR MESSAGES                                   29920005
*----------------------------------------------------------*            29930005
*                                                                       29940005
NPXOK    DS    0H                                                       29950005
         XR    R15,R15                                                  29960005
         B     NPXEXIT                                                  29970005
NPXZOMBI DS    0H                                                       29980005
         OI    EXPFLAGS,EXPZOMBI                                        29990005
         L     R2,=A(MSG303W)                                           30000005
         CTSCALL MSGSDX,((R2),EXITNAME),LINK=INT                        30010005
         LA    R15,4                                                    30020005
         B     NPXEXIT                                                  30030005
NPXNOCVT DS    0H                                                       30040005
         LA    R15,8                                                    30050005
         B     NPXEXIT                                                  30060005
NPXWCVT  DS    0H                                                       30070005
         LA    R15,12                                                   30080005
         B     NPXEXIT                                                  30090005
NPXNOCS  DS    0H                                                       30100005
         LA    R15,16                                                   30110005
         B     NPXEXIT                                                  30120005
NPXEXP   DS    0H                                                       30130005
         LA    R15,20                                                   30140005
         B     NPXEXIT                                                  30150005
NPXNPREV DS    0H                                                       30160005
         LA    R15,24                                                   30170005
         B     NPXEXIT                                                  30180005
         DROP  R3,R5                                                    30190005
*                                                                       30200005
*----------------------------------------------------------*            30210005
*  RESET PSW AUTHORITY                                                  30220005
*----------------------------------------------------------*            30230005
*                                                                       30240005
NPXEXIT  DS    0H                                                       30250005
         LR    R5,R15                                                   30260005
         MODESET MODE=PROB,KEY=NZERO                                    30270005
         LR    R15,R5                                                   30280005
*                                                                       30290005
*----------------------------------------------------------*            30300005
*  RETURN TO CALLER                                                     30310005
*----------------------------------------------------------*            30320005
*                                                                       30330005
         BRTRN (15)                                                     30340005
         LTORG ,                                                        30350005
         DROP  ,                                                        30360005
*                                                                       30370005
****************************************************************        30380005
*                                                              *        30390005
*        ISSUE MESSAGE ROUTINE                                 *        30400005
*                                                              *        30410005
****************************************************************        30420005
*                                                                       30430005
MSGSDX   DS      0F                                                     30440005
*                                                                       30450005
*----------------------------------------------------------*            30460005
*  INITIALIZE                                                           30470005
*----------------------------------------------------------*            30480005
*                                                                       30490005
         BEGIN                                                          30500005
         L     R10,=A(COMMON)                                           30510005
         USING COMMON,R10                                               30520005
         L     R11,ADDRPARM                                             30530005
         USING PARM,R11                                                 30540005
         L     R15,0(R1)               R4 -> ADDR OF EXIT ROUTINE       30550005
         BR    R15                                                      30560005
*                                                                       30570005
*----------------------------------------------------------*            30580005
*  MESSAGES                                                             30590005
*----------------------------------------------------------*            30600005
*                                                                       30610005
MSG300I  DS    0H                                                       30620005
         L     R2,4(R1)                                                 30630005
         CTSMSG1 CODE=CTS300I,ROUT=WTO,                                X30640005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            30650005
         B     MSGRTN                                                   30660005
*                                                                       30670005
MSG301I  DS    0H                                                       30680005
         L     R2,4(R1)                                                 30690005
         CTSMSG1 CODE=CTS301I,ROUT=WTO,                                X30700005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            30710005
         B     MSGRTN                                                   30720005
*                                                                       30730005
MSG302I  DS    0H                                                       30740005
         L     R2,4(R1)                                                 30750005
         CTSMSG1 CODE=CTS302I,ROUT=WTO,                                X30760005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            30770005
         B     MSGRTN                                                   30780005
*                                                                       30790005
MSG303W  DS    0H                                                       30800005
         L     R2,4(R1)                                                 30810005
         CTSMSG1 CODE=CTS303W,ROUT=WTO,                                X30820005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            30830005
         B     MSGRTN                                                   30840005
*                                                                       30850005
MSG304E  DS    0H                                                       30860005
         L     R2,4(R1)                                                 30870005
         CTSMSG1 CODE=CTS304E,ROUT=WTO,                                X30880005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            30890005
         B     MSGRTN                                                   30900005
*                                                                       30910005
MSG305I  DS    0H                                                       30920005
         LM    R2,R3,4(R1)                                              30930005
         CTSMSG1 CODE=CTS305I,ROUT=WTO,                                X30940005
               PLANT=(8,0(R2),4,0(R3)),RAREA=WTOAREA                    30950005
         B     MSGRTN                                                   30960005
*                                                                       30970005
MSG306I  DS    0H                                                       30980005
         LM    R2,R3,4(R1)                                              30990005
         CTSMSG1 CODE=CTS306I,ROUT=WTO,                                X31000005
               PLANT=(8,0(R2),4,0(R3)),RAREA=WTOAREA                    31010005
         B     MSGRTN                                                   31020005
*                                                                       31030005
MSG307I  DS    0H                                                       31040005
         L     R2,4(R1)                                                 31050005
         CTSMSG1 CODE=CTS307I,ROUT=WTO,                                X31060005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            31070005
         B     MSGRTN                                                   31080005
*                                                                       31090005
MSG308I  DS    0H                                                       31100005
         L     R2,4(R1)                                                 31110005
         CTSMSG1 CODE=CTS308I,ROUT=WTO,                                X31120005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            31130005
         B     MSGRTN                                                   31140005
*                                                                       31150005
MSG309W  DS    0H                                                       31160005
         CTSMSG1 CODE=CTS309W,ROUT=WTO,                                X31170005
               RAREA=WTOAREA                                            31180005
         B     MSGRTN                                                   31190005
*                                                                       31200005
MSG310W  DS    0H                                                       31210005
         L     R2,4(R1)                                                 31220005
         CTSMSG1 CODE=CTS310W,ROUT=WTO,                                X31230005
               PLANT=(8,0(R2)),RAREA=WTOAREA                            31240005
         B     MSGRTN                                                   31250005
MSG311W  DS    0H                                               *CTS2   31260005
         CTSMSG1 CODE=CTS311W,ROUT=WTO,                         *CTS2  X31270005
               RAREA=WTOAREA                                    *CTS2   31280005
         B     MSGRTN                                           *CTS2   31290005
*                                                                       31300005
*----------------------------------------------------------*            31310005
*  RETURN TO CALLER                                                     31320005
*----------------------------------------------------------*            31330005
*                                                                       31340005
MSGRTN   DS    0H                                                       31350005
         BRTRN 0                                                        31360005
         LTORG ,                                                        31370005
         DROP  ,                                                        31380005
*                                                                       31390005
****************************************************************        31400005
*                                                              *        31410005
*        COMMON DATA AREA                                      *        31420005
*                                                              *        31430005
****************************************************************        31440005
*                                                                       31450005
         DS    4096X                                                    31460005
COMMON   DS    0D                                                       31470005
*                                                                       31480005
STEPLIB  DCB   DDNAME=STEPLIB,DSORG=PO,MACRF=R                          31490005
STEPLIBL EQU   *-STEPLIB                                       IS10188  31500005
DCBAID   DC    CL8'SDXDCB'                                     IS10188  31510005
DCBALEN  EQU   STEPLIBL+L'DCBAID                               IS10188  31520005
DCBAAD   DC    A(0)                                            IS10188  31530005
MODESUP  DC    X'00'                                           IS10188  31540005
*                                                                       31550005
AMODE    DC    F'0'                                                     31560005
DBGLEVEL DC    FL1'1'                                                   31570005
JOBNAME  DC    CL8' '                                                   31580005
RC       DC    F'0'                                                     31590005
REASON   DC    F'0'                                                     31600005
FLAGAUTH DC    C'N'                                                     31610005
FLAGENB  DC    CL1' '                                                   31620005
@EXP     DC    CL4'CSAX'                                                31630005
SMFSUB   DC    CL4' '                                                   31640005
*                                                                       31650005
*        TEMPORARY WORK AREA                                            31660005
*                                                                       31670005
EXITADDR DC    A(0)                                                     31680005
EXITLEN  DC    F'0'                                                     31690005
EXITNAME DC    CL8' '                                                   31700005
EXPADDR  DC    A(0)                                            IS10188  31710005
ADDRPARM DC    A(0)                                                     31720005
*SAS2IBMN ADDRSSCT DC    A(0)                                           31730005
*SAS2IBMN ADDRSSVT DC    A(0)                                           31740005
ADDRXMMH DC    A(0)                                                     31750005
ADDRXSH  DC    A(0)                                                     31760005
ADDRXST  DC    A(0)                                                     31770005
*                                                                       31780005
*IS10188 ADDRSMCA DC    A(0)                                            31790005
ADDRSSTP DC    A(0)                                                     31800005
NUMSST   DC    F'0'                                                     31810005
SIZESST  DC    F'0'                                                     31820005
*----------------------------------------------------------*            31830005
*        TOKEN PARAMETERS                                               31840005
*----------------------------------------------------------*            31850005
CTSAINST DC    CL16'BMC_EE_CTSA_TOK      '                       WS2356 31860005
*                                                                WS2356 31870005
ICB_PTR  DS    AL4                   INSTALLATION CB TOKEN       WS2356 31880005
         DS    3F                                                WS2356 31890005
*                                                                WS2356 31900005
ICB_RC   DS    F                                                 WS2356 31910005
*----------------------------------------------------------*            31920005
*        CTSMSG1 WORKAREA                                               31930005
*----------------------------------------------------------*            31940005
*                                                                       31950005
MSGAREA  DS    XL256                                                    31960005
WTOAREA  DS    XL256                                                    31970005
*                                                                       31980005
*----------------------------------------------------------*            31990005
*        LOCK/UNLOCK FUNCTIONS                                          32000005
*----------------------------------------------------------*            32010005
*                                                                       32020005
@RNAME   DC    CL44'CTSA'                                               32030005
QNAME    DC    CL8'CTSASDX'                                             32040005
RNAME    DC    CL44' '                                                  32050005
FLAGLOCK DC    C'Y'                                                     32060005
*                                                                       32070005
*----------------------------------------------------------*            32080005
*        SUPPORTED EXITS TABLES                                         32090005
*----------------------------------------------------------*            32100005
*                                                                       32110005
EXITS    DS    0F                                                       32120005
*IS10188 U83RACF  DC    CL8'CTSFU83 ',CL8'IEFU83  ',AL4(ACTU83)         32130005
PWX01    DC    CL8'CTSFPWX ',CL8'ICHPWX01',AL4(ACTPWX01)                32140005
RIX02    DC    CL8'CTSFRIX ',CL8'ICHRIX02',AL4(ACTRIX02)                32150005
NPXIT    DC    CL8'CTS2NPX ',CL8'ACFNPXIT',AL4(ACTNPXIT)    @DC         32160005
NHXIT    DC    CL8'CTS2NPH ',CL8'NPWPEXIT',AL4(ACTNPXIT)    WS10064     32170005
*IS10188 U83ACF2  DC CL8'CTS2U83 ',CL8'IEFU83  ',AL4(ACTU83)  @DC       32180005
PWX11    DC    CL8'CTSFPPX  ',CL8'ICHPWX11',AL4(ACTPWX11)   WS10064     32190005
EXITS#   EQU   (*-EXITS)/EXLEN                                          32200005
*                                                                       32210005
*                                                                       32220005
****************************************************************        32230005
*                                                                       32240005
*        EXIT ENTRY                                                     32250005
*                                                                       32260005
****************************************************************        32270005
*                                                                       32280005
EXENTRY  DSECT                                                          32290005
EXLMOD   DS    CL8                                                      32300005
EXNAME   DS    CL8                                                      32310005
EXFUNC   DS    AL4                                                      32320005
EXLEN    EQU   *-EXENTRY                                                32330005
*                                                                       32340005
****************************************************************        32350005
*                                                                       32360005
*        PARAMETER LIST                                                 32370005
*                                                                       32380005
****************************************************************        32390005
*                                                                       32400005
PARM     DSECT                                                          32410005
PARMFUNC DS    A                                                        32420005
PARMSSN  DS    A                                                        32430005
PARMJBN  DS    A                                                        32440005
PARMEXIT DS    A                                                        32450005
PARMDBG  DS    A                                                        32460005
PARMRC   DS    A                                                        32470005
PARMRS   DS    A                                                        32480005
*                                                                       32490005
****************************************************************        32500005
*                                                                       32510005
*        SMF SUBSYSTEM EXIT TABLE                                       32520005
*                                                                       32530005
****************************************************************        32540005
*                                                                       32550005
SEXT     DSECT                                                          32560005
*                                                                       32570005
SEXTRSV  DS    HL2                                                      32580005
SEXTSIZE DS    HL2                                                      32590005
SEXTCNT  DS    FL4                                                      32600005
*                                                                       32610005
SEXTENTY EQU   *                                                        32620005
SEXTNAME DS    CL8                                                      32630005
SEXTFLAG DS    XL4                                                      32640005
SEXTADDR DS    AL4                                                      32650005
SEXTELEN EQU   *-SEXTENTY                                               32660005
*                                                                       32670005
*                                                                       32680005
****************************************************************        32690005
*                                                                       32700005
*        CONTROL-SA CONTROL BLOCKS                                      32710005
*                                                                       32720005
****************************************************************        32730005
*                                                                       32740005
EXP      DSECT                                                          32750005
         COPY  CTSAEXP                                                  32760005
*                                                                       32770005
XSH      DSECT                                                          32780005
         COPY CTSAXMM                                                   32790005
*                                                                       32800005
XSH      DSECT                                                          32810005
         COPY CTSAXSH                                                   32820005
*                                                                       32830005
XST      DSECT                                                          32840005
         COPY CTSAXST                                                   32850005
*                                                                       32860005
****************************************************************        32870005
*                                                                       32880005
*        ACF2 CONTROL BLOCKS                                            32890005
*                                                                       32900005
****************************************************************        32910005
*                                                                       32920005
         ACCVT                                                 @DC      32930005
*                                                                       32940005
****************************************************************        32950005
*                                                                       32960005
*        MVS CONTROL BLOCKS                                             32970005
*                                                                       32980005
****************************************************************        32990005
*                                                                       33000005
         ICHPRCVT                                                       33010005
ENDRCVT  EQU   *                                                        33020005
*                                                                       33030005
         PRINT NOGEN                                                    33040005
         DCBD  DSORG=PS                                                 33050005
*                                                                       33060005
*WS10047 TIOT  DSECT                                                    33070005
*WS10047 IEFTIOT1                                                       33080005
*                                                                       33090005
         IHAPSA                                                         33100005
*                                                                       33110005
CVT      CVT   DSECT=YES,PREFIX=YES,LIST=YES                            33120005
*                                                                       33130005
*IS10188 IEESMCA                                                        33140005
*                                                                       33150005
         IKJTCB                                                         33160005
*                                                                       33170005
         IEZJSCB ,                                             WS10047  33180005
*                                                                       33190005
CSCB     DSECT                                                 WS10047  33200005
         IEECHAIN ,                                            WS10047  33210005
*                                                                       33220005
*SAS1IBMN IEFJSCVT                                                      33230005
*SAS1IBMN IEFJESCT                                                      33240005
*SAS1IBMN IEFJSSVT                   SSVT                               33250005
*SAS1IBMN ORG   SSVTFRTN+256                                            33260005
*SAS1IBMN COPY  CTSSUSE                                                 33270005
ICB      DSECT                                                   WS2356 33280005
         COPY  CTSICB                                            WS2356 33290005
**                                                                      33300005
         END                                                            33310005
