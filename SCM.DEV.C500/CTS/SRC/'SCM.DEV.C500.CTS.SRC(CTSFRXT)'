         TITLE 'WORK WITH RACF DATABASE USING MACRO LEVEL ACCESS '      00010000
*                                                                       00020000
****************************************************************        00030000
****                                                        ****        00040000
****     CONTROL-SA  RELEASE 1.3.0                          ****        00050000
****                                                        ****        00060000
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00070000
****                                                        ****        00080000
****************************************************************        00090000
*                                                                       00100000
****************************************************************        00110000
*                                                              *        00120000
* TITLE            : CTSFRXT ("THE EXTRACTOR")                 *        00130000
*                                                              *        00140000
* FILE NAME        : CTSFRXT                                   *        00150000
*                                                              *        00160000
* AUTHOR           : ALEX SHVARTSMAN                           *        00170000
*                                                              *        00180000
* CREATION DATE    : 15/02/94                                  *        00190000
*                                                              *        00200000
* DESCRIPTION      : ACCESS RACF DATA BASE VIA ICHEINTY MACRO. *        00210000
*                    EXTRACT INFO FROM RACF RETURN AREA.       *        00220000
*                                                              *        00230000
* NOTE : THIS PROGRAM IS CALLED BY THE CTSFAGR MACRO.          *        00240000
*        SEE DOCS OF THIS MACRO ALSO.                          *        00250000
*                                                              *        00260000
* IMPORTANT !!! THIS PGM IS HIGHLY DEPENDENT ON ICHEINTY AND   *        00270000
* ICHEACTN OPERATION AND RETURN AREAS. SEE DOCS IN :           *        00280000
* "RESOURCE ACCESS CONTROL FACILITY", MACROS AND INTERFACES    *        00290000
*                                                              *        00300000
* 1. STRUCTURE OF INPUT FIELD PARAMETER LIST :                 *        00310000
* ------------------------------------------                   *        00320000
*   FOR EACH REQUESTED FIELD :                                 *        00330000
*                     DC   CL8'RACF-FIELD-NAME'                *        00340000
*                     DC   CL1'RULE'     - E - ELEMENTARY DATA *        00350000
*                                          L - LIST DATA       *        00360000
*                     DC   AL4(ADDR.TEXT PARAM.LIST)           *        00370000
*                     .....                                    *        00380000
*                     DC   CL8'********'   - END-OF-LIST       *        00390000
*                                                              *        00400000
*   ADDR.TEXT PARAM.LIST :                                     *        00410000
*                     DC   AL1(LENGTH-TEXT-BEFORE-DATA)        *        00420000
*                     DC   CL...'TEXT-BEFORE-DATA'             *        00430000
*                     DC   B'DATA-FLAGS'                       *        00440000
*                     DC   AL1(LENGTH-TEXT-AFTER-DATA)         *        00450000
*                     DC   CL...'TEXT-AFTER-DATA'              *        00460000
*                     DC   A(ADDR.TRANSLATE-TABLE)             *        00470000
*                                                              *        00480000
*   DATA-FLAGS        B'B1B2B3B4B5B6B7B8'                      *        00490000
*   B1    -     1 CHAR DATA                                    *        00500000
*               0 HEX  DATA                                    *        00510000
*   B1=1,B8=1     DECIMAL DATA ( DATE )                        *        00520000
*   B1=0,B8=1     TIME    DATA                                 *        00530000
*   B2          1 PUT DATA TO OUTPUT AREA                      *        00540000
*               0 DON'T PUT DATA                               *        00550000
*                                                              *        00560000
*   B3          1 PUT NEW LINE                                 *        00570000
*               0 NO                                           *        00580000
*                                                              *        00590000
*   B4          1 PUT DATA TO ALL OUTPUT LINE                  *        00600000
*               0 PUT DATA ONLY ONE TIMES                      *        00610000
*                                                              *        00620000
*   B5          1 PUT DATA WITH LENGTH                         *        00630000
*               0 PUT DATA WITHOUT LENGTH                      *        00640000
*                                                              *        00650000
*   B6          NOT USE                                        *        00660000
*                                                              *        00670000
*   B7          1 DON'T MAKE LOOP TROUGH LIST DATA             *        00680000
*               0 MAKE LOOP THROUGH LIST DATA                  *        00690000
*                                                              *        00700000
*   PROGRAM CAN USE NUMBER OF TRANSLATE TABLES IF NEED :       *        00710000
*                                                              *        00720000
*   - GENERAL TRANSLATE TABLE :                                *        00730000
*     ------------------------                                 *        00740000
*   LABEL     DC     AL1(LENGTH-OF-INPUT-DATA)                 *        00750000
*             DC     CL...'INPUT-DATA'                         *        00760000
*             DC     AL1(LENGTH-OF-OUTPUT-DATA)                *        00770000
*             DC     CL...'OUTPUT-DATA'                        *        00780000
*                    ......                                    *        00790000
*             DC     AL1(LENGTH-OF-INPUT-DATA = 0 ) - END OF TBL        00800000
*                                                              *        00810000
*   - FLAGS TRANSLATE TABLE :                                  *        00820000
*                                                              *        00830000
*   LABEL     DC     B'BIT-FLAG'                               *        00840000
*             DC     AL1(LENGTH-OF-OUTPUT-DATA)                *        00850000
*             DC     CL...'LENGTH-OF-OUTPUT-DATA'              *        00860000
*                    .....                                     *        00870000
*             DC     B'BIT-FLAG = 0'  - END OF TABLE           *        00880000
*                                                              *        00890000
*   - TRANSLATE TABLE WITH DUMMY OUTPUT :                      *        00900000
*                                                              *        00910000
*   LABEL     DC     AL1(LENGTH-OF-INPUT-DATA)                 *        00920000
*             DC     CL...'INPUT-DATA'                         *        00930000
*             DC     AL1(0)      - DON'T PUT TO OUTPUT AREA    *        00940000
*             DC     AL1(0)      - END OF TABLE                *        00950000
*                                                              *        00960000
* 2. STRUCTURE OF EXTRACTOR OUTPUT AREA :                      *        00970000
* --------------------------------------                       *        00980000
*                     DS   F      - MAX LENGTH                 *        00990000
*                     DS   F      - USE LENGTH                 *        01000000
*                     DS   H      - LENGTH OF TEXT BEFORE DATA *        01010000
*                     DS   CL...  - TEXT BEFORE                *        01020000
*                     DS   H      - LENGTH OF DATA             *        01030000
*                     DS   CL...  - DATA                       *        01040000
*                     DS   H      - LENGTH OF TEXT AFTER DATA  *        01050000
*                     DS   CL...  - TEXT AFTER                 *        01060000
*                     ....                                     *        01070000
*                     ....                                     *        01080000
*                     ....                                     *        01090000
*                                                              *        01100000
* RETURN CODES:                                                *        01110000
*                                                              *        01120000
* RACF RETURN CODES : SEE 'RETURN CODES FROM THE ICHEINTY MACRO'        01130000
*                                                              *        01140000
* EXTRACTOR RETURN CODES: (IN R15 ALSO)                        *        01150000
*                     16   -  OVERFLOW OUTPUT AREA             *        01160000
*                     20   -  INVALID OPTION                   *        01170000
*                                     VALID : LOCATE/ NEXT     *        01180000
*                     24   -  INVALID ENTRY TYPE               *        01190000
*                                     VALID : USR,GRP,DS,GEN   *        01200000
*                     28   -  INVALID MAP CODE                 *        01210000
*                                     VALID : NEW / OLD        *        01220000
*                     32   -  FREEMAIN FAILED                  *        01230000
*                                                              *        01240000
*                     36   -  EXTRACTOR INTERNAL ERROR         *        01250000
*                                                              *        01260000
* CALLED BY: (VIA CTSFAGR)                                     *        01270000
*                     CTSFRLU  -  GET USER PROFILE INFORMATION *        01280000
*                     CTSFRLG  -  GET GROUP PROFILE INFORMATION*        01290000
*                     CTSFRCN  -  GET CONNECT INFO (BY GROUP)  *        01300000
*                     CTSFRNM  -  GET COUNT OF CONNECT INFO    *        01310000
*                     CTSFRUC  -  GET CONNECT INFO (BY PAIR :  *        01320000
*                                     USER - GROUP )           *        01330000
*                     CTSFRGC  -  GET CONNECT INFO (BY USER)   *        01340000
*                     CTSFRCH  -  CHECK EXIST/NO USER/GROUP    *        01350000
*                                 IN RACF DATABASE             *        01360000
*                                                              *        01370000
* CALLS TO:          CTSARWA  - EXTRACT INFO FROM RACF RETURN  *        01380000
*                               AREA AND BUILD OUTPUT AREA.    *        01390000
*                                                              *        01400000
*                    EXIT-OUTPUT-ROUTINE                       *        01410000
*                    EXIT-TEST-ROUTINE                         *        01420000
*                                                              *        01430000
*                                                              *        01440000
* CONSIDERATIONS :                                             *        01450000
* - CALLER MUST BE AUTHORIZED                                  *        01460000
*                                                              *        01470000
****************************************************************        01480000
* LOGIC :                                                      *        01490000
*                                                              *        01500000
* MAIN (CTSFRXT)                                               *        01510000
* ----                                                         *        01520000
*                                                              *        01530000
* 0. /*PS0155*/                                                *        01540000
*    CHECK AND UPDATE OBTAINED TABLES AGAINST RACF DATABASE    *        01550000
*    TEMPLATES                                                 *        01560000
* 1. PREPAIRING ICHEINTY MACRO FOR ISSUE RACF ACCESS SVC       *        01570000
*    ACCORDING INPUT PARAMETERS :                              *        01580000
*    OPERATION CODE  -  LOCATE / NEXT / NEXTC                  *        01590000
*    GENERIC         -  YES    / UNCOND                        *        01600000
*                                                              *        01610000
* 2. CALL CALLER EXIT ( TEST   ROUTINE WITH PARM 'START' )     *        01620000
*                                                              *        01630000
* 2A /*PS0232*/                                                *        01640000
*    IF DATAMAP PARAMETER EQUAL 'EXT', SKIP CALL TO RACF,GOTO 6*        01650000
*                                                              *        01660000
* 3. ISSUE ICHEINTY                                            *        01670000
*                                                              *        01680000
* 4. CHECK ICHEINTY RC: ( FOR BASE SEGMENT )                   *        01690000
*                                                              *        01700000
*    IF RETURN CODE NOT EQUAL    0 - EXIT                      *        01710000
*    IF RACF RETURN AREA ADDR IS 0 - EXIT                      *        01720000
*    IF RACF RETURN AREA LEN  IS 0 - EXIT                      *        01730000
*                                                              *        01740000
* 5. CHECK ICHEINTY CHAIN RC ( SEGMENTS )                      *        01750000
*    IF RETURN CODE NOT EQUAL    0,  OR                        *        01760000
*    IF RACF RETURN AREA ADDR IS 0,  OR                        *        01770000
*    IF RACF RETURN AREA LEN  IS 0                             *        01780000
*                                                              *        01790000
*    CREATE SEGMENT RELATED INFO IN FORM:'NO' || SEGMENT = 'Y' *        01800000
*    RESET ACCESS TO ALL FIELDS RELATED TO THIS ICHEINTY       *        01810000
*                                                              *        01820000
* 6. CALL EXTRACTOR (CTSARW)                                   *        01830000
*                                                              *        01840000
* EXTRACTOR                                                    *        01850000
* ----------                                                   *        01860000
*                                                              *        01870000
* 5. PERFORM SEPARATE RACF RETURN AREA AND BUILD EXTRACTOR     *        01880000
*    RETURN AREA                                               *        01890000
*                                                              *        01900000
* 5.1. CREATE HEADER DATA ACCORDING ENTRY NAME                 *        01910000
* 5.2. CALL TO USER-EXIT-ROUTINE PARM('ENTRY')                 *        01920000
* 5.3. ANALIZE RET CODE. 0 - CONTINUE                          *        01930000
*                        4 - RETURN ( R15=0 )                  *        01940000
*                        8 - RETURN ( R15=8 ) RETURN           *        01950000
* 5.4. RESET REPEAT-FIELDS FLAGS                               *        01960000
* 5.5. PUT HEADER DATA TO EXTR OUTPUT AREA                     *        01970000
*      CALL TO USER-OUTPUT-ROUTINE ( PARM 'WRITE' )            *        01980000
*                                                              *        01990000
* 5.6. M A I N   L O O P  ( THROUGH RACF OUTPUT AREA , USING   *        02000000
*                           ACTION MACRO LIST               )  *        02010000
* 5.6.1  CREATE FIELD PARAMETER LIST                           *        02020000
* 5.6.2. IF NAME OF FIELD '********'  EXIT                     *        02030000
* 5.6.3. FIELDS PROCESSING.                                    *        02040000
* 5.6.3. IF RULE OF CURRENT DATA = 'E' EXTRACT FIELD.          *        02050000
*        CALL TO ROUTINE GET-ELEMENTARY-DATA                   *        02060000
*        CALL TO USER-EXIT-ROUTINE ( PARM = 'ELEM' )           *        02070000
*               R15 = 0  - CONT PROC OF PUTTING TO EXTRACT AREA*        02080000
*                   = 4  - DO NOT PUT FIELD TO EXTRACT AREA    *        02090000
*        PUT FIELD TO EXTR OUTPUT AREA :                       *        02100000
*        - IF NEED, CALL TO TRANSLATE-TABLE-CONVERT ROUTINE    *        02110000
*        - ELSE CALL TO FIELD-TYPE-CONVERT ROUTINE             *        02120000
*        PUT DATA TO EXTR OUTPUT AREA                          *        02130000
*        CALL TO USER-OUTPUT-ROUTINE ( PARM 'WRITE' )          *        02140000
*        CHECK : IF CURRENT ELEMENTARY FIELD NEED TO BE        *        02150000
*                REPEATED IN FURTHER PROCESSING,               *        02160000
*                IF YES , SET REPEAT FLAG=ON                   *        02170000
*                ELSE     SET REPEAT FLAG=OFF                  *        02180000
*                                                              *        02190000
* 5.6.4. IF RULE OF CURRENT DATA = 'L' AND LIST NOT ENDED      *        02200000
* 5.6.5. EXTRACT TOTAL LIST LENGTH                             *        02210000
*        IF TOTAL LIST LENGTH = 0 GOTO 5.6.7. (LIST ENDED)     *        02220000
* 5.6.6. L I S T   D A T A  L O O P                            *        02230000
*        CALL TO ROUTINE GET-LIST-DATA                         *        02240000
*        CHECK : IF LENGTH OF CIRRENT LIST DATA = 0            *        02250000
*                   RESET ALL REPEAT FLAGS TO 'OFF'            *        02260000
*                   GOTO 5.6.7.                                *        02270000
*                ELSE                                          *        02280000
*                   CALL TO USER-EXIT-ROUTINE ( PARM 'LIST')   *        02290000
*                         R15=0 - CONTINUE                     *        02300000
*                             4 - DO NOT PUT FIELD TO EXTR.AREA*        02310000
*                   - IF NEED,                                 *        02320000
*                   CALL TO TRANSLATE-TABLE-CONVERT ROUTINE    *        02330000
*                   - ELSE                                     *        02340000
*                   CALL TO FIELD-TYPE-CONVERT ROUTINE         *        02350000
*                   PUT DATA TO EXTR OUTPUT AREA               *        02360000
*                   CALL TO USER-OUTPUT-ROUTINE (PARM 'WRITE') *        02370000
*                   CHECK : LIST-LOOP-FLAG                     *        02380000
*                           IF ON - GOTO 5.6.6.                *        02390000
*                           IF OFF- GOTO 5.6.7                 *        02400000
*                                                              *        02410000
* 5.6.7  CHECK:WHETHER PENDING REPEATED FIELD, IF SO,          *        02420000
*        RESTORE ADDRESS OF ACTION LIST  GOTO 5.6.1.           *        02430000
*        ELSE GET NEXT ACTION ADDRESS .  GOTO 5.6.1.           *        02440000
* 5.6.9. UPDATE USE LENGTH OF EXTRACT AREA                     *        02450000
*                                                              *        02460000
* 6. FREEMAIN RACF RETURN AREA                                 *        02470000
*                                                              *        02480000
* 7. CALL CALLER EXIT ( TEST ROUTINE WITH PARM 'END' )         *        02490000
*                                                              *        02500000
* 8. EXIT                                                      *        02510000
****************************************************************        02520000
* MOD.ID   WHO      WHEN     DESCRIPTION                       *        02530000
* -------- -------- -------- --------------------------------- *        02540000
*                                                              *        02550000
* PS0155   ALEX     23/07/97 TEMPLATE CHECKING SUPPORT         *        02560000
* PS0232   ALEX     28/12/97 DATAMAP=EXT (EXTERNAL) SUPPORT    *        02570000
* PS0292   AS       24/07/98 DIGITAL CERTIFICATE SUPPORT       *        02580000
* PS0402   AS       20/12/99 RACF DATABASE CORRUPTION HANDLING *        02590000
* IS10090  NURITY   04/06/13 S0C4 DURING GS.  (BS10031)        *        02600000
* WS10053  SELIGT   05/06/16 SUPPORT RACDCERT MAP              *        02610000
*                            THIS FIX HAS NOTHING TO DO WITH   *        02620000
*                            RACDCERT.  IT WAS JUST AN ERROR   *        02630000
*                            NOTICED WHILE ANALYZING THE CODE. *        02640000
* WS10081  NURITY   27/05/21 SNAPPED OUTPUT AREA IS TRUNCATED  *        02641001
* IS10188  AVNERL   06/10/24 MOVE OUR MODULES ABOVE 16M LINE   *        02642002
****************************************************************        02650000
*                                                                       02660000
********************************************************************    02670000
*    MAIN PARAMETERS LIST                                               02680000
*******************************************************************     02690000
RXTPRM   DSECT                                                          02700000
RXTINTY  DS    A                       ADDRESS ICHEINTY MACRO           02710000
RXTEXT   DS    A                       ADDRESS GET PROGRAM              02720000
RXTDBG   DS    A                       DEBUG LEVEL                      02730000
RXTRC    DS    A                       RETURN CODE - 3 WORDS            02740000
*                                       1  - RACF RETURN CODE           02750000
*                                       2  - RACF REASON CODE           02760000
*                                       3  - EXTRACTOR RC               02770000
*                                                                       02780000
RXTOP    DS    CL8                     OPERATION  ( NEXT / LOCATE )     02790000
RXTPRF   DS    CL8                     PROFILE TYPE ( USR,GRP,..  )     02800000
RXTENTRY DS    A                       ENTRY VALUE                      02810000
RXTFLDS  DS    A                       ADDR FIELDS DESCRIPTIONS         02820000
RXTETXT  DS    A                       TEXT FOR ENTRY FIELD             02830000
RXTOUT   DS    A                       EXT OUTPUT ROUT. ( V - CONTST)   02840000
RXTEXTA  DS    A                       ADDR OUTPUT AREA                 02850000
RXT1LINE DS    A                       ONE LINE PARAMETER               02860000
RXTALST  DS    A                       ADDRESS ACTION LIST              02870000
RXTRULE  DS    A                       ADDR RULE LIST                   02880000
RXTGEN   DS    A                       ADDRESS GENERIC PARAMETER        02890000
RXTRST   DS    A                       ADDRESS RESET PARAMETER          02900000
RXTTSTP  DS    A                       ADDRESS EXIT TEST ROUTINE        02910000
RXTPRX   DS    A                       ICHEINTY MIN. WORK AREA          02920000
RXTMAP   DS    A                       ADDR MAP PARAMETER               02930000
RXTDELAY DS    A                       DELAY PARAMETER LIST             02940000
*                                                                       02950000
*        ADDITIONAL PARAMETERS  (2.1.0)                                 02960000
*                                                                       02970000
RXTRAREA DS    A                       RACF RETURN AREA                 02980000
RXTRSGLT DS    A                       SEGMENT'S LIST ADDR              02990000
*                                      HL2:0- UPDATE ICHEINTY REQUIRED  03000000
*                                          1- UPDATE ICHEINTY DONE      03010000
*                                      HL2: NUMBER OF SEGMENTS          03020000
*                                      CL8'SEGM-NAME',A(ICHEINTY-ADDR), 03030000
*                                                     A(0)-SEGM EXISTS  03040000
******************************************************************      03050000
*                                                                       03060000
********************************************************************    03070000
*    FIELDS PARAMETERS LIST                                             03080000
*******************************************************************     03090000
RFTPRM   DSECT                                                          03100000
RFTFNM   DS    CL8                     FIELD NAME                       03110000
RFTFRL   DS    CL1                     FIELD RULE (E-ELEMENT, L-LIST)   03120000
RFTATXT  DS    AL4                     TEXT PARAMETER ADDRESS           03130000
RFTACTN  DS    AL4                     ACTION PARAMETER ADDRESS         03140000
RFTDFLG  DS    CL1                     DELAY FLAG (R-REGULAR, D-DELAY)  03150000
RFTLEN   EQU   *-RFTPRM                FIELD PARAMETER LIST LEN         03160000
*                                                                       03170000
******************************************************************      03180000
*        RETURN AREA FROM RACF                                          03190000
******************************************************************      03200000
RETAREA  DSECT                                                          03210000
RETALEN  DS    F                       MINIMUM LENGTH OF AREA           03220000
RETRBA   DS    XL6                     RBA RETURN AREA                  03230000
RETFLGS  DS    XL1                     FLAG                             03240000
RETRES1  DS    XL1                     RESERVED                         03250000
RETDDSC  DS    F                       DUPLICATE DATASET NAME COUNT     03260000
RETRES2  DS    XL8                     RESERVED                         03270000
FILLER   DS    XL10                                                     03280000
*******************************************************************     03290000
CTSFRXT  CSECT                                                          03300000
CTSFRXT  AMODE 31                                                       03310000
*IS10188 CTSFRXT  RMODE 24       (FOR CTSADBG)                          03320002
CTSFRXT  RMODE ANY                                             IS10188  03321002
*********************************************************************   03330000
*                                                                   *   03340000
* TITLE       - RACF DATABASE EXTRACTOR                             *   03350000
*                                                                   *   03360000
* DESCRIPTION - WORK WITH RACF DATABASE USING MACRO LEVEL ACCESS    *   03370000
*                                                                   *   03380000
*********************************************************************   03390000
         BEGIN *,R3,R8                                                  03400000
         CTSEQUR                                                        03410000
         CTSLEVEL                                                       03420000
*--------------------------------------------------------------------   03430000
*        ESTABLISH ADDRESSABILITY MAIN PARAMETERS                       03440000
*--------------------------------------------------------------------   03450000
         LR    R10,R1                                                   03460000
         USING RXTPRM,R10                                               03470000
         L     R2,RXTDBG              | SAVE                            03480000
         LTR   R2,R2                  |                                 03490000
         BZ    DBGSTORE               |                                 03500000
         L     R2,0(R2)               |  DEBUG                          03510000
DBGSTORE DS    0H                     |                                 03520000
         STC   R2,ZDBGL0              |   LEVEL                         03530000
*                                                                       03540000
         CTSADBG 'ENTER DEBUG LEVEL=#',(?R2),                          X03550000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    03560000
         L     R2,RXTEXTA              EXTRACTOR OUTPUT AREA            03570000
         L     R2,0(R2)                                                 03580000
         CTSADBG 'OBTAINED EXTRACT AREA: ~ MAXLEN=# USELEN=#',         X03590000
               (?R2,0(R2),4(R2)),                                      X03600000
               LEVEL=(ZDBGL0,6,7,8),RAREA=RAREA1                        03610000
*                                                                       03620000
*        MOVE PARAMETERS                                                03630000
*                                                                       03640000
         L     R5,RXTEXTA              EXTRACTOR OUTPUT AREA            03650000
         MVC   ZCMNCA,0(R5)            EXTRACTOR OUTPUT AREA            03660000
*                                                                       03670000
         XC    ZEXITP(4),ZEXITP                                         03680000
         L     R2,RXTTSTP              EXIT TEST ROUTINE                03690000
         LTR   R2,R2                   TEST ROUTINE SUPPLIED ?          03700000
         BZ    NOEXIT                  N,SKIP                           03710000
         MVC   ZEXITP(4),0(R2)         SAVE TEST ROUTINE ADDR           03720000
NOEXIT   DS    0H                                                       03730000
*********************************************************************   03740000
*        PS0232   CHECK WHETHER NEED ACCESS TO RACF DATABASE            03750000
********************************************************************    03760000
         L     R5,RXTMAP               ADDR MAP PARAMETER               03770000
*                                                                       03780000
         CTSADBG 'MAP PARAMETER=_',(0(R5),3),                          X03790000
               LEVEL=(ZDBGL0,6,7,8),RAREA=RAREA1                        03800000
*                                                                       03810000
         CLC   =CL3'EXT',0(R5)                                          03820000
         BE    MAPEXT                                                   03830000
*********************************************************************   03840000
*        UPDATE ICHEINTY PARAMETER LIST                                 03850000
*********************************************************************   03860000
         L     R5,RXTRSGLT             SEGMENT'S LIST ADDR              03870000
         LH    R6,0(R5)                GET UPDATE REQUIRED FLAG         03880000
         LTR   R6,R6                   UPDATE ALREADY DONE ?            03890000
         BNZ   OPRCODE                 Y,SKIP                           03900000
         LH    R6,2(R5)                GET SEGMENT'S COUNTER            03910000
         LTR   R6,R6                   ANY SEGMENTS ?                   03920000
         BZ    UPDSGMD                 N, SKIP                          03930000
         LR    R1,R10                  RESTORE MAIN PARAMETER LIST ADDR 03940000
         CTSCALL CTSUSGM,,LINK=INT     UPDATE SEGMENT TABLE             03950000
*                                                                       03960000
         CTSADBG 'CTSUSGM RC=~',(?R15),                                X03970000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    03980000
*                                                                       03990000
         CTSCALL CTSCCHN,,LINK=INT     CHECK OBTAINED CHAIN             04000000
*                                                                       04010000
         CTSADBG 'CTSCCHN RC=~',(?R15),                                X04020000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    04030000
*                                                                       04040000
         LTR   R15,R15                                                  04050000
         BZ    UPDSGMD                                                  04060000
         LA    R15,36                  EXTRACTOR INTERNAL ERROR         04070000
         BNZ   EXTCNCL                 CANCELLED EXTRACT PROCESSING     04080000
UPDSGMD  DS    0H                                                       04090000
         LA    R6,1                                                     04100000
         STH   R6,0(R5)                UPDATE SEGMENTS TABLE DONE       04110000
         B     OPRCODE                                                  04120000
*********************************************************************   04130000
*        PREPAIRING  ICHEINTY PARAMETER LIST                            04140000
*********************************************************************   04150000
OPRCODE  DS    0H                                                       04160000
         L     R5,RXTENTRY             ENTRY NAME ADDR                  04170000
         L     R12,RXTINTY             ADDRESS ICHEINTY MACRO           04180000
         L     R6,RXTGEN               GET GENERIC PARAMETER            04190000
         L     R9,RXTPRX               RACF RETURN AREA PREFIX ADDR     04200000
         USING RETAREA,R9                                               04210000
         MVC   ZRBA(6),RETRBA          RBA=0. FIRST ENTRY               04220000
         MVC   ZRCFFLG,RETFLGS         KEEP GENERIC FLAG VALUE          04230000
         DROP  R9                                                       04240000
*                                                                       04250000
         SR    R7,R7                                                    04260000
         IC    R7,0(R5)                ENTRY NAME LEN                   04270000
         CTSADBG 'GENERIC:PARM=_/FLAG=$ RBA=$ OPCODE=_ ENTRY=#/_',     X04280000
               (0(R6),8,ZRCFFLG,1,ZRBA,6,RXTOP,8,?R7,1(R5),?R7),       X04290000
               LEVEL=(ZDBGL0,6,7,8),RAREA=RAREA1                        04300000
*                                                                       04310000
*-------------------------------------------------------------------*   04320000
*        PREPARE ICHEINTY MACRO ACCORDING OPERATION CODE :              04330000
*        LOCATE / NEXT / NEXTC                                          04340000
*-------------------------------------------------------------------*   04350000
OPRLOOP  DS    0H                                                       04360000
         CTSADBG 'SET PARAMETERS ICHEINTY ADDR=~',(?R12),              X04370000
               LEVEL=(ZDBGL0,6,7,8),RAREA=RAREA1                        04380000
         CLC   RXTOP,=CL8'LOCATE'      OPCODE LOCATE ?                  04390000
         BE    OPRLPL                  YES                              04400000
         CLC   RXTOP,=CL8'NEXTC'       OPCODE NEXTC ?                   04410000
         BE    OPRLXC                  YES                              04420000
         B     OPRLXT                  DEFAULT 'NEXT'                   04430000
*                                                                       04440000
*********************************************************************   04450000
*        LOCATE                                                         04460000
*********************************************************************   04470000
*                                                                       04480000
OPRLPL   DS    0H                                                       04490000
         CLC   =CL6'UNCOND',0(R6)      GENERIC PARAMETER UNCOND ?       04500000
         BE    GENUL                   YES                              04510000
         CLC   =CL3'YES',0(R6)         GENERIC PARAMETER YES ?          04520000
         BE    GENYL                   YES                              04530000
*                                                                       04540000
*        GENERIC PARAMETER 'NO'                                         04550000
*                                                                       04560000
         ICHEINTY LOCATE,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=NO,         X04570000
               MF=(E,(R12))                                             04580000
         B     OPRLOOPE                                                 04590000
*                                                                       04600000
*        GENERIC PARAMETER 'UNCOND'                                     04610000
*                                                                       04620000
GENUL    DS    0H                                                       04630000
         ICHEINTY LOCATE,OPTIONS=NOEXEC,GENERIC=UNCOND,ENTRY=(R5),     X04640000
               MF=(E,(R12))                                             04650000
         B     OPRLOOPE                                                 04660000
*                                                                       04670000
*        GENERIC PARAMETER 'YES'                                        04680000
*                                                                       04690000
GENYL    DS    0H                                                       04700000
         ICHEINTY LOCATE,OPTIONS=NOEXEC,GENERIC=YES,ENTRY=(R5),        X04710000
               MF=(E,(R12))                                             04720000
         B     OPRLOOPE                                                 04730000
*                                                                       04740000
*********************************************************************   04750000
*        NEXTC                                                          04760000
*********************************************************************   04770000
*                                                                       04780000
OPRLXC   DS    0H                                                       04790000
         L     R9,RXTPRX               RACF RETURN AREA PREFIX ADDR     04800000
         USING RETAREA,R9                                               04810000
         CLC   RETRBA,=XL6'00'         RBA=0. FIRST ENTRY               04820000
         BE    OPRLXCG                 Y,GENERIC PARM PROCESSING        04830000
*                                                                       04840000
*        CHECK FLAG PARAMETER FROM RACF RETURN AREA PREFIX              04850000
*                                                                       04860000
         TM    RETFLGS,X'80'           GENERIC FLAG                     04870000
         DROP  R9                                                       04880000
         BO    GENUXC                                                   04890000
         B     GENNXC                                                   04900000
OPRLXCG  DS    0H                      GENERIC PARM PROCESSING          04910000
         CLC   =CL6'UNCOND',0(R6)      GENERIC PARAMETER UNCOND ?       04920000
         BE    GENUXC                  YES                              04930000
         CLC   =CL3'YES',0(R6)         GENERIC PARAMETER YES ?          04940000
         BE    GENYXC                  YES                              04950000
*                                                                       04960000
*        GENERIC PARAMETER 'NO'                                         04970000
*                                                                       04980000
GENNXC   DS    0H                                                       04990000
         ICHEINTY NEXTC,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=NO,          X05000000
               MF=(E,(R12))                                             05010000
         B     OPRLOOPE                                                 05020000
*                                                                       05030000
*        GENERIC PARAMETER 'UNCOND'                                     05040000
*                                                                       05050000
GENUXC   DS    0H                                                       05060000
         ICHEINTY NEXTC,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=UNCOND,      X05070000
               MF=(E,(R12))                                             05080000
         B     OPRLOOPE                                                 05090000
*                                                                       05100000
*        GENERIC PARAMETER 'YES'                                        05110000
*                                                                       05120000
GENYXC   DS    0H                                                       05130000
         ICHEINTY NEXTC,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=YES,         X05140000
               MF=(E,(R12))                                             05150000
         B     OPRLOOPE                                                 05160000
*                                                                       05170000
*********************************************************************   05180000
*        NEXT                                                           05190000
*********************************************************************   05200000
*                                                                       05210000
OPRLXT   DS    0H                                                       05220000
         L     R9,RXTPRX               RACF RETURN AREA PREFIX ADDR     05230000
         USING RETAREA,R9                                               05240000
         CLC   RETRBA,=XL6'00'         RBA=0. FIRST ENTRY               05250000
         BE    OPRLXTG                 Y,GENERIC PARM PROCESSING        05260000
*                                                                       05270000
*        CHECK FLAG PARAMETER FROM RACF RETURN AREA PREFIX              05280000
*                                                                       05290000
         TM    RETFLGS,X'80'           GENERIC FLAG                     05300000
         DROP  R9                                                       05310000
         BO    GENUXT                                                   05320000
         B     GENNXT                                                   05330000
OPRLXTG  DS    0H                      GENERIC PARM PROCESSING          05340000
         CLC   =CL6'UNCOND',0(R6)      GENERIC PARAMETER UNCOND ?       05350000
         BE    GENUXT                  YES                              05360000
         CLC   =CL3'YES',0(R6)         GENERIC PARAMETER YES ?          05370000
         BE    GENYXT                  YES                              05380000
*                                                                       05390000
*        GENERIC PARAMETER 'NO'                                         05400000
*                                                                       05410000
GENNXT   DS    0H                                                       05420000
         ICHEINTY NEXT,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=NO,           X05430000
               MF=(E,(R12))                                             05440000
         B     OPRLOOPE                                                 05450000
*                                                                       05460000
*        GENERIC PARAMETER 'UNCOND'                                     05470000
*                                                                       05480000
GENUXT   DS    0H                                                       05490000
         ICHEINTY NEXT,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=UNCOND,       X05500000
               MF=(E,(R12))                                             05510000
         B     OPRLOOPE                                                 05520000
*                                                                       05530000
*        GENERIC PARAMETER 'YES'                                        05540000
*                                                                       05550000
GENYXT   DS    0H                                                       05560000
         ICHEINTY NEXT,OPTIONS=NOEXEC,ENTRY=(R5),GENERIC=YES,          X05570000
               MF=(E,(R12))                                             05580000
         B     OPRLOOPE                                                 05590000
*                                                                       05600000
OPRLOOPE DS    0H                                                       05610000
         L     R12,48(R12)             GET NEXT ICHEINTY ADDR           05620000
         LTR   R12,R12                 END OF ICHEINTY LIST ?           05630000
         BNZ   OPRLOOP                 YES                              05640000
*                                                                       05650000
*******************************************************************     05660000
*        INVOKE REQUEST ACCESS TO RACF DATA BASE                        05670000
*******************************************************************     05680000
DORACF   DS    0H                                                       05690000
         L     R12,RXTINTY          ADDRESS ICHEINTY MACRO              05700000
         L     R2,RXTPRX            ADDRESS OF WORK AREA (RACF PREFIX)  05710000
         XC    ZR15RC1,ZR15RC1      CLEAR RACF RETURN CODE              05720000
         XC    ZR15RC2,ZR15RC2      CLEAR RACF REASON CODE              05730000
         XC    ZR15WA,ZR15WA        CLEAR EXTRACTOR RETURN CODE         05740000
*                                                                       05750000
DORACF10 DS    0H                                                       05760000
         ICM   R15,X'F',ZEXITP      ADDR EXIT ROUTINE                   05770000
         BZ    DORACF11             NO                                  05780000
         CALL (15),(ZSTART,ZCMNCA)                                      05790000
DORACF11 DS    0H                                                       05800000
*                                                                       05810000
         ICHEINTY MF=(E,(R12))      INVOKE ACCESS TO RACF DATA BASE     05820000
*                                                                       05830000
*--------------------------------------------------------------------*  05840000
*        FROM ADDRESS ICHEINTY  MACRO OFFSET 56 -  REASON CODE       *  05850000
*        FROM ADDRESS ICHEINTY  MACRO OFFSET 52 -  RETURN CODE       *  05860000
*        FROM ADDRESS ICHEINTY  MACRO OFFSET 60 -  ADDR RACF RET AREA*  05870000
*--------------------------------------------------------------------*  05880000
         L     R15,56(R12)           REASON CODE OF BASE SEGMENT        05890000
         ST    R15,ZR15RC2                                              05900000
         L     R15,52(R12)           RETURN CODE OF BASE SEGMENT        05910000
         ST    R15,ZR15RC1                                              05920000
*                                                                       05930000
         CTSADBG 'BASE SEGM:RACF-RC=~ RACF-REASON=~',                  105940000
               (ZR15RC1,ZR15RC2),RAREA=RAREA1,                         205950000
               LEVEL=(ZDBGL0,4,5,6,7,8)                                 05960000
*                                                                       05970000
         LTR   R15,R15               ACCESS SUCCESSFUL ?                05980000
         BNZ   EXTRET                ERROR                              05990000
*                                                                       06000000
* PS0402. CHECK ENTRY NAME LENGTH.                                      06010000
* FOR USR, GRP PROFILES IT MUST BE NOT GREATER THEN 8                   06020000
*                                                                       06030000
         CLC   =CL2'DS',RXTPRF       DATASET PROFILE ?           PS0402 06040000
         BE    DORACF12                                          PS0402 06050000
         CLC   =CL3'GEN',RXTPRF      GEN RESOURCE PROFILE ?      PS0402 06060000
         BE    DORACF12                                          PS0402 06070000
*                                                                PS0402 06080000
*        USER, GROUP PROFILES                                    PS0402 06090000
*                                                                PS0402 06100000
         L     R12,RXTINTY           ADDR OF ICHEINTY (FIRST)    PS0402 06110000
         L     R4,4(R12)             ADDR OF ENTRY NAME          PS0402 06120000
         SR    R5,R5                                             PS0402 06130000
         IC    R5,0(R4)              LENGTH OF ENTRY NAME        PS0402 06140000
         LTR   R5,R5                 CHECK LENGTH OF ENTRY NAME  PS0402 06150000
         BNP   SETERR                MINUS, ERR                  PS0402 06160000
         BZ    SETERR                ZERO,  ERR                  PS0402 06170000
         LA    R15,8                                             PS0402 06180000
         CR    R5,R15                GREATER THEN 8, ERR         PS0402 06190000
         BH    SETERR                                            PS0402 06200000
         SR    R15,R15               CLEAR R15 , NO ERRORS       PS0402 06210000
         B     DORACF12                                          PS0402 06220000
SETERR   DS    0H                                                PS0402 06230000
         LA    R15,12                SET RACF REASON CODE        PS0402 06240000
         ST    R15,ZR15RC2                                       PS0402 06250000
         LA    R15,12                SET RACF RETURN CODE (EOF)  PS0402 06260000
         ST    R15,ZR15RC1                                       PS0402 06270000
         LA    R15,0                                             PS0402 06280000
         ST    R15,ZR15WA            SET EXTRACTOR RET.CODE      PS0402 06290000
         B     EXTRET                EXTRACTOR EXIT              PS0402 06300000
DORACF12 DS    0H                                                       06310000
         L     R2,60(R12)            ADDRESS OF RACF RET AREA           06320000
         L     R6,RXTRAREA           RACF RETURN AREA                   06330000
         ST    R2,0(R6)              SAVE RACF RETURN AREA              06340000
*                                                                       06350000
         CTSADBG 'ICHEINTY ADDR R12=~ ADDR RACF RET.AREA(R2)=~',       X06360000
               (?R12,?R2),RAREA=RAREA1,                                X06370000
               LEVEL=(ZDBGL0,4,5,6,7,8)                                 06380000
*                                                                       06390000
         LTR   R2,R2                 CHECK LENGTH OF RACF RETURN AREA   06400000
         BZ    DORACF13              RETURN AREA IS EMPTY,USE STATIC    06410000
         L     R2,0(R2)              LENGTH OF AREA                     06420000
         ST    R2,ZLENRCF                                               06430000
         L     R6,RXTRAREA           RACF RETURN AREA                   06440000
         L     R5,0(R6)                                                 06450000
         LR    R4,R5                                                    06460000
         A     R5,ZLENRCF                                               06470000
*                                                                       06480000
         CTSADBG TYPE=SNAP,ID=5,                                       X06490000
               HDR='** RACF RETURN AREA ( BASE SEGM) **',              X06500000
               ADDR=(0(R4),0(R5)),LEVEL=(ZDBGL0,5,6,7,8),RAREA=RAREA1   06510000
*                                                                       06520000
DORACF13 DS    0H                                                       06530000
*----------------------------------------------------------------       06540000
*        CHECK ICHEINTY CHAIN.                                          06550000
*        IF ICHEINTY RET CODE <> 0 CLEAR RELATED ACTIONS MACRO THAT     06560000
*        BELONGING TO THIS ICHEINTY (LENGTH ,ADDR OF RETURNED DATA)     06570000
*----------------------------------------------------------------       06580000
         L     R12,RXTINTY             ADDRESS ICHEINTY MACRO           06590000
FLDPRM10 DS    0H                                                       06600000
         L     R11,60(R12)             ADDRESS OF RACF RET AREA         06610000
         L     R4,4(R12)               ADDR ENTRY NAME                  06620000
         SR    R5,R5                                                    06630000
         IC    R5,0(R4)                LENGTH OF ENTRY NAME             06640000
*                                                                       06650000
         CTSADBG '~ SEGM=_/_ RC=~ RS=~ RACF AREA=~',                   X06660000
               (?R12,40(R12),8,1(R4),?R5,                              X06670000
               52(R12),56(R12),?R11),                                  X06680000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    06690000
         LTR   R11,R11                                                  06700000
         BZ    FLDPRM11                                                 06710000
         L     R6,0(R11)               RET AREA LENGTH                  06720000
         AR    R6,R11                  RET AREA END ADDRESS             06730000
*                                                                       06740000
         CTSADBG '~ SEGM=_/_ RC=~ RS=~ RACF AREA=~ LEN=#',             X06750000
               (?R12,40(R12),8,1(R4),?R5,                              X06760000
               52(R12),56(R12),?R11,0(R11)),                           X06770000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    06780000
         CTSADBG TYPE=SNAP,ID=6,                                       X06790000
               HDR='** RACF RETURN AREA **',                           X06800000
               ADDR=(0(R11),0(R6)),LEVEL=(ZDBGL0,5,6,7,8),RAREA=RAREA1  06810000
*                                                                       06820000
FLDPRM11 DS    0H                                                       06830000
         L     R5,52(R12)              RETURN CODE = 0                  06840000
         LTR   R5,R5                                                    06850000
         BZ    FLDPRM1B                Y, GET NEXT ICHEINTY FROM CHAIN  06860000
*                                                                       06870000
*        ICHEINTY RC <> 0. CLEAR RELATED ACTIONS MACRO                  06880000
*                                                                       06890000
         L     R11,8(R12)              FLDEF PTR                        06900000
         SR    R4,R4                                                    06910000
         IC    R4,2(R11)               CURRENT NUMBER OF TESTS          06920000
         SLL   R4,2                    *4                               06930000
         LA    R11,4(R11)              BRANCH OVER SERVICE BYTES        06940000
         AR    R11,R4                  ADDR OF FIRST ACTION MACRO       06950000
         L     R9,0(R11)               ACTION MACRO FROM ICHEINTY       06960000
FLDPRM1A DS    0H                                                       06970000
*                                                                       06980000
*        CLEAR PTR AND LEN FOR NONE EXISTING FIELD                      06990000
*                                                                       07000000
         LR    R4,R9                   ACTIN MACRO ADDR                 07010000
*                                                                       07020000
         CTSADBG '~ SEGM=_ CANCELLED ACCESS TO ~/_',                   X07030000
               (?R12,40(R12),8,?R4,4(R4),8),                           X07040000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    07050000
*                                                                       07060000
         XC    12(4,R4),12(R4)         CLEAR LENGTH OF DATA     /8/     07070000
         XC    16(4,R4),16(R4)         CLEAR PTR TO DATA        /8/     07080000
*                                                                       07090000
*        GET NEXT FIELD FROM ICHEINTY LIST                              07100000
*                                                                       07110000
         LA    R11,4(R11)              NEXT ACTION MACRO                07120000
         L     R9,0(R11)               ACTION MACRO                     07130000
         LTR   R9,R9                   ACTION MACRO IS AVAILABLE        07140000
         BNZ   FLDPRM1A                YES                              07150000
*                                                                       07160000
*        GET HEXT ICHEINTY ADDR FROM CHAIN AND ICHEINTY TABLE           07170000
*                                                                       07180000
FLDPRM1B DS    0H                                                       07190000
         L     R12,48(R12)             GET NEXT ICHEINTY MACRO          07200000
         LTR   R12,R12                 ICHEINTY AVAILABLE ?             07210000
         BNZ   FLDPRM10                YES                              07220000
FLDPRM1C DS    0H                                                       07230000
* -----------------------------------------------------------------     07240000
*        SEPARATE RACF RETURN AREA AND BUILD EXTRACTOR OUTPUT AREA      07250000
* -----------------------------------------------------------------     07260000
*                                                                       07270000
MAPEXT   DS    0H                      24/12/97                         07280000
         L     R2,RXTEXTA              EXTRACTOR OUTPUT AREA            07290000
         L     R2,0(R2)                                                 07300000
         CTSADBG 'OBTAINED EXTRACT AREA: ~ MAXLEN=# USELEN=#',         X07310000
               (?R2,0(R2),4(R2)),                                      X07320000
               LEVEL=(ZDBGL0,6,7,8),RAREA=RAREA1                        07330000
*                                                                       07340000
         LR    R1,R10                  RESTORE ADDR OF PARAMETER LIST   07350000
         CTSCALL CTSARWA,,LINK=INT                                      07360000
*                                                                       07370000
         L     R2,RXTEXTA              EXTRACTOR OUTPUT AREA            07380000
         L     R2,0(R2)                                                 07390000
         LR    R6,R2                                                    07400000
         L     R5,4(R2)                EXTRACTOR AREA USE LENGTH        07410000
         AR    R6,R5                   RET AREA END ADDRESS             07420000
*WS10081 LA    R6,4(R6)                + PREFIX AREA LENGTH             07430001
         LA    R6,8(R6)                + PREFIX AREA LENGTH    WS10081  07431001
         CTSADBG TYPE=SNAP,ID=10,                                      X07440000
               HDR='** EXTRACT AREA **',                               X07450000
               ADDR=(0(R2),0(R6)),LEVEL=(ZDBGL0,5,6,7,8),RAREA=RAREA1   07460000
*                                                                       07470000
         ST    R15,ZR15WA              STORE EXTRACTOR RET. AREA        07480000
         L     R6,RXTRAREA             RACF RETURN AREA ADDR            07490000
         L     R2,0(R6)                RACF RETURN AREA ADDR            07500000
         L     R5,ZLENRCF              GET LENGTH OF RACF RET. AREA     07510000
*-----------------------------------------------------------------      07520000
*        HREEMAIN RACF OUTPUT AREA                                      07530000
*-----------------------------------------------------------------      07540000
         L     R12,RXTINTY             ADDRESS ICHEINTY MACRO           07550000
FREEL1   DS    0H                                                       07560000
         L     R2,60(R12)              ADDRESS OF RACF RET AREA         07570000
         LTR   R2,R2                   OBTAINED AREA ?                  07580000
         BZ    FREEL2                  NO,PASS                          07590000
         L     R4,4(R12)               ADDR ENTRY NAME                  07600000
         SR    R5,R5                                                    07610000
         IC    R5,0(R4)                LENGTH OF ENTRY NAME             07620000
*                                                                       07630000
         CTSADBG 'FREEMAIN SEGM=_/_  ADDR RET AREA=~ LEN=~',           X07640000
               (40(R12),8,1(R4),?R5,?R2,0(R2)),                        X07650000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    07660000
*                                                                       07670000
         L     R5,0(R2)                                                 07680000
         FREEMAIN RC,LV=(R5),A=(R2)                                     07690000
         LTR   R15,R15                                                  07700000
         BZ    FREEL2                                                   07710000
ERRFREE  DS    0H                      R15 CONSIST ERR.CODE FROM        07720000
         LA    R15,32                  FREEMAIN ERROR                   07730000
         ST    R15,ZR15WA                                               07740000
FREEL2   DS    0H                                                       07750000
         L     R12,48(R12)             GET NEXT ICHEINTY MACRO          07760000
         LTR   R12,R12                 ICHEINTY AVAILABLE ?             07770000
         BNZ   FREEL1                  YES                              07780000
*------------------------------------------------------------------     07790000
*        RET CODE=8 CAN BE OBTAINED FROM USER-EXIT ROUTINE.             07800000
*        IT  MEANS : GET NEXT RECORD                                    07810000
*------------------------------------------------------------------     07820000
*        L     R15,ZR15WA              FOR POSSIBILITY DO LOOP          07830000
*        C     R15,=F'8'               WITHOUT EXIT FROM PROGRAM        07840000
*        BE    DORACF                                                   07850000
*                                                                       07860000
EXTRET   DS    0H                                                       07870000
         L     R2,RXTRC                LOAD ADDR.RETURN CODE            07880000
         MVC   0(4,R2),ZR15RC1         STORE RACF RETURN CODE           07890000
         MVC   4(4,R2),ZR15RC2         STORE RACF REASON CODE           07900000
         MVC   8(4,R2),ZR15WA          STORE EXTRACTOR RET.CODE         07910000
         L     R15,ZR15WA                                               07920000
*                                                                       07930000
         ICM   R15,X'F',ZEXITP         ADDR EXIT ROUTINE                07940000
         BZ    EXTRETA                 NO                               07950000
         CALL (15),(ZEND,ZCMNCA)                                        07960000
EXTRETA  DS    0H                                                       07970000
         L     R2,RXTPRX               ICHEINTY WORK AREA               07980000
         L     R5,RXTRST                                                07990000
         LR    R6,R15                  EXTRACTOR RET CODE               08000000
         A     R6,ZR15RC1              ADD RACF RET CODE                08010000
         A     R6,ZR15RC2              ADD RACF REASON CODE             08020000
         LTR   R6,R6                   IF SOMETHING WRONG               08030000
         BNZ   RESETL                  NEED RESET RET AREA PREFIX       08040000
*                                      IF EVERTHING O.K                 08050000
*                                      RESET RET AREA PREFIX PERFORM    08060000
*                                      ACCORDING RESET PARAMETER        08070000
*                                                                       08080000
         CLC   =CL3'YES',0(R5)         RESET = "YES" ?                  08090000
         BNE   NORESETL                N, SKIP                          08100000
RESETL   DS    0H                                                       08110000
         XC    4(30,R2),4(R2)          RESET RETURN AREA (EXCEPT LEN)   08120000
NORESETL DS    0H                                                       08130000
         L     R15,ZR15WA                                               08140000
*                                                                       08150000
         CTSADBG 'EXITING WITH RC=~',(?R15),                           108160000
               LEVEL=(ZDBGL0,4,5,6,7,8),RAREA=RAREA1                    08170000
*                                                                       08180000
EXTCNCL  DS    0H                                                       08190000
         BRTRN (15)                                                     08200000
* ------------------------------------------------------------------    08210000
         LTORG                                                          08220000
********************************************************************    08230000
*        W O R K  A R E A  A N D   C O N S T A N T S                    08240000
********************************************************************    08250000
ZCMNCA   DS    F                                                        08260000
ZEXITP   DS    F                       ADDRESS OF EXIT ROUTINE          08270000
ZR15WA   DS    F                       RETURN CODE FROM CTSARWA         08280000
ZR15RC1  DS    F                       RETURN CODE AFTER RACF MACRO     08290000
ZR15RC2  DS    F                       REASON CODE AFTER RACF MACRO     08300000
ZLENRCF  DS    F                       LENGTH OF RETURN AREA RACF       08310000
ZDBGL0   DS    AL1                     DEBUG LEVEL                      08320000
ZRCFFLG  DS    CL1                     GENERIC FLAG                     08330000
ZSTART   DC    CL1'S'                  START PARAM FOR USER TEST PROG   08340000
ZEND     DC    CL1'F'                  END PARAM FOR USER TEST PROG     08350000
ZRBA     DS    CL6                     RBA RETURNED BY RACF             08360000
RAREA1   DS    64F                     DEBUG PACKAGE WORK AREA          08370000
********************************************************************    08380000
         DROP  ,                                                        08390000
CTSARWA  BEGIN *,R12,R11                                                08400000
*********************************************************************   08410000
*                                                                   *   08420000
* TITLE - CTSARWA                                                   *   08430000
*                                                                   *   08440000
* DESCRIPTION - PROCESSING WORK AREA AFTER ACCES TO RACF DATA BASE  *   08450000
*               PARAMETERS : R1 - ADDRESS OF LIST PARAMETERS        *   08460000
*                                                                   *   08470000
* CALLED BY        : CTSFRXT                                        *   08480000
*                                                                   *   08490000
* CALLS  TO        : CTSARCT   - PUT DATA TO OUTPUT AREA            *   08500000
*                    CTSARMH   - MOVE HEADER TO OUTPUT AREA         *   08510000
*                    CRTADDR   - CREATE CURRENT ADDR. LIST          *   08520000
*                    CTSAACF   - CLEAR LOOP FLAGS                   *   08530000
*                    CTSARNE   - GET ELEMENTARY DATA                *   08540000
*                    CTSARNL   - GET LIST DATA ( MAP NEW )          *   08550000
*                    CTSAACT   - CREATE PTRS ACCESS TO LIST DATA    *   08560000
*                    USER-OUTPUT ROUTINE                            *   08570000
*                    USER-TEST   ROUTINE                            *   08580000
*********************************************************************   08590000
FCHAR    EQU   B'10000000'            CHAR DATA                         08600000
FPUT     EQU   B'01000000'            PUT DATA TO OUTPUT AREA           08610000
FPRINT   EQU   B'00100000'            PRINT OUTPUT AREA                 08620000
FREPEAT  EQU   B'00010000'            REPEAT FLAG                       08630000
FPUTLEN  EQU   B'00001000'            PUT DATA WITH WITH LENGTH         08640000
FLSTLOOP EQU   B'00000010'            END-OF-LIST FLAG                  08650000
FDATE    EQU   B'10000001'            DATE                              08660000
FDEC     EQU   B'00000001'            DECIMAL DATA                      08670000
         LR    R4,R1                                                    08680000
         USING RXTPRM,R4               ADDRESSABILITY PARAMETERS        08690000
         L     R2,RXTDBG              | SAVE                            08700000
         LTR   R2,R2                  |                                 08710000
         BZ    DBGSAVE                |                                 08720000
         L     R2,0(R2)               |  DEBUG                          08730000
DBGSAVE  DS    0H                     |                                 08740000
         STC   R2,DBGL1               |   LEVEL                         08750000
*                                                                       08760000
         CTSADBG 'MAIN EXTRACT ROUTINE ENTERING',                      X08770000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         08780000
*                                                                       08790000
         L     R2,RXTEXTA              ADDRESS OF OUTPUT AREA           08800000
         MVC   RRTEXTA(4),0(R2)        ADDRESS OF OUTPUT AREA           08810000
         MVC   ADDRACTM(4),RXTALST     ADDRESS OF ACTION ADDRESS LIST   08820000
         MVC   ADDRACT(4),RXTALST      ADDRESS OF ACTION ADDRESS LIST   08830000
         MVC   RRTINTY(4),RXTINTY      ADDRESS OF 1-ST ICHEINTY MACRO   08840000
         XC    RRTDELAY(4),RRTDELAY    CLEAR DELAY ICHEINTY ADDR        08850000
         L     R2,RXTDELAY             DELAY ICHEINTY ADDR              08860000
         LTR   R2,R2                   ADDRESS SUPPLIED ?               08870000
         BZ    PRMSV0                  N, SKIP                          08880000
         MVC   RRTDELAY,0(R2)          SAVE DELAY ICHEINTY ADDR         08890000
PRMSV0   DS    0H                                                       08900000
         MVC   RRTRSGLT,RXTRSGLT       SEGMENT'S LIST ADDR              08910000
         L     R2,RXT1LINE             ADDR OF 1 LINE PARAM             08920000
         MVC   RRT1LINE(3),0(R2)       END-OF-ENTRY PARAMETER           08930000
         XC    RRTTSTP(4),RRTTSTP      CLEAR ADDRESS OF EXIT ROURINE    08940000
         L     R2,RXTTSTP              ADDRESS OF EXIT ROURINE          08950000
         LTR   R2,R2                   ADDR SUPPLIED ?                  08960000
         BZ    PRMSV1                  N, SKIP                          08970000
         MVC   RRTTSTP(4),0(R2)        ADDRESS OF EXIT ROURINE          08980000
PRMSV1   DS    0H                                                       08990000
         MVC   RRTPRX(4),RXTPRX        ADDR OF PREFIX OF RACF WORK AREA 09000000
         XC    CNTF,CNTF               CLEAR COUNTER OF FIELDS          09010000
         MVC   RRTRULE,RXTRULE         SAVE RULE LIST ADDR              09020000
         L     R2,RRTEXTA                                               09030000
*                                                                       09040000
         CTSADBG 'OBTAINED EXTRACT AREA: ~ MAXLEN=# USELEN=#',         X09050000
               (?R2,0(R2),4(R2)),                                      X09060000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         09070000
*                                                                       09080000
         LA    R2,4(R2)                BRANCH OVER THE MAX LENGTH       09090000
         MVC   CLEN(4),0(R2)           KEEP PREVIOUS USE LENGTH         09100000
         MVC   CLENI(4),0(R2)          KEEP PREVIOUS USE LENGTH         09110000
         MVC   USELENP(4),0(R2)        KEEP PREVIOUS USE LENGTH         09120000
         XC    HEADERL,HEADERL         CLEAR USE LEN OF HEADER LINE     09130000
* --------------------------------------------------------------------- 09140000
*        CREATE HEADER FROM ENTRY FIELD                                 09150000
* --------------------------------------------------------------------- 09160000
*        ENTRY NAME PROCESSING                                          09170000
* --------------------------------------------------------------------- 09180000
         L     R2,RXTENTRY             ADDR OF ENTRY NAME               09190000
         SR    R3,R3                                                    09200000
         IC    R3,0(R2)                ENTRY NAME LENGTH                09210000
         LA    R2,1(R2)                BRANCH OVER THE LENGTH           09220000
         ST    R3,ADDRF                LENGTH OF ENTRY NAME             09230000
         BCTR  R3,0                    DECR FOR EX COMMAND              09240000
         EX    R3,MVENTRY                                               09250000
*                                                                       09260000
* --------------------------------------------------------------------  09270000
*        DEFINITION OUTPUT PARAMETER LIST FOR ENTRY FIELD               09280000
* --------------------------------------------------------------------  09290000
*                                                                       09300000
         L     R2,RXTETXT              ADDR OF TXT PARAMETERS           09310000
         LR    R5,R2                                                    09320000
         SR    R3,R3                                                    09330000
         IC    R3,0(R2)                LENGTH OF TEXT BEFORE            09340000
         LA    R2,1(R2)                BRANCH OVER THE LENGTH           09350000
         AR    R2,R3                   BRANCH OVER THE TEXT             09360000
         MVC   PRTPH(1),0(R2)          OUTPUT PARAMETERS LIST           09370000
         LR    R2,R5                   ADDR.OF TEXT PARM LIST           09380000
         ST    R2,ADDRTXT                                               09390000
         L     R2,RXTOUT               EXTERNAL OUTPUT PROG             09400000
         L     R2,0(R2)                EXTERNAL OUTPUT PROG             09410000
         ST    R2,RRTOUT                                                09420000
* --------------------------------------------------------------------- 09430000
         ICM   R15,X'F',RRTTSTP                                         09440000
         BZ    ENTRYCNT                                                 09450000
*                                             |  USER-EXIT              09460000
         CALL (15),(TEX,ADDRF,RRTPRX,RRTEXTA) |  ROUTINE                09470000
*                                             |  PARM 'ENTRY'           09480000
         B     ENTRYEXT(R15)                                            09490000
ENTRYEXT B     ENTRYCNT                RET.CODE=0 .CONTINUE             09500000
         B     RETWA0                  RET.CODE=4 .NEXT RECORD          09510000
         B     RETWA                   RET.CODE=8 .RETURN               09520000
ENTRYCNT DS    0H                                                       09530000
* --------------------------------------------------------------------- 09540000
         TM    PRTPH,FPUT              PUT ENTRY NAME ?                 09550000
         BZ    ENTRYNPT                NOPUT                            09560000
*---------------------------------------------------------------------- 09570000
*        CREATE HEADER LINE                                             09580000
*---------------------------------------------------------------------- 09590000
         MVC   NAMEF(8),=CL8'HEADER'                                    09600000
         CTSCALL CTSARCT,(TYPEH,AHEADER,ADDRF,ADDRTXT,DBGL1,NAMEF),    X09610000
               LINK=INT                                                 09620000
         LTR   R15,R15                 OVERFLOW ?                       09630000
         BNZ   RETWA                   YES, RETURN                      09640000
*---------------------------------------------------------------------- 09650000
*        CHECK ICHEINTY MACRO CHAIN AND PUT INFORMATION ABOUT SEGMENTS  09660000
*---------------------------------------------------------------------- 09670000
         CTSCALL CTSARCS,(AHEADER,RRTRSGLT,DBGL1,ADDRTXT),LINK=INT      09680000
         LTR   R15,R15                 OVERFLOW ?                       09690000
         BNZ   RETWA                   YES, RETURN                      09700000
         CTSCALL CTSARMH,LINK=INT      MOVE HEADER                      09710000
         L     R9,RRTEXTA                                               09720000
         MVC   CLEN(4),4(R9)           KEEP NEW USE LEN                 09730000
         TM    PRTPH,FPRINT            PRINT HEDAER LINE ?              09740000
         BZ    ENTRYNPT                NO                               09750000
         ICM   R15,X'F',RRTOUT              |  USER                     09760000
         BZ    ENTRYNPT                     |    OUTPUT                 09770000
         CALL (15),(WRITE,AHEADER)          |       ROUTINE             09780000
ENTRYNPT DS    0H                                                       09790000
         ST    R4,MREG4                                                 09800000
* --------------------------------------------------------------------- 09810000
*        MAIN LOOP EXTRACT DATA FROM RACF RETURN AREA                   09820000
*        LOOP INITIALIZE                                                09830000
* --------------------------------------------------------------------- 09840000
MAINLOOP DS    0H                                                       09850000
         L     R4,MREG4                RESTORE PARM REGISTER            09860000
         LR    R1,R4                                                    09870000
         MVC   ADDRACT(4),ADDRACTM     RESTORE ACTION LIST ADDR         09880000
         L     R6,ADDRACT                                               09890000
         L     R6,0(R6)                GET CURRENT ACTION MACRO ADDR    09900000
         ST    R6,CURRACT              FIRST ACTION MACRO               09910000
         XC    FLDCNTR,FLDCNTR         FIELD COUNTER                    09920000
         XC    FLDCNTRZ,FLDCNTRZ       FIELD COUNTER                    09930000
         XC    CURRFCZ,CURRFCZ         CLEAR BREAK LOOP PTR             09940000
         LA    R9,RFTLEN               FIELD DESCRIPT ENTRY LEN         09950000
         ST    R9,RFTELEN              SAVE FIELD ENTRY LEN             09960000
         L     R9,RXTFLDS                                               09970000
         ST    R9,ADDRFL               STORE ADDR FIELD PARM LIST       09980000
* --------------------------------------------------------------------- 09990000
*        MAIN LOOP                                                      10000000
* --------------------------------------------------------------------- 10010000
MAINLP0  DS    0H                                                       10020000
         CTSCALL CRTADDR,LINK=INT      CREATE ADDRESS PARAM.LIST        10030000
MAINLP1  DS    0H                                                       10040000
         CLC   NAMEF,=CL8'********'    END OF FIELD PARAM. LIST         10050000
         BE    MAINLPX                 YES                              10060000
*                                                                       10070000
         CTSADBG '>>> CURRENT PROCESSING FIELD=_/_',                   X10080000
               (NAMEF,8,CRULE,1),                                      X10090000
               LEVEL=(DBGL1,4,5,6,7,8),RAREA=RAREA2                     10100000
*                                                                       10110000
         CLI   CRULE,C'B'              BYPASS THE DATA ?                10120000
         BE    MAINLP0                 Y, GET NEXT ACTION MACRO         10130000
         CLI   CRULE,C'E'              ELEMENTARY DATA ?                10140000
         BNE   LSTDATA                 NO                               10150000
* --------------------------------------------------------------------- 10160000
*        GET ELEMENTARY DATA                                            10170000
* --------------------------------------------------------------------- 10180000
         CTSCALL CTSARNE,(ADDRF,CURRACT,DBGL1),LINK=INT                 10190000
         LTR   R15,R15                                                  10200000
         BNZ   MAINLP0                 DATA NOT FOUND,GET NEXT          10210000
*                                                                       10220000
         L     R8,ADDRF                CURRENT FIELD                    10230000
*                                                                       10240000
         CTSADBG 'E/DATA _=#/_/$',                                     X10250000
               (NAMEF,8,?R8,ADDRF+4,?R8,ADDRF+4,?R8),                  X10260000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         10270000
*                                                                       10280000
         CTSCALL FLDPROC,LINK=INT                                       10290000
         LTR   R15,R15                      | AREA OVERFLOW             10300000
         BNZ   RETWA                        |   CHECKING                10310000
         B     MAINLP0                 GET NEXT ACTION MACRO            10320000
* --------------------------------------------------------------------- 10330000
LSTDATA  DS    0H                                                       10340000
*------------------------------------------------------------------     10350000
*        LIST DATA LOOP                                                 10360000
*------------------------------------------------------------------     10370000
LSTLOOP  DS    0H                                                       10380000
*-------------------------------------------------------------------    10390000
*        GET CURRENT LIST DATA                                          10400000
*-------------------------------------------------------------------    10410000
         CTSCALL CTSARNL,(ADDRF,CURRACT,DBGL1),LINK=INT                 10420000
         LTR   R15,R15                                                  10430000
         BNZ   LSTEND                  LIST DATA ENDED                  10440000
*                                                                       10450000
         L     R8,ADDRF                                                 10460000
*                                                                       10470000
         CTSADBG 'L/DATA _=#/_/$',                                     X10480000
               (NAMEF,8,?R8,ADDRF+4,?R8,ADDRF+4,?R8),                  X10490000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         10500000
*                                                                       10510000
         CTSCALL FLDPROC,LINK=INT                                       10520000
         LTR   R15,R15                      | AREA OVERFLOW             10530000
         BNZ   RETWA                        |   CHECKING                10540000
         TM    PRTPF,FLSTLOOP          CONTINUE THIS LIST DATA ?        10550000
         BNO   MAINLP0                 NO, GET NEXT FIELD               10560000
         L     R9,FLDCNTRZ                                              10570000
         LTR   R9,R9                   NO BREAK POINT FOUND             10580000
         BZ    LSTLOOP                 YES, LIST LOOP                   10590000
         CLC   FLDCNTRZ,FLDCNTR        THIS LIST FIELD LOOP ?           10600000
         BE    LSTLOOP                 YES, LIST LOOP                   10610000
         CTSCALL CRTADDR2,LINK=INT     RESET PARAM FOR LOOP             10620000
         B     MAINLP1                                                  10630000
LSTEND   DS    0H                      LIST DATA ENDED                  10640000
         L     R9,CURRFC               ADDR CURRENT REPEAT FLAG         10650000
         MVI   0(R9),1                 LIST DATA ENDED                  10660000
*                                                                       10670000
         CTSADBG 'LIST END FOR _ REPEAT FLAG=~/# BREAK FIELD CNTR=#',  X10680000
               (NAMEF,8,CURRFC,FLDCNTRZ,FLDCNTR),                      X10690000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         10700000
*                                                                       10710000
         L     R9,FLDCNTRZ                                              10720000
         LTR   R9,R9                   BREAK POINT NOT FOUND            10730000
         BZ    MAINLP0                 YES, LIST LOOP                   10740000
*(T)                                                                    10750000
         CLC   FLDCNTRZ,FLDCNTR        THE SAME BREAK POINT             10760000
         BE    MAINLP0                 YES, LIST LOOP                   10770000
*(T)                                                                    10780000
         CTSCALL CTSAACF,LINK=INT      CLEAR ALL HIGHER FLAGS           10790000
         B     MAINLP0                                                  10800000
* --------------------------------------------------------------------- 10810000
*        END OF MAIN LOOP                                               10820000
* --------------------------------------------------------------------- 10830000
MAINLPX  DS    0H                                                       10840000
         SR    R2,R2                                                    10850000
         TRT   CNTF,TABLSTLP           CHECK LOOP TABLE                 10860000
         LTR   R2,R2                   (IF FOUND R2 = FFFFFFL )         10870000
         BNZ   MAINLOOP                YES                              10880000
         CLC   RRT1LINE(3),=CL3'NO'    WILL BE ADD INFORMATION ?        10890000
         BE    RETWA0                  NO                               10900000
         CLC   CLEN(4),CLENI           LENGTH = PREVIOUS LENGTH ?       10910000
         BNE   MAINLPX1                NO, SKIP                         10920000
         CLC   CLENI(4),=F'0'          LENGTH OF PUTTED DATA=0 ?        10930000
         BNE   MAINLPX2                NO,SKIP                          10940000
MAINLPX1 DS    0H                                                       10950000
         L     R3,CLEN                 LENGTH OF CONST PART AREA        10960000
         L     R4,RRTEXTA              ADDR OUTPUT AREA                 10970000
         LA    R4,4(R4)                BRANCH OVER THE MAX.LENGTH       10980000
         MVC   NWUSELN(4),0(R4)        GET USE LENGTH                   10990000
         L     R5,NWUSELN                                               11000000
         CR    R3,R5                   USE LEN = LENGTH OF CONST PART   11010000
         BE    RETWA0                  YES, SKIP                        11020000
MAINLPX2 DS    0H                                                       11030000
         L     R15,RRTOUT              |   USER-OUTPUT                  11040000
         CALL (15),(WRITE,RRTEXTA)     |          ROUTINE               11050000
*                                      CLEAR OUTPUT AREA                11060000
         L     R9,RRTEXTA                   ADDR OF OUTPUT LINE         11070000
         MVC   4(4,R9),USELENP              RESTORE PREVIOUS USE LEN    11080000
         MVC   CLEN,USELENP                 KEEP PREVIOUS USE LEN       11090000
RETWA0   DS    0H                      RETURN                           11100000
         SR    R15,R15                                                  11110000
RETWA    DS    0H                                                       11120000
*                                                                       11130000
         CTSADBG 'MAIN EXTRACT ROUTINE EXITING RC=~',(?R15),           X11140000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         11150000
*                                                                       11160000
         BRTRN (15)                                                     11170000
TABLSTLP DC    256X'00'                TABLE FOR LIST LOOP CHECKING     11180000
         ORG   TABLSTLP+C'L'                                            11190000
         DC    C'L'                                                     11200000
         ORG   ,                                                        11210000
         LTORG                                                          11220000
* ------------------------------------------------------------------    11230000
*        SUBPROGRAMMS                                                   11240000
* ------------------------------------------------------------------    11250000
*        CREATE ADDRESS PARAMETERS LIST                                 11260000
*        R6 - FIELDS COUNTER                                            11270000
* ------------------------------------------------------------------    11280000
CRTADDR  DS    0H                      CREATE ADDRESS PARAM.LIST        11290000
*                                                                       11300000
*        LOCATE CURRENT ACTION TABLE                                    11310000
*                                                                       11320000
CRTADDR1 DS    0H                                                       11330000
         L     R6,FLDCNTR              LOAD FIELD COUNTER               11340000
         LTR   R6,R6                                                    11350000
         BZ    CRTADDR3                FIRST ENTRY                      11360000
         L     R9,ADDRACT              ADDRESS ACTION LIST              11370000
         LA    R9,4(R9)                GET NEXT ADDR ACTION MACRO       11380000
         ST    R9,ADDRACT              STORE CURRENT ADDR ACTION MACRO  11390000
         L     R9,0(R9)                                                 11400000
         ST    R9,CURRACT              STORE ACTION ADDRESS             11410000
         B     CRTADDR3                DEFINITION FIELD PROCESS PARM    11420000
*                                                                       11430000
*        RESET INFORMATION FOR CONTINUE LOOP PROCESSING                 11440000
*                                                                       11450000
CRTADDR2 DS    0H                                                       11460000
         L     R6,FLDCNTRZ             LOAD FIELD COUNTER               11470000
         BCTR  R6,0                    DECR COUNTER                     11480000
         ST    R6,FLDCNTR              RESET FIELD COUNTER              11490000
         L     R9,ADDRACTZ             ADDRESS ACTION LIST              11500000
         ST    R9,ADDRACT              RESET ACTION LIST                11510000
         L     R9,0(R9)                                                 11520000
         ST    R9,CURRACT              STORE ACTION ADDRESS             11530000
*                                                                       11540000
         CTSADBG 'RESET FIELD PROCESS FROM=_ ACTION=~ FLG.REPEAT=#/~', X11550000
               (NAMEFZ,8,CURRACT,FLDCNTRZ,CURRFCZ),                    X11560000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         11570000
*                                                                       11580000
         B     CRTADDR3                DEFINITION FIELD PROCESS PARM    11590000
*                                                                       11600000
*        DEFINITION FIELD PROCESSING PARAMETERS                         11610000
*                                                                       11620000
CRTADDR3 DS    0H                                                       11630000
*                                                                       11640000
         CTSADBG '(T) FIELD COUNTER R6=#',(?R6),                       X11650000
               LEVEL=(DBGL1,8),RAREA=RAREA2                             11660000
*                                                                       11670000
         LA    R4,CNTF                 ADDR. OF REPEAT-FLAG AREA        11680000
         AR    R4,R6                   ADDR FIELD'S REPEAT-FLAG         11690000
         ST    R4,CURRFC               ADDR CURRENT REPEAT-FLAG         11700000
         L     R9,ADDRFL               ADDR. FIELDS LIST PARM           11710000
         SR    R4,R4                                                    11720000
         LR    R5,R6                                                    11730000
         M     R4,RFTELEN              MULTIPLY TO LENGTH OF ONE ENTRY  11740000
*                                      PARAMETERS LIST                  11750000
         AR    R9,R5                   ADDR.OF FIELD PARAMETERS         11760000
         ST    R9,PARMF                                                 11770000
         USING RFTPRM,R9                                                11780000
         MVC   NAMEF(8),RFTFNM         NAME OF FIELD                    11790000
*                                                                       11800000
         CTSADBG '(T) NAMEF=_',(NAMEF,8),                              X11810000
               LEVEL=(DBGL1,8),RAREA=RAREA2                             11820000
*                                                                       11830000
         CLC   NAMEF,=CL8'********'    END OF FIELD LIST                11840000
         BE    CRTADDRE                YES                              11850000
         MVC   CRULE(1),RFTFRL         RULE                             11860000
         MVC   TXTPRM(4),RFTATXT       ADDR OF TXT PARAM. LIST          11870000
         DROP  R9                                                       11880000
         L     R9,TXTPRM               ADDR OF TXT PARAM. LIST          11890000
*                                                                       11900000
         SR    R4,R4                                                    11910000
         IC    R4,0(R9)                LENGTH TEXT BEFORE               11920000
         LA    R9,1(R9)                BRANCH OVER THE LENGTH           11930000
         AR    R9,R4                   BRANCH OVER THE TEXT             11940000
         MVC   PRTPF(1),0(R9)          OUTPUT PARAM.LIST                11950000
         LA    R9,1(R9)                BRANCH OVER THE OUTPUT           11960000
*                                      PARAMETERS FIELD                 11970000
         IC    R4,0(R9)                LENGTH OF TEXT AFTER             11980000
         LA    R9,1(R9)                BRANCH OVER THE LENGTH           11990000
         AR    R9,R4                   BRANCH OVER THE TEXT             12000000
         MVC   TRTADDR(4),0(R9)        ADDR OF TRANSLATE TABLE          12010000
         L     R6,FLDCNTR              LOAD FIELD COUNTER               12020000
         LA    R6,1(R6)                INCR FIELD COUNTER               12030000
         ST    R6,FLDCNTR              SAVE FIELD COUNTER               12040000
*                                                                       12050000
         CTSADBG '(T) UPDATED FIELD COUNTER R6=#',(?R6),               X12060000
               LEVEL=(DBGL1,8),RAREA=RAREA2                             12070000
*                                                                       12080000
         L     R9,CURRFC                                                12090000
*                                                                       12100000
         CTSADBG '(T) REPEAT FIELD PROC 0(R9)=$',(0(R9),1),            X12110000
               LEVEL=(DBGL1,8),RAREA=RAREA2                             12120000
*                                                                       12130000
         CLI   0(R9),1                 REPEAT PROCESSING THIS FIELD?    12140000
         BE    CRTADDR1                NO                               12150000
*                                                                       12160000
         CTSADBG 'FIELD=_.RULE=_.ADDR.TEXT FIELD=~.ADDR TRN TABLE =~', 112170000
               (NAMEF,8,CRULE,1,TXTPRM,TRTADDR),                       212180000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         12190000
*                                                                       12200000
CRTADDRE DS    0H                                                       12210000
         BR    R14                                                      12220000
* ------------------------------------------------------------------    12230000
*        FIELD PROCESSING                                               12240000
* ------------------------------------------------------------------    12250000
FLDPROC  DS    0H                                                       12260000
         ST    R14,REGR14                   SAVE RETURN ADDRESS         12270000
*                                                                       12280000
*        CALL USER'S TEST ROTINE                                        12290000
*                                                                       12300000
         ICM   R15,X'F',RRTTSTP                                         12310000
         BZ    FLDP1                                                    12320000
*                                                   | USER-EXIT         12330000
*                                                   | ROUTINE           12340000
*                                                   | PARM 'FIELD'      12350000
         CALL (15),(CRULE,NAMEF,ADDRF,RRTPRX,RRTEXTA,                  X12360000
               ADDRACTM,RRTRULE,AACTP,RRTDELAY)                         12370000
*                                                                       12380000
         CTSADBG 'TEST EXTERNAL ROUTINE RC=~',(?R15),                  X12390000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         12400000
*                                                                       12410000
         C     R15,=F'0'                                                12420000
         BE    FLDP1                        RET.CODE=0 CONTINUE.        12430000
         C     R15,=F'4'                                                12440000
         BE    FLDNPUT                      RET.CODE=4 DON'T PUT        12450000
         B     FLDRET0                      RETURN                      12460000
*                                                                       12470000
*        CONTINUE                                                       12480000
*                                                                       12490000
FLDP1    DS    0H                                                       12500000
         TM    PRTPF,FPUT                   PUT FIELD TO OUTPUT LINE    12510000
         BZ    FLDNPUT                      DON'T PUT FIELD             12520000
*                                                                       12530000
*        PUT DATA TO OUTPUT AREA                                        12540000
*                                                                       12550000
         CTSCALL CTSARCT,(TYPEF,RRTEXTA,ADDRF,TXTPRM,DBGL1,NAMEF),     X12560000
               LINK=INT                                                 12570000
         LTR   R15,R15                                                  12580000
         BNZ   FLDRET16                     OVERFLOW !                  12590000
*                                                                       12600000
FLDNPUT  DS    0H                                                       12610000
         TM    PRTPF,FPRINT                 PRINT OUTPUT LINE           12620000
         BZ    FLDRPT                       NOPRINT,CHECK REPEAT FLAG   12630000
*                                                                       12640000
*        CALL USER'S OUTPUT ROUTINE                                     12650000
*                                                                       12660000
         ICM   R15,X'F',RRTOUT                                          12670000
         BZ    FLDRPT                       CHECK REPEAT FLAG           12680000
*                                           | USER                      12690000
         CALL (15),(WRITE,RRTEXTA)          |    OUTPUT                 12700000
*                                           |      ROUTINE              12710000
         L     R9,RRTEXTA                   ADDR OF OUTPUT LINE         12720000
         MVC   4(4,R9),USELENP              RESTORE PREVIOUS USE LEN    12730000
         MVC   CLEN,USELENP                 KEEP PREVIOUS USE LEN       12740000
         TM    PRTPH,FREPEAT                HEADER PUT INTO EACH LINE   12750000
         BZ    FLDNHDR                      NOPUT HEADER LINE           12760000
         CTSCALL CTSARMH,LINK=INT           MOVE HEADER                 12770000
         MVC   CLEN(4),4(R9)                KEEP NEW USE LEN            12780000
FLDNHDR  DS    0H                                                       12790000
FLDRPT   DS    0H                                                       12800000
         CLI   CRULE,C'L'                   LIST DATA ?                 12810000
         BE    FLDRPT1                      Y, REPEAT IT !              12820000
         TM    PRTPF,FREPEAT                REPEAT PUT THIS FIELD       12830000
         BZ    FLDNREPT                     NO                          12840000
*                                                                       12850000
*        KEEP LOOP BREAK POINT INFO                                     12860000
*                                                                       12870000
FLDRPT1  DS    0H                                                       12880000
         L     R9,CURRFC                    REPEAT AREA                 12890000
         MVC   0(1,R9),CRULE                REPEAT THIS FIELD 'E'/'L'   12900000
         L     R9,FLDCNTRZ                  FIELD COUNTER               12910000
         LTR   R9,R9                                                    12920000
         BNZ   FLDRET0                      RETURN                      12930000
         MVC   FLDCNTRZ,FLDCNTR             FIELD COUNTER               12940000
         MVC   ADDRACTZ,ADDRACT             ACTION LIST PARM ADDR       12950000
         MVC   NAMEFZ(8),NAMEF                                          12960000
         MVC   CURRFCZ(4),CURRFC                                        12970000
*                                                                       12980000
         CTSADBG 'SET BREAK PNT AT FLD=_/~.RULE=_ FLG.REPEAT ADDR=#/~',112990000
               (NAMEF,8,CURRACT,CRULE,1,FLDCNTRZ,CURRFC),              213000000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         13010000
*                                                                       13020000
         B     FLDRET0                      RETURN                      13030000
FLDNREPT DS    0H                                                       13040000
         L     R9,CURRFC                    REPEAT AREA                 13050000
         MVI   0(R9),1                      NO REPEAT THIS THIS FIELD   13060000
         B     FLDRET0                      RETURN                      13070000
FLDRET0  DS    0H                                                       13080000
         SR    R15,R15                      O.K.                        13090000
         B     FLDRET                                                   13100000
FLDRET16 DS    0H                                                       13110000
         LA    R15,16                       OVERFLOW                    13120000
         B     FLDRET                                                   13130000
FLDRET   DS    0H                                                       13140000
         L     R14,REGR14                   RESTORE RETURN ADDRESS      13150000
         BR    R14                          RETURN                      13160000
*-------------------------------------------------------------------    13170000
CTSARMH  DS    0H                                                       13180000
* ------------------------------------------------------------------    13190000
*        MOVE HEADER TO OUTPUT LINE                                     13200000
* ------------------------------------------------------------------    13210000
* PS0292 STM   R2,R5,STMR2R5                                            13220000
*WS10053 STM   R2,R5,STMR2R7                                     PS0292 13230000
         STM   R2,R7,STMR2R7                                    WS10053 13240000
         L     R3,HEADERL              HEADER LENGTH                    13250000
         LR    R2,R3                                                    13260000
         L     R4,RRTEXTA              ADDR OUTPUT AREA                 13270000
         LA    R4,4(R4)                BRANCH OVER THE MAX.LENGTH       13280000
         MVC   NWUSELN(4),0(R4)        USE LENGTH OF OUTPUT AREA        13290000
         L     R5,NWUSELN                                               13300000
         AR    R2,R5                   USE LEN + HEADER LEN             13310000
         ST    R2,HEADERLN             TOTAL LENGTH WITH HEADER         13320000
         MVC   0(4,R4),HEADERLN        UPDATE USE LEN                   13330000
         LA    R4,4(R4)                BRANCH OVER THE USE LENGTH       13340000
         AR    R4,R5                   BRANCH OVER THE FILLING PART     13350000
*                                                                       13360000
         CTSADBG 'MOVE HEADER TO EXTRACT AREA ADDR ~ (LEN=#)',         113370000
               (?R4,?R3),                                              213380000
               LEVEL=(DBGL1,6,7,8),RAREA=RAREA2                         13390000
*                                                                       13400000
* PS0292 BCTR  R3,0                    DECR FOR EX COMMAND              13410000
* PS0292 EX    R3,MVCHDR               MOVE HEADER LINE  (MVCL !!!!)    13420000
         LR    R5,R3                   DATA LENGTH               PS0292 13430000
         LR    R7,R3                   DATA LENGTH               PS0292 13440000
         LA    R6,HEADERV              SOURCE ADDR               PS0292 13450000
         MVCL  R4,R6                   R6(L=R7) -> R4(L=R5)      PS0292 13460000
* PS0292 LM    R2,R5,STMR2R5                                            13470000
         LM    R2,R7,STMR2R7                                     PS0292 13480000
         BR    R14                                                      13490000
* ------------------------------------------------------------------    13500000
*        CLEAR LOOP FLAGS                                               13510000
* ------------------------------------------------------------------    13520000
CTSAACF  DS    0H                                                       13530000
         SR    R2,R2                                                    13540000
         LA    R5,255                  MAX LOOP COUNTER                 13550000
         LA    R6,CNTF                 ADDR OF LOOP FLAGS               13560000
CTSAACFL DS    0H                                                       13570000
         C     R6,CURRFC               ADDR OF CURRENT FIELD FLAG       13580000
         BE    CTSAACFR                RETURN                           13590000
         CLI   0(R6),C'L'              LIST LOOP FLAG ?                 13600000
         BNE   CTSAACF0                NO                               13610000
         LA    R2,1                    NOT ENDED LIST DATA FOUND        13620000
         B     CTSAACF1                SORRY, LIST NOT ENDED !          13630000
CTSAACF0 DS    0H                                                       13640000
*                                                                       13650000
         CTSADBG 'CLEAR REPEAT FLAG AT ADDR=~ STOP.ADDR=~',            113660000
               (?R6,CURRFC),                                           213670000
               LEVEL=(DBGL1,8),RAREA=RAREA2                             13680000
*                                                                       13690000
         MVI   0(R6),1                 CLEAR REPEAT FLAG                13700000
CTSAACF1 DS    0H                                                       13710000
         LA    R6,1(R6)                GET NEXT FLAG                    13720000
         BCT   R5,CTSAACFL                                              13730000
CTSAACFR DS    0H                                                       13740000
         LTR   R2,R2                                                    13750000
         BNZ   CTSACFRT                WAS FOUND NOT ENDED LIST DATA    13760000
         XC    FLDCNTRZ,FLDCNTRZ       CLEAR BREAK LOOP COUNTER         13770000
         XC    CURRFCZ,CURRFCZ         CLEAR BREAK LOOP PTR             13780000
CTSACFRT DS    0H                                                       13790000
         BR    R14                                                      13800000
* --------------------------------------------------------------------- 13810000
         LTORG                                                          13820000
* ------------------------------------------------------------------    13830000
*        WORK AREAS                                                     13840000
* ------------------------------------------------------------------    13850000
         DS    0D                                                       13860000
RRTEXTA  DS    F                       ADDRESS OF OUTPUT AREA           13870000
AHEADER  DC    A(HEADER)               ADDRESS OF HEADER LINE           13880000
* ------------------------------------------------------------------    13890000
         DS    0D                                                       13900000
* PS0292 HEADER   DC    F'300'         MAX LENGTH OF HEADR LINE         13910000
HEADER   DC    F'1024'                 MAX LENGTH OF HEADR LINE  P20292 13920000
HEADERL  DS    F                       USE LEN                          13930000
* PS0292 HEADERV  DS    CL300          HEADER LINE                      13940000
HEADERV  DS    CL1024                  HEADER LINE               PS0292 13950000
TYPEH    DC    CL1'H'                  HEADER  TYPE LINE                13960000
TYPEE    DC    CL1'E'                  ELEMENT TYPE LINE                13970000
TYPEL    DC    CL1'L'                  LIST    TYPE LINE                13980000
TYPEF    DC    CL1'F'                  FIELD                            13990000
*IS10090  ADDRF    DS    F             FIELD :   4 BYTE LENGTH          14000000
*IS10090           DS    CL2048                    VALUE                14010000
*                                                                       14020000
* PS0292 STMR2R5  DS    4F                                              14030000
STMR2R7  DS    6F                                                PS0292 14040000
RRTDELAY DS    F                       FOR SAVE DELAY ICHEINTY ADDR     14050000
RRTINTY  DS    F                       ICHEINTY ADDR                    14060000
RRTRSGLT DS    F                       SEGMENT'S LIST ADDR              14070000
ADDRTXT  DS    F                       ADDRESS TEXT PARAMETERS LIST     14080000
ADDRACTM DS    F                       ADDRESS ACTION ADDRESS LIST      14090000
ADDRACT  DS    F                       ADDRESS ACTION ADDRESS LIST      14100000
ADDRACTZ DS    F                       ADDRESS ACTION ADDRESS LIST      14110000
CURRACT  DS    F                       CURRENT ACTION ADDRESS           14120000
RRTOUT   DS    F                       EXTERNAL OUTPUT PROGRAM          14130000
ADDRFL   DS    F                       ADDRESS OF FIELDS TABLE          14140000
RFTELEN  DS    F                       FIELD ENTRY LEN                  14150000
HEADERLN DS    F                       HEADER LENGTH                    14160000
NWUSELN  DS    F                       LINE   LENGTH                    14170000
CLEN     DS    F                       LENGTH OF CONSTANT PART          14180000
CLENI    DS    F                       LENGTH OF CONSTANT PART PREV     14190000
USELENP  DS    F                       LENGTH OF CONSTANT PART          14200000
PRTPH    DS    F                       OUTPUT PARAM.LIST FOR HEADER     14210000
PRTPF    DS    F                       OUTPUT PARAM.LIST FOR CURR.FIELD 14220000
NAMEF    DS    CL8                     NAME OF FIELD                    14230000
NAMEFZ   DS    CL8                     NAME OF FIELD                    14240000
AACTP    DC    A(CTSAACT)              ADDR CTSAACT PROGRAM             14250000
RRT1LINE DS    CL3                     SUMM OUTPUT INFORMATION FLAG     14260000
CRULE    DS    CL1                     CURRENT FIELD RULE               14270000
RRTTSTP  DS    F                       ADDRESS EXT ROUTINE              14280000
RRTPRX   DS    F                       PREFIX OUTPUT ROUTINE            14290000
PARMF    DS    F                       FIELD PARAM.LIST FOR CURR.FIELD  14300000
TXTPRM   DS    F                       TEXT PARAM.LIST FOR CURR.FIELD   14310000
TRTADDR  DS    F                       WORK PARAMETER LIST              14320000
REGR14   DS    F                                                        14330000
RAREA2   DS    CL256                                                    14340000
DBGL1    DS    AL1                     DEBUG LEVEL                      14350000
WRITE    DC    CL8'WRITE'                                               14360000
TEX      DC    CL1'Y'                  OPTION FOR EXTERNAL ROUTINE      14370000
CNTF     DS    CL256                   COUNT FIELDS                     14380000
CURRFC   DS    F                       CURRENT FIELD COUNT              14390000
CURRFCZ  DS    F                       CURRENT FIELD COUNT              14400000
FLDCNTR  DS    F                       FIELD COUNTER                    14410000
FLDCNTRZ DS    F                       FIELD COUNTER                    14420000
RRTRULE  DS    F                                                        14430000
MREG4    DS    F                                                        14440000
MVCHDR   MVC   0(0,R4),HEADERV         MOVE HEADER TO OUTPUT LINE       14450000
MVENTRY  MVC   ADDRF+4(0),0(R2)        MOVE ENTRY NAME TO GENERAL FLD   14460000
*        MOVE IT TO END OF ROUTINE ...                       IS10090    14470000
ADDRF    DS    F                       FIELD :   4 BYTE LENGTH          14480000
         DS    CL32768                 INCREASE FROM 2K TO 32K IS10090  14490000
* -----------------------------------------------------------------     14500000
         DROP  ,                                                        14510000
*                                                                       14520000
XTEPRM   DSECT                                                          14530000
XTEOUT   DS    A                       EXTRACT AREA ADDRESS             14540000
XTEACTN  DS    A                       ICHACTN MACRO ADDR               14550000
XTEDBG   DS    A                       DEBUG LEVEL                      14560000
*                                                                       14570000
CTSFRXT  CSECT                                                          14580000
CTSARNE  BEGIN                                                          14590000
*********************************************************************   14600000
*                                                                   *   14610000
* TITLE - CTSARNE                                                   *   14620000
*                                                                   *   14630000
* DESCRIPTION - TREATMENT WORK AREA AFTER ACCES TO RACF DATA BASE   *   14640000
*               GET ELEMENTARY DATA                                 *   14650000
*               PARAMETERS : R1 - ADDRESS OF LIST PARAMETERS        *   14660000
*                            OFFSET :                               *   14670000
*                                   0  ADDRESS RETURN AREA          *   14680000
*                                   4  ADDRESS ACTION MACRO         *   14690000
*                                   8  ADDR OF DEBUG LEVEL          *   14700000
*                                                                   *   14710000
* NOTE - MAP WORKAREA 'NEW'                                         *   14720000
*********************************************************************   14730000
         LR    R11,R1                  STORE PARM REGISTER              14740000
         USING XTEPRM,R11                                               14750000
         L     R8,XTEOUT               RET AREA ADDRESS                 14760000
         SR    R5,R5                                                    14770000
         ST    R5,0(R8)                CLEAR FIELD LENGTH               14780000
         L     R5,XTEACTN              ICHACTN MACRO ADDR               14790000
         ST    R5,ACTAE                STORE ADDR ACTION MACRO          14800000
         L     R5,XTEDBG               DEBUG LEVEL                      14810000
         MVC   DBGLE(1),0(R5)                                           14820000
*----------------------------------------------------------------       14830000
*        GET PTR, LENGTH OF CURRENT ELEMENTARY DATA                     14840000
*----------------------------------------------------------------       14850000
         CTSCALL CTSAACT,(ACTAE,LENE,PTRE,R5E,DBGLE),LINK=INT           14860000
*                                                                       14870000
         L     R10,ACTAE                                                14880000
         L     R10,0(R10)                                               14890000
         CTSADBG '~/GENERAL ELEM DATA INFO:LEN=# PTR=~',               X14900000
               (?R10,LENE,PTRE),                                       X14910000
               LEVEL=(DBGLE,6,7,8)                                      14920000
*                                                                       14930000
         ICM   R6,X'F',PTRE            PTR TO FIELD = 0 ?               14940000
         BZ    EOPNE4                  YES, RETURN                      14950000
         ICM   R9,X'F',LENE            LENGTH                           14960000
         BNP   EOPNE0                  YES                              14970000
         LR    R7,R9                                                    14980000
         ST    R7,0(R8)                STORE LENGTH OF DATA             14990000
         LA    R8,4(R8)                BRANCH OVER THE DATA LENGTH      15000000
*                                                                       15010000
         CTSADBG '~/GET ELEM DATA:LEN=# VAL=_',                        X15020000
               (?R10,?R7,0(R6),?R7),LEVEL=(DBGLE,6,7,8)                 15030000
*                                                                       15040000
         MVCL  R8,R6                   MOVE DATA R6(R7) -> R8(R9)       15050000
*                                                                       15060000
         B     EOPNE0                                                   15070000
EOPNE4   DS    0H                      RC=4. FIELD NOT FOUND            15080000
         LA    R15,4                                                    15090000
         B     EOPNE                                                    15100000
EOPNE0   DS    0H                                                       15110000
         SR    R15,R15                 RC=0. O.K.                       15120000
EOPNE    DS    0H                                                       15130000
         BRTRN (15)                                                     15140000
DBGLE    DS    CL1                     DEBUG LEVEL                      15150000
ACTAE    DS    F                       ADDRESS ACTION MACRO             15160000
LENE     DS    F                       LENGTH                           15170000
PTRE     DS    F                       POINTER                          15180000
R5E      DS    F                       ADDR.FOR CHANGE LENGTH           15190000
         LTORG                                                          15200000
         DROP  ,                                                        15210000
*                                                                       15220000
XTLPRM   DSECT                                                          15230000
XTLOUT   DS    A                       EXTRACT AREA ADDRESS             15240000
XTLACTN  DS    A                       ICHACTN MACRO ADDR               15250000
XTLDBG   DS    A                       DEBUG LEVEL                      15260000
*                                                                       15270000
CTSFRXT  CSECT                                                          15280000
CTSARNL  BEGIN                                                          15290000
*********************************************************************   15300000
*                                                                   *   15310000
* TITLE - CTSARNL                                                   *   15320000
*                                                                   *   15330000
* DESCRIPTION - TREATMENT WORK AREA AFTER ACCES TO RACF DATA BASE   *   15340000
*               GET LIST DATA                                       *   15350000
*               PARAMETERS : R1 - ADDRESS OF FULL WORD THAT         *   15360000
*                            OFFSET:                                *   15370000
*                                   0  ADDRESS RETURN AREA          *   15380000
*                                   4  ADDRESS ACTION MACRO         *   15390000
*                                   8  ADDR OF DEBUG LEVEL          *   15400000
* NOTE - MAP WORKAREA 'NEW'                                         *   15410000
*********************************************************************   15420000
         LR    R11,R1                                                   15430000
         USING XTLPRM,R11                                               15440000
         L     R6,XTLOUT               RETURN AREA ADDRESS              15450000
         SR    R5,R5                                                    15460000
         ST    R5,0(R6)                CLEAR OUTPUT FIELD               15470000
         L     R5,XTLACTN              ICHACTN MACRO ADDR               15480000
         ST    R5,ACTAL                                                 15490000
         L     R5,XTLDBG               ADDR OF DEBUG LEVEL              15500000
         MVC   DBGLL(1),0(R5)                                           15510000
*-------------------------------------------------------------------    15520000
*        GET PTR, LENGTH OF WHOLE LIST DATA ( TOTAL : PTR, LENGTH )     15530000
*-------------------------------------------------------------------    15540000
         CTSCALL CTSAACT,(ACTAL,LENL,PTRL,R5L,DBGLL),LINK=INT           15550000
*                                                                       15560000
         L     R10,ACTAL                                                15570000
         L     R10,0(R10)                                               15580000
         CTSADBG '~/GENERAL LIST DATA INFO:LEN=# PTR=~',               X15590000
               (?R10,LENL,PTRL),LEVEL=(DBGLL,6,7,8)                     15600000
*                                                                       15610000
         ICM   R3,X'F',LENL            TOTAL LIST LENGTH                15620000
         BZ    EOPNL4                  YES, RETURN                      15630000
         ICM   R8,X'F',PTRL            START ADDR. POINTER.             15640000
         BZ    EOPNL4                  YES, RETURN                      15650000
*                                      R8-> LEN | VALUE                 15660000
* --------------------------------------------------------------        15670000
*        CURRENT LIST DATA                                              15680000
* --------------------------------------------------------------        15690000
         MVC   LENGTHNL,0(R8)          LENGTH OF CURRENT LIST DATA      15700000
         L     R7,LENGTHNL             R7 = CURRENT LIST DATA LENGTH    15710000
         LA    R8,4(R8)                R8 -> CURRENT LIST DATA VAL      15720000
         S     R3,=F'4'                TOTAL LIST LENGTH - 4            15730000
*                                                                       15740000
         LTR   R7,R7                   CURRENT LIST DATA LENGTH <= 0 ?  15750000
         BNP   RNLUPD                  YES, SKIP                        15760000
         LR    R9,R7                                                    15770000
         ST    R7,0(R6)                STORE LENGTH OF DATA             15780000
         LA    R6,4(R6)                BRANCH OVER THE DATA LENGTH      15790000
*                                                                       15800000
         CTSADBG '~/GET LIST DATA:LEN=# VAL=_',                        X15810000
               (?R10,?R7,0(R8),?R7),LEVEL=(DBGLL,6,7,8)                 15820000
*                                                                       15830000
*                                                                       15840000
         MVCL  R6,R8                   MOVE DATA                        15850000
*                                                                       15860000
* -------------------------------------------------------------------   15870000
*        UPDATE INFORMATION FOR CONTINUE LIST PROCESSING                15880000
* -------------------------------------------------------------------   15890000
RNLUPD   DS    0H                                                       15900000
         S     R3,LENGTHNL             TOTAL LIST LEN -= LEN OF DATA    15910000
         L     R8,PTRL                 START ADDR. POINTER.             15920000
         LA    R8,4(R8)                R8 -> CURRENT LIST DATA VAL      15930000
         A     R8,LENGTHNL             NEXT ADDR                        15940000
         L     R5,R5L                  ADDR OF TOTAL LIST INFO          15950000
         ST    R8,4(R5)                STORE START ADDRESS              15960000
         ST    R3,0(R5)                STORE LENGTH                     15970000
*                                                                       15980000
         CTSADBG '~/UPDATE GENERAL INFO :LEN=# PTR=~',                 X15990000
               (?R10,?R3,?R8),LEVEL=(DBGLL,6,7,8)                       16000000
*                                                                       16010000
         B     EOPNL0                                                   16020000
*                                                                       16030000
EOPNL0   DS    0H                                                       16040000
         SR    R15,R15                                                  16050000
         B     EOPNL                                                    16060000
EOPNL4   DS    0H                                                       16070000
         LA    R15,4                   END-OF-LIST-INFORMATION          16080000
         B     EOPNL                                                    16090000
EOPNL    DS    0H                                                       16100000
         BRTRN (15)                                                     16110000
DBGLL    DS    CL1                     DEBUG LEVEL                      16120000
ACTAL    DS    F                       ADDR OF ACTION MACRO             16130000
LENL     DS    F                       LENGTH OF LIST DATA              16140000
PTRL     DS    F                       PTR TO LIST DATA                 16150000
R5L      DS    F                                                        16160000
         LTORG                                                          16170000
* ------------------------------------------------------------------    16180000
*        WORK AREAS                                                     16190000
* ------------------------------------------------------------------    16200000
LENGTHNL DS    F                       LENGTH OF DATA                   16210000
         DROP  ,                                                        16220000
*                                                                       16230000
XTCPRM   DSECT                                                          16240000
XTCFTYPE DS    A                       TYPE OF FIELD                    16250000
XTCOUT   DS    A                       OUTPUT AREA                      16260000
*                                      F       - MAX LENGTH             16270000
*                                      F       - USE LENGTH             16280000
*                                      CL....  - EXTRACT AREA           16290000
XTCFLD   DS    A                       FIELD                            16300000
XTCTXT   DS    A                       TEXT PARAMETERS LIST             16310000
XTCDBG   DS    A                       DEBUG LEVEL                      16320000
XTCFNM   DS    A                       FIELD NAME                       16330000
*                                                                       16340000
CTSFRXT  CSECT                                                          16350000
CTSARCT  BEGIN *,R7                                                     16360000
*********************************************************************   16370000
*                                                                   *   16380000
* TITLE - CTSARCT                                                   *   16390000
*                                                                   *   16400000
* DESCRIPTION - WORK AREA PROCESSING AFTER ACCES TO RACF DATA BASE  *   16410000
*               PUT DATA TO OUTPUT AREA                             *   16420000
*               PARAMETERS : R1 - ADDRESS OF LIST PARAMETERS        *   16430000
*                            OFFSET 0  TYPE OF FIELD                *   16440000
*                            OFFSET 4  OUTPUT AREA                  *   16450000
*                                      F       - MAX LENGTH         *   16460000
*                                      F       - USE LENGTH         *   16470000
*                                      CL....  - LINE               *   16480000
*                                   8  FIELD                        *   16490000
*                                  12  TEXT PARAMETERS LIST         *   16500000
*                                  16  DEBUG LEVEL                  *   16510000
*                                  20  FIELD NAME                   *   16520000
*                                                                   *   16530000
*********************************************************************   16540000
         LR    R6,R1                   KEEP PARM REGISTER               16550000
         USING XTCPRM,R6                                                16560000
         L     R4,XTCDBG               DEBUG LEVEL                      16570000
         MVC   DBGL2(1),0(R4)                                           16580000
         L     R4,XTCOUT               OUTPUT AREA PARAM                16590000
         L     R4,0(R4)                ADDRESS OF OUTPUT AREA           16600000
         MVC   MAXLEN(4),0(R4)         STORE MAX LEN                    16610000
*                                                                       16620000
         LR    R5,R4                   START ADDR. OF OUTPUT LINE       16630000
         A     R5,MAXLEN               MAX. ADDRESS FOR STORE DATAS     16640000
         ST    R5,MAXADDR              END ADDR OF OUTPUT LINE          16650000
*                                                                       16660000
         LA    R4,4(R4)                BRANCH OVER THE MAX LENGTH       16670000
         ST    R4,USELNADR             STORE USE LEN ADDR               16680000
         MVC   USELEN(4),0(R4)         STORE USE LEN VALUE              16690000
         L     R10,USELEN                                               16700000
*                                                                       16710000
         CTSADBG 'ADDR.LINE=~. MAXLEN=~/#. USELEN=~/#',                X16720000
               (?R4,MAXLEN,MAXLEN,?R10,?R10),LEVEL=(DBGL2,7,8),        X16730000
               RAREA=DBGAREA                                            16740000
*                                                                       16750000
         LA    R4,4(R4)                BRANCH OVER THE USE  LENGTH      16760000
         ST    R4,PUTADDR              START ADDR  FOR PUT              16770000
         A     R4,USELEN               BRANCH OVER THE USING PART       16780000
         ST    R4,PUTADDRP             START ADDR FOR CURRENT PROCESS   16790000
         L     R9,XTCTXT               TEXT PARAMETER ADDR              16800000
         L     R9,0(R9)                ADDRESS OF TEXT PARAM.LIST       16810000
*----------------------------------------------------------------       16820000
*        START PROCESS 'PUT DATA TO EXTRACT AREA'                       16830000
*----------------------------------------------------------------       16840000
*                                                                       16850000
         CTSCALL GETW,LINK=INT         GET OUTPUT PARAMETERS LIST       16860000
*                                      AND ADDRESS WORK PARAM.LIST      16870000
* --------------------------------------------------------------------  16880000
*        'PUT FIELD' PROCESSING                                         16890000
* --------------------------------------------------------------------  16900000
         L     R11,XTCFLD              ADDRESS OF FIELD                 16910000
         L     R12,0(R11)              LENGTH OF FIELD                  16920000
         LTR   R12,R12                 DATA LENGTH = 0 ?                16930000
         BZ    PTDCHAR                                                  16940000
         LA    R11,4(R11)              BRANCH OVER THE LENGTH OF FIELD  16950000
* --------------------------------------------------------------------  16960000
*        CHECK WHETHER NEED TRANSLATE TABLE                             16970000
* --------------------------------------------------------------------  16980000
         CLC   ADDRTT(4),=F'0'         ADDRESS OF TRANSLATE TABLE=0?    16990000
         BE    PTDSTRT                 YES,SKIP                         17000000
         CTSCALL TRTTBL,LINK=INT       INVOKE TRANSLATE TABLE           17010000
         B     TRTRETCD(R15)                                            17020000
TRTRETCD B     PTDCHAR                 CHAR DATA                        17030000
         B     PTDHEXX1                HEX DATA                         17040000
         B     PTDNPTAF                DON'T PUT DATA                   17050000
         B     PTDERR                  OVERFLOW                         17060000
* --------------------------------------------------------------------  17070000
*        PROCESSING DATAS WITHOUT TRANSLATE TABLE                       17080000
* --------------------------------------------------------------------  17090000
PTDSTRT  DS    0H                                                       17100000
         TM    PRTF,FDEC               DECIMAL DATA                     17110000
         BO    PTDDEC                                                   17120000
         TM    PRTF,FCHAR                                               17130000
         BNO   PTDHEX                  HEX DATA                         17140000
         B     PTDCHAR                 N,CHAR DATA                      17150000
* --------------------------------------------------------------------  17160000
*        HEX NUMBERS                                                    17170000
* --------------------------------------------------------------------  17180000
PTDHEX   DS    0H                                                       17190000
         CH    R12,=H'255'             MAX LEN OF HEX DATA              17200000
         BH    PTDFLDER                HEX DATA TOO LONG                17210000
PTDHEXX  DS    0H                                                       17220000
         CH    R12,=H'4'               MAX LEN OF NUMB HEX DATA         17230000
         BNH   PTDHEXN                 NUMBER HEX DATA                  17240000
*                                                                       17250000
*        CONVERT HEX DATA TO HEX 'DUMP' DATA                            17260000
*                                                                       17270000
PTDHEXX1 DS    0H                                                       17280000
         LTR   R12,R12                 DATA LENGTH = 0 ?                17290000
         BZ    PTDCHAR                                                  17300000
         LA    R5,PDECT                ADDRESS OF TARGET AREA           17310000
         LR    R8,R12                  KEEP DATA LENGTH                 17320000
PTDHEXXL DS    0H                                                       17330000
         MVC   HEXWRK1(1),0(R11)       MOVE BYTE                        17340000
         UNPK  HEXWRK2(3),HEXWRK1(2)   UNPK ONE BYTE                    17350000
         MVC   0(2,R5),HEXWRK2         MOVE 2 BYTE RESULT TO TARGET     17360000
         LA    R5,2(R5)                INCR TARGET ADDR                 17370000
         LA    R11,1(R11)              INCR SOURCE ADDR                 17380000
         BCT   R8,PTDHEXXL             LOOP                             17390000
         LR    R8,R12                  SOURCE DATA LEN                  17400000
         SLL   R8,1                    SOURCE DATA LEN * 2 = TARGET LEN 17410000
         LR    R12,R8                                                   17420000
         BCTR  R12,0                   DECR FOR EX COMMAND              17430000
         EX    R12,TRTXX               TRANSLATE SPECIAL SMB TO CHAR    17440000
         LA    R12,1(R12)              RESTORE LENGTH                   17450000
         LR    R11,R5                  |ADDR OF LAST BYTE               17460000
         BCTR  R11,0                   |     OF TARGET DATA             17470000
         B     PTDHEX2                                                  17480000
*                                                                       17490000
*        HEX NUMBERS DATAS                                              17500000
*                                                                       17510000
PTDHEXN  DS    0H                                                       17520000
         XC    PDEC,PDEC               CLEAR TARGET DATA                17530000
         LA    R5,PDEC                                                  17540000
         LA    R8,8                    MAX LEN OF TARGET DATA           17550000
         SR    R8,R12                  OFFSET FOR MOVING                17560000
         AR    R5,R8                   ADDR FOR MOVING DATA             17570000
         BCTR  R12,0                   DECR FOR EX COMMAND              17580000
         EX    R12,MVCHEX              MOVE HEX DATA                    17590000
         LA    R12,1(R12)              RESTORE LENGTH                   17600000
         CLC   PDEC(8),=D'0'           HEX DATA = 0                     17610000
         BNZ   PTDHEX1                 N, SKIP                          17620000
*----------------------------------------------------------------       17630000
*        HEX DATA=0 . STORE '0' TO EXTRACT AREA                         17640000
*----------------------------------------------------------------       17650000
         MVI   0(R11),C'0'             SAVE CHAR '0'                    17660000
         LA    R12,1                   FIELD LENGTH                     17670000
         B     PTDCHAR                 CHAR DATA                        17680000
*----------------------------------------------------------------       17690000
*        HEX DATA NE 0 . CONVERT TO DECIMAL AND EDIT DATA               17700000
*----------------------------------------------------------------       17710000
PTDHEX1  DS    0H                                                       17720000
         L     R5,PDEC+4                                                17730000
         CVD   R5,PDEC                 CONVERT TO DECIMAL               17740000
         UNPK  PDECT(16),PDEC(8)       UNPACK DECIMAL DATA              17750000
         OI    PDECT+15,X'F0'                                           17760000
         LA    R11,PDECT+15            ADDR OF LAST BYTE                17770000
         LA    R12,16                  DATA LENGTH                      17780000
*                                                                       17790000
*        CALCULATE DATA LENGTH WITHOUT LEADING ZEROES                   17800000
*        R12 - DATA LENGTH, R11 - ADDR OF LAST BYTE                     17810000
*                                                                       17820000
PTDHEX2  DS    0H                                                       17830000
         LR    R1,R11                                                   17840000
         BCTR  R12,0                                                    17850000
         EX    R12,SRCHNZ              SEARCH FIRST NON ZERO BYTE       17860000
         LR    R8,R1                   KEEP START ADDR OF DATA          17870000
         SR    R11,R1                  DATA LENGTH - 1                  17880000
         LR    R12,R11                                                  17890000
         LA    R12,1(R12)              DATA LENGTH                      17900000
         LR    R11,R8                  DATA ADDR                        17910000
         B     PTDCHAR                 PUT DATA                         17920000
* --------------------------------------------------------------------  17930000
*        DECIMAL TIME, DATE                                             17940000
*        RACF FORMAT OF DATE : YYDDDF    BINARY                         17950000
*        RACF FORMAT OF TIME : HHMMSSTT  BINARY                         17960000
* --------------------------------------------------------------------  17970000
PTDDEC   DS    0H                                                       17980000
         CH    R12,=H'10'              MAX LEN OF DECIMAL DATA          17990000
         BH    PTDFLDER                DECIMAL DATA TOO LONG            18000000
         LTR   R12,R12                                                  18010000
         BZ    PTDRET0                                                  18020000
*                                                                       18030000
*        CHECK ILLEGAL DECIMAL SYMBOLS                                  18040000
*                                                                       18050000
         BCTR  R12,0                   DECR FOR EX COMMAND              18060000
         EX    R12,CHKDEC                                               18070000
         BNZ   PTDDEC1                                                  18080000
         SR    R12,R12                                                  18090000
         B     PTDCHAR                 PUT DATA                         18100000
PTDDEC1  DS    0H                                                       18110000
         LA    R12,1(R12)              RESTORE LENGTH                   18120000
         LR    R5,R11                  ADDR OF DATA                     18130000
         AR    R5,R12                  | ADDR OF                        18140000
         BCTR  R5,0                    |  LAST BYTE OF DATA             18150000
*                                                                       18160000
         OI    0(R5),X'0F'             PREPARING FOR UNPK COMMAND       18170000
         BCTR  R12,0                   DECR FOR EX COMMAND              18180000
         EX    R12,DECUPACK            UNPACK DECIMAL DATA              18190000
         LA    R12,1(R12)              RESTORE LENGTH OF DATA           18200000
         OI    PDECT+15,X'F0'                                           18210000
         TRT   PDECT(16),NUMTAB        CHECK VALIDITY OF DECIMAL DATA   18220000
         BNZ   PTDFLDER                DECIMAL DATA ERROR               18230000
* --------------------------------------------------------------------  18240000
*        CHECK KIND OF DECIMAL DATA                                     18250000
*---------------------------------------------------------------------  18260000
PTDDATE  DS    0H                                                       18270000
         TM    PRTF,FDATE              DECIMAL DATA ? ( DATE )          18280000
         BO    PTDDATEY                YES                              18290000
*-------------------------------------------------------------------    18300000
*        DECIMAL TIME DATA                                              18310000
*-------------------------------------------------------------------    18320000
         LA    R12,6                   TIME LENGTH IN FORM HHMMSS       18330000
         LA    R11,PDECT+9             START ADDR OF CONVERTED FIELD    18340000
         B     PTDCHAR                 PUT CHAR DATA                    18350000
*-------------------------------------------------------------------    18360000
*        DECIMAL DATE DATA                                              18370000
*-------------------------------------------------------------------    18380000
PTDDATEY DS    0H                                                       18390000
         LA    R12,5                   DATE LENGTH IN FORM YYDDD        18400000
         LA    R11,PDECT+11            START ADDR OF CONVERTED FIELD    18410000
         B     PTDCHAR                 PUT CHAR DATA                    18420000
* -------------------------------------------------------------------   18430000
*        'PUT FIELD' ERROR                                              18440000
* --------------------------------------------------------------------  18450000
PTDFLDER DS    0H                                                       18460000
         L     R6,XTCFNM               FIELD NAME                       18470000
         CTSADBG 'ERR FIELD=_ VALUE=#/$',                              X18480000
               (0(R6),8,?R12,0(R11),?R12),                             X18490000
               RAREA=DBGAREA                                            18500000
         SR    R12,R12                                                  18510000
         B     PTDRET0                 RETURN                           18520000
*--------------------------------------------------------------         18530000
*        CHAR DATA . R11 - ADDR, R12 - LEN                              18540000
*--------------------------------------------------------------         18550000
PTDCHAR  DS    0H                                                       18560000
         LTR   R12,R12                                                  18570000
         BZ    PTDRET0                                                  18580000
         CTSCALL PUTTXT,(LTXTL,ATXTL),LINK=INT  PUT 'TEXT LEFT'         18590000
         LTR   R15,R15                                                  18600000
         BNZ   PTDERR                  OVERFLOW                         18610000
*                                                                       18620000
         CTSCALL CHKL,LINK=INT         CHECK OVERFLOW !                 18630000
         LTR   R15,R15                 OVERFLOW ?                       18640000
         BNZ   PTDERR                  Y, RETURN                        18650000
         CH    R12,=H'255'             CHECK LENGTH OF DATA             18660000
         BH    PTDCHARL                GOTO MOVE LONG DATA              18670000
*                                                                       18680000
*        MOVE SHORT DATA  (BY MVC COMMAND)                              18690000
*                                                                       18700000
         BCTR  R12,0                   DECR FOR EX COMMAND              18710000
         EX    R12,MVCFLD              MOVE CHAR DATA TO OUTPUT AREA    18720000
         LA    R12,1(R12)              RESTORE DATA LENGTH              18730000
         B     PTDCAHRC                                                 18740000
*                                                                       18750000
*        MOVE LONG DATA   (BY MVCL COMMAND)                             18760000
*                                                                       18770000
PTDCHARL DS    0H                                                       18780000
*PS0292  LR    R7,R4                   KEEP TARGET ADDR                 18790000
*PS0292  LR    R8,R11                  KEEP SOURCE ADDR                 18800000
         STM   R4,R5,TRGADDR           KEEP TARGET ADDR          PS0292 18810000
         STM   R10,R11,SRCADDR         KEEP SOURCE ADDR          PS0292 18820000
*                                      R4  -> TARGET ADDR               18830000
         LR    R5,R12                  R5  =  TARGET LEN                18840000
         LR    R10,R11                 R10 -> SOURCE ADDR               18850000
         LR    R11,R12                 R11 =  SOURCE LEN                18860000
         MVCL  R4,R10                  MOVE THE FIELD                   18870000
*PS0292  LR    R4,R7                   RESTORE TARGET ADDR              18880000
*PS0292  LR    R11,R8                  RESTORE SOURCE ADDR              18890000
         LM    R4,R5,TRGADDR           RESTORE TARGET ADDR       PS0292 18900000
         LM    R10,R11,SRCADDR         RESTORE SOURCE ADDR       PS0292 18910000
         B     PTDCAHRC                                                 18920000
*                                                                       18930000
PTDCAHRC DS    0H                                                       18940000
         CTSADBG 'AT ~ PUT FIELD=#/_',                                 X18950000
               (?R4,?R12,0(R11),?R12),LEVEL=(DBGL2,7,8),               X18960000
               RAREA=DBGAREA                                            18970000
*                                                                       18980000
         AR    R4,R12                  NEW ADDR FOR PUT TO OUTPUT AREA  18990000
         CTSCALL PUTTXT,(LTXTR,ATXTR),LINK=INT  PUT 'TEXT RIGHT'        19000000
         LTR   R15,R15                                                  19010000
         BNZ   PTDERR                  OVERFLOW                         19020000
*                                                                       19030000
PTDNPTAF DS    0H                                                       19040000
*                                                                       19050000
*        UPDATE EXTRACT AREA USE LENGTH                                 19060000
*                                                                       19070000
         C     R4,PUTADDRP             WERE PUTTED SOMETHING ?          19080000
         BE    PTDRET0                 NO, RETURN                       19090000
         S     R4,PUTADDR              NEW USE LENGTH                   19100000
*                                                                       19110000
         CTSADBG 'UPDATED USELEN(R4)=#/~',                             X19120000
               (?R4,?R4),LEVEL=(DBGL2,7,8),RAREA=DBGAREA                19130000
*                                                                       19140000
         L     R5,USELNADR             ADDR OF USE LENGTH               19150000
         ST    R4,USELEN               STORE USE LENGTH                 19160000
         MVC   0(4,R5),USELEN          STORE USE LENGTH                 19170000
         B     PTDRET0                                                  19180000
PTDRET0  DS    0H                                                       19190000
         SR    R15,R15                                                  19200000
         B     RETCT                                                    19210000
PTDERR   DS    0H                      OVERFLOW OUTPUT AREA             19220000
         LA    R15,16                  R15=16                           19230000
         B     RETCT                                                    19240000
RETCT    DS    0H                                                       19250000
         BRTRN (15)                    RETURN                           19260000
TRGADDR  DS    2F                                               PS0292  19270000
SRCADDR  DS    2F                                               PS0292  19280000
* -----------------------------------------------------------------     19290000
*        SUBPROGRAMMS                                                   19300000
*        GET WORK PARAMETER LIST                                        19310000
*        R9 - ADDR TEXT PARAMETERS LIST                                 19320000
* -----------------------------------------------------------------     19330000
GETW     DS    0H                                                       19340000
         SR    R11,R11                                                  19350000
         IC    R11,0(R9)               LENGTH OF TXT BEFORE FIELD       19360000
         ST    R11,LTXTL                                                19370000
         LA    R9,1(R9)                BRANCH OVER THE LENGTH           19380000
         ST    R9,ATXTL                ADDRESS OF TEXT BEFORE           19390000
         AR    R9,R11                  BRANCH OVER THE TEXT             19400000
         MVC   PRTF(1),0(R9)           STORE OUTPUT PARAMETER LIST      19410000
         LA    R9,1(R9)                BRANCH OVER THE OUTPUT           19420000
*                                      PARAMETERS LIST                  19430000
         IC    R11,0(R9)               LENGTH OF TXT AFTER  FIELD       19440000
         ST    R11,LTXTR                                                19450000
         LA    R9,1(R9)                BRANCH OVER THE LENGTH           19460000
         ST    R9,ATXTR                ADDRESS OF TEXT BEFORE           19470000
         AR    R9,R11                  BRANCH OVER THE TEXT             19480000
         MVC   ADDRTT(4),0(R9)         STORE ADDRESS TRANSLATE TABLE    19490000
         BR    R14                                                      19500000
* ------------------------------------------------------------------    19510000
*        PUT TEXT INFORMATION ROUTINE                                   19520000
*        R1 - ADDR OF LIST PARAMETERS                                   19530000
*             OFFSET : 0 - ADDR OF TEXT LENGTH                          19540000
*                      4 - ADDR OF TEXT                                 19550000
* ------------------------------------------------------------------    19560000
PUTTXT   DS    0H                                                       19570000
         ST    R14,R14TXT              SAVE R14                         19580000
         LR    R5,R12                  KEEP R12 ( DATA LENGTH )         19590000
*                                                                       19600000
         L     R12,0(R1)                                                19610000
         L     R12,0(R12)              TEXT LENGTH                      19620000
         L     R9,4(R1)                                                 19630000
         L     R9,0(R9)                TEXT ADDR                        19640000
         CTSCALL CHKL,LINK=INT         CHECK OVERFLOW !                 19650000
         LTR   R15,R15                 OVERFLOW ?                       19660000
         BNZ   PUTTXT16                Y,RETURN                         19670000
         LTR   R12,R12                 LENGTH = 0 ?                     19680000
         BZ    PUTTXT0                 YES, RETURN                      19690000
         BCTR  R12,0                   DECR FOR EX COMMAND              19700000
         EX    R12,MVCTXT              MOVE TEXT BEFORE                 19710000
         LA    R12,1(R12)              RESTORE LENGTH                   19720000
*                                                                       19730000
         CTSADBG 'AT ~ PUT TEXT INFO=#/_',                             X19740000
               (?R4,?R12,0(R9),?R12),LEVEL=(DBGL2,7,8),RAREA=DBGAREA    19750000
*                                                                       19760000
         AR    R4,R12                  NEW ADDR IN OUTPUT AREA          19770000
PUTTXT0  DS    0H                                                       19780000
         SR    R15,R15                                                  19790000
         B     PUTTXTR                                                  19800000
PUTTXT16 DS    0H                                                       19810000
         LA    R15,16                                                   19820000
         B     PUTTXTR                                                  19830000
PUTTXTR  DS    0H                                                       19840000
         LR    R12,R5                  RESTORE R12 ( DATA LENGTH )      19850000
         L     R14,R14TXT              RESTORE R14                      19860000
         BR    R14                                                      19870000
* ------------------------------------------------------------------    19880000
*        TRANSLATE TABLE PROCESSING                                     19890000
* ------------------------------------------------------------------    19900000
TRTTBL   DS    0H                                                       19910000
         ST    R14,STORE14                                              19920000
         CH    R12,=H'255'             LENGTH OF DATA > 255 BYTE        19930000
         BH    TRTRET                  Y, RETURN                        19940000
         L     R2,ADDRTT               ADDRESS TRANSLATE TABLE          19950000
         CLI   0(R2),X'FF'             FLAGS TRANSLATE TABLE ?          19960000
         BNE   TRTNFLG0                N,SKIP                           19970000
         LA    R2,1(R2)                BRANCH OVER THE FLAG             19980000
         CTSCALL TRTTBLF,LINK=INT      INVOKE FLAGS TRANSLATE TABLE     19990000
         B     TRTRET                  RETURN                           20000000
*-----------------------------------------------------------------      20010000
*        GENERAL TRANSLATE TABLE PROCESSING                             20020000
*        R2 - ADDR OF TRANSLATE TABLE                                   20030000
*        R12- LENGTH OF RACF DATA                                       20040000
*        TRANSLATE TABLE STRUCTURE :                                    20050000
*                 DC     AL1(LENGTH-OF-DATA-FROM-RACF)                  20060000
*                 DC     CL...'DATA-FROM-RACF'                          20070000
*                 DC     AL1(LENGTH-OF-DATA-FROM-TRANSL-TABLE)          20080000
*                 DC     CL...'DATA-FROM-TRANSL-TABLE'                  20090000
*                 .......                                               20100000
*-----------------------------------------------------------------      20110000
TRTNFLG0 DS    0H                                                       20120000
*                                                                       20130000
         CTSADBG '(TT) OBTAINED DATA=#/_/$',                           X20140000
               (?R12,0(R11),?R12,0(R11),?R12),                         X20150000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            20160000
*                                                                       20170000
TRTNFLAG DS    0H                                                       20180000
         SR    R3,R3                                                    20190000
         IC    R3,0(R2)                LENGTH OF RACF DATA (SOURCE)     20200000
         LA    R2,1(R2)                BRANCH OVER THE LENGTH DATA FROM 20210000
*                                                                       20220000
         CTSADBG '(TT) TABLE DATA=#/_/$',                              X20230000
               (?R3,0(R2),?R3,0(R2),?R3),                              X20240000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            20250000
*                                                                       20260000
         LTR   R3,R3                   LENGTH=0                         20270000
         BZ    TRTNFLG1                YES. END OF TRANSLATE TABLE      20280000
         CR    R3,R12                  CHECK LENGTH                     20290000
         BE    TRTLOOP1                EQUAL LENGTH                     20300000
*                                                                       20310000
*        GET NEXT ELEMENT FROM TABLE                                    20320000
*                                                                       20330000
TRTLOOP0 DS    0H                                                       20340000
         AR    R2,R3                   BRANCH OVER THE SOURCE DATA      20350000
         IC    R3,0(R2)                LENGTH OF TARGET DATA            20360000
*                                                                       20370000
         CTSADBG '(TT) SKIP DATA OF LENGTH=#',(?R3),                   X20380000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            20390000
*                                                                       20400000
         LA    R2,1(R2)                BRANCH OVER THE TARGET DATA LEN  20410000
         AR    R2,R3                   BRANCH OVER THE TARGET DATA      20420000
         B     TRTNFLAG                CHECK NEXT DATA FROM TRNSL/TBL   20430000
*----------------------------------------------------------------       20440000
*        EQUAL LENGTH.                                                  20450000
*        R3    - LENGTH OF DATA FROM TRANSLATE TABLE                    20460000
*        R12   - LENGTH OF DATA FROM RACF RETURN AREA                   20470000
*----------------------------------------------------------------       20480000
TRTLOOP1 DS    0H                                                       20490000
         BCTR  R3,0                    DECR FOR EX COMMAND              20500000
         EX    R3,CHKTBL                                                20510000
         LA    R3,1(R3)                RESTORE LENGTH                   20520000
         BNE   TRTLOOP0                THE DATAS ARE NOT EQUAL.         20530000
*---------------------------------------------------------------------  20540000
*        EQUAL LENGTH AND DATA                                          20550000
*---------------------------------------------------------------------  20560000
TRTEQUAL DS    0H                                                       20570000
         AR    R2,R3                   BRANCH OVER THE SOURCE DATA      20580000
         IC    R3,0(R2)                LENGTH OF TARGET DATA            20590000
         LA    R2,1(R2)                BRANCH OVER THE TARGET DATA LEN  20600000
         LTR   R12,R3                                                   20610000
         BZ    TRTRET0                 SUPPRESS PUT DATA                20620000
*                                                                       20630000
         CTSADBG 'DATA FROM TRANL TABLE=#/_',                          X20640000
               (?R12,0(R2),?R12),LEVEL=(DBGL2,7,8),RAREA=DBGAREA        20650000
*                                                                       20660000
         BCTR  R12,0                   DECR FOR EX COMMAND              20670000
         EX    R12,MOVTRT              MOVE DATA FROM TRANSLATE TABLE   20680000
         LA    R12,1(R12)              RESTORE LENGTH                   20690000
         B     TRTRET0                                                  20700000
*--------------------------------------------------------------         20710000
*        END-OF-TRANSLATE TABLE                                         20720000
*        ANY DATA WAS NOT FOUND                                         20730000
*        - IF TYPE OF DATA CHAR  - PUT DATA FROM RACF TO OUTPUT AREA    20740000
*          ELSE                  - DON'T PUT DATA TO OUTPUT AREA        20750000
*--------------------------------------------------------------         20760000
TRTNFLG1 DS    0H                                                       20770000
         TM    PRTF,FDATE              DEC FIELD  ?                     20780000
         BO    TRTRET4                 Y, SKIP                          20790000
         TM    PRTF,FCHAR              CHAR FIELD ?                     20800000
         BNO   TRTRET4                 NO, SKIP                         20810000
         B     TRTRET0                 CHAR DATA                        20820000
*                                                                       20830000
*        TRANSLATE TABLE RETURNS CODES                                  20840000
*                                                                       20850000
TRTRET0  DS    0H                      PUT CHAR DATA AFTER PROCESSING   20860000
         SR    R15,R15                                                  20870000
         B     TRTRET                                                   20880000
TRTRET4  DS    0H                      PUT HEX ( NOT NUMBER )           20890000
*        LA    R15,4                                                    20900000
         SR    R12,R12                                                  20910000
         LA    R15,0                                                    20920000
         B     TRTRET                                                   20930000
TRTRET   DS    0H                                                       20940000
         L     R14,STORE14                                              20950000
         BR    R14                      RETURN                          20960000
* ------------------------------------------------------------------    20970000
*        FLAGS TRANSLATE TABLE                                          20980000
*        R11 - FLAGS DATA FROM RACF RETURN AREA                         20990000
*        R2  - ADDR OF TRANSLATE TABLE                                  21000000
* ------------------------------------------------------------------    21010000
* NOTE : FLAGS DATA CAN BE SEPARATE TO NUMBER OF DATAS                  21020000
*        THAT WILL BE PUTTED TO OUTPUT AREA. EACH DATA MUST BE          21030000
*        PUTTED ACCORDING EXTRACTORS RULES : 'TEXT BEFORE', DATA,       21040000
*        AND 'TEXT AFTER'                                               21050000
* ------------------------------------------------------------------    21060000
TRTTBLF  DS    0H                      FLAGS TRANSLATE TABLE            21070000
         ST    R14,STORE14S                                             21080000
         MVI   FLAGI,0                 INTERNAL FLAG 'PUT DATA'         21090000
         MVC   RMASK(1),0(R11)         MOVE MASK DATA                   21100000
*                                                                       21110000
         CTSADBG '(TF) OBTAINED MASK=$',(RMASK,1),                     X21120000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            21130000
*                                                                       21140000
         CLI   RMASK,X'00'             FLAG = 0 ?                       21150000
         BE    TRFRET8                 Y, RETURN WITH NOT PUT DATA      21160000
TRFLOOP  DS    0H                                                       21170000
         SR    R3,R3                                                    21180000
         IC    R3,0(R2)                MASK FROM TRANSLATE TABLE        21190000
*                                                                       21200000
         CTSADBG '(TF) MASK FROM TBL=$',(0(R2),1),                     X21210000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            21220000
*                                                                       21230000
         LA    R2,1(R2)                BRANCH OVER THE MASK             21240000
         LTR   R3,R3                   MASK = 0 ?                       21250000
         BZ    TRFRET                  Y, RETURN ( END-OF-TABLE)        21260000
TRFCHK   DS    0H                      CHECK MASKS                      21270000
         EX    R3,CHKMASK              CHECK MASK                       21280000
         BZ    TRFLOOPF                MASK NOT EQUAL,GET NEXT MASK     21290000
*--------------------------------------------------------------------   21300000
*        MASK(FLAG) DATA FROM RACF = MASK(FLAG) FROM TRANSLATE TABLE    21310000
*--------------------------------------------------------------------   21320000
         SR    R3,R3                                                    21330000
         IC    R3,0(R2)                TARGET LENGTH FROM TRNSL/T       21340000
*                                                                       21350000
         CTSADBG '(TF) DATA FROM TBL=#/_',(?R3,1(R2),?R3),             X21360000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            21370000
*                                                                       21380000
         LTR   R3,R3                   LENGTH=0 ?                       21390000
         BZ    TRFLOOPF                Y, GET NEXT TABLE ELEMENT        21400000
         LA    R2,1(R2)                BRANCH OVER THE LENGTH           21410000
*                                                                       21420000
         CTSCALL PUTTXT,(LTXTL,ATXTL),LINK=INT  PUT 'TEXT LEFT'         21430000
         LTR   R15,R15                                                  21440000
         BNZ   TRFRET16                OVERFLOW                         21450000
*                                                                       21460000
         LR    R12,R3                  LENGTH                           21470000
         CTSCALL CHKL,LINK=INT         CHECK OVERFLOW !                 21480000
         LTR   R15,R15                 OVERFLOW ?                       21490000
         BNZ   TRFRET16                Y,RETURN                         21500000
*                                                                       21510000
         CTSADBG 'TRANSL TBL:AT ~ PUT FIELD=#/_',                      X21520000
               (?R4,?R12,0(R2),?R12),LEVEL=(DBGL2,7,8),RAREA=DBGAREA    21530000
*                                                                       21540000
         MVI   FLAGI,1                 INTERNAL FLAG 'PUT DATA'         21550000
         BCTR  R12,0                   DECR FOR EX COMMAND              21560000
         EX    R12,MVDT2F              PUT DATA FROM TRANSLATE TABLE    21570000
         LA    R12,1(R12)              RESTORE LENGTH                   21580000
         AR    R2,R12                  BRANCH OVER THE DATA             21590000
         AR    R4,R12                  NEW ADDR FOR PUT DATA            21600000
*                                                                       21610000
         CTSCALL PUTTXT,(LTXTR,ATXTR),LINK=INT  PUT 'TEXT RIGHT'        21620000
         LTR   R15,R15                                                  21630000
         BNZ   TRFRET16                OVERFLOW                         21640000
*                                                                       21650000
         B     TRFLOOP                                                  21660000
*---------------------------------------------------------------        21670000
*        PREPAIRING FOR THE NEXT MASK FROM TRANSLATE TABLE              21680000
*---------------------------------------------------------------        21690000
TRFLOOPF DS    0H                                                       21700000
         SR    R3,R3                                                    21710000
         IC    R3,0(R2)                LENGTH OF DATA                   21720000
*                                                                       21730000
         CTSADBG '(TF) SKIP DATA OF LENGTH=#',(?R3),                   X21740000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            21750000
*                                                                       21760000
         LA    R2,1(R2)                BRANCH OVER THE LENGTH           21770000
         AR    R2,R3                   BRANCH OVER THE DATA             21780000
         B     TRFLOOP                                                  21790000
*----------------------------------------------------------------       21800000
*        PREPAIRING DATAS BEFORE RETURN :                               21810000
*        EACH FLAGS DATA WAS PUTTED AS :                                21820000
*        'TEXT BEFORE'  DATA  'TEXT AFTER'                              21830000
*         - 'TEXT BEFORE' FIRST TIME WAS PUTTED                         21840000
*           BEFORE INVOKE FLAGS TRANS/T                                 21850000
*         - BECAUSE 'TEXT AFTER' ALREADY PUTTED BY FLAGS                21860000
*           TRANSLATE TABLE PROG                                        21870000
*        IT MEANS THAT AFTER INVOKE FLAGS TRANSLATE TABLE NOT NEED      21880000
*        PUT 'TEXT AFTER' NEXT TIMES                                    21890000
*----------------------------------------------------------------       21900000
TRFRET   DS    0H                                                       21910000
*                                                                       21920000
         CTSADBG '(TF) RETURN. FLAG=$',(FLAGI,1),                      X21930000
               LEVEL=(DBGL2,8),RAREA=DBGAREA                            21940000
*                                                                       21950000
         CLI   FLAGI,1                 INTERNAL FLAG PUT AFTER          21960000
         BNE   TRFRET4                 WAS NOT PUTTED ANY DATA          21970000
         B     TRFRET8                 RETURN                           21980000
*-----------------------------------------------------------------      21990000
*        FLAGS TRANSLATE TABLE  RETURN CODES                            22000000
*-----------------------------------------------------------------      22010000
TRFRET4  DS    0H                                                       22020000
         LA    R12,1                   LENGTH OF SOURCE DATA( FLAG )    22030000
         LA    R15,4                   DATA NOT MATCHED                 22040000
         B     FRETURN                 RETURN                           22050000
TRFRET8  DS    0H                                                       22060000
         LA    R15,8                   DON'T PUT ANY DATA               22070000
         B     FRETURN                 RETURN                           22080000
TRFRET16 DS    0H                                                       22090000
         LA    R15,16                  OVERFLOW                         22100000
         B     FRETURN                                                  22110000
FRETURN  DS    0H                                                       22120000
         L     R14,STORE14S                                             22130000
         BR    R14                     RETURN                           22140000
* ------------------------------------------------------------------    22150000
*        CHECK OVERFLOW  EXTR OUTPUT AREA                               22160000
*        IF NO OVERFLOW - PUT LENGTH OF DATA TO OUTPUT AREA(IF NEED)    22170000
*        R12 - LENGTH OF DATA FOR PUT                                   22180000
*        R4  - CURRENT ADDR OF OUTPUT AREA                              22190000
* ------------------------------------------------------------------    22200000
CHKL     DS    0H                                                       22210000
         ST    R12,DATALEN                                              22220000
         AR    R12,R4                  END ADDR OF OUTPUT AREA IF       22230000
         TM    PRTF,FPUTLEN            DATA WILL BE PUTTED WITH LENGTH? 22240000
         BZ    CHKL0                   N,SKIP                           22250000
         LA    R12,2(R12)              ADD DESCRIPTOR LENGTH            22260000
CHKL0    DS    0H                                                       22270000
         C     R12,MAXADDR             HAS A PLACE FOR DATA ?           22280000
         BH    CHKERR                  NO. OVERFLOW !                   22290000
         CR    R4,R12                  HOW ABOUT LENGTH < 0 ?           22300000
         BH    CHKERR                  ERR LENGTH !                     22310000
         TM    PRTF,FPUTLEN            PUT LENGTH OF DATA BEFORE DATA?  22320000
         BZ    CHKL1                   NO,SKIP                          22330000
         MVC   0(2,R4),DATALEN+2       PUT LENGTH OF DATA               22340000
*                                                                       22350000
         CTSADBG 'AT ~ PUT FIELD LENGTH=2/#',(?R4,DATALEN),            X22360000
               LEVEL=(DBGL2,7,8),RAREA=DBGAREA                          22370000
*                                                                       22380000
         LA    R4,2(R4)                NEW ADDR FOR PUT DATA            22390000
CHKL1    DS    0H                                                       22400000
         SR    R15,R15                 OK.                              22410000
         B     CHKLRET                                                  22420000
CHKERR   DS    0H                                                       22430000
         LA    R15,16                  OVERFLOW RETURN CODE             22440000
CHKLRET  DS    0H                                                       22450000
         L     R12,DATALEN             RESTORE DATA LENGTH              22460000
         BR    R14                     RETURN                           22470000
         LTORG                                                          22480000
* ------------------------------------------------------------------    22490000
*        WORK AREAS                                                     22500000
* ------------------------------------------------------------------    22510000
*                                                                       22520000
         DS    0D                                                       22530000
DBGAREA  DS    CL256                   AREA FOR DEBUG ROUTINE           22540000
LTXTL    DS    F                       LENGTH TEXT BEFORE               22550000
ATXTL    DS    F                       ADDR   TEXT BEFORE               22560000
LTXTR    DS    F                       LENGTH TEXT AFTER                22570000
ATXTR    DS    F                       ADDR   TEXT AFTER                22580000
FLAGI    DS    CL1                     INTERNAL FLAG 'PUT AFTER'        22590000
RMASK    DS    CL1                     FLAG INFO FROM RACF DATABASE     22600000
*                                                                       22610000
DATALEN  DS    F                       FIELD LENGTH                     22620000
STORE14  DS    F                                                        22630000
STORE14S DS    F                                                        22640000
R14TXT   DS    F                                                        22650000
PRTF     DS    CL1                     OUTPUT PARAMETER LIST            22660000
DBGL2    DS    AL1                     DEBUG LEVEL                      22670000
MAXLEN   DS    F                       MAX LENGTH OF LINE               22680000
MAXADDR  DS    F                       END ADDR OF OUTPUT LINE          22690000
USELEN   DS    F                       CURRENT FILLING PART             22700000
PUTADDR  DS    F                       START ADDR OF TEXT               22710000
PUTADDRP DS    F                       PUT ADDR FOR CURRENT PROCESS     22720000
USELNADR DS    F                       ADDRESS OF CURR.FILL.LINE        22730000
ADDRTT   DS    F                       ADDRESS OF TRANSLATE TABLE       22740000
PDEC     DS    D                       DEC DATA                         22750000
*                                                                       22760000
*TABLSTLP DC    256X'00'                TABLE FOR LIST LOOP CHECKING    22770000
*         ORG   TABLSTLP+C'L'                                           22780000
*         DC    C'L'                                                    22790000
*         ORG   ,                                                       22800000
*                                                                       22810000
NUMTAB   DC    256X'01'                CHECK TABLE FOR NUMERIC CHAR     22820000
         ORG   NUMTAB+C'0'                                              22830000
         DC    X'00000000000000000000'                                  22840000
         ORG   ,                                                        22850000
*                                                                       22860000
NZEROTAB DC    256X'FF'                                                 22870000
         ORG   NZEROTAB+C'0'                                            22880000
         DC    X'00'                                                    22890000
         ORG   ,                                                        22900000
*                                                                       22910000
TRTX     DC    X'F0F1F2F3F4F5F6F7F8F9C1C2C3C4C5C6'                      22920000
TRTXX    TR    PDECT(0),TRTX-X'F0'     CONVERT HEX DATA                 22930000
SRCHNZ   TRT   PDECT(0),NZEROTAB       SEARCH FIRST NON ZERO BYTE       22940000
PDECT    DS    CL16                    FOR CONVERT FROM DEC TO CHAR     22950000
PDECTADD DS    CL256                   MUST BE AFTER PDECT !            22960000
HEXWRK1  DS    CL2                     WORK FIELD FOR UNPK              22970000
HEXWRK2  DS    CL3                     WORK FIELD FOR UNPK              22980000
MVCTXT   MVC   0(0,R4),0(R9)           MOVE TEXT                        22990000
MVCFLD   MVC   0(0,R4),0(R11)          MOVE FIELD                       23000000
MVCHEX   MVC   0(0,R5),0(R11)          MOVE HEX DATA FOR CNVRT TO DEC   23010000
DECUPACK UNPK  PDECT(16),0(0,R11)      UNPACK DECIMAL DATA              23020000
MVCLHEX  MVC   0(0,R11),PDECT          MOVE LONG HEX DATA               23030000
CHKTBL   CLC   0(0,R2),0(R11)          CHECK DATA ACCORDING TRN TABLE   23040000
CHKDEC   CLC   0(0,R11),NZEROTAB       CHECK FFFFFFFFF DATA             23050000
MOVTRT   MVC   0(0,R11),0(R2)          MOVE DATA FROM TRANSLATE TABLE   23060000
CHKMASK  TM    RMASK,0                 CHECK ACOORDING MASK             23070000
MVDT2F   MVC   0(0,R4),0(R2)           MOVE DATA FROM TRANSLATE TABLE   23080000
         DROP  ,                                                        23090000
* ------------------------------------------------------------------    23100000
*        CURRENT ACTION MACRO PROCESSING                                23110000
*        DEFINITION PTR AND LENGTH OF DATA                              23120000
*                    R1  - ADDR. OF :                                   23130000
*          OFFSET :   0  - ADDR. OF ACTION      INPUT                   23140000
*                     4  - ADDR. OF LENGTH      OUTPUT                  23150000
*                     8  - ADDR. OF PTR         OUTPUT                  23160000
*                    12  - ADDR. OF UPDATED LEN OUTPUT                  23170000
* ------------------------------------------------------------------    23180000
XTAPRM   DSECT                                                          23190000
XTAACTN  DS    A             0         ICHACTN MACRO ADDR               23200000
XTALEN   DS    A             4         LEN FIELD ADDR (OUTPUT)          23210000
XTAPTR   DS    A             8         FIELD PTR ADDRESS (OUTPUT)       23220000
XTAULEN  DS    A            12         LEN UPDATED ADDR (OUTPUT)        23230000
XTADBG   DS    A            16         DIAG LEVEL                       23240000
*                                                                       23250000
CTSFRXT  CSECT                                                          23260000
CTSAACT  BEGIN                                                          23270000
         USING XTAPRM,R1                                                23280000
         L     R5,XTADBG               DIAG LEVEL                       23290000
         MVC   DBGTA(1),0(R5)          SET DIAG LEVEL                   23300000
         L     R5,XTAACTN              ICHACTN MACRO ADDR               23310000
         L     R5,0(R5)                ADDR.ACTION MACRO                23320000
         L     R5,0(R5)                ADDR.ACTION PARAM.LIST           23330000
*                                                                       23340000
         CTSADBG '(TA) ~. ACTION PROCESSING FIELD=_',(?R5,4(R5),8),    X23350000
               LEVEL=(DBGTA,8),RAREA=DBGAACT                            23360000
*                                                                       23370000
         SR    R11,R11                                                  23380000
         IC    R11,0(R5)               COUNT OF TEST MACRO              23390000
         SLL   R11,2                   CALCULATE OFFSET=TST * 4         23400000
         LA    R5,12(R5)               BRANCH OVER FLAGS,FIELD NAME     23410000
         AR    R5,R11                  BRANCH OVER THE TEST MACRO       23420000
         L     R6,0(R5)                LENGTH                           23430000
         L     R7,4(R5)                START ADDR. POINTER.             23440000
         L     R10,XTALEN              LEN FIELD ADDR (OUTPUT)          23450000
         ST    R6,0(R10)               STORE LENGTH                     23460000
         L     R10,XTAPTR              FIELD PTR ADDRESS (OUTPUT)       23470000
         ST    R7,0(R10)               STORE POINTER                    23480000
         L     R10,XTAULEN             LEN UPDATED ADDR (OUTPUT)        23490000
         ST    R5,0(R10)               STORE ADDR. FOR CHANGE LENGTH    23500000
*                                                                       23510000
         CTSADBG '(TA) LEN=# ADDR=~ LEN.ADDR=~',(?R6,?R7,?R5),         X23520000
               LEVEL=(DBGTA,8),RAREA=DBGAACT                            23530000
*                                                                       23540000
         BRTRN 0                                                        23550000
         LTORG                                                          23560000
DBGAACT  DS    32D                                                      23570000
DBGTA    DS    X                                                        23580000
         DROP  ,                                                        23590000
XTSPRM   DSECT                                                          23600000
XTSOUT   DS    A             0         OUTPUT AREA ADDR                 23610000
XTSEINTY DS    A             4         ICHEINTY ADDR                    23620000
XTSDBG   DS    A             8         DEBUG LEVEL                      23630000
XTSTXT   DS    A            12         TEXT PARAMETER ADDR              23640000
*                                                                       23650000
CTSFRXT  CSECT                                                          23660000
CTSARCS  BEGIN                                                          23670000
*********************************************************************   23680000
*                                                                   *   23690000
* TITLE - CTSARCS                                                   *   23700000
*                                                                   *   23710000
* DESCRIPTION - CHECK ICHEINTY CHAIN MACRO AND PUT                  *   23720000
*               INFORMATION LIKE :                                  *   23730000
*               NOTSO=N       - USER HAS A TSO SEGMENT              *   23740000
*               NOTSO=Y       - USER HAS NOT A TSO SEGMENT          *   23750000
*               PARAMETERS :                                            23760000
*                  OFFSET 0  ADDRESS OF LINE                        *   23770000
*                         F       - MAX LENGTH                      *   23780000
*                         F       - USE LENGTH                      *   23790000
*                         CL....  - LINE                            *   23800000
*                      4  ADDRESS ICHEINTY MACRO ADDR LIST          *   23810000
*                         CL8'SEGMENT-NAME'                         *   23820000
*                         A(ACHEINTY-ADDR)                          *   23830000
*                         A(STATUS)         0 - EXISTS              *   23840000
*                      8  DEBUG LEVEL                               *   23850000
*                     12  ADDR TEXT PARAMETERS LIST                 *   23860000
*                                                                   *   23870000
*********************************************************************   23880000
         USING XTSPRM,R1                                                23890000
         L     R4,XTSDBG               DEBUG LEVEL                      23900000
         MVC   DBGL2S(1),0(R4)                                          23910000
*                                                                       23920000
*        TEXT PARAMETERS FIELD . DEFINITION OUTPUT PARAMETERS           23930000
*                                                                       23940000
         L     R9,XTSTXT               ADDRESS OF TEXT PARAM.LIST       23950000
         L     R9,0(R9)                ADDRESS OF TEXT PARAM.LIST       23960000
         SR    R11,R11                                                  23970000
         IC    R11,0(R9)               LENGTH OF TXT BEFORE FIELD       23980000
         LA    R9,1(R9)                BRANCH OVER THE LENGTH           23990000
         AR    R9,R11                  BRANCH OVER THE TEXT             24000000
         MVC   PRTFS(1),0(R9)          STORE OUTPUT PARAMETER LIST      24010000
*                                                                       24020000
         L     R4,XTSOUT               ADDRESS OF OUTPUT AREA           24030000
         L     R4,0(R4)                ADDRESS OF OUTPUT AREA           24040000
         MVC   MXLS(4),0(R4)           STORE MAX LEN                    24050000
         LR    R7,R4                   START ADDR. OF OUTPUT LINE       24060000
         A     R7,MXLS                 MAX. ADDRESS FOR STORE DATAS     24070000
         LA    R4,4(R4)                BRANCH OVER THE MAX LENGTH       24080000
         MVC   USELENS(4),0(R4)        USE LEN                          24090000
         L     R10,USELENS                                              24100000
         ST    R4,USELNADRS            STORE USE LEN ADDR               24110000
*                                                                       24120000
         CTSADBG 'ADDR.LINE=~ .MAXLEN=~/#. USELEN=~/#',                124130000
               (?R4,MXLS,MXLS,?R10,?R10),LEVEL=(DBGL2S,6,7,8)           24140000
*                                                                       24150000
         LA    R4,4(R4)                BRANCH OVER THE USE  LENGTH      24160000
         ST    R4,PUTADDRS             START ADDR OF USING PART         24170000
         AR    R4,R10                  BRANCH OVER THE USING PART       24180000
         L     R12,XTSEINTY            ADDR OF ICHEINTY MACRO LIST      24190000
         L     R12,0(R12)              ADDR OF ICHEINTY MACRO LIST      24200000
         LA    R12,4(R12)              SKIP OVER THE CONTROL WORD       24210000
         DROP  R1                                                       24220000
*                                                                       24230000
*        SEGMENTS LOOP (ACCORDING SEGMENT'S TABLE)                      24240000
*                                                                       24250000
SEGLOOP  DS    0H                                                       24260000
         CTSADBG 'SEGM=_ ADDR=~ STATUS=~',                             X24270000
               (0(R12),8,8(R12),12(R12)),LEVEL=(DBGL2S,7,8)             24280000
         CLC   0(8,R12),BASESEG        BASE SEGMENT ?                   24290000
         BE    SEGNEXT                 YES, SKIP                        24300000
         L     R5,12(R12)              STATUS = 0  ?                    24310000
         LTR   R5,R5                                                    24320000
         BZ    SEGMYES                 Y                                24330000
         MVC   FLDSEGM(1),FLDYES       NOTSO=Y                          24340000
         B     SEGMPRCS                                                 24350000
SEGMYES  DS    0H                                                       24360000
         MVC   FLDSEGM(1),FLDNO        NOTSO=N                          24370000
         L     R5,8(R12)               LOAD ICHEINTY ADDRESS            24380000
         L     R5,52(R5)               RETURN CODE = 0                  24390000
         LTR   R5,R5                                                    24400000
         BZ    SEGMPRCS                NOTSO=N HAS LEFT                 24410000
         MVC   FLDSEGM(1),FLDYES       NOTSO=Y                          24420000
         B     SEGMPRCS                                                 24430000
SEGMPRCS DS    0H                                                       24440000
*                                                                       24450000
* --------------------------------------------------------------------  24460000
*        PUT INFORMATION IN FORM: NO<SEGMENT-NAME>=Y/N                  24470000
* --------------------------------------------------------------------  24480000
*                                                                       24490000
         MVC   TXTINF1(8),0(R12)       SEGMENT NAME                     24500000
*                                                                       24510000
*---------------------------------------------------------------------  24520000
*        CALCULATE EXACT LENGTHS                                        24530000
*---------------------------------------------------------------------  24540000
*                                                                       24550000
         LA    R1,TXTINF+L'TXTINF+L'TXTINF1+L'TXTINFB                   24560000
         LA    R8,TXTINF                                                24570000
         LR    R6,R1                                                    24580000
         TRT   TXTINF(30),BLANKTAB                                      24590000
         LR    R6,R1                                                    24600000
         S     R1,=A(TXTINF)                                            24610000
         ST    R1,TXTINFL                                               24620000
         LR    R11,R1                                                   24630000
*                                                                       24640000
         CTSADBG 'TXTINF=#/_/_',                                       X24650000
               (?R11,TXTINF,?R11,FLDSEGM,1),LEVEL=(DBGL2S,7,8)          24660000
*                                                                       24670000
         LR    R8,R11                  LENGTH                           24680000
         LA    R6,2                    LENGTH OF LINE-LENGTH            24690000
         CTSCALL CHKLS,LINK=INT        CHECK OVERFLOW !                 24700000
         LTR   R15,R15                 OVERFLOW ?                       24710000
         BNZ   SEGERR                  Y,RETURN                         24720000
*                                                                       24730000
         BCTR  R11,0                   DECR FOR EX COMMAND              24740000
*-----------------------------------------------------------------      24750000
*        MOVE STRING TO OUTPUT AREA.                                    24760000
*        R4 - ADDR OF PLACE IN OUTPUT AREA                              24770000
*        R11- LENGTH                                                    24780000
*-----------------------------------------------------------------      24790000
         EX    R11,MVCTXTSG            MOVE TEXT BEFORE                 24800000
         LA    R11,1(R11)              RESTORE LENGTH                   24810000
         AR    R4,R11                  NEW ADDR IN OUTPUT AREA          24820000
*                                                                       24830000
*        PUT 'YES'  ==   'Y'  OR   'NO'   == 'N'                        24840000
*                                                                       24850000
         LA    R11,1                                                    24860000
*                                                                       24870000
         LR    R8,R11                  LENGTH                           24880000
         LA    R6,2                    LENGTH OF LINE-LENGTH            24890000
         CTSCALL CHKLS,LINK=INT        CHECK OVERFLOW !                 24900000
         LTR   R15,R15                 OVERFLOW ?                       24910000
         BNZ   SEGERR                  Y,RETURN                         24920000
*                                                                       24930000
         BCTR  R11,0                   DECR FOR EX COMMAND              24940000
*-----------------------------------------------------------------      24950000
*        MOVE STRING TO OUTPUT AREA.                                    24960000
*        R4 - ADDR OF PLACE IN OUTPUT AREA                              24970000
*        R11- LENGTH                                                    24980000
*-----------------------------------------------------------------      24990000
         EX    R11,MVCSEGF             MOVE TEXT ABOUT SEGMENT          25000000
         LA    R11,1(R11)              RESTORE LENGTH                   25010000
         AR    R4,R11                  NEW ADDR IN OUTPUT AREA          25020000
*                                                                       25030000
         SR    R11,R11                 LENGTH OF TEXT AFTER             25040000
         LR    R8,R11                  LENGTH                           25050000
         LA    R6,2                    LENGTH OF LINE-LENGTH            25060000
         CTSCALL CHKLS,LINK=INT        CHECK OVERFLOW !                 25070000
         LTR   R15,R15                 OVERFLOW ?                       25080000
         BNZ   SEGERR                  Y,RETURN                         25090000
*                                                                       25100000
SEGNEXT  DS    0H                      GET NEXT ICHEINTY                25110000
*                                                                       25120000
         LA    R12,16(R12)             GET NEXT ICHEINTY MACRO          25130000
         CLC   0(8,R12),=CL8'********' END-OF ICHEINTY LIST ?           25140000
         BNZ   SEGLOOP                 YES                              25150000
*                                                                       25160000
         L     R5,USELNADRS            ADDR OF USE LENGTH               25170000
         S     R4,PUTADDRS             NEW USE LEN                      25180000
         ST    R4,USELENS              STORE USE LENGTH                 25190000
         MVC   0(4,R5),USELENS         STORE USE LENGTH                 25200000
         SR    R15,R15                                                  25210000
SEGRET   DS    0H                                                       25220000
         L     R5,USELNADRS            ADDR OF USE LEN                  25230000
         L     R6,0(R5)                                                 25240000
         CTSADBG 'OUTP AREA:#/_/$',                                    *25250000
               (?R6,4(R5),?R6,4(R5),?R6),                              *25260000
               LEVEL=(DBGL2S,7,8)                                       25270000
         BRTRN (15)                    RETURN                           25280000
SEGERR   DS    0H                      OVERFLOW OUTPUT AREA             25290000
         LA    R15,16                  R15=16                           25300000
         B     SEGRET                                                   25310000
* ------------------------------------------------------------------    25320000
*        CHECK OVERFLOW  EXTR OUTPUT AREA                               25330000
*        IF NO OVERFLOW - PUT LENGTH OF DATA TO OUTPUT AREA(IF NEED)    25340000
*                                                                       25350000
*        R6  - LENGTH FOR STORE LENGTH OF DATA                          25360000
*        R8  - LENGTH OF DATA FOR PUT                                   25370000
*        R4  - CURRENT ADDR OF OUTPUT AREA                              25380000
*        R7  - END  ADDR OF OUTPUT AREA                                 25390000
* ------------------------------------------------------------------    25400000
CHKLS    DS    0H                                                       25410000
         ST    R8,LENDATS                                               25420000
         AR    R8,R4                   END ADDR OF OUTPUT AREA IF       25430000
*                                      DATA WILL BE PUTTED              25440000
         TM    PRTFS,FPUTLEN           DATA WILL BE PUTTED WITH LENGTH? 25450000
         BZ    CHKLS0                  N,SKIP                           25460000
         AR    R8,R6                   ADD LENGTH FOR OF LENGTH OF DATA 25470000
CHKLS0   DS    0H                                                       25480000
         CR    R8,R7                   POSSIBLE PUT THE DATA ?          25490000
         BH    CHKERRS                 NO. OVERFLOW !                   25500000
*-------------------------------------------------------------------    25510000
*        AFTER OVERFLOW CHECKING THE DATA CAN BE STORED                 25520000
*-------------------------------------------------------------------    25530000
         TM    PRTFS,FPUTLEN           PUT LENGTH OF DATA BEFORE DATA?  25540000
         BZ    CHKLS1                  NO,SKIP                          25550000
*                                                                       25560000
         LA    R8,LENDATS+3            ADDR OF LENGTH OF DATA           25570000
         BCTR  R6,0                    DECR FOR EX COMMAND              25580000
         SR    R8,R6                   ADDR. FOR MOVING                 25590000
         EX    R6,MVCLENS              MOVE LENGTH OF DATA              25600000
         LA    R6,1(R6)                RESTORE LENGTH                   25610000
         AR    R4,R6                   NEW ADDR FOR PUT DATA            25620000
*                                                                       25630000
CHKLS1   DS    0H                                                       25640000
         SR    R15,R15                 OK.                              25650000
         BR    R14                     RETURN                           25660000
CHKERRS  DS    0H                                                       25670000
         LA    R15,16                  OVERFLOW RETURN CODE             25680000
         BR    R14                     RETURN                           25690000
         LTORG                                                          25700000
* ------------------------------------------------------------------    25710000
*        WORK AREAS                                                     25720000
* ------------------------------------------------------------------    25730000
*                                                                       25740000
TXTINF   DC    CL2'NO'                 INFORMATION PREFIX               25750000
TXTINF1  DS    CL8                     FIELD FOR SEGMENT NAME           25760000
TXTINFB  DC    CL10' '                 FIELD FOR CLEAR SEGMENT NAME     25770000
         DC    CL20' '                                                  25780000
BASESEG  DC    CL8'BASE'               NAME OF BASE SEGMENT             25790000
FLDYES   DC    C'Y'                    NO SEGMENT = YES !               25800000
FLDNO    DC    C'N'                    NO SEGMENT - NO  !               25810000
FLDSEGM  DS    CL1                                                      25820000
LENDATS  DS    F                                                        25830000
TXTINFL  DS    F                       REAL LENGTH OF INFO              25840000
PRTFS    DS    CL1                     OUTPUT PARAMETER LIST            25850000
DBGL2S   DS    AL1                     DEBUG LEVEL                      25860000
MXLS     DS    F                       MAX LENGTH OF LINE               25870000
USELENS  DS    F                       CURRENT FILLING PART             25880000
PUTADDRS DS    F                       START ADDR OF USE PART           25890000
USELNADRS DS   F                       ADDRESS OF CURR.FILL.LINE        25900000
*                                                                       25910000
BLANKTAB DC    256AL1(00)                                               25920000
         ORG   BLANKTAB+X'40'                                           25930000
         DC    X'FF'                                                    25940000
         ORG   ,                                                        25950000
*                                                                       25960000
MVCTXTSG MVC   0(0,R4),TXTINF          MOVE INFO TEXT                   25970000
MVCSEGF  MVC   0(0,R4),FLDSEGM         MOVE FIELD 'Y' / 'N'             25980000
MVCLENS  MVC   0(0,R4),0(R8)           MOVE LENGTH OF DATA              25990000
         DROP  ,                                                        26000000
*********************************************************************   26010000
*                                                                   *   26020000
* TITLE - CTSUSGM                                                   *   26030000
*                                                                   *   26040000
* DESCRIPTION - UPDATE SEGMENT ICHEINTY MACRO CHAIN                 *   26050000
* NOTE        - USED MAIN PARAMETER LIST                            *   26060000
*********************************************************************   26070000
*----------------------------------------------------------------       26080000
*   CHECK ICHEINTY CHAIN.                                               26090000
*   1. EXISTING OF SEGMENT                                              26100000
*      IF SEGMENT DOES NOT EXIST                                        26110000
*                 - REMOVE RELATED ICHEINTY FROM CHAIN                  26120000
*                 - UPDATE ALL ICHACTION MACRO RELATED                  26130000
*                   (LEN AND ADDR = 0)                                  26140000
*                 - UPDATE RULE LIST (KIND OF DATA - 'B'(BYPASS)        26150000
*   2. EXISTING OF FIELD                                                26160000
*      IF FIELD DOES NOT EXIST                                          26170000
*                 - UPDATE RELATED ICHACTION MACRO TO EXTRACT           26180000
*                   FIRST FIELD FROM SEGMENT INSTEAD                    26190000
*                 - UPDATE RULE LIST (KIND OF DATA - 'B'(BYPASS)        26200000
*----------------------------------------------------------------       26210000
CTSUSGM  BEGIN                                                          26220000
         LR    R10,R1                                                   26230000
         ST    R10,MAINP               MAIN PARAMETER LIST              26240000
         USING RXTPRM,R10                                               26250000
         L     R2,RXTDBG              | SAVE                            26260000
         LTR   R2,R2                  |                                 26270000
         BZ    DBGS1                  |                                 26280000
         L     R2,0(R2)               |  DEBUG                          26290000
DBGS1    DS    0H                     |                                 26300000
         STC   R2,UDBGL1              |   LEVEL                         26310000
         ST    R2,UDB1VR              |                                 26320000
*                                                                       26330000
         L     R2,RXTFLDS              FIELDS LIST ADDR                 26340000
         ST    R2,FLDTP                FIELD TABLE ADDRESS              26350000
*                                                                       26360000
         XC    ACRCFT,ACRCFT           CLEAR CURRENT ICHEINTY ADDR      26370000
         XC    ACRCWK,ACRCWK           CLEAR CURRENT ICHEINTY ADDR      26380000
         L     R4,RXTRSGLT             SEGMENT'S LIST ADDR              26390000
         LA    R4,4(R4)                SKIP OVER THE CONTROL WORD       26400000
         L     R12,RXTINTY             ADDRESS ICHEINTY MACRO           26410000
*                                                                       26420000
*----------------------------------------------------------------       26430000
*        CONVERT PROFILE NAME                                           26440000
*----------------------------------------------------------------       26450000
         CLC   =CL3'USR',RXTPRF        USER PROFILE ?                   26460000
         BE    UPDSGM0U                                                 26470000
         CLC   =CL3'GRP',RXTPRF        GROUP PROFILE ?                  26480000
         BE    UPDSGM0G                                                 26490000
         CLC   =CL2'DS',RXTPRF         DATASET PROFILE ?                26500000
         BE    UPDSGM0D                                                 26510000
         CLC   =CL3'GEN',RXTPRF        GENERAL RESOURCE PROFILE ?       26520000
         BE    UPDSGM0R                                                 26530000
*                                                                       26540000
UPDSGM0U DS    0H                                                       26550000
         MVC   PROFILE(8),=CL8'USER'                                    26560000
         B     UPDSGM0E                                                 26570000
UPDSGM0G DS    0H                                                       26580000
         MVC   PROFILE(8),=CL8'GROUP'                                   26590000
         B     UPDSGM0E                                                 26600000
UPDSGM0D DS    0H                                                       26610000
         MVC   PROFILE(8),=CL8'DATASET'                                 26620000
         B     UPDSGM0E                                                 26630000
UPDSGM0R DS    0H                                                       26640000
         MVC   PROFILE(8),=CL8'GENERAL'                                 26650000
         B     UPDSGM0E                                                 26660000
UPDSGM0E DS    0H                                                       26670000
*                                                                       26680000
*----------------------------------------------------------------       26690000
*        SEGMENT EXISTING CHECKING                                      26700000
*----------------------------------------------------------------       26710000
*                                                                       26720000
UPDSGM10 DS    0H                                                       26730000
         MVI   CLRFMODE,C'N'           CLEAR ACTIONS MACRO FLAG         26740000
         ST    R12,ACRCWK              SAVE CURRENT ICHEINTY ADDR       26750000
*                                                                       26760000
         CTSADBG 'PROFILE=_ SEGM=~/_ TABLE=~/_',                       X26770000
               (PROFILE,8,?R12,40(R12),8,8(R4),0(R4),8),               X26780000
               LEVEL=(UDBGL1,4,5,6,7,8),RAREA=RAREU1                    26790000
*                                                                       26800000
         MVC   SEGMENT(8),40(R12)                                       26810000
         CLC   40(8,R12),BASESGM1      BASE SEGMENT ?                   26820000
         BE    UPDSGMFD                Y, GOTO CHECK FIELDS EXISTING    26830000
         CLC   40(8,R12),BASESGM2      BASE SEGMENT ?                   26840000
         BE    UPDSGMFD                Y, GOTO CHECK FIELDS EXISTING    26850000
*                                                                       26860000
         CTSADBG 'SEGM=~/_/ TABLE SEGM=~/_/',                          X26870000
               (?R12,40(R12),8,8(R4),0(R4),8),                         X26880000
               LEVEL=(UDBGL1,4,5,6,7,8),RAREA=RAREU1                    26890000
*                                                                       26900000
         CLC   40(8,R12),0(R4)         THE SAME SEGMENT ?               26910000
         BNE   UPDSGMR8                NO, INTERNAL ERROR               26920000
         C     R12,8(R4)               THE SAME ICHEINTY ADDR ?         26930000
         BNE   UPDSGMR8                NO, INTERNAL ERROR               26940000
*                                                                       26950000
         CALL  CTSFSGC,(UDB1VR,SGMMODE,PROFILE,SEGMENT)                 26960000
         LTR   R15,R15                 SEGMENT EXISTS ?                 26970000
         BZ    UPDSGMFD                YES, GOTO FIELDS CHECKING        26980000
         C     R15,=F'16'                                               26990000
         BE    UPDSGMR8                INTERNAL ERROR                   27000000
         C     R15,=F'8'                                                27010000
         BE    UPDSGMR8                INTERNAL ERROR                   27020000
         ST    R15,12(R4)              SET NOT EXISTS FLG TO SEGM TABLE 27030000
         L     R8,ACRCFT               GET PREVIOUS ICHEINTY ADDR       27040000
         LTR   R8,R8                                                    27050000
         BZ    UPDSGMR8                INTERNAL ERROR                   27060000
*                                                                       27070000
         CTSADBG 'SEGM=_ DOES NOT EXIST IN TEMPLATE TABLE.REMOVED',    X27080000
               (SEGMENT,8),                                            X27090000
               LEVEL=(UDBGL1,1,2,3,4,5,6,7,8),RAREA=RAREU1              27100000
         CTSADBG 'SEGM=~/_/ DOES NOT EXIST. UPDATE CHAIN OF   ~/_',    X27110000
               (?R12,40(R12),8,?R8,40(R8),8),                          X27120000
               LEVEL=(UDBGL1,4,5,6,7,8),RAREA=RAREU1                    27130000
*                                                                       27140000
         LR    R9,R8                   ICHEINTY ADDR FOR CHAIN CHANGE   27150000
         L     R9,48(R9)               CHAIN ADDR                       27160000
*                                                                       27170000
         CTSADBG 'SEGM=~/_/ DOES NOT EXIST. UPDATE CHAIN FROM ~/_',    X27180000
               (?R12,40(R12),8,?R9,40(R9),8),                          X27190000
               LEVEL=(UDBGL1,4,5,6,7,8),RAREA=RAREU1                    27200000
*                                                                       27210000
         LR    R9,R4                   CURRENT CHAIN ADDR               27220000
         LA    R9,16(R9)               GET NEXT CHAIN ADDR FROM TABLE   27230000
*                                                                       27240000
         CTSADBG 'SEGM=~/_/ DOES NOT EXIST. UPDATE CHAIN TO   ~/_',    X27250000
               (?R12,40(R12),8,8(R9),0(R9),8),                         X27260000
               LEVEL=(UDBGL1,4,5,6,7,8),RAREA=RAREU1                    27270000
*                                                                       27280000
         LR    R12,R8                  RETURN TO PREVIOUS ICHEINTY ADDR 27290000
         MVC   48(4,R12),8(R9)         UPDATE CHAIN ICHEINTY MACRO ADDR 27300000
         MVI   CLRFMODE,C'Y'           CLEAR ACTIONS MACRO FLAG         27310000
         B     UPDSGMF1                                                 27320000
UPDSGMFD DS    0H                      CHECK FIELDS EXISTING            27330000
         ST    R12,ACRCFT              SAVE CURRENT ICHEINTY ADDR       27340000
UPDSGMF1 DS    0H                                                       27350000
         CTSCALL CTSUFLD,(CLRFMODE,MAINP,ACRCWK,PROFILE,SEGMENT,       X27360000
               FLDTP),LINK=INT                                          27370000
         LTR   R15,R15                                                  27380000
         BNZ   UPDSGMR8                INTERNAL ERROR                   27390000
         LA    R4,16(R4)               GET NEXT ENTRY FROM TABLE        27400000
         L     R12,48(R12)             GET NEXT ICHEINTY MACRO          27410000
         LTR   R12,R12                 ICHEINTY AVAILABLE ?             27420000
         BNZ   UPDSGM10                YES                              27430000
         SR    R15,R15                 RETURN O.K                       27440000
         B     UPDSGMRT                                                 27450000
UPDSGMR8 DS    0H                      INTERNAL ERROR                   27460000
         LA    R15,8                                                    27470000
         B     UPDSGMRT                                                 27480000
UPDSGMRT DS    0H                                                       27490000
         BRTRN (15)                    RETURN                           27500000
*                                                                       27510000
         LTORG                                                          27520000
*                                                                       27530000
* ------------------------------------------------------------------    27540000
*        WORK AREAS                                                     27550000
* ------------------------------------------------------------------    27560000
*                                                                       27570000
RAREU1   DS    64F                     DEBUG WORK AREA                  27580000
MAINP    DS    F                       MAIN PARAMETER LIST              27590000
ACRCFT   DS    F                       CURRENT ICHEINTY ADDR            27600000
ACRCWK   DS    F                       PREVIOUS ICHEINTY ADDR           27610000
UDB1VR   DS    F                       DEBUF LEVEL WORD                 27620000
FLDTP    DS    F                       FIELD TABLE ADDRESS              27630000
SGMMODE  DC    CL8'VRFSGM'             VERIFY SEGMENT MODE              27640000
BASESGM1 DC    CL8' '                  NAME OF BASE SEGMENT             27650000
BASESGM2 DC    CL8'BASE'               NAME OF BASE SEGMENT             27660000
PROFILE  DS    CL8                     PROFILE                          27670000
SEGMENT  DS    CL8                     SEGMENT                          27680000
UDBGL1   DS    XL1                     DEBUG LEVEL                      27690000
CLRFMODE DS    CL1                     CLEAR ACTIONS MACRO FLAG         27700000
*                                                                       27710000
* ------------------------------------------------------------------    27720000
*        FIELDS EXISTING CHECKING                                       27730000
*          PARAMETER LIST :                                             27740000
*           0   A(CLRFMODE)    -   CLEAR FIELDS MODE                    27750000
*           4   A(MAINP)       -   MAIN PARAMETER LIST                  27760000
*           8   A(ACRCFT)      -   CURRENT ICHEINTY ADDR                27770000
*          12   A(PROFILE)     -   PROFILE                              27780000
*          16   A(SEGMENT)     -   SEGMENT                              27790000
*          20   A(FLDTP)       -   FIELD TABLE ADDDRESS                 27800000
* ------------------------------------------------------------------    27810000
*                                                                       27820000
UPDFP    DSECT                                                          27830000
UPDFMODE DS    A                       CLEAR FIELDS MODE                27840000
UPDFMP   DS    A                       MAIN PARAMETER ADDR              27850000
UPDFINTY DS    A                       CURRENT ICHEINTY ADDR            27860000
UPDFPRF  DS    A                       PROFILE                          27870000
UPDFSGM  DS    A                       SEGMENT                          27880000
UPDFFTBL DS    A                       FIELD TABLE ADDRESS              27890000
*                                                                       27900000
CTSFRXT  CSECT                                                          27910000
CTSUFLD  BEGIN                                                          27920000
         LR    R10,R1                                                   27930000
         ST    R10,MPRM                KEEP PARAMETER LIST ADDR         27940000
         MVC   FSTSF(8),=CL8'DUMMY'    DEFAULT FIELD NAME FOR UPDATE    27950000
         USING UPDFP,R10                                                27960000
         L     R2,UPDFMODE             CLEAR MODE                       27970000
         MVC   CLRMODE(1),0(R2)        CLEAR MODE                       27980000
         L     R12,UPDFINTY            CURRENT ICHEINTY ADDR            27990000
         L     R12,0(R12)                                               28000000
         L     R2,UPDFPRF              PROFILE                          28010000
         MVC   PRF(8),0(R2)            PROFILE                          28020000
         L     R2,UPDFSGM              SEGMENT                          28030000
         MVC   SGM(8),0(R2)            SEGMENT                          28040000
         CLC   SGM(8),=CL8' '          BASE SEGMENT IN EMPTY FORM ?     28050000
         BNE   GTMPRM                  N,SKIP                           28060000
         MVC   SGM(8),=CL8'BASE'                                        28070000
GTMPRM   DS    0H                                                       28080000
*                                                                       28090000
         L     R2,UPDFFTBL             FIELD DESCRIPT TABLE ADDRESS     28100000
         L     R2,0(R2)                FIELD DESCRIPT TABLE ADDRESS     28110000
         ST    R2,FLDENTRY             KEEP  ENTRY ADDRESS              28120000
         USING RFTPRM,R2               ADDRESSABILITY OF ENTRY          28130000
*                                                                       28140000
         L     R10,UPDFMP              MAIN PARAMETER ADDR              28150000
         L     R10,0(R10)              MAIN PARAMETER LIST              28160000
         DROP  R10                                                      28170000
         USING RXTPRM,R10                                               28180000
         L     R8,RXTDBG              | SAVE                            28190000
         LTR   R8,R8                  |                                 28200000
         BZ    DBGS2                  |                                 28210000
         L     R8,0(R8)               |  DEBUG                          28220000
DBGS2    DS    0H                     |                                 28230000
         STC   R8,UDBGL2              |   LEVEL                         28240000
         ST    R8,UDB2VR              |                                 28250000
*                                                                       28260000
         CTSADBG 'CTSUFLD:MODE=_ PRF=_ SGM=_ ICHEINTY=~ PARAM=~',      X28270000
               (CLRMODE,1,PRF,8,SGM,8,?R12,?R10),                      X28280000
               LEVEL=(UDBGL2,6,7,8),RAREA=RAREU2                        28290000
*                                                                       28300000
         L     R11,8(R12)              FLDEF PTR                        28310000
         SR    R4,R4                                                    28320000
         IC    R4,2(R11)               CURRENT NUMBER OF TESTS          28330000
         SLL   R4,2                    *4                               28340000
         LA    R11,4(R11)              BRANCH OVER SERVICE BYTES        28350000
         AR    R11,R4                  ADDR OF FIRST ACTION MACRO       28360000
         L     R9,0(R11)               ACTION MACRO FROM ICHEINTY       28370000
*                                                                       28380000
CTSUFLD1 DS    0H                                                       28390000
         CLC   RFTFNM(8),=CL8'********' LIST OF FIELDS ENDED ?          28400000
         BE    CTSUFLD7                YES                              28410000
         ICM   R8,X'F',RFTACTN         ADDRESS OF ACTION MACRO          28420000
         CLI   CLRMODE,C'N'            CHECK FIELD EXISTANCE ?          28430000
         BNE   CTSUFLD2                N, SKIP (WITH ERR MESSAGE)       28440000
*        BNE   CTSUFLD3                N, SKIP (WITHOUT ERR MESSAGE)    28450000
*                                                                       28460000
         CTSADBG '1.SEGM=_ FLD=F/_/A/_(_).ACTION=AL~/EI~',             X28470000
               (SGM,8,RFTFNM,8,4(R9),8,RFTFRL,1,?R8,?R9),              X28480000
               LEVEL=(UDBGL2,6,7,8),RAREA=RAREU2                        28490000
*                                                                       28500000
         MVC   FLDNM(8),RFTFNM         FIELD NAME                       28510000
         CLC   RFTFNM,4(R9)            RFTFNM - FIELD NAME FROM TABEL   28520000
*                                      4(R9)  - FIELD NAME FROM ICHACTN 28530000
         BNE   CTSUFLDE                INTERNAL ERROR                   28540000
         CR    R8,R9                   CHECK ACTION PTRS                28550000
         BNE   CTSUFLDE                NOT EQUAL,INTERNAL ERROR         28560000
*                                                                       28570000
         CALL  CTSFSGC,(UDB2VR,FLDMODE,PROFILE,SGM,FLDNM,FSTSF)         28580000
         LTR   R15,R15                 FIELD EXISTS ?                   28590000
         BZ    CTSUFLD4                Y,SKIP                           28600000
         C     R15,=F'16'                                               28610000
         BE    CTSUFLDE                INTERNAL ERROR                   28620000
         C     R15,=F'8'                                                28630000
         BE    CTSUFLDE                INTERNAL ERROR                   28640000
CTSUFLD2 DS    0H                                                       28650000
*                                                                       28660000
         CTSADBG 'FIELD=_/_ DOES NOT EXIST IN TEMPLATE TABLE.REMOVED', X28670000
               (SGM,8,4(R8),8),                                        X28680000
               LEVEL=(UDBGL2,1,2,3,4,5,6,7,8),RAREA=RAREU2              28690000
         CTSADBG 'FIELD=_/_ CHANGED ACCESS TO _',                      X28700000
               (SGM,8,4(R8),8,FSTSF,8),                                X28710000
               LEVEL=(UDBGL2,1,2,3,4,5,6,7,8),RAREA=RAREU2              28720000
*                                                                       28730000
CTSUFLD3 DS    0H                                                       28740000
         DROP  R2                                                       28750000
         L     R5,FLDENTRY             FIELD RULE ADDRESS               28760000
         USING RFTPRM,R5                                                28770000
         MVI   RFTFRL,C'B'             BYPASS FIELD FLAG                28780000
         DROP  R5                                                       28790000
         USING RFTPRM,R2                                                28800000
         XC    12(4,R8),12(R8)         CLEAR LENGTH OF DATA             28810000
         XC    16(4,R8),16(R8)         CLEAR PTR TO DATA                28820000
         MVC   4(8,R8),FSTSF           FIRST FIELD FROM SEGMENT         28830000
*                                                                       28840000
CTSUFLD4 DS    0H                                                       28850000
*                                                                       28860000
         CTSADBG '2.SEGM=_ FLD=F/_/A/_(_).ACTION=AL~/EI~',             X28870000
               (SGM,8,RFTFNM,8,4(R9),8,RFTFRL,1,?R8,?R9),              X28880000
               LEVEL=(UDBGL2,6,7,8),RAREA=RAREU2                        28890000
*                                                                       28900000
CTSUFLD5 DS    0H                                                       28910000
         LA    R9,RFTLEN               FIELD ENTRY LEN                  28920000
         AR    R2,R9                   NEXT FIELD DESCR ADDRESS         28930000
         ST    R2,FLDENTRY             KEEP FIELD RULE ADDRESS          28940000
*                                                                       28950000
*        BYPASS DELAY FIELDS                                            28960000
*                                                                       28970000
         CLC   RFTFNM(8),=CL8'********' LIST OF FIELDS ENDED ?          28980000
         BE    CTSUFLD7                 YES                             28990000
         CLI   RFTDFLG,C'R'            REGULAR FIELD ?                  29000000
         BE    CTSUFLD6                Y, SKIP                          29010000
*                                                                       29020000
         CTSADBG '3.BYPASS DELAY FIELD.SEGM=_ FLD=_ ACTION=$',         X29030000
               (SGM,8,RFTFNM,8,RFTACTN,4),                             X29040000
               LEVEL=(UDBGL2,6,7,8),RAREA=RAREU2                        29050000
*                                                                       29060000
         B     CTSUFLD5                                                 29070000
*                                                                       29080000
CTSUFLD6 DS    0H                                                       29090000
         LA    R11,4(R11)              NEXT ACTION MACRO                29100000
         L     R9,0(R11)               ACTION MACRO                     29110000
         LTR   R9,R9                   ACTION MACRO IS AVAILABLE        29120000
         BNZ   CTSUFLD1                YES                              29130000
CTSUFLD7 DS    0H                                                       29140000
         SR    R15,R15                                                  29150000
         L     R10,MPRM                LOAD PARAMETER LIST ADDR         29160000
         USING UPDFP,R10                                                29170000
         L     R9,UPDFFTBL             FIELD TABLE ADDRESS              29180000
         ST    R2,0(R9)                                                 29190000
         B     CTSUFLDR                RETURN                           29200000
         DROP  R10                                                      29210000
*                                                                       29220000
CTSUFLDE DS    0H                                                       29230000
         LA    R15,8                   INTERNAL ERROR                   29240000
         B     CTSUFLDR                RETURN                           29250000
*                                                                       29260000
CTSUFLDR DS    0H                                                       29270000
         BRTRN (15)                    RETURN                           29280000
*                                                                       29290000
         LTORG                                                          29300000
*                                                                       29310000
* ------------------------------------------------------------------    29320000
*        WORK AREAS                                                     29330000
* ------------------------------------------------------------------    29340000
*                                                                       29350000
RAREU2   DS    64F                     DEBUG WORK AREA                  29360000
UDB2VR   DS    F                       DEBUF LEVEL WORD                 29370000
FLDENTRY DS    F                       FIELD RULE ADDRESS               29380000
MPRM     DS    F                       PARAMETER LIST ADDR              29390000
PRF      DS    CL8                     PROFILE                          29400000
SGM      DS    CL8                     SEGMENT                          29410000
FLDNM    DS    CL8                     FIELD NAME                       29420000
FLDMODE  DC    CL8'VRFFLD'             VERIFY FIELD MODE                29430000
FSTSF    DS    CL8                     FIRST SEGMENT'S FIELD            29440000
CLRMODE  DS    CL1                     CLEAR MODE                       29450000
UDBGL2   DS    XL1                     DEBUG LEVEL                      29460000
         DROP  ,                                                        29470000
*----------------------------------------------------------------       29480000
*        CHECK ICHEINTY CHAIN AFTER TEMPLATE PROCESSING                 29490000
*----------------------------------------------------------------       29500000
CTSCCHN  BEGIN                                                          29510000
         LR    R10,R1                                                   29520000
         USING RXTPRM,R10                                               29530000
         L     R2,RXTDBG              | SAVE                            29540000
         LTR   R2,R2                  |                                 29550000
         BZ    DBGSCH                 |                                 29560000
         L     R2,0(R2)               |  DEBUG                          29570000
DBGSCH   DS    0H                     |                                 29580000
         STC   R2,UDBGLCH             |   LEVEL                         29590000
*                                                                       29600000
         L     R2,RXTFLDS              ADDR OF FIELDS LIST              29610000
         USING RFTPRM,R2                                                29620000
*                                                                       29630000
         L     R8,RXTRSGLT             SEGMENT'S LIST ADDR              29640000
         LA    R8,4(R8)                SKIP OVER THE CONTROL WORD       29650000
*                                                                       29660000
         L     R12,RXTINTY             ADDRESS ICHEINTY MACRO           29670000
CHKCHN10 DS    0H                                                       29680000
         CLC   0(8,R8),=C'********'    LIST OF ICHEINTY ENDED ?         29690000
         BE    CHKCHN1F                YES, END-OF-PROCESSING           29700000
         CLC   12(4,R8),=F'0'          TABLE'S ICHEINTY EXISTS ?        29710000
         BE    CHKCHN11                Y, SKIP                          29720000
         ST    R12,EINTYCHN            SAVE CHAIN ENTRY POINT           29730000
         L     R12,8(R8)               GET ICHEINTY ADDR FROM TABLE     29740000
CHKCHN11 DS    0H                                                       29750000
         L     R4,4(R12)               ADDR ENTRY NAME                  29760000
         SR    R5,R5                                                    29770000
         IC    R5,0(R4)                LENGTH OF ENTRY NAME             29780000
*                                                                       29790000
         CTSADBG '~/~ SEGM=_/_/_  STATUS=~',                           X29800000
               (?R12,8(R8),40(R12),8,0(R8),8,1(R4),?R5,12(R8)),        X29810000
               LEVEL=(UDBGLCH,4,5,6,7,8),RAREA=RAREACHN                 29820000
*                                                                       29830000
         L     R11,8(R12)              FLDEF PTR                        29840000
         SR    R4,R4                                                    29850000
         IC    R4,2(R11)               CURRENT NUMBER OF TESTS          29860000
         SLL   R4,2                    *4                               29870000
         LA    R11,4(R11)              BRANCH OVER SERVICE BYTES        29880000
         AR    R11,R4                  ADDR OF FIRST ACTION MACRO       29890000
         L     R9,0(R11)               ACTION MACRO FROM ICHEINTY       29900000
CHKCHN1A DS    0H                                                       29910000
         CLC   RFTFNM,=CL8'********'   LIST OF FIELDS ENDED ?           29920000
         BE    CHKCHN1F                YES                              29930000
         ICM   R4,X'F',RFTACTN         ADDRESS OF ACTION MACRO          29940000
         L     R9,0(R11)               ACTION MACRO                     29950000
         CLC   12(4,R8),=F'0'          TABLE'S ICHEINTY EXISTS ?        29960000
         BNE   CHKCHN1S                N, SKIP                          29970000
         CLI   RFTFRL,C'B'             BYPASSED FIELD ?                 29980000
         BE    CHKCHN1B                Y, SKIP                          29990000
         CLI   RFTDFLG,C'D'            DELAY FIELD ?                    30000000
         BE    CHKCHN1D                Y, SKIP                          30010000
         B     CHKCHN1R                REGULAR FIELD                    30020000
*                                                                       30030000
*        BYPASS REMOVED FIELDS AFTER TEMPLATE CHECKING                  30040000
*                                                                       30050000
CHKCHN1B DS    0H                                                       30060000
*                                                                       30070000
         CTSADBG 'REMOVED.SEGM=_ FLD=F/_/A/_(_).ACTION=AL~/EI~',       X30080000
               (40(R12),8,RFTFNM,8,4(R9),8,RFTFRL,1,?R4,?R9),          X30090000
               LEVEL=(UDBGLCH,6,7,8),RAREA=RAREACHN                     30100000
*                                                                       30110000
         B     CHKCHN1X                GET NEXT FIELD                   30120000
*                                                                       30130000
*        EXISTING FIELDS AFTER TEMPLATE CHECKING                        30140000
*                                                                       30150000
CHKCHN1R DS    0H                                                       30160000
*                                                                       30170000
         CTSADBG 'SEGM=_ FLD=F/_/A/_(_).ACTION=AL~/EI~',               X30180000
               (40(R12),8,RFTFNM,8,4(R9),8,RFTFRL,1,?R4,?R9),          X30190000
               LEVEL=(UDBGLCH,6,7,8),RAREA=RAREACHN                     30200000
         B     CHKCHN1X                GET NEXT FIELD                   30210000
*                                                                       30220000
*        WHOLE SEGMENT DOES NOT EXIST                                   30230000
*                                                                       30240000
CHKCHN1S DS    0H                                                       30250000
*                                                                       30260000
         CTSADBG 'BYPASS .~ SEGM=_ FLD=_ ACTION=$',                    X30270000
               (8(R8),0(R8),8,RFTFNM,8,RFTACTN,4),                     X30280000
               LEVEL=(UDBGLCH,6,7,8),RAREA=RAREACHN                     30290000
*                                                                       30300000
         B     CHKCHN1X                GET NEXT FIELD                   30310000
*                                                                       30320000
*        DELAY FIELD                                                    30330000
*                                                                       30340000
CHKCHN1D DS    0H                                                       30350000
*                                                                       30360000
         CTSADBG 'DELAY  .~ SEGM=_ FLD=_ ACTION=$',                    X30370000
               (8(R8),0(R8),8,RFTFNM,8,RFTACTN,4),                     X30380000
               LEVEL=(UDBGLCH,6,7,8),RAREA=RAREACHN                     30390000
*                                                                       30400000
         B     CHKCHN1X                GET NEXT FIELD                   30410000
*                                                                       30420000
*        GET NEXT FIELD FROM TABLE                                      30430000
*                                                                       30440000
CHKCHN1X DS    0H                                                       30450000
         LA    R9,RFTLEN               FIELD ENTRY LEN                  30460000
         AR    R2,R9                   GET NEXT FIELD DESCR ENTRY       30470000
         CLI   RFTDFLG,C'D'            DELAY FIELD ?                    30480000
         BE    CHKCHN1A                Y, SKIP                          30490000
         LA    R11,4(R11)              NEXT ACTION MACRO                30500000
         L     R9,0(R11)               ACTION MACRO                     30510000
         LTR   R9,R9                   ACTION MACRO IS AVAILABLE        30520000
         BNZ   CHKCHN1A                YES                              30530000
*                                                                       30540000
*        GET HEXT ICHEINTY ADDR FROM CHAIN AND ICHEINTY TABLE           30550000
*                                                                       30560000
         CLC   12(4,R8),=F'0'          TABLE'S ICHEINTY EXISTS ?        30570000
         BE    CHKCHN1E                Y, SKIP                          30580000
         LA    R8,16(R8)               GET NEXT ENTRY FROM TABLE        30590000
         L     R12,EINTYCHN            RESTORE CHAIN ENTRY POINT        30600000
         B     CHKCHN10                CONTINUE                         30610000
CHKCHN1E DS    0H                                                       30620000
         LA    R8,16(R8)               GET NEXT ENTRY FROM TABLE        30630000
         L     R12,48(R12)             GET NEXT ICHEINTY MACRO          30640000
         LTR   R12,R12                 ICHEINTY ADDRESS AVAILABLE ?     30650000
         BNZ   CHKCHN10                Y, CONTINUE                      30660000
CHKCHN1F DS    0H                                                       30670000
         B     CHKCHNR0                                                 30680000
CHKCHNR0 DS    0H                                                       30690000
         SR    R15,R15                 O.K.                             30700000
         B     CHKCHNRR                                                 30710000
CHKCHNR8 DS    0H                                                       30720000
         LA    R15,8                   EXTRACTOR TABLES CORRUPTED       30730000
         B     CHKCHNRR                                                 30740000
CHKCHNRR DS    0H                                                       30750000
         BRTRN (15)                    RETURN                           30760000
*                                                                       30770000
         LTORG                                                          30780000
*                                                                       30790000
* ------------------------------------------------------------------    30800000
*        WORK AREAS                                                     30810000
* ------------------------------------------------------------------    30820000
*                                                                       30830000
RAREACHN DS    64F                     DEBUG PACKAGE WORK AREA          30840000
EINTYCHN DS    F                       CHAIN ENTRY POINT                30850000
UDBGLCH  DS    CL1                     DEBUG LEVEL                      30860000
         END   CTSFRXT                                                  30870000
