         TITLE 'LIST USER->GROUP CONNECT INFORM FROM RACF DATA BASE'    00010000
*                    PAIRS : USER - GROUP                               00020000
****************************************************************        00030000
****                                                        ****        00040000
****     CONTROL-SA  RELEASE 1.3.0                          ****        00050000
****                                                        ****        00060000
****     LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.    ****        00070000
****                                                        ****        00080000
****************************************************************        00090000
*                                                                       00100000
****************************************************************        00110000
*                                                              *        00120000
* TITLE            : CTSFRUC                                   *        00130000
*                                                              *        00140000
* FILE NAME        : CTSFRUC                                   *        00150000
*                                                              *        00160000
* AUTHOR           : ALEX SHVARTSMAN                           *        00170000
*                                                              *        00180000
* CREATION DATE    : 03/05/94                                  *        00190000
*                                                              *        00200000
* DESCRIPTION      : LIST  USER->GROUP CONNECT INFORMATION     *        00210000
*                    PAIRS USER-GROUP                          *        00220000
*                                                              *        00230000
* ASSUMPTIONS AND                                              *        00240000
*   CONSIDERATIONS : PROGRAM WHICH CALL TO MUST BE AUTHORIZED  *        00250000
*                                                              *        00260000
****************************************************************        00270000
*                                                                       00280000
****************************************************************        00290000
* MOD.ID   WHO      WHEN     DESCRIPTION                       *        00300000
* -------- -------- -------- --------------------------------- *        00310000
*                   DD/MM/YY                                   *        00320000
*                                                              *        00330000
* AS0602    ALEX    06/02/95 CHANGE FIELD NAME REVOKE_STATUS   *        00340000
*                                         TO   REVOKED         *        00350000
* PS0095    AS      03/06/97 CALL TO CTSADTE INSTEAD TO CTSFDTE*        00351000
* WS2427    SK      17/01/02 UNIVERSAL GROUP                   *        00352000
* SAS2IBMN NURITY   12/12/16 REMOVE DUPLICATE CODE.            *        00352100
* IS10186  AVNERL   21/01/24 RECOMP WITH CTSFXPR               *        00352200
* IS10188  AVNERL   06/10/24 MOVE OUR MODULES ABOVE 16M LINE   *        00352301
****************************************************************        00353000
*                                                                       00354000
****************************************************************        00355000
*        PARAMETER LIST DSECT                                           00356000
****************************************************************        00357000
*                                                                       00358000
PARMLIST DSECT                                                          00359000
AOPTION  DS    A                       ADDR OPTION CODE = 'LOCATE'      00360000
AENTYP   DS    A                       ADDR.ENTRY TYPE  = 'USER'        00370000
AENTRY   DS    A                       ADDR ENTRY NAME                  00380000
*                                           8 - BYTE USER               00390000
*                                           8 - BYTE GROUP              00400000
AFGEN    DS    A                       ADDR. GENERIC FLAG = 0           00410000
AOUT     DS    A                       ADDR OUTPUT LINE                 00420000
ADEBUG   DS    A                       DEBUG LEVEL                      00430000
ARCFRET  DS    A                       ADDR RACF RETURN CODE            00440000
AREASON  DS    A                       ADDR RACF REASON CODE            00450000
ASEP     DS    A                       SEPARATOR                        00460000
*                                                                       00470000
****************************************************************        00480000
*        INITIALIZE                                                     00490000
****************************************************************        00490100
*                                                                       00490200
CTSFRUC  CSECT                                                          00490300
CTSFRUC  AMODE 31                                                       00490400
*IS10188 CTSFRUC  RMODE 24       (FOR CTSADBG)                          00490501
CTSFRUC  RMODE ANY                                             IS10188  00490601
*                                                                       00490701
         BEGIN *,R12,R11                                                00490801
         CTSEQUR                                                        00490901
         CTSLEVEL                                                       00491001
         LR    R10,R1                                                   00491101
         USING PARMLIST,R10            ADDRESABILITY PARAMETERS         00492000
*                                                                       00493000
*        SET DEBUG LEVEL                                                00494000
*                                                                       00495000
         L     R2,ADEBUG               R2 -> DEBUG LEVEL (4 BYTES)      00496000
         XC    DEBUGL,DEBUGL           STORE DEBUG LEVEL                00497000
         XC    DEBUG,DEBUG             STORE DEBUG LEVEL                00498000
         ICM   R2,15,0(R2)             DEBUG LEVEL                      00499000
         BNP   NODEBUG                 SKIP DEBUG LVL IF MINUS          00500000
         STC   R2,DEBUGL               STORE DEBUG LEVEL (1 BYTE)       00510000
         ST    R2,DEBUG                STORE DEBUG LEVEL                00520000
NODEBUG  DS    0H                                                       00530000
         CTSADBG LEVEL=(DEBUGL,3,4,5,6,7),'ENTERING'                    00540000
*                                                                       00550000
****************************************************************        00560000
*        PREPARE FOR EXTRACTOR CALL                                     00570000
****************************************************************        00580000
*                                                                       00590000
         L     R2,AOUT                                                  00600000
         ST    R2,AAREA                ADDRESS OUTPUT AREA              00610000
         NI    AAREA,X'7F'             CLEAR 0 - BYTE(C-CONVENTIONS)    00620000
         L     R2,AENTRY               ENTRY NAME ADDR                  00630000
*                                                                       00640000
         MVC   ENTRY12(8),0(R2)        MOVE USERID                      00650000
         TR    ENTRY12(8),TAB          CONVERT TO UPPERCASE             00660000
         MVC   USERID(8),ENTRY12       KEEP USERID                      00670000
*                                                                       00680000
         MVC   GROUP(8),8(R2)          KEEP GROUP NAME                  00690000
         TR    GROUP(8),TAB            CONVERT TO UPPERCASE             00700000
*                                                                       00710000
****************************************************************        00720000
*    CALCULATE REAL LENGTH OF ENTRY NAME                                00730000
****************************************************************        00740000
         LA    R1,ENTRY12+8            MAX ENTRY NAME ADDR              00750000
         TRT   ENTRY12(8),BLANKTAB                                      00760000
         S     R1,=A(ENTRY12)                                           00770000
         LTR   R6,R1                   LENGTH = 0 ?                     00780000
         BNZ   LLENNZ                  NO,SKIP                          00790000
LLENZ    DS    0H                                                       00800000
         MVI   ENTRY11,1               INITIAL LENGTH OF ENTRY NAME     00810000
         XC    ENTRY12,ENTRY12         CLEAR ENTRY NAME                 00820000
         B     LUCPP                                                    00830000
LLENNZ   DS    0H                                                       00840000
         STC   R6,ENTRY11              STORE REAL ENTRY NAME LENGTH     00850000
*                                                                       00860000
         L     R2,AOPTION              OPTION CODE / LOCATE / NEXTC /   00870000
         MVC   OPTCDE(8),0(R2)                                          00880000
         TR    OPTCDE(8),TAB           CONVERT OPTION TO UPPERCASE      00890000
*                                                                       00900000
LUCPP    DS    0H                                                       00910000
*                                                                       00920000
*-------------------------------------------------------------------    00930000
*   MOVE  DEBUG LEVEL TO TEST ROUTINES                                  00940000
*-------------------------------------------------------------------    00950000
         L     R8,TSTUSR               TEST ROUTINE                     00960000
         USING TESTUSR,R8                                               00970000
         MVC   DBGCNN(1),DEBUGL        DEBUG LEVEL                      00980000
         DROP  R8                                                       00990000
*WS2427                                                                 01000000
         L     R8,TSTGRP                                                01010000
         USING TESTGRP,R8              TEST ROUTINE                     01020000
         MVC   DBGGRP(1),DEBUGL        DEBUG LEVEL                      01030000
         DROP  R8                                                       01040000
*                                                                       01050000
LUCLOC   DS    0H                                                       01060000
         CTSFAGR LOCATE,                                               101070000
               TYPE='USR',OUTEP=OUTP,OUTAREA=AAREA,                    201080000
               DATAMAP=NEW,ENTRY=ENTRY1,RC=RETCODE,TEST=TSTUSR,        301090000
               EOE=NO,GETPRG=CTSFRXT,FORMAT=INTERNAL,DEBUG=DEBUG,      401100000
               (TXTL='USERID'),                                        *01110000
               (DFLTGRP,E,C,TXTL='DFLTGRP'),                           *01120000
               (CGGRPNM,E,C,TXTL='GROUP',IGNORE=YES,TST=SGRP),         *01130000
               (CGAUTHOR,E,C,TXTL='OWNER',TST=SGRP),                   *01140000
               (CGUACC,E,X,TXTL='UACC',TRN=TUACC,TST=SGRP),            *01150000
               (CGFLAG1,E,X,TXTL='ADSP',TRN=G1,TST=SGRP),              *01160000
               (CGFLAG2,E,X,TXTL='SPECIAL',TRN=G1,TST=SGRP),           *01170000
               (CGFLAG3,E,X,TXTL='OPERATIONS',TRN=G1,TST=SGRP),        *01180000
               (CGFLAG5,E,X,TXTL='GRPACC',TRN=G1,TST=SGRP),            *01190000
               (CGGRPAUD,E,X,TXTL='AUDITOR',TRN=G1,TST=SGRP),          *01200000
               (CGREVKDT,E,C,TXTL='REVOKE_DATE',TST=SGRP),             *01210000
               (CGRESMDT,E,C,TXTL='RESUME_DATE',TST=SGRP),             *01220000
               (CGFLAG4,E,X,TXTL='REVOKED',TRN=G1,TST=SGRP),           *01230000
               (CGAUTHDA,E,C,TXTL='INFO.CREATE_DATE',TST=SGRP)          01240000
*                                                                       01250000
         LTR   R15,R15                                                  01260000
         BNZ   RETURN                                                   01270000
****************************************************************        01280000
*      CHECK : IF FOUND REQUESTED GROUP IN CONNECT USERS INFO           01290000
****************************************************************        01300000
*                                                                       01310000
         CTSADBG 'REQUESTED GROUP=_ TEST FLAG=$ ',                     X01320000
               (GROUP,8,SGRP+1,1),                                     X01330000
               LEVEL=(DEBUGL,5,6,7)                                     01340000
*                                                                       01350000
         CLI   SGRP+1,X'00'            GROUP FOUND ?                    01360000
         BE    LUCFOUND                                                 01370000
         MVC   RETCODE,=F'12'          GROUP NOT FOUND                  01380000
         B     RETURN                                                   01390000
*                                                                       01400000
****************************************************************        01410000
*      REQUESTED GROUP FOUND IN CONNECT USERS INFO                      01420000
****************************************************************        01430000
*                                                                       01440000
LUCFOUND DS    0H                      GROUP FOUND                      01450000
         SR    R6,R6                   REL LENGTH                       01460000
         LA    R8,8                    MAX GROUP NAME LENGTH            01470000
         LA    R2,GROUP                                                 01480000
         MVC   ENTRYG2(8),GROUP                                         01490000
*                                                                       01500000
****************************************************************        01510000
*    CALCULATE REAL LENGTH OF ENTRY NAME                                01520000
****************************************************************        01530000
         LA    R1,ENTRYG2+8            MAX ENTRY NAME ADDR              01540000
         TRT   ENTRYG2(8),BLANKTAB                                      01550000
         S     R1,=A(ENTRYG2)                                           01560000
         LTR   R6,R1                   LENGTH = 0 ?                     01570000
         BNZ   LGLENNZ                 NO,SKIP                          01580000
LGLENZ   DS    0H                                                       01590000
         MVI   ENTRYG1,1               INITIAL ENTRY NAME(GROUP)=1      01600000
         XC    ENTRYG2,ENTRYG2         CLEAR ENTRY NAME                 01610000
         B     LUGPP                                                    01620000
LGLENNZ  DS    0H                                                       01630000
         STC   R6,ENTRYG1              STORE REAL GROUP NAME LENGTH     01640000
LUGPP    DS    0H                                                       01650000
*                                                                       01660000
         CTSADBG 'GROUP=#/_',(?R6,ENTRYG2,?R6),                        X01670000
               LEVEL=(DEBUGL,5,6,7)                                     01680000
*                                                                       01690000
*****************************************************************       01700000
*    MOVE DEBUG LEVEL FOR TEST ROUTINE                                  01710000
*****************************************************************       01720000
         PRINT GEN                                                      01730000
         CTSFAGR LOCATE,                                               101740000
               TYPE='GRP',OUTEP=OUTP,OUTAREA=AAREA,                    201750000
               DATAMAP=NEW,ENTRY=ENTRYG,RC=RETCODG,DEBUG=DEBUG,        301760000
               EOE=NO,GETPRG=CTSFRXT,FORMAT=INTERNAL,                  401770000
               TEST=TSTGRP,                                 WS2427     501780000
               (TXTL='GROUP'),                                         *01790000
               (UNVFLG,E,X,TXTL='UNIVERSAL',TRN=TUNIV),     WS2427     *01800000
               (USERID,E,C,TXTL='USERID',IGNORE=YES,TST=SUSR),         *01810000
               (USERACS,E,X,TXTL='AUTHORITY',TRN=TAUTH,TST=SUSR),      *01820000
               (UNVFLG,E,X,TXTL='AUTHORITY',TRN=TAUSE,TST=SUNV)  WS2427 01830000
*                                                                       01840000
         CLI   SUSR+1,X'00'            USERID FOUND ?                   01850000
         BE    RETURN                                                   01860000
         CLI   SUNV+1,X'00'            UNIVERSAL GROUP   WS2427         01870000
         BE    RETURN                                    WS2427         01880000
         MVC   RETCODE,=F'12'          USERID NOT FOUND                 01890000
         B     RETURN                                                   01900000
RETURN   DS    0H                                                       01910000
         L     R2,AENTRY                                                01920000
         MVC   0(8,R2),=CL8' '                                          01930000
         SR    R6,R6                                                    01940000
         IC    R6,ENTRY11              LENGTH OF ENTRY NAME             01950000
         BCTR  R6,0                                                     01960000
         EX    R6,MVCENTRY                                              01970000
* --------------------     1  - RACF RETURN CODE                        01980000
* --------------------     2  - RACF REASON CODE                        01990000
* --------------------     3  - EXTRACTOR RETURN CODE                   02000000
         L     R4,ARCFRET                                               02010000
         MVC   0(4,R4),RETCODE                                          02020000
         L     R4,AREASON                                               02030000
         MVC   0(4,R4),RETCODE+4                                        02040000
         L     R15,RETCODE+8                                            02050000
         CTSADBG 'EXITING WITH RC=~',(?R15),                           102060000
               LEVEL=(DEBUGL,3,4,5,6,7)                                 02070000
         BRTRN (15)                                                     02080000
* -------------------------------------------------------               02090000
         LTORG                                                          02100000
*                                                                       02110000
* -------------------------------------------------------               02120000
*     TEST FOR GROUP SELECTING                                          02130000
* -------------------------------------------------------               02140000
SGRP     ICHETEST FIELD=CGGRPNM,COND=EQ,FLDATA=(8,GROUP),RELEASE=1.9    02150000
* -------------------------------------------------------               02160000
*     TEST FOR USER  SELECTING                                          02170000
* -------------------------------------------------------               02180000
SUSR     ICHETEST FIELD=USERID,COND=EQ,FLDATA=(8,USERID),RELEASE=1.9    02190000
* -------------------------------------------------------               02200000
*     TEST FOR UNIVERSAL FLAG                                           02210000
* -------------------------------------------------------               02220000
SUNV ICHETEST FIELD=UNVFLG,COND=ONES,FLDATA=(1,UNIYES),RELEASE=1.9      02230000
UNIYES   DC  X'80'  UNIVERSAL=YES                                       02240000
* -------------------------------------------------------               02250000
*     TRANSLATE TABLE                                                   02260000
* -------------------------------------------------------               02270000
*                                                                       02280000
*                                      ADSP                             02290000
*                                      SPECIAL                          02300000
*                                      OPERATIONS                       02310000
*                                      REVOKED                          02320000
*                                      GRPACC                           02330000
*                                      AUDITOR                          02340000
G1       DC    AL1(1),X'80'                                             02350000
         DC    AL1(1),CL1'Y'                                            02360000
         DC    AL1(1),X'00'                                             02370000
         DC    AL1(1),CL1'N'                                            02380000
         DC    AL1(0)                                                   02390000
* -------------------------------------------------------               02400000
*WS2427                                                                 02410000
TUNIV    DC    AL1(1),X'80'            UNIVERSAL FLAG                   02420000
         DC    AL1(1),CL1'Y'                                            02421000
         DC    AL1(1),X'00'                                             02422000
         DC    AL1(1),CL1'N'                                            02423000
         DC    AL1(0)                                                   02424000
*                                                                       02425000
*                                                                       02426000
*                                      AUTHORITY                        02427000
TAUTH    DC    AL1(1),X'80'                                             02428000
         DC    AL1(4),CL4'JOIN'                                         02429000
         DC    AL1(1),X'40'                                             02430000
         DC    AL1(7),CL7'CONNECT'                                      02440000
         DC    AL1(1),X'20'                                             02450000
         DC    AL1(6),CL6'CREATE'                                       02460000
         DC    AL1(1),X'10'                                             02470000
         DC    AL1(3),CL3'USE'                                          02480000
         DC    AL1(0)                                                   02490000
*WS2427                                AUTHORITY(USE) FOR UNIGROUP      02500000
TAUSE    DC    AL1(1),X'80'                                             02510000
         DC    AL1(3),CL3'USE'                                          02520000
         DC    AL1(0)                                                   02521000
* -------------------------------------------------------               02522000
*                                      UACC                             02523000
TUACC    DC    AL1(1),X'80'                                             02524000
         DC    AL1(5),CL5'ALTER'                                        02525000
         DC    AL1(1),X'40'                                             02526000
         DC    AL1(7),CL7'CONTROL'                                      02527000
         DC    AL1(1),X'20'                                             02528000
         DC    AL1(6),CL6'UPDATE'                                       02529000
         DC    AL1(1),X'10'                                             02530000
         DC    AL1(4),CL4'READ'                                         02540000
         DC    AL1(1),X'08'                                             02550000
         DC    AL1(7),CL7'EXECUTE'                                      02560000
         DC    AL1(1),X'01'                                             02570000
         DC    AL1(4),CL4'NONE'                                         02580000
         DC    AL1(0)                                                   02590000
* -------------------------------------------------------               02600000
AAREA    DS   F                        ADDRESS OUTPUT AREA              02610000
DEBUG    DS   F                        DEBUG LEVEL                      02620000
DEBUGL   DS   CL1                      DEBUG LEVEL                      02630000
*                                                                       02640000
ENTRY1   DS   0H                       ENTRY-NAME FOR USER              02650000
ENTRY11  DS   AL1                                                       02660000
ENTRY12  DS   CL10                                                      02670000
*                                                                       02680000
ENTRYG   DS   0H                       ENTRY-NAME FOR GROUP             02690000
ENTRYG1  DS   AL1                                                       02700000
ENTRYG2  DS   CL10                                                      02710000
*                                                                       02720000
OPTCDE   DS   CL8                      OPCODE  = LOCATE / NEXTC         02730000
GROUP    DS   CL8                      GROUP NAME                       02740000
USERID   DS   CL8                      USERID                           02750000
OUTP     DC   A(DUMMYG)                EXTERNAL OUTPUT ROUTINE          02760000
TSTUSR   DC   A(TESTUSR)               TEST ROUTINE GROUP               02770000
TSTGRP   DC   A(TESTGRP)              TEST ROUTINE                      02780000
CTSFRXT  DC   V(CTSFRXT)               EXTRACTOR NAME                   02790000
RETCODE  DS   3F                                                        02800000
RETCODG  DS   3F                                                        02810000
* --------------------     1  - RACF RETURN CODE                        02820000
* --------------------     2  - RACF REASON CODE                        02830000
* --------------------     3  - EXTRACTOR RETURN CODE                   02840000
*                                                                       02850000
MVCENTRY MVC   0(0,R2),ENTRY12         MOVE ENTRY NAME                  02860000
*                                                                       02870000
BLANKTAB DC    256AL1(00)                                               02880000
         ORG   BLANKTAB+X'40'                                           02890000
         DC    X'FF'                                                    02900000
         ORG   ,                                                        02910000
*                                                                       02920000
TAB      DC    256AL1(*-TAB)           TRANSLATE TABLE TO UPPERCASE     02930000
         ORG   TAB                                                      02940000
         DC    40C' '                                                   02950000
         ORG   TAB+C'A'-X'40'                                           02960000
         DC    C'ABCDEFGHI'                                             02970000
         ORG   TAB+C'J'-X'40'                                           02980000
         DC    C'JKLMNOPQR'                                             02990000
         ORG   TAB+C'S'-X'40'                                           03000000
         DC    C'STUVWXYZ'                                              03010000
         ORG   ,                                                        03020000
*                                                                       03030000
         DROP  ,                                                        03040000
DUMMYG   DS   0H           DUMMY OUTPUT SECTION                         03050000
         BR   R14                                                       03060000
         DROP  ,                                                        03070000
* ---------------------------------------------------------------       03080000
         TITLE 'TEST ROUTINE WORK WITH RACF DATA BASE'                  03090000
*                                                                       03100000
*********************************************************************   03110000
*                                                                   *   03120000
* EXTRACTOR EXIT ROUTINE                                            *   03120100
*                                                                   *   03120200
*********************************************************************   03120300
*                                                                   *   03120400
* INPUT PARAMETERS :                                                *   03120500
* ------------------                                                *   03120600
*                                                                   *   03120700
*  1) TYPE OF CALL                                                  *   03120800
*        START  -  BEFORE REACORD READ FROM RACF DATABASE           *   03120900
*        ENTRY  -  AFTER  REECORD READ FROM RACF DATABASE           *   03121000
*        ELEMN  -  ELEMENTARY DATA FIELD                            *   03121100
*        LIST   -  LIST DATA FIELD                                  *   03121200
*        END    -  BEFORE RETURN FROM EXTRACTOR                     *   03121300
*                                                                   *   03121400
*  SEE PARMM DESCT BELOW FOR OPCODE  DEPENDENT PARAMETERS LIST      *   03121500
*                                                                   *   03121600
* RETURN CODE ( R15 ) :                                             *   03121700
* ---------------------                                             *   03121800
*                                                                   *   03121900
*        TYPE OF ENTRY POINT                                        *   03122000
*        ENTRY  -  0 - CONTINUE, 4 - NEXT RECORD , 8 - END          *   03122100
*        ELEMN  -  0 - CONTINUE, 4 - NOT PUT AND CONTINUE ,8-END    *   03122200
*        LIST   -  0 - CONTINUE, 4 - NOT PUT AND CONTINUE           *   03122300
*                                                                   *   03122400
*********************************************************************   03122500
TESTUSR  BEGIN                                                          03122600
*--------------------------------------------------------------------   03122700
*     ADDRESSABILITY MAIN PARAMETERS                                    03122800
*--------------------------------------------------------------------   03122900
         USING PARMM,R1                                                 03123000
         L     R2,XPROPCD                                               03124000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 03125000
         BE    LSTART                           RACF DATA BASE          03126000
         CLI   0(R2),XPRENTY          ENTRY  -  AFTER  READ RECORD FROM 03127000
         BE    LENTRY                           RACF DATA BASE          03128000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         03129000
         BE    LELEMN                                                   03130000
         CLI   0(R2),XPRLIST          LIST   -  LIST DATA               03140000
         BE    LLIST                                                    03150000
         CLI   0(R2),XPREND           END    -  BEFORE RETURN FROM      03160000
         BE    LEND                             EXTRACTOR               03170000
         B     RET0                                                     03180000
*                                                                       03190000
********************************************************************    03200000
*        START                                                          03210000
********************************************************************    03220000
*                                                                       03230000
LSTART   DS    0H                                                       03240000
         B     RET0                                                     03250000
*                                                                       03260000
********************************************************************    03270000
*        ENTRY                                                          03280000
********************************************************************    03290000
*                                                                       03300000
LENTRY   DS    0H                                                       03310000
         L     R3,XPRENTRY              ADDR FIELD NAME                 03320000
         L     R5,0(R3)                 ENTRY NAME LENGTH               03330000
         L     R4,XPRPRFXY                                              03340000
         L     R4,0(R4)                                                 03350000
         USING RETAREA,R4                                               03360000
*                                                                       03370000
         CTSADBG 'ENTRY=#/_',(?R5,4(R3),?R5),                          X03380000
               LEVEL=(DBGCNN,5,6,7)                                     03390000
*                                                                       03400000
         DROP  R4                                                       03410000
         B     RET0                                                     03420000
*                                                                       03430000
********************************************************************    03440000
*        ELEMNTRY FIELD                                                 03450000
********************************************************************    03460000
*                                                                       03470000
LELEMN   DS    0H                                                       03480000
         L     R3,XPRFNME              ADDR FIELD NAME                  03490000
         L     R4,XPRFADRE             ADDR FIELD VALUE                 03500000
         L     R5,0(R4)                FIELD LENGTH                     03510000
*                                                                       03520000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          *03530000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *03540000
               LEVEL=(DBGCNN,5,6,7)                                     03550000
*                                                                       03560000
         CLC   =CL8'CGREVKDT',0(R3)    REVOKE DATE                      03570000
         BE    LREV                                                     03580000
         CLC   =CL8'CGRESMDT',0(R3)    RESUME DATE                      03590000
         BE    LRES                                                     03600000
         CLC   =CL8'CGFLAG4',0(R3)     REVOKE FLAG                      03610000
         BE    LFLG4                                                    03620000
         CLC   =CL8'CGAUTHDA',0(R3)    CREATE DATE                      03630000
         BE    LAUTH                                                    03640000
         B     RET0                    PUT DATA TO OUTPUT AREA          03650000
LAUTH    DS    0H                      CREATE DATE                      03660000
         CLC   0(4,R4),=F'3'           LENGTH VALID ?                   03670000
         BNE   RET4                    N,DON'T PUT                      03680000
         ST    R4,RDT4                                                  03690000
         CALL  CTSADTE,(RDT4)          CREATE DATE                      03700000
         B     RET0                    PUT DATA                         03710000
LREV     DS    0H                      REVOKE DATE                      03720000
         XC    REVDT,REVDT                                              03730000
         CLC   0(4,R4),=F'3'           LENGTH VALID ?                   03740000
         BNE   RET4                    N, DON'T PUT                     03750000
         MVC   REVDT(3),4(R4)          SAVE REVOKE DATE                 03760000
         ST    R4,RDT4                                                  03770000
         CALL  CTSADTE,(RDT4)          REVOKE DATE                      03780000
         B     RET0                    PUT DATA TO OUTPUT AREA          03790000
*------------------------------------------------------------           03800000
*     REVOKE FLAG                                                       03810000
*------------------------------------------------------------           03820000
LFLG4    DS    0H                                                       03830000
         L     R5,REVDT                |REVOKE DATE                     03840000
         LTR   R5,R5                   |   WAS NOT OBTAINED             03850000
         BZ    RET0                    |     RETURN REVOKE FLAG         03860000
         MVI   4(R4),X'00'             |   USER NOT REVOKED             03870000
         B     RET0                                                     03880000
*                                                                       03890000
LRES     DS    0H                      RESUME DATE                      03900000
         CLC   0(4,R4),=F'3'           LENGTH VALID ?                   03910000
         BNE   RET4                    N,DON'T PUT DATA                 03920000
         ST    R4,RDT4                                                  03930000
         CALL  CTSADTE,(RDT4)          RESUME DATE                      03940000
         B     RET0                    PUT DATA TO OUTPUT AREA          03950000
*                                                                       03960000
LLIST    DS    0H                                                       03970000
         L     R3,XPRFNML              ADDR FIELD NAME                  03980000
         L     R4,XPRFADRL             ADDR FIELD VALUE                 03990000
         L     R5,0(R4)                FIELD LENGTH                     04000000
*                                                                       04010000
         CTSADBG 'LIST FIELD=_ VALUE=#/_/$',                           *04020000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *04030000
               LEVEL=(DBGCNN,5,6,7)                                     04040000
*                                                                       04050000
         B     RET0                    PUT DATA TO OUTPUT AREA          04060000
LEND     DS    0H                                                       04070000
         B     RET0                                                     04080000
RET0     DS    0H                                                       04090000
         SR    R15,R15                                                  04100000
         B     RETT                                                     04110000
RET4     DS    0H                                                       04120000
         LA    R15,4                                                    04130000
         B     RETT                                                     04140000
RET8     DS    0H                                                       04150000
         LA    R15,8                                                    04160000
         B     RETT                                                     04170000
RETT     DS    0H                                                       04180000
         BRTRN (15)                                                     04190000
********************************************************************    04200000
*       W O R K  A R E A  A N D   C O N S T A N T S                     04210000
********************************************************************    04220000
REVDT    DS    F                                                        04230000
RDT4     DS    F                                                        04240000
DBGCNN   DS    CL1                     DEBUG LEVEL                      04250000
         LTORG                                                          04260000
         DROP  ,                                                        04270000
*                                                                       04280000
*********************************************************************   04290000
*                                                                   *   04300000
* EXTRACTOR EXIT ROUTINE FOR GROUP WS2427                           *   04310000
*                                                                   *   04320000
*********************************************************************   04330000
*                                                                   *   04340000
* INPUT PARAMETERS :                                                *   04350000
* ------------------                                                *   04360000
*                                                                   *   04370000
*  1) TYPE OF CALL OF INTEREST                                      *   04380000
*        ELEMN  -  ELEMENTARY DATA FIELD                            *   04390000
*        START  -  BEFORE RACF CALL                                 *   04400000
*                                                                   *   04410000
*  SEE PARMM DSECT BELOW FOR OPCODES AND                            *   04420000
*                            OPCODES DEPENDENT PARM LIST            *   04430000
*                                                                   *   04440000
* RETURN CODE ( R15 ) :                                             *   04450000
* ---------------------                                             *   04460000
*                                                                   *   04470000
*        TYPE OF ENTRY POINT                                        *   04480000
*        ELEMN  -  0 - PUT AND CONTINUE, 4 - NOT PUT AND CONTINUE   *   04490000
*        START  -  0 - CONTINUE                                     *   04500000
*        OTHER  -  0 - CONTINUE                                     *   04510000
*                                                                   *   04520000
*********************************************************************   04530000
TESTGRP  BEGIN                                                          04540000
********************************************************************    04550000
*        CHECK ENTRY REASON                                             04560000
********************************************************************    04570000
*                                                                       04580000
         USING PARMM,R1                                                 04590000
         L     R2,XPROPCD                                               04600000
         CLI   0(R2),XPRSTRT          START  -  BEFORE READ RECORD FROM 04610000
         BE    GSTART                           RACF DATA BASE          04620000
         CLI   0(R2),XPRELMN          ELEMN  -  ELEMENTARY DATA         04630000
         BE    GELEMN                                                   04640000
         B     GRET0                                                    04650000
********************************************************************    04660000
*        START INITIALIZE                                               04670000
********************************************************************    04680000
GSTART   MVI   FUNIV,X'01'            INITILIZE FIRST TIME              04690000
         MVI   FUSER,X'00'            INITIALIZE NO USER                04700000
         B     GRET0                                                    04710000
********************************************************************    04720000
*        ELEMNTRY FIELD                                                 04730000
********************************************************************    04740000
GELEMN   L     R3,XPRFNME                                               04750000
         L     R4,XPRFADRE                                              04760000
         L     R5,0(R4)                FIELD LENGTH                     04770000
         CTSADBG 'ELEMN FIELD=_ VALUE=#/_/$',                          *04780000
               (0(R3),8,?R5,4(R4),?R5,4(R4),?R5),                      *04790000
               LEVEL=(DBGGRP,4,5,6,7)                                   04800000
*                                                                       04810000
         CLC   =CL6'UNVFLG',0(R3)    UNIVERSAL                          04820000
         BE    GUNIV                                                    04830000
         CLC   =CL7'USERACS',0(R3)                                      04840000
         BE    GAUTH                                                    04850000
         B     GRET0                                                    04860000
*******************************************************                 04870000
*   UNIVERSAL                                                           04880000
*******************************************************                 04890000
GUNIV    DS    0H                                                       04900000
         CLI   FUNIV,X'01'             FIRST TIME ?                     04910000
         BNE   GUNIV2                  IF NOT - SECOND                  04920000
         MVI   FUNIV,X'00'             TURN OFF FIRST TIME              04930000
         B     GRET0                   RETURN                           04940000
GUNIV2   DS    0H                                                       04950000
         LTR   R5,R5                   WAS VALUE OF UNVFLG PASSED ?     04960000
         BZ    GRET4                   IF NOT, NOTHING TO PUT           04970000
         CLI   FUSER,X'01'             WAS USER FOUND IN GROUP          04980000
         BNE   GRET0                   IF NOT, PUT AUTH(USE)            04990000
         B     GRET4                   OTHERWISE PUT NOTHING            05000000
*******************************************************                 05010000
*   AUTHORITY                                                           05020000
*******************************************************                 05030000
GAUTH    DS    0H                                                       05040000
         LTR   R5,R5                                                    05050000
         BZ    GRET4                                                    05060000
         MVI   FUSER,X'01'                                              05070000
         B     GRET0                                                    05080000
********************************************************************    05090000
*        SET RC AND EXIT                                                05100000
********************************************************************    05110000
GRET0    DS    0H                                                       05120000
         SR    R15,R15                                                  05130000
         B     GRETT                                                    05140000
GRET4    DS    0H                                                       05150000
         LA    R15,4                                                    05160000
GRETT    DS    0H                                                       05170000
         BRTRN (15)                                                     05180000
         LTORG                                                          05190000
DBGGRP   DS    CL1                     DEBUG LEVEL                      05200000
FUNIV    DS    X                                                        05210000
FUSER    DS    X                                                        05220000
         DROP  ,                                                        05230000
*                                                                       05240000
********************************************************************    05250000
*    MAIN PARAMETERS LIST FOR TEST ROUTINES                             05260000
*******************************************************************     05270000
PARMM    DSECT                                                          05280000
         COPY  CTSFXPR                                                  05290000
******************************************************************      05300000
*       RETURN AREA FROM RACF                                           05310000
******************************************************************      05320000
RETAREA  DSECT                                                          05330000
         COPY  CTSFXPF                                                  05340000
*SAS2IBMN REMOVE THE FOLLOWING LINES - DIPLICATE                        05341000
*SAS2IBMN END                                                           05350000
*SAS2IBMN  *****************************************************        05360000
*SAS2IBMN  *    MAIN PARAMETERS LIST FOR TEST ROUTINES                  05370000
*SAS2IBMN  *****************************************************        05380000
*SAS2IBMN  PARMM    DSECT                                               05390000
*SAS2IBMN COPY  CTSFXPR                                                 05400000
*SAS2IBMN  *****************************************************        05410000
*SAS2IBMN  *       RETURN AREA FROM RACF                                05420000
*SAS2IBMN  *****************************************************        05430000
*SAS2IBMN  RETAREA  DSECT                                               05440000
*SAS2IBMN COPY  CTSFXPF                                                 05450000
         END                                                            05460000
