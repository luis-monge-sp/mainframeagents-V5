**********************************************************************  00040000
*                                                                       00050000
*                                                                       00060000
* REQUEST CHAINING ROUTINE                                              00070000
* ------------------------                                              00080000
*                                                                       00090000
*                                                                       00100000
* ATTRIBUTES: REENTRANT, REUSABLE                                       00110000
*    THE ROUTINE USES THE CALLER'S SAVE AREA, AND IN THE                00120000
*    INIT AND END OPERATION CODES, IT REQUIRES IT'S OWN                 00130000
*    SAVE AREA.                                                         00140000
*                                                                       00150000
*                                                                       00160000
* OPERATION CODES OF THE ROUTINE: (IN IOARQCP DSECT)                    00170000
*                                                                       00180000
*    INIT   - INITIATE REQUEST CHAIN                                    00190000
*             GETMAIN AREA FOR THE CHAIN, FORMAT IT INTO LINK           00200000
*             ELEMENTS, CHAIN THEN AND SET THE POINTERS.                00210000
*             (SEE "DATA STRUCTURE" CLAUSE)                             00220000
*                                                                       00230000
*    PUT    - PUT REQUEST                                               00240000
*             RECEIVE A REQUEST FROM THE CALLER AND PUT IT              00250000
*             IN GIVEN CHAIN.                                           00260000
*                                                                       00270000
*    GET    - GET REQUEST                                               00280000
*             TAKE A REQUEST FROM GIVEN CHAIN AND PASS ITS              00290000
*             ADDRESS TO THE CALLER.                                    00300000
*                                                                       00310000
*    MASSP  - MASS PUT                                                  00280000
*             CHAIN A CHAIN TO ANOTHER CHAIN                            00290000
*                                                                       00270000
*    LIST   - LIST REQUEST                                              00280000
*             RETURN THE ADDRESS OF A REQUEST WITHOUT DESCONNECTING IT. 00290000
*                                                                       00300000
*    GETTP  - GET TOP OF LIST                                           00280000
*             GET TOP OF LIST ACCORDING TO AN ADDRESS (THE ADDRESS      00290000
*             WAS OBTAINED WITH THE LIST OPERATION). THE ROUTINE        00300000
*             VERIFIES IF THE REQUEST IS STILL ON TOP OF QUEUE.         00310000
*                                                                       00310000
*                                                                       00310000
*           NOTE: PUT,GET,MASSP,LIST AND GETTP ARE ALSO AVAILABLE IN
*                 REENTRANT MACRO:  CTSAREQ
*                 THE MACRO DOESN'T USE THE CALLER'S SAVE AREA
*                 AND DESTROYS REGS R0,R1,R9,R10,R11,R14,R15.
*
*    END    - TERMINATE REQUEST CHAIN                                   00370000
*             FREE THE GETMAINED AREA.                                  00380000
*             IMPORTANT: TERMINATION OF A CHAIN FREES ALL THE ELEMENTS  00390000
*                        IN ITS INITIAL AREA, SO MAKE SURE THAT NO      00400000
*                        OTHER CHAIN POINTS AT ELEMENTS IN THE AREA OF  00410000
*                        THE CHAIN YOU ARE TERMINATING.                 00420000
*                                                                       00430000
*********************************************************************** 00440000
*                                                                       00450000
* PARAMETERS:                                                           00460000
*                                                                       00470000
*    INIT/END:                                                          00480000
*       1. F   - OPERATION CODE                                         00490000
*       2. A   - ADDRESS OF ANCHOR                                      00500000
*       3. F   - NUMBER OF ELEMENTS                                     00510000
*       4. F   - SUBPOOL OF THE GETMAIN/FREEMAIN                        00520000
*       5. 18F - WORK                                                   00530000
*                                                                       00540000
*    INIT                                                               00480000
*       6. XL1 - CHAIN ID#                                              00530000
*       7. XL1 - QTYPE                                                  00530000
*                                                                       00540000
*    GET/PUT/MASSP/LIST/GETTOP                                          00550000
*       1. F   - OPERATION CODE                                         00560000
*       2. A   - ADDRESS OF ANCHOR                                      00570000
*       3. A   - REQUEST ADDRESS                                        00580000
*                                                                       00590000
* RETURN CODES:                                                         00610000
*                                                                       00620000
*    INIT/END:                                                          00630000
*       0 - OK                                                          00640000
*       4 - GETMAIN/FREEMAIN FAILED                                     00650000
*                                                                       00660000
*    GET/PUT/MASSP/LIST/GETTOP                                          00550000
*       0 - OK                                                          00680000
*       4 - NO FREE ELEMENT FOUND                                       00690000
*       8 - ANCHOR IS ZERO OR INVALID                                   00691000
*      12 - AN INVALID CHAIN ID WAS DETECTED                            00691000
*                                                                       00693000
*    GETTOP:                                                            00670000
*      16 - ADDRESSES OF REQUEST AND ADDRESS AT TOP DOES NOT MATCH      00692000
*                                                                       00693000
*********************************************************************** 00694000
*                                                                       00695000
* USAGE:                                                                00696000
*                                                                       00697000
*    - INITIATE:                                                        00698000
*                                                                       00699000
*       /* INITIATE FREE CHAIN                                          00700000
*          CALL CTSAREQ (INIT,FREE_ANCHOR,ELEM#,SP,WORK,ID#,QTYPE)      00710000
*       /* INITIATE REQUEST CHAIN                                       00720000
*          CALL CTSAREQ (INIT,REQ_ANCHOR,0,SP,WORK,ID#,QTYPE)           00730000
*                                                                       00740000
*    - BY THE REQUESTOR:                                                00750000
*                                                                       00760000
*       /* GET FREE ELEMENT                                             00770000
*          CALL CTSAREQ (GET,FREE_ANCHOR,ADDR)                          00780000
*       /* PROCESS THE AREA                                             00790000
*          CALL USER (ADDR)                                             00800000
*       /* INSERT INTO REQUEST CHAIN                                    00810000
*          CALL CTSAREQ (PUT,REQ_ANCHOR,ADDR)                           00820000
*                                                                       00830000
*    - BY THE EXECUTOR:                                                 00840000
*                                                                       00850000
*       /* GET REQUEST ELEMENT                                          00860000
*          CALL CTSAREQ (GET,REQ_ANCHOR,ADDR)                           00870000
*       /* PROCESS THE AREA                                             00880000
*          CALL USER (ADDR)                                             00890000
*       /* INSERT BACK INTO FREE CHAIN                                  00900000
*          CALL CTSAREQ (PUT,FREE_ANCHOR,ADDR)                          00910000
*                                                                       00920000
*    - TERMINATE:                                                       00930000
*                                                                       00940000
*    /* TERMINATE FREE CHAIN                                            00950000
*       CALL CTSAREQ (END,FREE_ANCHOR,ELEM#,SP,WORK)                    00960000
*    /* TERMINATE REQUEST CHAIN                                         00970000
*       CALL CTSAREQ (END,REQ_ANCHOR,0,SP,WORK)                         00980000
*                                                                       00990000
*********************************************************************** 01000000
*                                                                       01010000
* DATA STRUCTURE:                                                       01020000
*                                                                       01030000
* THE ANCHOR SUPPLIED BY THE CALLER POINTS TO A GETMAINED AREA          01040000
* STRUCTURED AS SPECIFIED IN DSECT IOARQH (RQC CHAIN HEADER)            01050000
*                                                                       01060000
* FIFO TYPE OF CHAIN STRUCTURE                                          01050000
* ----------------------------                                          01150000
* 'TOP' POINTS TO THE OLDEST ELEMENT.                                   01160000
* 'BOTTOM' POINTS TO THE NEWEST ELEMENT.                                01170000
* IF 'TOP' AND/OR 'BOTTOM' ARE ZERO, THE CHAIN IS EMPTY.                01180000
* EACH ELEMENT POINTS TO ONE THAT WAS INSERTED JUST BEFORE IT WAS.      01190000
* 'GET' DELETES THE ELEMENT POINTED BY TOP.                             01200000
* 'PUT' INSERTS ANOTHER ELEMENT BEFORE THE ONE POINTED BY BOTTOM.       01210000
*                                                                       01220000
* I.E.:                                                                 01230000
*                                                                       01240000
* TOP -> E4 -> E3 -> E2 -> E1 <- BOTTOM                                 01250000
*        |                 A                                            01260000
*        V                 |                                            01270000
*       GET               PUT                                           01280000
*                                                                       01290000
* LIFO TYPE OF CHAIN STRUCTURE                                          01050000
* ----------------------------                                          01150000
* WHEN USING LIFO TYPE OF MANAGEMENT, ONLY THE TOP POINTER IS USED.     01050000
* THE BOTTOM POINTER HAS NOT FUNCTION.                                  01050000
*                                                                       01220000
* I.E.:                                                                 01230000
*                                                                       01240000
* TOP -> E1 -> E2 -> E3 -> E4                                           01250000
*        |A                                                             01260000
*        ||                                                             01270000
*        ||________________                                             01270000
*        V                 |                                            01270000
*       GET               PUT                                           01280000
*                                                                       01290000
*********************************************************************** 01300000
*--------V 2.2.0 -----------------------------------------------------* 01300000
* WO0129 KM 07/06/93 AUTOMATION LOG                                     01300000
* IO0019 KM 18/11/93 NEW ALGORITHM FOR REQUESTS CHAINING                01300000
*--------IOA ?   -----------------------------------------------------* 01300000
* *CTV   NY 24/01/94 COPY FROM CTOREQ (AND CHANGE)                      01300000
*IS10188 AL 14/10/24 MOVE OUR MODULES ABOVE 16M LINE                  *
***********************************************************************
*---------------------------------------------------------------------* 01300000
*                                                                       01310000
* MAIN - SAVE/RESTORE AND BRANCH TO OPCODES                             01320000
*                                                                       01320100
         GBLC   &AMODUSE                                      WM0910    01320200
&AMODUSE SETC   'CVT'                                         WM0910    01320300
         PRINT NOGEN                                                    01320400
         CTSEQUR                                                        01320500
         PRINT GEN                                                      01320600
**CTV CTOREQ   CSECT                                                    01320700
CTSAREQ  CSECT                                                   *CTV   01320700
CTSAREQ  AMODE ANY                                              IS10188
CTSAREQ  RMODE ANY                                              IS10188
*                                                                       01320800
* REENTERANT SAVE                                                       01320900
*                                                                       01321000
         STM   14,12,12(R13)       SAVE REGISTERS IN CALLER'S SAVE AREA 01322000
         LR    R12,R15             USING FOR ROUTINE                    01323000
**CTV    USING CTOREQ,R12                                               01324000
         USING CTSAREQ,R12                                       *CTV   ING IOA0
         LR    R7,R1               USING FOR PARMS                      01325000
         USING PRM,R7                                                   01326000
         SLR   R6,R6               R6 = 0 -> NO SAVE AREA               01327000
*                                                                       01328000
* LEVEL OF THIS MODULE                                                  01329000
*                                                                       01330000
**CTV    CTOLEVEL                                                       01340000
         CTSLEVEL                                                *CTV   01340000
**********************************************************************  01350000
****                                                              ****  01360000
****       SA-AGENT    RELEASE 1.4.0                              ****  01370000
****                                                              ****  01380000
****       LICENCED MATERIAL - NEW DIMENSION SOFTWARE LTD.        ****  01390000
****                                                              ****  01400000
**********************************************************************  01410000
*                                                                       01420000
* BRANCH ACCORDING TO OPERATION CODE                                    01430000
*                                                                       01440000
         L     R1,PRMOPCOD         R1 -> OPERATION CODE                 01450000
         L     R1,0(R1)            R1 =  OPERATION CODE                 01460000
         SLL   R1,2                MULTIPLY BY 4                        01470000
         L     R1,OPERTAB(R1)      OPERATION ROUTINE ADDRESS            01480000
         BR    R1                  BRANCH TO IT                         01490000
*                                                                       01500000
* REENTERANT RESTORE AND RETURN                                         01510000
*                                                                       01520000
RETURNOK EQU   *                                                        01530000
         SLR   R15,R15                                                  01531000
RETURN   EQU   *                                                        01532000
         LTR   R6,R6               WAS THERE A SAVE AREA ?              01533000
         BZ    DORETURN            NO - SKIP CHANGE R13                 01534000
         L     R13,4(R13)          R13 - OLD SAVE AREA                  01535000
DORETURN EQU   *                                                        01536000
         RETURN (14,12),RC=(15)                                         01537000
*                                                                       01538000
*********************************************************************** 01539000
*                                                                       01540000
* INITIATE A CHAIN                                                      01550000
*                                                                       01560000
DOINIT   EQU   *                                                        01570000
*                                                                       01580000
* ESTABLISH SAVE AREA FOR CALLING CTSAXGR                               01590000
*                                                                       01600000
         L     R1,PRMWORK                                               01610000
         ST    R13,4(1)            FORWARD SAVE AREA CHAIN              01620000
         ST    R1,8(0,13)          BACKWARDS SAVE AREA CHAIN            01630000
         LR    R13,R1              USING FOR WORK AREA (VARIABLES)      01640000
         USING WORKAREA,R13        ADDRESS WORKING STORAGE              01650000
         LA    R6,1                R6 ^= 0 -> SAVE AREA                 01660000
*                                                                       01670000
* CALCULATE CHAIN AREA LENGTH                                           01680000
*                                                                       01690000
         L     R2,PRMELEM#         R2 -> ELEM#                          01700000
         L     R4,0(R2)            R4 =  ELEM#                          01710000
         MH    R4,=Y(RQCLEN)       R4 =  ELEM# * ELEMENT LENGTH         01720000
* IO0019 LA    R4,12(R4)           PLUS TOP & BOTTOM & SYNC WORD        01730000
         LA    R4,RQHLEN(R4)       PLUS LENGTH OF CHAIN HEADER   IO0019 01730000
         L     R3,PRMSP            R3 -> SUBPOOL NUMBER                 01740000
         L     R3,0(R3)            R3 =  SUBPOOL NUMBER                 01750000
*                                                                       01760000
* GETMAIN                                                               01770000
*                                                                       01780000
**CTV    CTMXAGR GETMAIN,LV=(R4),LOC=ANY,SP=(R3)                        01790000
         CTSAXGR GETMAIN,LV=(R4),LOC=ANY,SP=(R3),BLOCKID=RQC     *CTV   01790000
         LTR   R15,R15             SUCCESSFUL ?                         01800000
         BNZ   GTMNFAIL            NOT - ERROR                          01810000
*                                                                       01820000
* ZERO THE CHAIN AREA                                                   01830000
*                                                                       01840000
         LR    R8,R1               SAVE CHAIN ADDRESS                   01850000
         LR    R0,R1               SET MVCL TARGET                      01860000
         LR    R1,R4               SET MVCL LENGTH                      01870000
         SR    R15,R15             PADD EVERYTHING WITH X'00'           01880000
         MVCL  R0,R14                                                   01890000
         LR    R1,R8               RESTORE CHAIN ADDRESS                01900000
* IO0019                                                                01910000
* IO0019 FORMAT THE CHAIN                                               01920000
* IO0019                                                                01930000
* IO0019 LA    R3,12(R1)           R3 -> FIRST ELEMENT                  01940000
* IO0019 ST    R3,0(R1)            TOP -> FIRST ELEMENT                 01950000
* IO0019 L     R2,0(R2)            R2 =  ELEM#                          01960000
* IO0019 LTR   R2,R2               ANY ELEMENTS ?                       01970000
* IO0019 BNZ   FRMTLOOP            YES - FORMAT THEM                    01980000
* IO0019                                                                01990000
* IO0019 SET UP NULL CHAIN                                              02000000
* IO0019                                                                02010000
* IO0019 XC    0(4,R1),0(R1)       TOP = 0                              02020000
* IO0019 XC    4(4,R1),4(R1)       BOTTOM = 0                           02030000
* IO0019 B     DOINITRT            AND RETURN                           02040000
*                                                                IO0019 01910000
* SET HEADER OF CHAIN                                            IO0019 01920000
*                                                                IO0019 01930000
         USING RQHSTART,R1                                       IO0019
         STCM  R3,B'0001',RQHSPOOL SET SUBPOOL                   IO0019 01940000
*                                                                IO0019 01990000
**CTV    CTOREQ XMHINIT,ANCHOR=(R1),QTYPE=PRMQTYPE,ID=PRMID      IO0019 00351000
         CTSAREQ XMHINIT,ANCHOR=(R1),QTYPE=PRMQTYPE,ID=PRMID     IO0019 00351000
*                                                                IO0019 01990000
         LR    R3,R1               R3 -> START OF GETMAINED AREA IO0019 01940000
         LA    R3,RQHLEN(R3)       PLUS LENGTH OF CHAIN HEADER   IO0019 01730000
         L     R2,0(R2)            R2 =  ELEM#                   IO0019 01960000
         LTR   R2,R2               ANY ELEMENTS ?                IO0019 01970000
         BZ    DOINITRT            NO, RETURN                    IO0019 02040000
*                                                                IO0019 01990000
         ST    R3,RQHTOP           TOP -> FIRST ELEMENT          IO0019 01950000
         ST    R2,RQHINIT#         SET INITIAL # OF ENTRIES      IO0019 01970000
         ST    R2,RQHCURR#         SET CURRENT # OF ENTRIES      IO0019 01970000
         ST    R2,RQHHWM           SET LOW WATER MARK            IO0019 01970000
*                                                                       02050000
* LOOP OVER THE NEW ELEMENTS                                            02060000
*                                                                       02070000
FRMTLOOP EQU   *                                                        02080000
         LR    R4,R3               R4 -> NEXT ELEMENT                   02090000
         LA    R3,RQCLEN(R4)       R3 -> FOLLOWING ELEMENT              02100000
         ST    R3,0(R4)            UPDATE RQCNEXT                       02110000
         BCT   R2,FRMTLOOP         MORE ELEMENTS - CONTINUE             02120000
         XC    0(4,R4),0(R4)       ZERO RQCNEXT OF LAST ELEMENT         02130000
* IO0019 ST    R4,4(R1)            UPDATE BOTTOM                        02140000
         ST    R4,RQHBOT           UPDATE BOTTOM                 IO0019 02140000
         DROP  R1                                                IO0019
DOINITRT EQU   *                                                        02150000
*                                                                       02160000
* UPDATE CHAIN ANCHOR                                                   02170000
*                                                                       02180000
         L     R4,PRMANCHR         R4 -> ANCHOR                         02190000
         ST    R1,0(R4)            ANCHOR -> GETMAINED AREA             02200000
*                                                                       02210000
* AND RETURN                                                            02220000
*                                                                       02230000
         B     RETURNOK                                                 02240000
         DROP  R13                                                      02250000
*                                                                       02260000
*********************************************************************** 02270000
*                                                                       02280000
* EXECUTE PUT COMMAND                                                   02290000
*                                                                       02300000
DOPUT    EQU   *                                                        02310000
         L     R2,PRMANCHR         R2 -> ANCHOR ADDRESS                 02320000
         L     R3,PRMREQA          R3 -> REQUEST ADDRESS                02330000
*                                                                       02340000
* CALL REQUEST PUT MACRO                                                02350000
*                                                                       02360000
* IO0019 CTORQP 0(R2),0(R3)                                             02370000
**CTV    CTOREQ PUT,ANCHOR=0(R2),REQADDR=0(R3)                   IO0019 02370000
         CTSAREQ PUT,ANCHOR=0(R2),REQADDR=0(R3)             *CTV+IO0019 02370000
*                                                                       02380000
* AND RETURN                                                            02390000
*                                                                       02400000
         B     RETURN                                                   02410000
*                                                                       02420000
*********************************************************************** 02430000
*                                                                       02440000
* EXECUTE GET COMMAND                                                   02450000
*                                                                       02460000
DOGET    EQU   *                                                        02470000
         L     R2,PRMANCHR         R2 -> ANCHOR ADDRESS                 02480000
         L     R3,PRMREQA          R2 -> REQUEST ADDRESS                02490000
*                                                                       02500000
* CALL REQUEST GET MACRO                                                02510000
*                                                                       02520000
* IO0019 CTORQG 0(R2),0(R3)                                             02370000
**CTV    CTOREQ GET,ANCHOR=0(R2),REQADDR=0(R3)                   IO0019 02370000
         CTSAREQ GET,ANCHOR=0(R2),REQADDR=0(R3)             *CTV+IO0019 02370000
*                                                                       02540000
* AND RETURN                                                            02550000
*                                                                       02560000
         B     RETURN                                                   02570000
*                                                                       02580000
*********************************************************************** 02590000
*                                                                       02600000
* TERMINATE A CHAIN                                                     02610000
*                                                                       02620000
DOEND    EQU   *                                                        02630000
*                                                                       02640000
* ESTABLISH SAVE AREA FOR CALLING CTSAXGR                               02650000
*                                                                       02660000
         L     R1,PRMWORK                                               02670000
         ST    R13,4(1)            FORWARD SAVE AREA CHAIN              02680000
         ST    R1,8(0,13)          BACKWARDS SAVE AREA CHAIN            02690000
         LR    R13,R1              USING FOR WORK AREA (VARIABLES)      02700000
         USING WORKAREA,R13        ADDRESS WORKING STORAGE              02710000
         LA    R6,1                R6 ^= 0 -> SAVE AREA                 02720000
*                                                                       02730000
* ZERO ANCHOR                                                           02740000
*                                                                       02750000
         L     R4,PRMANCHR         R4 -> ANCHOR                         02760000
         L     R5,0(R4)            R5 =  ANCHOR                         02770000
         XC    0(4,R4),0(R4)       ANCHOR = 0                           02780000
*                                                                       02790000
* CALCULATE CHAIN AREA LENGTH                                           02800000
*                                                                       02810000
         L     R2,PRMELEM#         R2 -> ELEM#                          02820000
         L     R2,0(R2)            R2 =  ELEM#                          02830000
         MH    R2,=Y(RQCLEN)       R2 =  ELEM# * ELEMENT LENGTH         02840000
* IO0019 LA    R2,12(R2)           PLUS TOP & BOTTOM & SYNC             02850000
         LA    R2,RQHLEN(R2)       PLUS LENGTH OF CHAIN HEADER   IO0019 01730000
         L     R3,PRMSP            R3 -> SUBPOOL NUMBER                 02860000
         L     R3,0(R3)            R3 =  SUBPOOL NUMBER                 02870000
*                                                                       02880000
* FREEMAIN                                                              02890000
*                                                                       02900000
**CTV    CTMXAGR FREEMAIN,LV=(R2),A=(R5),SP=(R3)                        02910000
         CTSAXGR FREEMAIN,LV=(R2),A=(R5),SP=(R3)                 *CTV   02910000
         LTR   R15,R15            SUCCESSFUL ?                          02920000
         BNZ   FRMNFAIL           NOT - ERROR                           02930000
*                                                                       02940000
* AND RETURN                                                            02950000
*                                                                       02960000
         B     RETURNOK                                                 02970000
         DROP  R13                                                      02980000
*                                                                       02990000
*********************************************************************** 02430000
*                                                               WO0129  02440000
* EXECUTE MASSP COMMAND                                         WO0129  02450000
*                                                               WO0129  02460000
DOMASSP  EQU   *                                                WO0129  02470000
         L     R2,PRMANCHR         R2 -> ANCHOR ADDRESS         WO0129  02480000
         L     R3,PRMREQA          R2 -> REQUEST ADDRESS        WO0129  02490000
*                                                               WO0129  02500000
* CALL REQUEST FOR MASS PUT                                     WO0129  02510000
*                                                               WO0129  02520000
**CTV    CTOREQ MASSPUT,ANCHOR=0(R2),REQADDR=0(R3)              IO0019  02370000
         CTSAREQ MASSPUT,ANCHOR=0(R2),REQADDR=0(R3)        *CTV+IO0019  02370000
*                                                               WO0129  02540000
* AND RETURN                                                    WO0129  02550000
*                                                               WO0129  02560000
         B     RETURN                                           WO0129  02570000
*                                                               WO0129  02580000
*********************************************************************** 03000000
*                                                               IO0019  02440000
* EXECUTE LIST COMMAND                                          IO0019  02450000
*                                                               IO0109  02460000
DOLIST   EQU   *                                                IO0019  02470000
         L     R2,PRMANCHR         R2 -> ANCHOR ADDRESS         IO0019  02480000
         L     R3,PRMREQA          R2 -> REQUEST ADDRESS        IO0019  02490000
*                                                               IO0019  02500000
* CALL LIST MACRO                                               IO0019  02510000
*                                                               IO0019  02520000
**CTV    CTOREQ LIST,ANCHOR=0(R2),REQADDR=0(R3)                 IO0019  02370000
         CTSAREQ LIST,ANCHOR=0(R2),REQADDR=0(R3)           *CTV+IO0019  02370000
*                                                               IO0019  02540000
* AND RETURN                                                    IO0019  02550000
*                                                               IO0019  02560000
         B     RETURN                                           IO0019  02570000
*                                                               IO0019  02580000
*********************************************************************** 03000000
*                                                               IO0019  02440000
* EXECUTE GETTOP COMMAND                                        IO0019  02450000
*                                                               IO0109  02460000
DOGETT   EQU   *                                                IO0019  02470000
         L     R2,PRMANCHR         R2 -> ANCHOR ADDRESS         IO0019  02480000
         L     R3,PRMREQA          R2 -> REQUEST ADDRESS        IO0019  02490000
*                                                               IO0019  02500000
* CALL GETTOP MACRO                                             IO0019  02510000
*                                                               IO0019  02520000
**CTV    CTOREQ GETTOP,ANCHOR=0(R2),REQADDR=0(R3)               IO0019  02370000
         CTSAREQ GETTOP,ANCHOR=0(R2),REQADDR=0(R3)         *CTV+IO0019  02370000
*                                                               IO0019  02540000
* AND RETURN                                                    IO0019  02550000
*                                                               IO0019  02560000
         B     RETURN                                           IO0019  02570000
*                                                               IO0019  02580000
*********************************************************************** 03000000
*                                                                       03010000
* GETMAIN FAILED                                                        03020000
*                                                                       03030000
GTMNFAIL EQU   *                                                        03040000
         LA    R15,4                                                    03050000
         B     RETURN                                                   03060000
*                                                                       03070000
*********************************************************************** 03080000
*                                                                       03090000
* FREEMAIN FAILED                                                       03100000
*                                                                       03110000
FRMNFAIL EQU   *                                                        03120000
         LA    R15,4                                                    03130000
         B     RETURN                                                   03140000
*                                                                       03150000
*********************************************************************** 03160000
*                                                                       03170000
* CONSTANT STORAGE - NO VARIABLES !                                     03180000
*                                                                       03190000
* OPERATION CODES OF THE ROUTINE (IN CTORQC)                            03200000
*                                                                       03210000
OPERTAB  DS    (RQCNOPCD)A                                              03220000
         ORG   OPERTAB+RQCINIT*4                                        03230000
         DC    A(DOINIT)                                                03240000
         ORG   OPERTAB+RQCPUT*4                                         03250000
         DC    A(DOPUT)                                                 03260000
         ORG   OPERTAB+RQCGET*4                                         03270000
         DC    A(DOGET)                                                 03280000
         ORG   OPERTAB+RQCEND*4                                         03290000
         DC    A(DOEND)                                                 03300000
         ORG   OPERTAB+RQCMASSP*4                                WO0129 03290000
         DC    A(DOMASSP)                                        WO0129 03300000
         ORG   OPERTAB+RQCLIST*4                                 IO0019 03290000
         DC    A(DOLIST)                                         IO0019 03300000
         ORG   OPERTAB+RQCGETTP*4                                IO0019 03290000
         DC    A(DOGETT)                                         IO0019 03300000
         ORG   OPERTAB+RQCXMINI*4                                IO0019 03290000
         DC    A(GTMNFAIL)          OPCODE NOT ALLOWED - RC=4    IO0019 03300000
         ORG   ,                                                        03310000
*                                                                       03320000
         LTORG                                                          03330000
         DROP  R12                                                      03340000
*                                                                       03350000
* PARAMETERS OF THE ROUTINE                                             03360000
*                                                                       03370000
PRM      DSECT                                                          03380000
PRMOPCOD DS    A              ALL OPCODES                               03390000
PRMANCHR DS    A              ALL OPCODES                               03400000
PRMREQA  DS    A              PUT/GET                                   03410000
PRMELEM# EQU   PRMREQA        INIT/END                                  03420000
PRMSP    DS    A              INIT/END                                  03430000
PRMWORK  DS    A              INIT/END                                  03440000
PRMID    DS    A              INIT                               IO0019 03440000
PRMQTYPE DS    A              INIT                               IO0019 03440000
*                                                                       03450000
* MAPPING OF WORK AREA                                                  03460000
*                                                                       03470000
WORKAREA DSECT                                                          03480000
SAVEAREA DS    18F                                                      03490000
*                                                                       03500000
* REQUEST ELEMENT STRUCTURE                                             03510000
*                                                                       03520000
RQC      DSECT                                                          03530000
**CTV    COPY  CTORQC                                                   03540000
**CTSA   COPY  IOARQCP                                          *CTV    03540000
         COPY  CTSRQCP                                    *CTSA+*CTV    03540000
*                                                                IO0019 03500000
* REQUEST HEADER STRUCTURE                                       IO0019 03510000
*                                                                IO0019 03520000
RQH      DSECT                     HEADER OF RQC CHAIN DSECT     IO0019 03530000
**CTV    COPY  CTORQH                                            IO0019 03540000
**CTSA   COPY  IOARQH                                       *CTV+IO0019 03540000
         COPY  CTSARQH                                *CTSA+*CTV+IO0019 03540000
*                                                                IO0019 03520000
         END                                                            03560000
