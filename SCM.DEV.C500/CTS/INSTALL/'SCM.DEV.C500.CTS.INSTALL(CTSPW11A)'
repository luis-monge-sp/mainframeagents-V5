         TITLE 'SA-AGENT ICHPWX11 Exit for RACF online interceptor'     00010000
*********************************************************************** 00020000
****                                                               **** 00030000
****   SA-AGENT VERSION 4.0.XX                                     **** 00040000
****                                                               **** 00050000
****   (C) COPYRIGHT 1999-2000 Sailpoint Software Inc.             **** 00060000
****                                                               **** 00070000
*********************************************************************** 00080000
*                                                                     * 00090000
*********************************************************************** 00100000
*                                                                     * 00110000
* Module Name : CTSPW11A (Static Version)                             * 00120000
*                                                                     * 00130000
* Description : SA-Agent ICHPWX11 RACF exit ROUTINE for static        * 00140000
*               installation                                          * 00150000
* Function:                                                           * 00160000
*                                                                     * 00170000
*    ICHPWX11 is RACF new password phrase (passphrase) exit which     * 00180000
*    SA-Agent uses for passphrase syncronization support.             * 00190000
*    The exit intercepts passphrase changes that were generated by    * 00200000
*    the RACF commands 'ALTUSER' and 'PASSWORD', as well as when      * 00210000
*    the user changes his passphrase during LOGON, due to his/her     * 00220000
*    request or RACF request when passphrase interval time expires.   * 00230000
*    Once the exit intercept the passphrase change, it notifies of    * 00240000
*    the event to SA-Agent online interceptor server via cross        * 00250000
*    memory services.                                                 * 00260000
*                                                                     * 00270000
* Attributes  : the exit module should be link-edited with RMODE ANY  * 00280000
*               and AMODE 31, reusable and reentrable.                * 00290000
*                                                                     * 00300000
* Environment : The exit receives control in problem state and PSW    * 00310000
*               key 8 when called from 'ADDUSER', 'ALTUSER' or        * 00320000
*               'PASSWORD' commands.                                  * 00330000
*               When called from RACROUTE REQUEST=VERIFY processing,  * 00340000
*               (i.e. when user is requested to change passphrase),   * 00350000
*               it receives control in Supervisor state and key zero  * 00360000
*                                                                     * 00370000
* Restrictions : None                                                 * 00380000
*                                                                     * 00390000
* Register usage :  R0  - Temporary work register                     * 00400000
*                   R1  - Temporary work register                     * 00410000
*                   R2  - saved storage key                           * 00420000
*                   R3  -> PWX2PL RACF's DSECT                        * 00430000
*                   R4  -> new password                               * 00440000
*                   R5  -  length register                            * 00450000
*                   R6  -  user-id                                    * 00460000
*                   R7  -  not used                                   * 00470000
*                   R8  -> not used                                   * 00480000
*                   R9  -> not used                                   * 00490000
*                   R10 -> not used                                   * 00500000
*                   R11 -> not used                                   * 00510000
*                   R12 -> program base                               * 00520000
*                   R13 -> Dynamic Work Area (save area)              * 00530000
*                   R14 -  return address                             * 00540000
*                   R15 -  return code                                * 00550000
*                                                                     * 00560000
* Input :                                                             * 00570000
*                                                                     * 00580000
*    Register 1 points to a RACF password phrase exit parameter list  * 00590000
*    which is mapped by the PWX2PL control block (ICHPWX2 marco)      * 00600000
*                                                                     * 00610000
* Output:                                                             * 00620000
*                                                                     * 00630000
*    This exit always returns a Return Code of 0.                     * 00640000
*                                                                     * 00650000
* CHANGE ACTIVITY :                                                   * 00660000
*                                                                     * 00670000
*    01/10/17 MS Created                                              * 00680000
*                                                                     * 00690000
*********************************************************************** 00700000
         SYSSTATE ARCHLVL=2                                             00710000
*=====================================================================* 00720000
*               C  T  S  P  W  1  1                                   * 00730000
*               ===================                                   * 00740000
*=====================================================================* 00750000
*----------------------*                                                00760000
* Globals and  Equates *                                                00770000
*----------------------*                                                00780000
FF       EQU   X'FF'                                                    00790000
BLANK    EQU   C' '                                                     00800000
CSASUBP  EQU   241                                                      00810000
*                                                                       00820000
R0       EQU   0                                                        00830000
R1       EQU   1                                                        00840000
R2       EQU   2                                                        00850000
R3       EQU   3                                                        00860000
R4       EQU   4                                                        00870000
R5       EQU   5                                                        00880000
R6       EQU   6                                                        00890000
R7       EQU   7                                                        00900000
R8       EQU   8                                                        00910000
R9       EQU   9                                                        00920000
R10      EQU   10                                                       00930000
R11      EQU   11                                                       00940000
R12      EQU   12                                                       00950000
R13      EQU   13                                                       00960000
R14      EQU   14                                                       00970000
R15      EQU   15                                                       00980000
*---------------------------------------------------------------------* 00990000
CTSPW11A CSECT ,                                                        01000000
CTSPW11A AMODE 31                                                       01010000
CTSPW11A RMODE ANY                                                      01020000
         SAVE  (14,12),,CTSPW11A-&SYSDATE-&SYSTIME                      01030000
         LR    R12,R15                                                  01040000
         USING CTSPW11A,R12                                             01050000
         LR    R3,R1                   R3  -> Parameters List           01060000
         USING PWX2PL,R3               ..Addressability                 01070000
         CTSLEVEL ,                                                     01080000
*--------------------------------------------------------------*        01090000
*        if new passphrase does not exist - return             *        01100000
*--------------------------------------------------------------*        01110000
         ICM   R4,15,PWX2NEW           new passphrase given?            01120000
         JZ    RETURN                  ..no,  return                    01130000
         CLI   0(R4),0                 is there a new passphrase?       01140000
         JE    RETURN                  no, return                       01150000
*                                                                       01160000
*        R4->  new PassPhrase          must be saved for future         01170000
*                                                                       01180000
         ICM   R6,15,PWX2USER          User-ID passed ?                 01190000
         JZ    RETURN                  ..no,  exit                      01200000
         CLI   0(R6),0                 is it a real user-id?            01210000
         JE    RETURN                  ..no,  exit                      01220000
*                                                                       01230000
*        R6->  User-ID                 must be saved for future         01240000
*                                                                       01250000
*--------------------------------------------------------------*        01260000
*        Obtain Dynamic Work Area                              *        01270000
*--------------------------------------------------------------*        01280000
GETWORK  DS    0H                                                       01290000
         GETMAIN RC,LV=WSASIZE,LOC=ANY                                  01300000
         LTR   R15,R15                                                  01310000
         JZ    CHAINSA                                                  01320000
         WTO   'CTSPW11A: GETMAIN FAILED ERROR'                         01330000
         J     RETURN                                                   01340000
*--------------------------------------------------------------*        01350000
*        Chain Save Area                                                01360000
*--------------------------------------------------------------*        01370000
CHAINSA  DS    0H                                                       01380000
         ST    R1,8(0,R13)             chain...                         01390000
         ST    R13,4(0,R1)             ...save areas                    01400000
         LR    R13,R1                  R13->Dynamic Work Area           01410000
*                                                                       01420000
         USING WSA,R13                 Establish Addressability         01430000
*--------------------------------------------------------------*        01440000
*        PWX11 might be invoked in PROB state, should be SUP   *        01450000
*--------------------------------------------------------------*        01460000
         MVI   WSASTAT,C'S'            default is SUP state             01470000
*@DBG    MVC   WTOAREA(WTO1L),WTO1                                      01480000
*@DBG    MVC   WTOAREA+4+19(4),=CL4'SUP'                                01490000
         TESTAUTH STATE=YES,RBLEVEL=1  is it?                           01500000
         LTR   R15,R15                 check it out                     01510000
         JZ    SETKEY0                 yes, it is in SUP mode           01520000
         MVI   WSASTAT,C'P'            no, it is in PROB. Keep it       01530000
*@DBG    MVC   WTOAREA+4+19(4),=CL4'PROB'                               01540000
         MODESET MODE=SUP              change to SUPervisor state       01550000
SETKEY0  DS    0H                                                       01560000
         MODESET SAVEKEY=(2)           save storage key                 01570000
         ST    R2,WSASKY               save it                          01580000
*----------------------------------------------------------------*      01590000
*        Debug - Displaying the SUP/PROB mode and new passphrase *      01600000
*----------------------------------------------------------------*      01610000
*@DBG    WTO   MF=(E,WTOAREA)                                           01620000
*@DBG    MVC   WTOAREA(WTO2L),WTO2                                      01630000
*@DBG    XR    R1,R1                                                    01640000
*@DBG    IC    R1,0(0,R4)                                               01650000
*@DBG    CHI   R1,WTO2L-23                                              01660000
*@DBG    JL    GOWTO2                                                   01670000
*@DBG    LHI   R1,WTO2L-23                                              01680000
*@DBG    GOWTO2   BCTR  R1,0                                            01690000
*@DBG    MVC   WTOAREA+4+19(*-*),1(R4)                                  01700000
*@DBG    EX    R1,*-6                                                   01710000
*@DBG    WTO   MF=(E,WTOAREA)                                           01720000
*----------------------------------------------------------------*      01730000
*        Inform ESTAE exit                                       *      01740000
*----------------------------------------------------------------*      01750000
         XC    ABNDCODE,ABNDCODE       CLEAR ABEND CODE                 01760000
         MVC   WRKESTAE,LSTESTAE                                        01770000
         ESTAE ABNDEXIT,PARAM=WSA,TERM=YES,MF=(E,WRKESTAE)              01780000
*----------------------------------------------------------------*      01790000
*        Build RQC and EVT                                       *      01800000
*----------------------------------------------------------------*      01810000
         LA    R0,RQCAREA              CLEAR THE AREA                   01820000
         LA    R1,RQCLEN               SET LENGTH                       01830000
         XR    R15,R15                 PADD WITH X'00'                  01840000
         MVCL  R0,R14                  CLEAR                            01850000
         USING RQC,RQCAREA             MAP RQC AREA                     01860000
         MVI   RQCTYPE,RQCTNOTX        SET RQC TYPE TO NOTIFY           01870000
         TIME  DEC                     GET TIME                         01880000
         STM   R0,R1,RQCTSTMP          TIMESTAMP RQC                    01890000
*                                                                       01900000
*        build EVT                                                      01910000
*                                                                       01920000
         USING EVT,RQCEVT              MAP EVENT BLOCK                  01930000
         MVC   EVTEVT,=CL4'EVT '       SET EVENT BLOCK EYE CATCHER      01940000
         MVC   EVTFLAG,=A(EVTFULL)     SET EVT INFO ON                  01950000
         MVI   EVTTYPE,EVTTUSER        TYPE = USER                      01960000
         MVI   EVTACT,EVTAPPH          ACTION = PASSphrase CHANGE       01970000
*                                                                       01980000
         TIME  BIN                                                      01990000
         ST    R0,EVTTIME              EVENT TIME STAMP                 02000000
         ST    R1,EVTDATE              EVENT TIME STAMP                 02010000
*                                                                       02020000
*        Inform EVT the caller type (LOGON, ALTUSER, PASSWORD)          02030000
*                                                                       02040000
         L     R1,PWX2CLLR            R1 -> Calling function identity   02050000
         MVI   EVTPHCLR,EVTPH$OT      default caller is 'OTHER'         02060000
         CLI   0(R1),PWX2RINI         Comes from LOGON                  02070000
         JNE   *+8                    ..no, leave default               02080000
         MVI   EVTPHCLR,EVTPH$LG      ..yes, it is from LOGON           02090000
*                                                                       02100000
*        Originator User-ID                                             02110000
*                                                                       02120000
         L     R1,PSATOLD-PSA         R1 -> CURRENT TCB                 02130000
         ICM   R1,15,TCBSENV-TCB(R1)  R1 -> TASK ACEE                   02140000
         JNZ   COPYOUID               HAVE IT, COPY TO EVT              02150000
         L     R1,PSAAOLD-PSA         R1 -> CURRENT ASCB                02160000
         L     R1,ASCBASXB-ASCB(R1)   R1 -> ASXB                        02170000
         ICM   R1,15,ASXBSENV-ASXB(R1) R1 -> ADDRESS SPACE ACEE         02180000
         JZ    SKIPOUID               NO, FAIL TO FIND AN ACEE          02190000
COPYOUID DS    0H                                                       02200000
         MVC   EVTOUID,ACEEUSRI-ACEE(R1) COPY UID FROM ACEE             02210000
SKIPOUID DS    0H                                                       02220000
*                                                                       02230000
*        Copy originator Jobname                                        02240000
*                                                                       02250000
         L     R1,PSAAOLD-PSA          R1 -> ASCB                       02260000
         USING ASCB,R1                 ASCB ADDRESS ABILITY             02270000
         ICM   R15,15,ASCBJBNI         JOBNAME EXISTS ?                 02280000
         JNZ   COPYOJBN                YES, THEN COPY IT                02290000
         ICM   R15,15,ASCBJBNS         STCNAME EXISTS ?                 02300000
         JZ    SKIPOJBN                NO, NOTHING CAN BE COPIED        02310000
COPYOJBN DS    0H                                                       02320000
         MVC   EVTOJBN,0(R15)          COPY JOBNAME/STCNAME             02330000
SKIPOJBN DS    0H                                                       02340000
         DROP  R1                      DONE WITH ASCB                   02350000
*                                                                       02360000
*        Copy originator progname (Jobstep TCB, oldest RB)              02370000
*                                                                       02380000
         L     R1,PSATOLD-PSA          R1 -> CURRENT TCB                02390000
         ICM   R15,15,TCBJSTCB-TCB(R1) R15 -> JOBSTEP TCB               02400000
         JZ    PROGRB                  NO, SAY WITH CURRENT TCB         02410000
         LR    R1,R15                  R1 -> JOB STEP TCB               02420000
PROGRB   DS    0H                                                       02430000
         L     R15,TCBRBP-TCB(,R1)     R15 -> NEWEST RB FOR TCB         02440000
         USING RBBASIC,R15             MAP RB                           02450000
LOOPPROG DS    0H                                                       02460000
         XR    R14,R14                 CLEAR TO BE SURE                 02470000
         ICM   R14,7,RBLINKB           R14 -> PREVIOUS RB IN CHAIN      02480000
         JZ    SKIPPROG                NO, DEAD END                     02490000
         CR    R1,R14                  IS RB THE OLDEST ?               02500000
         JE    COPYPROG                YES, COPY PROGNAME               02510000
         LR    R15,R14                 KEEP LOOKING FOR OLDEST RB       02520000
         J     LOOPPROG                                                 02530000
COPYPROG DS    0H                                                       02540000
         XR    R1,R1                   CLEAR R1                         02550000
         ICM   R1,7,RBCDE1             R1  -> CDE                       02560000
         MVC   EVTOPROG,CDNAME-CDENTRY(R1) COPY PROGNAME FROM CDE       02570000
         L     R1,PWX2CLLR            R1 -> Calling function identity   02580000
         CLI   0(R1),PWX2ALTU         Comes from ALTUSER                02590000
         JNE   SKIPALU                ..no, leave default               02600000
         MVC   EVTOPROG,=C'ALTUSER '  YES - MOVE INDICATION             02610000
SKIPALU  DS    0H                                                       02620000
SKIPPROG DS    0H                                                       02630000
         DROP  R15                                                      02640000
*                                                                       02650000
*        copy UserID                                                    02660000
*                                                                       02670000
         MVC   EVTUSER,=CL8' '         USERID SHOULD BE BLANK PADDED    02680000
         XR    R5,R5                   PREPARE FOR 'IC'                 02690000
         IC    R5,0(0,R6)              R5 = LENGTH OF USER ID           02700000
         BCTR  R5,0                    ADJUST USERID LENGTH FOR 'EX'    02710000
         MVC   EVTUSER(*-*),1(R6)      DUMMY CODE FOR 'EX'              02720000
         EX    R5,*-6                  COPY THE USERID TO EVT           02730000
*                                                                       02740000
*        copy new PassPhrase                                            02750000
*                                                                       02760000
         XR    R5,R5                   PREPARE FOR 'IC'                 02770000
         IC    R5,0(0,R4)              R5 = NEW PASSPHRASE LENGTH       02780000
         AHI   R5,1                    + one byte of length             02790000
         LA    R0,EVTPWPH-1            R0-> second byte of length       02800000
         LA    R1,L'EVTPWPH            R1=destination length            02810000
         MVCL  R0,R4                   move length + passphrase         02820000
*                                      ..and also padd with nulls       02830000
*                                      ..because R5's high order byte   02840000
*                                      ..is null                        02850000
*----------------------------------------------------------------*      02860000
*        Notify server via PC routine                            *      02870000
*----------------------------------------------------------------*      02880000
         CALL  CTSAPCC,(FUJIFLAG,                                      X02890000
               SSNAME,                                                 X02900000
               JOBNAME,                                                X02910000
               RQCAREA,                                                X02920000
               PCCWORK),                                               X02930000
               MF=(E,CALLAREA)                                          02940000
         LTR   R15,R15                 REQUEST PASSED SUCCESSFULLY ?    02950000
         JZ    CLEANUP                 YES, CONITNUE                    02960000
*                                                                       02970000
         CHI   R15,8                   FREE CHAIN EXISTS ?              02980000
         JE    NOFRCHN                 NO, FREE CHAIN RUN OUT           02990000
*                                                                       03000000
         CHI   R15,160                 IS SERVER UP ?                   03010000
         JNH   CLEANUP                 NO, ERROR IN PC ROUTINE          03020000
****************************************************************        03030000
*        NOTIFY ROUTINE INTERNAL ERROR - ISSUE  ERROR MESSAGE           03040000
****************************************************************        03050000
         CVD   R15,PACKD               CONVERT RC                       03060000
         UNPK  CHARRC,PACKD            ... TO                           03070000
         OI    CHARRC+7,X'F0'          ... EBCDIC                       03080000
         MVC   WTOAREA(WTONTFYL),WTONTFY                                03090000
         MVC   WTOAREA+WTONTFYL-4(4),CHARRC+4                           03100000
         WTO   MF=(E,WTOAREA)                                           03110000
         J     CLEANUP                 FINISH                           03120000
*                                                                       03130000
NOFRCHN  DS    0H                                                       03140000
         MVC   WTOAREA(WTOEVTL),WTOEVT                                  03150000
         MVC   WTOAREA+22(L'EVTUSER),EVTUSER                            03160000
         WTO   MF=(E,WTOAREA)                                           03170000
         J     CLEANUP                                                  03180000
*----------------------------------------------------------------*      03190000
*        Issue ABEND message (if occured)                        *      03200000
*----------------------------------------------------------------*      03210000
CLEANUP  DS    0H                                                       03220000
         ICM   R2,15,ABNDCODE          R2 = ABEND CODE WORD             03230000
         JZ    NOABEND                 NO, NO ABEND                     03240000
         MVI   ABNDTYPE,C'U'           ASSUME USER ABEND                03250000
         N     R2,=XL4'00000FFF'       TEST FOR USER ABEND CODE         03260000
         JNZ   ABENDMSG                YES, HAVE USER ABEND CODE        03270000
         L     R2,ABNDCODE             R2 = ABEND CODE WORD             03280000
         SRL   R2,12                   ISOLATE SYSTEM ABEND CODE        03290000
         MVI   ABNDTYPE,C'S'           SET SYSTEM ABEND CODE            03300000
ABENDMSG DS    0H                                                       03310000
         ST    R2,ABNDBIN              SAVE BINARY ABEND CODE           03320000
         UNPK  ABNDCHAR(9),ABNDBIN(5)  CONVERT TO ZONED                 03330000
         TR    ABNDCHAR(8),HEX2CHAR    MAKE IT CHARACTER                03340000
         MVC   ABNDCHAR+4(1),ABNDTYPE  INSERT ABEND TYPE CHARACTER      03350000
         MVC   WTOAREA(WTOABNDL),WTOABND                                03360000
         MVC   WTOAREA+WTOABNDL-4(4),ABNDCHAR+4                         03370000
         WTO   MF=(E,WTOAREA)                                           03380000
NOABEND  DS    0H                                                       03390000
*                                                                       03400000
*        restoring state - PROB or SUP                                  03410000
*                                                                       03420000
         CLI   WSASTAT,C'P'            Have we received control ..      03430000
*                                      ..in PROB state?                 03440000
         JNE   INSUP                   ..no,                            03450000
         MODESET MODE=PROB             ..yes, restore PROB state        03460000
INSUP    DS    0H                                                       03470000
*--------------------------------------------------------------*        03480000
*        Clear Recovery Environment                            *        03490000
*--------------------------------------------------------------*        03500000
         ESTAE 0                                                        03510000
*--------------------------------------------------------------*        03520000
*        Release Dynamic Work Area                             *        03530000
*--------------------------------------------------------------*        03540000
         DROP  R13                                                      03550000
         LR    R1,R13                  ADDRESS FOR FREEMAIN             03560000
         L     R13,4(R13)              RESTORE CALLERS SAVE AREA        03570000
         LHI   R0,WSASIZE                                               03580000
         FREEMAIN RC,LV=(0),A=(1)                                       03590000
         LTR   R15,R15                                                  03600000
         JZ    RETURN                                                   03610000
         WTO   'CTSPW11A: FREEMAIN FAILED ERROR'                        03620000
*--------------------------------------------------------------*        03630000
*        Terminate to caller                                   *        03640000
*--------------------------------------------------------------*        03650000
RETURN   DS    0H                                                       03660000
         SR    R15,R15                 LOAD RETURN CODE                 03670000
         RETURN (14,12),T,RC=(15)      RESTORE REGISTERS AND RETURN     03680000
*                                                                       03690000
WTOABND  WTO   'CTSPW11A: SA-AGENT RACF EXIT ICHPWX11 HAS ABENDED.   AB*03700000
               END CODE=XXXX',MF=L                                      03710000
WTOABNDL EQU   *-WTOABND                                                03720000
*                                                                       03730000
*@DBG    WTO   'CTSPW11A: Entring in XXXX mode',MF=L,ROUTCDE=(2)        03740000
*@DBG    EQU   *-WTO1                                                   03750000
*                                                                       03760000
*@DBG    WTO   'NewPassPhrase:                                         X03770000
                                               ',MF=L,ROUTCDE=(2)       03780000
*@DBG    EQU   *-WTO2                                                   03790000
*                                                                       03800000
FUJIFLAG DC    AL1(128)                                                 03810000
LSTESTAE ESTAE MF=L                    LIST FORM FOR ESTAE              03820000
LENESTAE EQU   *-LSTESTAE                                               03830000
*                                                                       03840000
WTOEVT   WTO   'CTSPW11A: CHNG PPX <USERID> EVENT IS LOST. START AGENT *03850000
               ASAP TO EMPTY QUEUE AND MEMORY.',MF=L                    03860000
WTOEVTL  EQU   *-WTOEVT                                                 03870000
*                                                                       03880000
WTONTFY  WTO   'CTSPW11A: SA-AGENT ONLINE INTERCEPTOR NOTIFY HAS FAILED*03890000
                RC=XXXX',MF=L                                           03900000
WTONTFYL EQU   *-WTONTFY                                                03910000
*                                                                       03920000
HEXDIG   DC    CL16'0123456789ABCDEF'                                   03930000
HEX2CHAR EQU   HEXDIG-C'0'                                              03940000
SSNAME   DC    CL4'    '                                                03950000
JOBNAME  DC    CL8'CTSAONI'            CROSS MEMEORY JOBNAME            03960000
         LTORG ,                                                        03970000
*--------------------------------------------------------------*        03980000
*        Abend Exit (informed be ESTAE macro)                  *        03990000
*--------------------------------------------------------------*        04000000
         DROP  R12                                                      04010000
ABNDEXIT DS    0H                                                       04020000
         USING ABNDEXIT,R15            ABEND EXIT ADDRESSABILITY        04030000
         LARL  R12,CTSPW11A            RESTORE LMOD BASE REG            04040000
         DROP  R15                                                      04050000
         USING CTSPW11A,R12          RESTORE ITS ADDRESSABILITY         04060000
         CHI   R0,12                   SDWA PROVIDED ?                  04070000
         JE    NOSDWA                  NO, CAN NOT RETRY                04080000
         USING SDWA,R1                 MAP SDWA                         04090000
         L     R13,SDWAPARM            RESTORE WSA REGISTER             04100000
         USING WSA,R13                 MAP WSA                          04110000
         MVC   ABNDCODE,SDWAABCC       SET ABEND CODE                   04120000
         TM    SDWAERRD,SDWACLUP       RETRY ALLOWED ?                  04130000
         JNZ   NORETRY                 NO, CAN NOT RETRY                04140000
*                                                                       04150000
RETRY    DS    0H                                                       04160000
         ST    R12,SDWASR12            SET BASE REGISTER FOR RETRY      04170000
         ST    R13,SDWASR13            SET WSA REGISTER FOR RETRY       04180000
*                                                                       04190000
         STM   R14,R1,SAVEREGS                                          04200000
         SDUMP HDR='SA-AGENT ICHPWX11 RACF EXIT ABEND',                X04210000
               SDATA=(ALLPSA,CSA,LSQA,RGN,SUMDUMP)                      04220000
         LM    R14,R1,SAVEREGS                                          04230000
*                                                                       04240000
         SETRP RETREGS=YES,RC=4,RETADDR=CLEANUP,                       X04250000
               FRESDWA=YES,DUMP=YES                                     04260000
         BR    R14                                                      04270000
*                                                                       04280000
NOSDWA   DS    0H                                                       04290000
         LR    R13,R2                   NO SDWA, PARM IN R2             04300000
         ST    R1,ABNDCODE              SAVE ABEND CODE                 04310000
         XR    R1,R1                    CLEAR                           04320000
NORETRY  DS    0H                                                       04330000
         XR    R15,R15                  INDICATE NO RETRY               04340000
         BR    R14                      RETURN TO RTM                   04350000
         LTORG                                                          04360000
         DROP                                                           04370000
*---------------------------------------------------------------------* 04380000
*        CONTROL-SA/IOA CONTROL BLOCKS                                * 04390000
*---------------------------------------------------------------------* 04400000
RQC      DSECT                                                          04410000
         COPY  CTSRQC                  XMS REQUEST ELEMENT              04420000
EVT      DSECT                                                          04430000
         COPY  CTSEVT                  EVENT CONTROL BLOCK              04440000
*---------------------------------------------------------------------* 04450000
*        Dynamic Work Area DSECT                                      * 04460000
*---------------------------------------------------------------------* 04470000
WSA      DSECT   ,                Mapping of the Dynamic Save Area      04480000
         DS    18F                                                      04490000
WSAEYCT  DS    CL4                                                      04500000
CALLAREA CALL  ,(,,,,,,,,),MF=L        EXECUTE FORM CALL AREA           04510000
PCCWORK  DS    XL512                   WORK AREA FOR CTSAPCC ROUTINE    04520000
WSAR14   DS    A                                                        04530000
WSASKY   DS    F                                                        04540000
WRKESTAE DS    CL(LENESTAE)            EXECUTE FORM FOR ESTAE           04550000
SAVEREGS DS    15F                     TEMPORARY SAVE REGISTERS AREA    04560000
PACKD    DS    D                       RETURN CODE CONVERSION           04570000
CHARRC   DS    CL8                     RETURN CODE CONVERSION           04580000
RQCAREA  DS    CL(RQCLEN)              AREA FOR RQC                     04590000
WTOAREA  DS    XL384                   CTSMSG1 WTO WORK AREA            04600000
WSASTAT  DS    CL1                                                      04610000
         DS    0F                                                       04620000
ABNDCODE DS    XL4                     ABCODE SAVED BY ESTAE ROUTINE    04630000
ABNDBIN  DS    XL5                     ISOLATED ABEND CODE + PAD BYTE   04640000
ABNDTYPE DS    CL1                     ABEND TYPE (S/U)                 04650000
ABNDCHAR DS    CL9                     CHARCTER ABEND CODE FOR MSG      04660000
         DS    0D                                                       04670000
WSASIZE  EQU   *-WSA                                                    04680000
*---------------------------------------------------------------------* 04690000
* System Data Areas                                                   * 04700000
*---------------------------------------------------------------------* 04710000
         PRINT GEN                                                      04720000
         ICHPWX2                                                        04730000
         IHASDWA                                                        04740000
         IHAPSA                                                         04750000
         CVT   DSECT=YES                                                04760000
         IHAASCB                                                        04770000
         IHAASXB                                                        04780000
         IHAACEE                                                        04790000
         IKJTCB                                                         04800000
         IHARB                                                          04810000
         IHACDE                                                         04820000
******   ***** ***                                                      04830000
         END                                                            04840000
